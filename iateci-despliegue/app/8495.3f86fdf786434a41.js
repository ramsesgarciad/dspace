(self.webpackChunkdspace_angular=self.webpackChunkdspace_angular||[]).push([[8495],{80495:(O,T,o)=>{"use strict";o.d(T,{Q:()=>s});class s{constructor(f,c){this.text=f,this.url=c}}},59072:(O,T,o)=>{"use strict";o.d(T,{S:()=>I});var s=o(54438),m=o(89777),f=o(54034),c=o(7673),R=o(80495);let D=(()=>{class g{getBreadcrumbs(M,r){return(0,c.of)([new R.Q(M+".breadcrumbs",r)])}static{this.\u0275fac=function(r){return new(r||g)}}static{this.\u0275prov=s.jDH({token:g,factory:g.\u0275fac,providedIn:"root"})}}return g})();const I=(g,p,M=(0,s.WQX)(D))=>{const r=g.data.breadcrumbKey;if((0,m.Tn)(r))throw new Error('You provided an i18nBreadcrumbResolver for url "'+g.url+"\" but no breadcrumbKey in the route's data");return{provider:M,key:r,url:(0,f.F)(g)}}},18892:(O,T,o)=>{"use strict";o.r(T),o.d(T,{ProfilePageMetadataFormComponent:()=>F});var s=o(1473),m=o(84418),f=o.n(m),c=o(78544),R=o(13817),D=(o(89253),o(4093)),I=o(89777),g=o(49838),p=o(86332),M=o(9847),r=o(54438),u=o(68018);function P(b,U){if(1&b&&r.nrm(0,"ds-form",0),2&b){const h=r.XpG();r.Y8G("formId","profile-page-metadata-form-id")("formModel",h.formModel)("formGroup",h.formGroup)("displaySubmit",!1)("displayCancel",!1)}}let F=(()=>{class b{constructor(h,E,v,S){this.formBuilderService=h,this.translate=E,this.epersonService=v,this.notificationsService=S,this.formModel=[new s.rA_({id:"email",name:"email",readOnly:!0,disabled:!0}),new s.rA_({id:"firstname",name:"eperson.firstname",required:!0,validators:{required:null},errorMessages:{required:"This field is required"},autoComplete:"given-name"}),new s.rA_({id:"lastname",name:"eperson.lastname",required:!0,validators:{required:null},errorMessages:{required:"This field is required"},autoComplete:"family-name"}),new s.rA_({id:"phone",name:"eperson.phone",autoComplete:"tel"}),new s.z4z({id:"language",name:"eperson.language"})],this.LABEL_PREFIX="profile.metadata.form.label.",this.ERROR_PREFIX="profile.metadata.form.error.",this.NOTIFICATION_PREFIX="profile.metadata.form.notifications."}ngOnInit(){this.activeLangs=c.c.languages.filter(h=>!0===h.active),this.setFormValues(),this.updateFieldTranslations(),this.translate.onLangChange.subscribe(()=>{this.updateFieldTranslations()})}setFormValues(){this.formModel.forEach(h=>{h.value="email"===h.name?this.user.email:this.user.firstMetadataValue(h.name),"language"===h.id&&(h.options=this.activeLangs.map(E=>Object.assign({value:E.code,label:E.label})))}),this.formGroup=this.formBuilderService.createFormGroup(this.formModel)}updateFieldTranslations(){this.formModel.forEach(h=>{h.label=this.translate.instant(this.LABEL_PREFIX+h.id),(0,I.hj)(h.validators)&&(h.errorMessages={},Object.keys(h.validators).forEach(E=>{h.errorMessages[E]=this.translate.instant(this.ERROR_PREFIX+h.id+"."+E)}))})}updateProfile(){if(!this.formGroup.valid)return!1;const h=f()(this.user.metadata);let E=!1;return this.formModel.filter(v=>"email"!==v.id).forEach(v=>{h.hasOwnProperty(v.name)&&h[v.name].length>0?(0,I.a4)(v.value)?h[v.name][0].value!==v.value&&(h[v.name][0].value=v.value,E=!0):(h[v.name]=[],E=!0):(0,I.a4)(v.value)&&(h[v.name]=[{value:v.value,language:null}],E=!0)}),E&&this.epersonService.update(Object.assign(f()(this.user),{metadata:h})).pipe((0,D.yd)(),(0,D.Bo)()).subscribe(v=>{this.user=v,this.setFormValues(),this.notificationsService.success(this.translate.instant(this.NOTIFICATION_PREFIX+"success.title"),this.translate.instant(this.NOTIFICATION_PREFIX+"success.content"))}),E}static{this.\u0275fac=function(E){return new(E||b)(r.rXU(g.j),r.rXU(u.c$),r.rXU(R.EPersonDataService),r.rXU(M.I))}}static{this.\u0275cmp=r.VBU({type:b,selectors:[["ds-base-profile-page-metadata-form"]],inputs:{user:"user"},standalone:!0,features:[r.aNF],decls:1,vars:1,consts:[[3,"formId","formModel","formGroup","displaySubmit","displayCancel"]],template:function(E,v){1&E&&r.DNE(0,P,1,5,"ds-form",0),2&E&&r.vxM(v.formModel?0:-1)},dependencies:[p.s],encapsulation:2})}}return b})()},39650:(O,T,o)=>{"use strict";o.d(T,{O:()=>D}),o(89253);var m=o(29710),c=(o(18892),o(54438));const R=["*"];function C(I,g){}let D=(()=>{class I extends m.J{constructor(){super(...arguments),this.inAndOutputNames=["user"]}getComponentName(){return"ProfilePageMetadataFormComponent"}importThemedComponent(p){return o(46020)(`./${p}/app/profile-page/profile-page-metadata-form/profile-page-metadata-form.component`)}importUnthemedComponent(){return Promise.resolve().then(o.bind(o,18892))}static{this.\u0275fac=(()=>{let p;return function(r){return(p||(p=c.xGo(I)))(r||I)}})()}static{this.\u0275cmp=c.VBU({type:I,selectors:[["ds-profile-page-metadata-form"]],inputs:{user:"user"},standalone:!0,features:[c.Vt3,c.aNF],ngContentSelectors:R,decls:5,vars:0,consts:[["vcr",""],["content",""]],template:function(M,r){1&M&&(c.NAR(),c.DNE(0,C,0,0,"ng-template",null,0,c.C5r),c.j41(2,"div",null,1),c.SdG(4),c.k0s())},encapsulation:2})}}return I})()},22370:(O,T,o)=>{"use strict";o.d(T,{g:()=>ee});var s=o(60177),m=o(68018),f=o(84786),c=o(84412),R=o(96697),C=o(25558),D=o(96354),I=o(88141),g=o(73028),p=o(94196),r=(o(89253),o(89894)),u=o(4093),P=o(79104),F=o(3116),b=o(89777),U=o(9847),h=o(4600),E=o(50186),v=o(7673),S=o(94314),x=o(34180),L=o(30726),e=o(54438);let $=(()=>{class i{constructor(n){this.searchService=n}hasProfilesToSuggest(n){return this.searchForSuggestions(n).pipe((0,u.qD)(),(0,D.T)(a=>(0,b.hj)(a)&&a.hasSucceeded&&a.payload?.page?.length>0))}searchForSuggestions(n){const a=this.personQueryData(n);return(0,b.Im)(a)?(0,v.of)((0,x.Wh)()):this.lookup(a)}lookup(n){return(0,b.Im)(n)?(0,v.of)((0,x.Wh)()):this.searchService.search(new L.C({configuration:"eperson_claims",query:n}),null,!1,!0)}personQueryData(n){return n&&n.email?"person.email:"+n.email:null}static{this.\u0275fac=function(a){return new(a||i)(e.KVO(S.S))}}static{this.\u0275prov=e.jDH({token:i,factory:i.\u0275fac,providedIn:"root"})}}return i})();var k=o(43446),j=(o(73685),o(19192)),t=o(92767),N=o(44905),X=o(79669),G=o(8447),A=o(58003),y=o(7901);function V(i,_){if(1&i){const n=e.RV6();e.j41(0,"div",7)(1,"button",14,0),e.bIt("click",function(){const l=e.eBV(n).$implicit,d=e.XpG();return e.Njj(d.selectItem(l.indexableObject))}),e.nrm(3,"ds-listable-object-component-loader",15),e.k0s()()}if(2&i){const n=_.$implicit,a=e.XpG();e.R7$(),e.FS9("title",a.dsoNameService.getName(n.indexableObject)),e.R7$(2),e.Y8G("object",n)("viewMode",a.viewMode)("linkType",a.linkTypes.None)}}let W=(()=>{class i extends N.${constructor(n,a,l,d,B){super(n,a),this.activeModal=n,this.route=a,this.router=l,this.profileClaimService=d,this.dsoNameService=B,this.listEntries$=new c.t(null),this.viewMode=j.n.ListElement,this.linkTypes=X.n,this.checked=!1,this.create=new e.bkB}ngOnInit(){this.profileClaimService.searchForSuggestions(this.dso).pipe((0,u.qD)()).subscribe(n=>this.listEntries$.next(n))}selectItem(n){this.close(),this.navigate(n)}navigate(n){this.router.navigate([(0,t._o)(n)])}toggleCheckbox(){this.checked=!this.checked}createFromScratch(){this.create.emit(),this.close()}static{this.\u0275fac=function(a){return new(a||i)(e.rXU(A.Lw),e.rXU(y.nX),e.rXU(y.Ix),e.rXU($),e.rXU(k.f))}}static{this.\u0275cmp=e.VBU({type:i,selectors:[["ds-profile-claim-item-modal"]],inputs:{dso:"dso"},outputs:{create:"create"},standalone:!0,features:[e.Vt3,e.aNF],decls:26,vars:16,consts:[["listEntryElement",""],[1,"modal-header"],["type","button","aria-label","Close",1,"btn-close",3,"click"],[1,"modal-body"],["role","alert",1,"alert","alert-info"],[1,"dropdown-divider"],[1,"scrollable-menu","list-group","container"],[1,"row"],[1,"col-md","mt-2"],[1,"modal-footer"],[1,"me-5"],["type","checkbox",3,"change","checked"],["type","submit",1,"btn","btn-primary","ms-5","me-2",3,"click","dsBtnDisabled"],[1,"fas","fa-plus"],[1,"list-group-item","list-group-item-action","border-0","list-entry",3,"click","title"],[3,"object","viewMode","linkType"]],template:function(a,l){if(1&a&&(e.j41(0,"div")(1,"div",1)(2,"h4"),e.EFF(3),e.nI1(4,"translate"),e.k0s(),e.j41(5,"button",2),e.bIt("click",function(){return l.close()}),e.k0s()(),e.j41(6,"div",3)(7,"div",4),e.EFF(8),e.nI1(9,"translate"),e.k0s(),e.nrm(10,"div",5),e.j41(11,"div",6),e.Z7z(12,V,4,4,"div",7,e.fX1),e.nI1(14,"async"),e.j41(15,"div",7),e.nrm(16,"div",8),e.k0s()()(),e.j41(17,"div",9)(18,"div",10)(19,"input",11),e.bIt("change",function(){return l.toggleCheckbox()}),e.k0s(),e.EFF(20),e.nI1(21,"translate"),e.k0s(),e.j41(22,"button",12),e.bIt("click",function(){return l.createFromScratch()}),e.nrm(23,"i",13),e.EFF(24),e.nI1(25,"translate"),e.k0s()()()),2&a){let d;e.R7$(3),e.JRh(e.bMT(4,6,"dso-selector.claim.item.head")),e.R7$(5),e.SpI(" ",e.bMT(9,8,"dso-selector.claim.item.body")," "),e.R7$(4),e.Dyx(null==(d=e.bMT(14,10,l.listEntries$))?null:d.payload.page),e.R7$(7),e.Y8G("checked",l.checked),e.R7$(),e.SpI(" ",e.bMT(21,12,"dso-selector.claim.item.not-mine-label")," "),e.R7$(2),e.Y8G("dsBtnDisabled",!l.checked),e.R7$(2),e.SpI(" ",e.bMT(25,14,"dso-selector.claim.item.create-from-scratch")," ")}},dependencies:[s.Jj,P.A,G.v,m.h,m.D9],encapsulation:2})}}return i})();function K(i,_){if(1&i){const n=e.RV6();e.j41(0,"div")(1,"p"),e.EFF(2),e.nI1(3,"translate"),e.k0s(),e.j41(4,"p",2)(5,"span",3),e.EFF(6),e.nI1(7,"translate"),e.k0s(),e.j41(8,"ui-switch",4),e.nI1(9,"translate"),e.nI1(10,"translate"),e.bIt("change",function(){e.eBV(n);const l=e.XpG().ngVar,d=e.XpG();return e.Njj(d.toggleProfileVisibility(l))}),e.k0s()()()}if(2&i){const n=e.XpG().ngVar;e.R7$(2),e.JRh(e.bMT(3,5,"researcher.profile.associated")),e.R7$(4),e.JRh(e.bMT(7,7,"researcher.profile.status")),e.R7$(2),e.Y8G("checkedLabel",e.bMT(9,9,"researcher.profile.public.visibility"))("uncheckedLabel",e.bMT(10,11,"researcher.profile.private.visibility"))("checked",n.visible)}}function w(i,_){1&i&&(e.j41(0,"div")(1,"p"),e.EFF(2),e.nI1(3,"translate"),e.k0s()()),2&i&&(e.R7$(2),e.JRh(e.bMT(3,1,"researcher.profile.not.associated")))}function z(i,_){1&i&&(e.j41(0,"span"),e.nrm(1,"i",6),e.EFF(2),e.nI1(3,"translate"),e.k0s()),2&i&&(e.R7$(2),e.SpI(" ",e.bMT(3,1,"researcher.profile.action.processing")," "))}function Y(i,_){1&i&&(e.j41(0,"span"),e.nrm(1,"i",7),e.EFF(2),e.nI1(3,"translate"),e.k0s()),2&i&&(e.R7$(2),e.SpI(" \xa0",e.bMT(3,1,"researcher.profile.create.new")," "))}function J(i,_){if(1&i){const n=e.RV6();e.SS7(0),e.nI1(1,"async"),e.j41(2,"button",5),e.bIt("click",function(){e.eBV(n);const l=e.XpG(2);return e.Njj(l.createProfile())}),e.DNE(3,z,4,3,"span")(4,Y,4,3,"span"),e.k0s()}if(2&i){const n=e.bMT(1,2,e.XpG(2).processingCreate$);e.R7$(2),e.Y8G("dsBtnDisabled",n),e.R7$(),e.vxM(n?3:4)}}function Q(i,_){1&i&&(e.j41(0,"span"),e.nrm(1,"i",6),e.EFF(2),e.nI1(3,"translate"),e.k0s()),2&i&&(e.R7$(2),e.SpI(" ",e.bMT(3,1,"researcher.profile.action.processing")," "))}function H(i,_){1&i&&(e.j41(0,"span"),e.nrm(1,"i",10),e.EFF(2),e.nI1(3,"translate"),e.k0s()),2&i&&(e.R7$(2),e.SpI(" \xa0",e.bMT(3,1,"researcher.profile.delete")," "))}function Z(i,_){if(1&i){const n=e.RV6();e.j41(0,"button",5),e.bIt("click",function(){e.eBV(n);const l=e.XpG().ngVar,d=e.XpG();return e.Njj(d.viewProfile(l))}),e.nrm(1,"i",8),e.EFF(2),e.nI1(3,"translate"),e.k0s(),e.j41(4,"button",9),e.bIt("click",function(){e.eBV(n);const l=e.XpG().ngVar,d=e.XpG();return e.Njj(d.deleteProfile(l))}),e.DNE(5,Q,4,3,"span"),e.nI1(6,"async"),e.DNE(7,H,4,3,"span"),e.k0s()}if(2&i){const n=e.XpG().ngVar,a=e.XpG();e.Y8G("dsBtnDisabled",!n),e.R7$(2),e.SpI(" ",e.bMT(3,4,"researcher.profile.view")," "),e.R7$(2),e.Y8G("dsBtnDisabled",!n),e.R7$(),e.vxM(e.bMT(6,6,a.processingDelete$)?5:7)}}function q(i,_){if(1&i&&(e.j41(0,"div"),e.DNE(1,K,11,13,"div")(2,w,4,3,"div")(3,J,5,4,"button",1)(4,Z,8,8),e.k0s()),2&i){const n=_.ngVar;e.R7$(),e.vxM(n?1:-1),e.R7$(),e.vxM(n?-1:2),e.R7$(),e.vxM(n?-1:3),e.R7$(),e.vxM(n?4:-1)}}let ee=(()=>{class i{constructor(n,a,l,d,B,te,ne){this.researcherProfileService=n,this.profileClaimService=a,this.translationService=l,this.notificationService=d,this.authService=B,this.router=te,this.modalService=ne,this.researcherProfile$=new c.t(null),this.processingDelete$=new c.t(!1),this.processingCreate$=new c.t(!1)}ngOnInit(){this.initResearchProfile()}createProfile(){this.processingCreate$.next(!0),this.authService.getAuthenticatedUserFromStore().pipe((0,R.s)(1),(0,C.n)(n=>this.profileClaimService.hasProfilesToSuggest(n))).subscribe(n=>{if(n){this.processingCreate$.next(!1);const a=this.modalService.open(W);a.componentInstance.dso=this.user,a.componentInstance.create.pipe((0,R.s)(1)).subscribe(()=>{this.createProfileFromScratch()})}else this.createProfileFromScratch()})}viewProfile(n){null!=this.researcherProfileItemId&&this.router.navigate(["items",this.researcherProfileItemId])}deleteProfile(n){const a=this.modalService.open(F.M);a.componentInstance.headerLabel="confirmation-modal.delete-profile.header",a.componentInstance.infoLabel="confirmation-modal.delete-profile.info",a.componentInstance.cancelLabel="confirmation-modal.delete-profile.cancel",a.componentInstance.confirmLabel="confirmation-modal.delete-profile.confirm",a.componentInstance.brandColor="danger",a.componentInstance.confirmIcon="fas fa-trash",a.componentInstance.response.pipe((0,R.s)(1)).subscribe(l=>{l&&(this.processingDelete$.next(!0),this.researcherProfileService.delete(n.id).pipe((0,u.qD)(),(0,D.T)(d=>d.isSuccess)).subscribe(d=>{d&&(this.researcherProfile$.next(null),this.researcherProfileItemId=null),this.processingDelete$.next(!1)}))})}toggleProfileVisibility(n){this.researcherProfileService.setVisibility(n,!n.visible).pipe((0,u.qD)()).subscribe(a=>{a.hasSucceeded?this.researcherProfile$.next(a.payload):this.notificationService.error(null,this.translationService.get("researcher.profile.change-visibility.fail"))})}createProfileFromScratch(){this.processingCreate$.next(!0),this.researcherProfileService.create().pipe((0,u.qD)()).subscribe(n=>{this.processingCreate$.next(!1),n.isSuccess?(this.initResearchProfile(),this.notificationService.success(null,this.translationService.get("researcher.profile.create.success"))):this.notificationService.error(null,this.translationService.get("researcher.profile.create.fail"))})}initResearchProfile(){this.researcherProfileService.findById(this.user.id,!1,!0,(0,h.s)("item")).pipe((0,u.ak)(),(0,I.M)(n=>this.researcherProfile$.next(n)),(0,g.Z)(n=>this.researcherProfileService.findRelatedItemId(n))).subscribe(n=>{(0,b.hj)(n)&&(this.researcherProfileItemId=n)})}static{this.\u0275fac=function(a){return new(a||i)(e.rXU(r.ResearcherProfileDataService),e.rXU($),e.rXU(m.c$),e.rXU(U.I),e.rXU(p.uR),e.rXU(y.Ix),e.rXU(A.Bq))}}static{this.\u0275cmp=e.VBU({type:i,selectors:[["ds-profile-page-researcher-form"]],inputs:{user:"user"},standalone:!0,features:[e.aNF],decls:2,vars:3,consts:[[4,"ngVar"],[1,"btn","btn-primary","me-2",3,"dsBtnDisabled"],[1,"align-items-center","researcher-profile-switch"],[1,"me-3"],[3,"change","checkedLabel","uncheckedLabel","checked"],[1,"btn","btn-primary","me-2",3,"click","dsBtnDisabled"],[1,"fas","fa-circle-notch","fa-spin"],[1,"fas","fa-plus"],[1,"fas","fa-info-circle"],[1,"btn","btn-danger",3,"click","dsBtnDisabled"],[1,"fas","fa-trash-alt"]],template:function(a,l){1&a&&(e.DNE(0,q,5,4,"div",0),e.nI1(1,"async")),2&a&&e.Y8G("ngVar",e.bMT(1,1,l.researcherProfile$))},dependencies:[s.Jj,P.A,m.h,m.D9,f.z,f.S,E.r],encapsulation:2})}}return i})()},68495:(O,T,o)=>{"use strict";o.r(T),o.d(T,{ROUTES:()=>I});var s=o(59072),m=o(29710),c=(o(83548),o(54438));const R=["*"];function C(g,p){}const I=[{path:"",pathMatch:"full",component:(()=>{class g extends m.J{getComponentName(){return"ProfilePageComponent"}importThemedComponent(M){return o(86930)(`./${M}/app/profile-page/profile-page.component`)}importUnthemedComponent(){return Promise.resolve().then(o.bind(o,83548))}static{this.\u0275fac=(()=>{let M;return function(u){return(M||(M=c.xGo(g)))(u||g)}})()}static{this.\u0275cmp=c.VBU({type:g,selectors:[["ds-profile-page"]],standalone:!0,features:[c.Vt3,c.aNF],ngContentSelectors:R,decls:5,vars:0,consts:[["vcr",""],["content",""]],template:function(r,u){1&r&&(c.NAR(),c.DNE(0,C,0,0,"ng-template",null,0,c.C5r),c.j41(2,"div",null,1),c.SdG(4),c.k0s())},encapsulation:2})}}return g})(),resolve:{breadcrumb:s.S},data:{breadcrumbKey:"profile",title:"profile.title"}}]},83548:(O,T,o)=>{"use strict";o.r(T),o.d(T,{ProfilePageComponent:()=>ee});var s=o(60177),m=o(7901),f=o(68018),c=o(84412),R=o(5964),C=o(25558),D=o(88141),I=o(94196),g=o(43446),p=o(94925),M=o(11873),r=o(6170),u=o(13817),P=o(31),F=o(4093),b=o(44209),U=o(64972),h=o(89777),E=o(14744),v=o(15202),S=o(9847),x=o(2175),L=o(8417),e=o(4600),$=o(50186),k=o(39650),oe=o(22370),j=o(22082),t=o(54438);function N(i,_){if(1&i&&(t.j41(0,"div",4)(1,"div",5),t.EFF(2),t.nI1(3,"translate"),t.k0s(),t.j41(4,"div",6)(5,"div",14),t.nrm(6,"ds-profile-page-researcher-form",7),t.k0s(),t.nrm(7,"ds-suggestions-notification"),t.k0s()()),2&i){const n=t.XpG(2).ngVar;t.R7$(2),t.JRh(t.bMT(3,2,"profile.card.researcher")),t.R7$(4),t.Y8G("user",n)}}function X(i,_){if(1&i){const n=t.RV6();t.j41(0,"div",8)(1,"div",5),t.EFF(2),t.nI1(3,"translate"),t.k0s(),t.j41(4,"div",6)(5,"ds-profile-page-security-form",15),t.bIt("isInvalid",function(l){t.eBV(n);const d=t.XpG(3);return t.Njj(d.setInvalid(l))})("passwordValue",function(l){t.eBV(n);const d=t.XpG(3);return t.Njj(d.setPasswordValue(l))})("currentPasswordValue",function(l){t.eBV(n);const d=t.XpG(3);return t.Njj(d.setCurrentPasswordValue(l))}),t.k0s()()()}2&i&&(t.R7$(2),t.JRh(t.bMT(3,2,"profile.card.security")),t.R7$(3),t.Y8G("FORM_PREFIX","profile.security.form."))}function G(i,_){1&i&&t.eu8(0)}function A(i,_){if(1&i&&(t.j41(0,"li",21),t.EFF(1),t.k0s()),2&i){const n=_.$implicit,a=t.XpG(8);t.R7$(),t.JRh(a.dsoNameService.getName(n))}}function y(i,_){if(1&i&&(t.j41(0,"div")(1,"h2",19),t.EFF(2),t.nI1(3,"translate"),t.k0s(),t.j41(4,"ul",20),t.Z7z(5,A,2,1,"li",21,t.fX1),t.k0s()()),2&i){const n=t.XpG();t.R7$(2),t.JRh(t.bMT(3,1,"profile.groups.head")),t.R7$(3),t.Dyx(n)}}function V(i,_){1&i&&t.DNE(0,y,7,3,"div"),2&i&&t.vxM((null==_?null:_.length)>0?0:-1)}function W(i,_){if(1&i&&(t.j41(0,"ds-pagination",18),t.DNE(1,V,1,1),t.k0s()),2&i){let n;const a=t.XpG(2),l=t.XpG(3);t.Y8G("hideGear",!0)("hidePagerWhenSinglePage",!0)("hidePaginationDetail",!0)("paginationOptions",l.optionsGroupsPagination)("collectionSize",null==a||null==a.payload?null:a.payload.totalElements),t.R7$(),t.vxM((n=null==a||null==a.payload?null:a.payload.page)?1:-1,n)}}function K(i,_){if(1&i&&t.DNE(0,W,2,6,"ds-pagination",18),2&i){const n=t.XpG();t.vxM(null!=n&&n.payload?0:-1)}}function w(i,_){1&i&&t.nrm(0,"ds-loading",22),2&i&&t.Y8G("showMessage",!1)}function z(i,_){1&i&&(t.nrm(0,"ds-error",17),t.nI1(1,"translate")),2&i&&t.FS9("message",t.bMT(1,1,"error.profile-groups"))}function Y(i,_){if(1&i&&t.DNE(0,G,1,0,"ng-container",16)(1,K,1,1,"ng-template",null,0,t.C5r)(3,w,1,1,"ng-template",null,1,t.C5r)(5,z,2,3,"ds-error",17),2&i){const n=_,a=t.sdS(2),l=t.sdS(4);t.Y8G("ngTemplateOutlet",null!=n&&n.isLoading?l:a),t.R7$(5),t.vxM(null!=n&&n.hasFailed?5:-1)}}function J(i,_){if(1&i&&(t.j41(0,"li",21),t.EFF(1),t.k0s()),2&i){const n=_.$implicit,a=t.XpG(5);t.R7$(),t.SpI(" ",a.dsoNameService.getName(n)," ")}}function Q(i,_){if(1&i&&(t.j41(0,"div",23)(1,"h2",19),t.EFF(2),t.nI1(3,"translate"),t.k0s(),t.j41(4,"ul",20),t.Z7z(5,J,2,1,"li",21,t.fX1),t.k0s()()),2&i){const n=t.XpG().ngVar;t.R7$(2),t.JRh(t.bMT(3,1,"profile.special.groups.head")),t.R7$(3),t.Dyx(n)}}function H(i,_){if(1&i&&(t.qex(0),t.DNE(1,Q,7,3,"div",23),t.bVm()),2&i){const n=_.ngVar;t.R7$(),t.vxM((null==n?null:n.length)>0?1:-1)}}function Z(i,_){if(1&i){const n=t.RV6();t.j41(0,"div",3)(1,"h1"),t.EFF(2),t.nI1(3,"translate"),t.k0s(),t.DNE(4,N,8,4,"div",4),t.nI1(5,"async"),t.j41(6,"div",4)(7,"div",5),t.EFF(8),t.nI1(9,"translate"),t.k0s(),t.j41(10,"div",6),t.nrm(11,"ds-profile-page-metadata-form",7),t.k0s()(),t.DNE(12,X,6,4,"div",8),t.nI1(13,"async"),t.j41(14,"div",9)(15,"button",10),t.bIt("click",function(){t.eBV(n);const l=t.XpG(2);return t.Njj(l.updateProfile())}),t.nrm(16,"i",11),t.EFF(17),t.nI1(18,"translate"),t.k0s()(),t.j41(19,"div",4)(20,"div",5),t.EFF(21),t.nI1(22,"translate"),t.k0s(),t.j41(23,"div",6)(24,"ds-alert",12),t.EFF(25),t.nI1(26,"translate"),t.k0s(),t.j41(27,"a",13),t.EFF(28),t.nI1(29,"translate"),t.k0s()()(),t.DNE(30,Y,6,2),t.nI1(31,"async"),t.DNE(32,H,2,1,"ng-container",2),t.nI1(33,"async"),t.k0s()}if(2&i){let n,a;const l=t.XpG().ngVar,d=t.XpG();t.R7$(2),t.JRh(t.bMT(3,13,"profile.title")),t.R7$(2),t.vxM(t.bMT(5,15,d.isResearcherProfileEnabled$)?4:-1),t.R7$(4),t.JRh(t.bMT(9,17,"profile.card.identify")),t.R7$(3),t.Y8G("user",l),t.R7$(),t.vxM(t.bMT(13,19,d.canChangePassword$)?12:-1),t.R7$(5),t.SpI(" ",t.bMT(18,21,"profile.form.submit"),""),t.R7$(4),t.JRh(t.bMT(22,23,"profile.card.accessibility.header")),t.R7$(3),t.Y8G("type","alert-info"),t.R7$(),t.JRh(t.bMT(26,25,"profile.card.accessibility.content")),t.R7$(2),t.Y8G("routerLink","/info/accessibility"),t.R7$(),t.JRh(t.bMT(29,27,"profile.card.accessibility.link")),t.R7$(2),t.vxM((n=t.bMT(31,29,d.groupsRD$))?30:-1,n),t.R7$(2),t.Y8G("ngVar",null==(a=t.bMT(33,31,d.specialGroupsRD$))||null==a.payload?null:a.payload.page)}}function q(i,_){if(1&i&&(t.qex(0),t.DNE(1,Z,34,33,"div",3),t.bVm()),2&i){const n=_.ngVar;t.R7$(),t.vxM(n?1:-1)}}let ee=(()=>{class i{constructor(n,a,l,d,B,te,ne,ie){this.authService=n,this.notificationsService=a,this.translate=l,this.epersonService=d,this.authorizationService=B,this.configurationService=te,this.dsoNameService=ne,this.paginationService=ie,this.NOTIFICATIONS_PREFIX="profile.notifications.",this.PASSWORD_NOTIFICATIONS_PREFIX="profile.security.form.notifications.",this.optionsGroupsPagination=Object.assign(new L.W,{id:"page_groups",currentPage:1,pageSize:20}),this.isResearcherProfileEnabled$=new c.t(!1)}ngOnInit(){this.user$=this.authService.getAuthenticatedUserFromStore().pipe((0,R.p)(n=>(0,h.a4)(n.id)),(0,C.n)(n=>this.epersonService.findById(n.id,!0,!0,(0,e.s)("groups"))),(0,F.v7)(),(0,F.Bo)(),(0,D.M)(n=>this.currentUser=n)),this.groupsRD$=this.paginationService.getCurrentPagination(this.optionsGroupsPagination.id,this.optionsGroupsPagination).pipe((0,C.n)(n=>this.epersonService.findById(this.currentUser.id,!0,!0,(0,e.s)("groups",{findListOptions:{elementsPerPage:n.pageSize,currentPage:n.currentPage}}))),(0,F.bD)(),(0,F.Bo)(),(0,C.n)(n=>n?.groups)),this.canChangePassword$=this.user$.pipe((0,C.n)(n=>this.authorizationService.isAuthorized(r._.CanChangePassword,n._links.self.href))),this.specialGroupsRD$=this.authService.getSpecialGroupsFromAuthStatus(),this.configurationService.findByPropertyName("researcher-profile.entity-type").pipe((0,F.qD)()).subscribe(n=>{this.isResearcherProfileEnabled$.next(n.hasSucceeded&&n.payload.values.length>0)})}updateProfile(){const n=this.metadataForm.compRef.instance.updateProfile(),a=this.updateSecurity();!n&&!a&&this.notificationsService.warning(this.translate.instant(this.NOTIFICATIONS_PREFIX+"warning.no-changes.title"),this.translate.instant(this.NOTIFICATIONS_PREFIX+"warning.no-changes.content"))}setInvalid(n){this.invalidSecurity=n}updateSecurity(){const n=(0,h.hj)(this.password);return(0,h.hj)(this.currentPassword)&&!n&&this.notificationsService.error(this.translate.instant(this.PASSWORD_NOTIFICATIONS_PREFIX+"error.general")),!this.invalidSecurity&&n&&this.epersonService.patch(this.currentUser,[{op:"add",path:"/password",value:{new_password:this.password,current_password:this.currentPassword}}]).pipe((0,F.qD)()).subscribe(d=>{d.hasSucceeded?this.notificationsService.success(this.translate.instant(this.PASSWORD_NOTIFICATIONS_PREFIX+"success.title"),this.translate.instant(this.PASSWORD_NOTIFICATIONS_PREFIX+"success.content")):this.notificationsService.error(this.translate.instant(this.PASSWORD_NOTIFICATIONS_PREFIX+"error.title"),this.getPasswordErrorMessage(d))}),n}setPasswordValue(n){this.password=n}setCurrentPasswordValue(n){this.currentPassword=n}submit(){this.updateProfile()}getPasswordErrorMessage(n){return n.hasFailed&&(0,h.hj)(n.errorMessage)?this.translate.instant(n.errorMessage):this.translate.instant(this.PASSWORD_NOTIFICATIONS_PREFIX+"error.change-failed")}static{this.\u0275fac=function(a){return new(a||i)(t.rXU(I.uR),t.rXU(S.I),t.rXU(f.c$),t.rXU(u.EPersonDataService),t.rXU(M.AuthorizationDataService),t.rXU(p.ConfigurationDataService),t.rXU(g.f),t.rXU(P.m))}}static{this.\u0275cmp=t.VBU({type:i,selectors:[["ds-base-profile-page"]],viewQuery:function(a,l){if(1&a&&t.GBs(k.O,5),2&a){let d;t.mGM(d=t.lsd())&&(l.metadataForm=d.first)}},standalone:!0,features:[t.aNF],decls:2,vars:3,consts:[["content",""],["loader",""],[4,"ngVar"],[1,"container"],[1,"card","mb-4"],[1,"card-header"],[1,"card-body"],[3,"user"],[1,"card","mb-4","security-section"],[1,"col-12","text-end","pe-0"],[1,"btn","btn-primary",3,"click"],[1,"fas","fa-edit"],[1,"mb-4",3,"type"],[3,"routerLink"],[1,"mb-4"],[3,"isInvalid","passwordValue","currentPasswordValue","FORM_PREFIX"],[4,"ngTemplateOutlet"],[3,"message"],[3,"hideGear","hidePagerWhenSinglePage","hidePaginationDetail","paginationOptions","collectionSize"],[1,"mt-4"],[1,"list-group","list-group-flush"],[1,"list-group-item"],[3,"showMessage"],["data-test","specialGroups"]],template:function(a,l){1&a&&(t.DNE(0,q,2,1,"ng-container",2),t.nI1(1,"async")),2&a&&t.Y8G("ngVar",t.bMT(1,1,l.user$))},dependencies:[U.C,s.Jj,E.A,s.T3,x.e,oe.g,j.q,m.iI,m.Wk,b.w,v.v,k.O,f.h,f.D9,$.r]})}}return i})()},46020:(O,T,o)=>{var s={"./custom/app/profile-page/profile-page-metadata-form/profile-page-metadata-form.component":[25577,5577]};function m(f){if(!o.o(s,f))return Promise.resolve().then(()=>{var C=new Error("Cannot find module '"+f+"'");throw C.code="MODULE_NOT_FOUND",C});var c=s[f],R=c[0];return o.e(c[1]).then(()=>o(R))}m.keys=()=>Object.keys(s),m.id=46020,O.exports=m},86930:(O,T,o)=>{var s={"./custom/app/profile-page/profile-page.component":[20687,687]};function m(f){if(!o.o(s,f))return Promise.resolve().then(()=>{var C=new Error("Cannot find module '"+f+"'");throw C.code="MODULE_NOT_FOUND",C});var c=s[f],R=c[0];return o.e(c[1]).then(()=>o(R))}m.keys=()=>Object.keys(s),m.id=86930,O.exports=m},84786:(O,T,o)=>{"use strict";o.d(T,{S:()=>I,z:()=>g});var s=o(54438),m=o(89417),f=o(60177);const c=["*"];function R(p,M){if(1&p&&(s.j41(0,"label",2)(1,"span",3),s.EFF(2),s.k0s(),s.j41(3,"span",4),s.EFF(4),s.k0s()()),2&p){const r=s.XpG();s.R7$(),s.xc7("color",r.getColor("checkedTextColor")),s.BMQ("aria-label",r.checkedLabel),s.R7$(),s.JRh(r.checkedLabel),s.R7$(),s.xc7("color",r.getColor("uncheckedTextColor")),s.BMQ("aria-label",r.uncheckedLabel),s.R7$(),s.JRh(r.uncheckedLabel)}}const C=new s.nKC("UI_SWITCH_OPTIONS"),D={provide:m.kq,useExisting:(0,s.Rfq)(()=>I),multi:!0};let I=(()=>{class p{cdr;_checked;_disabled;_reverse;_loading;_beforeChange;size;color;switchOffColor;switchColor;defaultBgColor;defaultBoColor;checkedLabel;uncheckedLabel;checkedTextColor;uncheckedTextColor;beforeChange;ariaLabel;set checked(r){this._checked=!1!==r}get checked(){return this._checked}set disabled(r){this._disabled=!1!==r}get disabled(){return this._disabled}set reverse(r){this._reverse=!1!==r}get reverse(){return this._reverse}set loading(r){this._loading=!1!==r}get loading(){return this._loading}change=new s.bkB;changeEvent=new s.bkB;valueChange=new s.bkB;constructor(r={},u){this.cdr=u,this.size=r&&r.size||"medium",this.color=r&&r.color,this.switchOffColor=r&&r.switchOffColor,this.switchColor=r&&r.switchColor,this.defaultBgColor=r&&r.defaultBgColor,this.defaultBoColor=r&&r.defaultBoColor,this.checkedLabel=r&&r.checkedLabel,this.uncheckedLabel=r&&r.uncheckedLabel,this.checkedTextColor=r&&r.checkedTextColor,this.uncheckedTextColor=r&&r.uncheckedTextColor}getColor(r=""){return"borderColor"===r?this.defaultBoColor:"switchColor"===r?this.reverse?this.checked&&this.switchOffColor||this.switchColor:this.checked?this.switchColor:this.switchOffColor||this.switchColor:"checkedTextColor"===r?this.reverse?this.uncheckedTextColor:this.checkedTextColor:"uncheckedTextColor"===r?this.reverse?this.checkedTextColor:this.uncheckedTextColor:this.reverse?this.checked?this.defaultBgColor:this.color:this.checked?this.color:this.defaultBgColor}onClick(r){this.disabled||(this.checked=!this.checked,this.change.emit(this.checked),this.valueChange.emit(this.checked),this.changeEvent.emit(r),this.onChangeCallback(this.checked),this.onTouchedCallback(this.checked),this.cdr.markForCheck())}onToggle(r){this.disabled||(this.beforeChange?this._beforeChange=this.beforeChange.subscribe(u=>{u&&this.onClick(r)}):this.onClick(r))}writeValue(r){r!==this.checked&&(this.checked=!!r),this.onChangeCallback(this.checked),this.cdr&&this.cdr.markForCheck()}registerOnChange(r){this.onChangeCallback=r}registerOnTouched(r){this.onTouchedCallback=r}setDisabledState(r){this.disabled=r}onTouchedCallback=r=>{};onChangeCallback=r=>{};ngOnDestroy(){this._beforeChange&&this._beforeChange.unsubscribe()}static \u0275fac=function(u){return new(u||p)(s.rXU(C,8),s.rXU(s.gRc))};static \u0275cmp=s.VBU({type:p,selectors:[["ui-switch"]],hostBindings:function(u,P){1&u&&s.bIt("click",function(b){return P.onToggle(b)})},inputs:{size:"size",color:"color",switchOffColor:"switchOffColor",switchColor:"switchColor",defaultBgColor:"defaultBgColor",defaultBoColor:"defaultBoColor",checkedLabel:"checkedLabel",uncheckedLabel:"uncheckedLabel",checkedTextColor:"checkedTextColor",uncheckedTextColor:"uncheckedTextColor",beforeChange:"beforeChange",ariaLabel:"ariaLabel",checked:"checked",disabled:"disabled",reverse:"reverse",loading:"loading"},outputs:{change:"change",changeEvent:"changeEvent",valueChange:"valueChange"},features:[s.Jv_([D])],ngContentSelectors:c,decls:4,vars:21,consts:[["type","button","role","switch",1,"switch"],["class","switch-pane",4,"ngIf"],[1,"switch-pane"],[1,"switch-label-checked"],[1,"switch-label-unchecked"]],template:function(u,P){1&u&&(s.NAR(),s.j41(0,"button",0),s.DNE(1,R,5,8,"label",1),s.j41(2,"small"),s.SdG(3),s.k0s()()),2&u&&(s.xc7("background-color",P.getColor())("border-color",P.getColor("borderColor")),s.AVh("checked",P.checked)("disabled",P.disabled)("loading",P.loading)("switch-large","large"===P.size)("switch-medium","medium"===P.size)("switch-small","small"===P.size),s.BMQ("aria-checked",P.checked)("aria-label",P.ariaLabel),s.R7$(),s.Y8G("ngIf",P.checkedLabel||P.uncheckedLabel),s.R7$(),s.xc7("background",P.getColor("switchColor")))},dependencies:[f.bT],encapsulation:2})}return p})(),g=(()=>{class p{static forRoot(r){return{ngModule:p,providers:[{provide:C,useValue:r||{}}]}}static \u0275fac=function(u){return new(u||p)};static \u0275mod=s.$C({type:p});static \u0275inj=s.G2t({imports:[f.MD,m.YN,m.YN]})}return p})()}}]);