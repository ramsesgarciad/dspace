(self.webpackChunkdspace_angular=self.webpackChunkdspace_angular||[]).push([[3381],{43381:(L,B,t)=>{"use strict";t.r(B),t.d(B,{ROUTES:()=>S});var b=t(85643),e=t(54438),h=t(4266),p=t(4093),C=t(4600);const E=[(0,C.s)("bundle",{},(0,C.s)("primaryBitstream"),(0,C.s)("item")),(0,C.s)("format")],M=(r,P,d=(0,e.WQX)(h.BitstreamDataService))=>d.findById(r.params.id,!0,!1,...E).pipe((0,p.qD)());var v=t(7673),m=t(25558),f=t(96354),g=t(15343),y=t(80495),u=t(89777),q=t(8177),N=t(46541),W=t(43446);let Y=(()=>{class r extends N.U{constructor(d,a,n){super(a,n),this.bitstreamService=d,this.linkService=a,this.dsoNameService=n}getBreadcrumbs(d,a){const n=this.dsoNameService.getName(d),l=new y.Q(n,a);return this.getOwningItem(d.uuid).pipe((0,m.n)(T=>{if((0,u.hj)(T)&&(0,u.a4)(T.payload)){const F=T.payload;return super.getBreadcrumbs(F,(0,g.wN)(F))}return(0,v.of)([])}),(0,f.T)(T=>[...T,l]))}getOwningItem(d){return this.bitstreamService.findById(d,!0,!0,...E).pipe((0,p.qD)(),(0,p.Bo)(),(0,m.n)(a=>(0,u.a4)(a)?a.bundle.pipe((0,p.qD)(),(0,p.Bo)(),(0,m.n)(n=>(0,u.a4)(n)?n.item.pipe((0,p.qD)()):(0,v.of)(void 0))):(0,v.of)(void 0)))}static{this.\u0275fac=function(a){return new(a||r)(e.KVO(h.BitstreamDataService),e.KVO(q._),e.KVO(W.f))}}static{this.\u0275prov=e.jDH({token:r,factory:r.\u0275fac,providedIn:"root"})}}return r})();var V=t(74593);const X=(r,P,d=(0,e.WQX)(Y),a=(0,e.WQX)(h.BitstreamDataService))=>(0,V.G)(r,P,d,a,...E);var U=t(59072),j=t(12808),O=t(60892),tt=t(38285),Q=t(8667),G=t(60177),i=t(7901),z=t(68018),et=t(61594),it=t(80781);const Z=r=>["/bitstreams",r,"edit"];let $=(()=>{class r{constructor(d){this.route=d}ngOnInit(){this.dsoRD$=this.route.data.pipe((0,et.$)(),(0,f.T)(d=>d.bitstream))}static{this.\u0275fac=function(a){return new(a||r)(e.rXU(i.nX))}}static{this.\u0275cmp=e.VBU({type:r,selectors:[["ds-bitstream-authorizations"]],standalone:!0,features:[e.aNF],decls:10,vars:12,consts:[[1,"container"],[3,"resourceType","resourceUUID"],[1,"button-row","bottom"],[1,"text-end"],["role","button",1,"btn","btn-outline-secondary","me-1",3,"routerLink"],[1,"fas","fa-arrow-left"]],template:function(a,n){if(1&a&&(e.j41(0,"div",0),e.nrm(1,"ds-resource-policies",1),e.nI1(2,"async"),e.j41(3,"div",2)(4,"div",3)(5,"a",4),e.nI1(6,"async"),e.nrm(7,"i",5),e.EFF(8),e.nI1(9,"translate"),e.k0s()()()()),2&a){let l,T;e.R7$(),e.Y8G("resourceType","bitstream")("resourceUUID",null==(l=e.bMT(2,4,n.dsoRD$))||null==l.payload?null:l.payload.id),e.R7$(4),e.Y8G("routerLink",e.eq3(10,Z,null==(T=e.bMT(6,6,n.dsoRD$))||null==T.payload?null:T.payload.id)),e.R7$(3),e.SpI(" ",e.bMT(9,8,"bitstream.edit.return")," ")}},dependencies:[G.Jj,it.e,i.Wk,z.h,z.D9],encapsulation:2})}}return r})();var st=t(84572),D=t(96697),w=t(5964),at=t(94196),K=t(94925),rt=t(11873),_=t(6170),nt=t(46828),ot=t(80193),dt=t(19548),lt=t(76461),mt=t(68660),k=t(95488);const ct=r=>({bitstream:r});let J=(()=>{class r{constructor(d,a,n,l,T,F,R,H,vt,It,gt,Tt){this.route=d,this.router=a,this.authorizationService=n,this.auth=l,this.fileService=T,this.hardRedirectService=F,this.location=R,this.dsoNameService=H,this.signpostingDataService=vt,this.responseService=It,this.matomoService=gt,this.platformId=Tt,this.configService=(0,e.WQX)(K.ConfigurationDataService),this.initPageLinks()}back(){this.location.back()}ngOnInit(){const d=this.route.queryParams.pipe((0,f.T)(a=>a?.accessToken||null),(0,D.s)(1));this.bitstreamRD$=this.route.data.pipe((0,f.T)(a=>a.bitstream)),this.bitstream$=this.bitstreamRD$.pipe((0,dt.QD)(this.router,this.auth),(0,p.Bo)()),this.bitstream$.pipe((0,m.n)(a=>{const n=this.authorizationService.isAuthorized(_._.CanDownload,(0,u.hj)(a)?a.self:void 0),l=this.auth.isAuthenticated(),T=this.matomoService.isMatomoEnabled$();return(0,st.z)([n,l,T,d,(0,v.of)(a)])}),(0,w.p)(([a,n,l,T,F])=>(0,u.a4)(a)&&(0,u.a4)(n)||(0,u.a4)(T)),(0,D.s)(1),(0,m.n)(([a,n,l,T,F])=>a&&n?this.fileService.retrieveFileDownloadLink(F._links.content.href).pipe((0,w.p)(R=>(0,u.a4)(R)),(0,D.s)(1),(0,f.T)(R=>[a,n,l,F,R])):(0,u.a4)(T)?[[a,!n,l,F,"",T]]:[[a,n,l,F,F._links.content.href]]),(0,m.n)(([a,n,l,T,F,R])=>l?this.matomoService.appendVisitorId(F).pipe((0,f.T)(H=>[a,n,T,H,R])):(0,v.of)([a,n,T,F,R]))).subscribe(([a,n,l,T,F])=>{a&&n&&(0,u.hj)(T)?this.hardRedirectService.redirect(T):!a||n||(0,u.a4)(F)?a||((0,u.a4)(F)?this.hardRedirectService.redirect(l._links.content.href+"?accessToken="+F):n?this.router.navigateByUrl((0,g.bZ)(),{skipLocationChange:!0}):n||(this.auth.setRedirectUrl(this.router.url),this.router.navigateByUrl("login"))):this.hardRedirectService.redirect(T)})}initPageLinks(){(0,G.Vy)(this.platformId)&&this.route.params.subscribe(d=>{this.signpostingDataService.getLinks(d.id).pipe((0,D.s)(1)).subscribe(a=>{let n="";a.forEach(l=>{n=n+((0,u.hj)(n)?", ":"")+`<${l.href}> ; rel="${l.rel}"`+((0,u.hj)(l.type)?` ; type="${l.type}" `:" ")}),this.responseService.setHeader("Link",n)})})}static{this.\u0275fac=function(a){return new(a||r)(e.rXU(i.nX),e.rXU(i.Ix),e.rXU(rt.AuthorizationDataService),e.rXU(at.uR),e.rXU(lt.E),e.rXU(k.$),e.rXU(G.aZ),e.rXU(W.f),e.rXU(nt.z),e.rXU(ot.w),e.rXU(mt.$n),e.rXU(e.Agw))}}static{this.\u0275cmp=e.VBU({type:r,selectors:[["ds-bitstream-download-page"]],standalone:!0,features:[e.aNF],decls:10,vars:11,consts:[[1,"container"],[1,"h2"],[1,"pt-3"],[1,"btn","btn-outline-secondary",3,"click"],[1,"fas","fa-arrow-left"]],template:function(a,n){1&a&&(e.j41(0,"div",0)(1,"h1",1),e.EFF(2),e.nI1(3,"async"),e.nI1(4,"translate"),e.k0s(),e.j41(5,"div",2)(6,"button",3),e.bIt("click",function(){return n.back()}),e.nrm(7,"i",4),e.EFF(8),e.nI1(9,"translate"),e.k0s()()()),2&a&&(e.R7$(2),e.JRh(e.i5U(4,4,"bitstream.download.page",e.eq3(9,ct,n.dsoNameService.getName(e.bMT(3,2,n.bitstream$))))),e.R7$(6),e.SpI(" ",e.bMT(9,7,"bitstream.download.page.back")," "))},dependencies:[G.Jj,z.h,z.D9],encapsulation:2})}}return r})();const ut=(0,t(85360).L)(()=>M,()=>(0,v.of)(_._.CanManagePolicies));var ft=t(29710);t(27576);const I=["*"];function x(r,P){}const o=(r,P,d=(0,e.WQX)(h.BitstreamDataService),a=(0,e.WQX)(k.$),n=(0,e.WQX)(i.Ix))=>{const l=r.params.prefix,T=r.params.suffix,F=r.params.filename;let R=r.params.sequence_id;return(0,u.Tn)(R)&&(R=r.queryParams.sequenceId),d.findByItemHandle(`${l}/${T}`,R,F).pipe((0,p.qD)(),(0,f.T)(H=>H.hasSucceeded&&!H.hasNoContent?(a.redirect(new URL(`/bitstreams/${H.payload.uuid}/download`,a.getCurrentOrigin()).href,301),!1):n.createUrlTree([g.RD])))},S=[{path:"handle/:prefix/:suffix/:filename",component:J,canActivate:[o]},{path:":prefix/:suffix/:sequence_id/:filename",component:J,canActivate:[o]},{path:":id/download",component:J,resolve:{bitstream:M}},{path:":id/edit",component:(()=>{class r extends ft.J{getComponentName(){return"EditBitstreamPageComponent"}importThemedComponent(d){return t(13170)(`./${d}/app/bitstream-page/edit-bitstream-page/edit-bitstream-page.component`)}importUnthemedComponent(){return Promise.resolve().then(t.bind(t,27576))}static{this.\u0275fac=(()=>{let d;return function(n){return(d||(d=e.xGo(r)))(n||r)}})()}static{this.\u0275cmp=e.VBU({type:r,selectors:[["ds-edit-bitstream-page"]],standalone:!0,features:[e.Vt3,e.aNF],ngContentSelectors:I,decls:5,vars:0,consts:[["vcr",""],["content",""]],template:function(a,n){1&a&&(e.NAR(),e.DNE(0,x,0,0,"ng-template",null,0,e.C5r),e.j41(2,"div",null,1),e.SdG(4),e.k0s())},encapsulation:2})}}return r})(),resolve:{bitstream:M,breadcrumb:X},canActivate:[b.t]},{path:":id/authorizations",canActivate:[ut],children:[{path:"create",resolve:{resourcePolicyTarget:Q.Q},component:j.m,data:{title:"resource-policies.create.page.title",showBreadcrumbs:!0}},{path:"edit",resolve:{breadcrumb:U.S,resourcePolicy:tt.n},component:O._,data:{breadcrumbKey:"item.edit",title:"resource-policies.edit.page.title",showBreadcrumbs:!0}},{path:"",resolve:{bitstream:M,breadcrumb:X},component:$,data:{title:"bitstream.edit.authorizations.title",showBreadcrumbs:!0}}]}]},27576:(L,B,t)=>{"use strict";t.r(B),t.d(B,{EditBitstreamPageComponent:()=>pt});var b=t(60177),e=t(7901),h=t(1473),p=t(68018),C=t(84418),E=t.n(C),M=t(84572),v=t(7673),m=t(96354),f=t(25558),g=t(96697),y=t(5964),u=t(88141),q=t(43446),N=t(4266),W=t(32336),Y=t(21626),V=t(9847),X=t(57775),U=t(81948),j=t(7094),O=t(4093),tt=t(37419),Q=t(49755),G=t(3601),i=t(54438);let z=(()=>{class I{constructor(s,o,c,A,S,r){this.requestService=s,this.rdbService=o,this.objectCache=c,this.halService=A,this.notificationsService=S,this.bundleDataService=r}getHttpOptions(){const s=Object.create({});let o=new Y.Lr;return o=o.append("Content-Type","text/uri-list"),s.headers=o,s}createAndSendRequest(s,o,c){const A=this.requestService.generateRequestId(),S=new s(A,o,c,this.getHttpOptions());return this.requestService.send(S),this.rdbService.buildFromRequestUUID(A)}create(s,o){return this.createAndSendRequest(Q.Qf,o._links.primaryBitstream.href,s.self)}put(s,o){return this.createAndSendRequest(Q.v_,o._links.primaryBitstream.href,s.self)}delete(s){return this.createAndSendRequest(Q.$,s._links.primaryBitstream.href).pipe((0,O.bD)(),(0,f.n)(o=>this.bundleDataService.findByHref(s.self,o.hasFailed)))}static{this.\u0275fac=function(o){return new(o||I)(i.KVO(G.B),i.KVO(X.o),i.KVO(U.$),i.KVO(j.Y),i.KVO(V.I),i.KVO(tt.BundleDataService))}}static{this.\u0275prov=i.jDH({token:I,factory:I.\u0275fac,providedIn:"root"})}}return I})();var et=t(36480),it=t(83286),Z=t(2454),$=t(61880),st=t(92767),D=t(89777),w=t(14744),at=t(17964),K=t(6549),rt=t(58901),_=t(8428),nt=t(86332),ot=t(15202),dt=t(81829),lt=t(50186),mt=t(49170);const k=I=>["/bitstreams",I,"authorizations"];function ct(I,x){if(1&I){const s=i.RV6();i.j41(0,"ds-form",11),i.bIt("submitForm",function(){i.eBV(s);const c=i.XpG(3);return i.Njj(c.onSubmit())})("cancel",function(){i.eBV(s);const c=i.XpG(3);return i.Njj(c.onCancel())})("dfChange",function(c){i.eBV(s);const A=i.XpG(3);return i.Njj(A.onChange(c))}),i.j41(1,"div",12)(2,"a",13),i.EFF(3),i.nI1(4,"translate"),i.k0s()()()}if(2&I){const s=i.XpG(2).ngVar,o=i.XpG();i.Y8G("formId","edit-bitstream-form-id")("formGroup",o.formGroup)("formModel",o.formModel)("formLayout",o.formLayout)("submitLabel","form.save"),i.R7$(2),i.Y8G("routerLink",i.eq3(9,k,null==s||null==s.payload?null:s.payload.id)),i.R7$(),i.JRh(i.bMT(4,7,"bitstream.edit.authorizations.link"))}}function J(I,x){if(1&I&&(i.j41(0,"div",2)(1,"div",4),i.nrm(2,"ds-thumbnail",5),i.k0s(),i.j41(3,"div",6)(4,"div",1)(5,"div",2)(6,"div",7)(7,"h1",8),i.EFF(8),i.j41(9,"span",9),i.EFF(10),i.nI1(11,"dsFileSize"),i.k0s()()()()(),i.DNE(12,ct,5,11,"ds-form",10),i.k0s()()),2&I){const s=i.XpG().ngVar,o=i.XpG();i.R7$(2),i.Y8G("thumbnail",null==s?null:s.payload),i.R7$(6),i.SpI("",o.dsoNameService.getName(null==s?null:s.payload)," "),i.R7$(2),i.SpI("(",i.bMT(11,4,null==s||null==s.payload?null:s.payload.sizeBytes),")"),i.R7$(2),i.vxM(o.formGroup?12:-1)}}function ht(I,x){1&I&&(i.nrm(0,"ds-error",3),i.nI1(1,"translate")),2&I&&i.FS9("message",i.bMT(1,1,"error.bitstream"))}function ut(I,x){1&I&&(i.nrm(0,"ds-loading",3),i.nI1(1,"translate")),2&I&&i.FS9("message",i.bMT(1,1,"loading.bitstream"))}function ft(I,x){if(1&I&&(i.qex(0),i.j41(1,"div",1),i.DNE(2,J,13,6,"div",2)(3,ht,2,3,"ds-error",3)(4,ut,2,3,"ds-loading",3),i.k0s(),i.bVm()),2&I){const s=x.ngVar;i.R7$(2),i.vxM(null!=s&&s.hasSucceeded?2:-1),i.R7$(),i.vxM(null!=s&&s.hasFailed?3:-1),i.R7$(),i.vxM(!s||null!=s&&s.isLoading?4:-1)}}let pt=(()=>{class I{constructor(s,o,c,A,S,r,P,d,a,n){this.route=s,this.router=o,this.changeDetectorRef=c,this.formService=A,this.translate=S,this.bitstreamService=r,this.dsoNameService=P,this.notificationsService=d,this.bitstreamFormatService=a,this.primaryBitstreamService=n,this.KEY_PREFIX="bitstream.edit.form.",this.LABEL_KEY_SUFFIX=".label",this.HINT_KEY_SUFFIX=".hint",this.NOTIFICATIONS_PREFIX="bitstream.edit.notifications.",this.IMAGE_WIDTH_METADATA="iiif.image.width",this.IMAGE_HEIGHT_METADATA="iiif.image.height",this.IIIF_TOC_METADATA="iiif.toc",this.IIIF_LABEL_METADATA="iiif.label",this.findAllOptions={elementsPerPage:20,currentPage:1},this.fileNameModel=new K.C({hasSelectableMetadata:!1,metadataFields:[],repeatable:!1,submissionId:"",id:"fileName",name:"fileName",required:!0,validators:{required:null},errorMessages:{required:"You must provide a file name for the bitstream"}}),this.primaryBitstreamModel=new at.i({id:"primaryBitstream",name:"primaryBitstream"}),this.descriptionModel=new rt.E({hasSelectableMetadata:!1,metadataFields:[],repeatable:!1,submissionId:"",id:"description",name:"description",rows:10}),this.selectedFormatModel=new _.j({id:"selectedFormat",name:"selectedFormat",displayKey:"shortDescription",repeatable:!1,metadataFields:[],submissionId:"",hasSelectableMetadata:!1,resourceType:it.a,formatFunction:l=>l instanceof et.v?(0,D.a4)(l)&&l.supportLevel===Z.c.Unknown?this.translate.instant(this.KEY_PREFIX+"selectedFormat.unknown"):l.shortDescription:l}),this.newFormatModel=new h.rA_({id:"newFormat",name:"newFormat"}),this.iiifLabelModel=new K.C({hasSelectableMetadata:!1,metadataFields:[],repeatable:!1,submissionId:"",id:"iiifLabel",name:"iiifLabel"},{grid:{host:"col col-lg-6 d-inline-block"}}),this.iiifLabelContainer=new h.iO5({id:"iiifLabelContainer",group:[this.iiifLabelModel]},{grid:{host:"row"}}),this.iiifTocModel=new K.C({hasSelectableMetadata:!1,metadataFields:[],repeatable:!1,submissionId:"",id:"iiifToc",name:"iiifToc"},{grid:{host:"col col-lg-6 d-inline-block"}}),this.iiifTocContainer=new h.iO5({id:"iiifTocContainer",group:[this.iiifTocModel]},{grid:{host:"row"}}),this.iiifWidthModel=new K.C({hasSelectableMetadata:!1,metadataFields:[],repeatable:!1,submissionId:"",id:"iiifWidth",name:"iiifWidth"},{grid:{host:"col col-lg-6 d-inline-block"}}),this.iiifWidthContainer=new h.iO5({id:"iiifWidthContainer",group:[this.iiifWidthModel]},{grid:{host:"row"}}),this.iiifHeightModel=new K.C({hasSelectableMetadata:!1,metadataFields:[],repeatable:!1,submissionId:"",id:"iiifHeight",name:"iiifHeight"},{grid:{host:"col col-lg-6 d-inline-block"}}),this.iiifHeightContainer=new h.iO5({id:"iiifHeightContainer",group:[this.iiifHeightModel]},{grid:{host:"row"}}),this.inputModels=[this.primaryBitstreamModel,this.fileNameModel,this.descriptionModel,this.selectedFormatModel,this.newFormatModel],this.formModel=[new h.iO5({id:"fileNamePrimaryContainer",group:[this.primaryBitstreamModel,this.fileNameModel]},{grid:{host:"row"}}),new h.iO5({id:"descriptionContainer",group:[this.descriptionModel]}),new h.iO5({id:"formatContainer",group:[this.selectedFormatModel,this.newFormatModel]})],this.newFormatBaseLayout="col col-sm-6 d-inline-block",this.formLayout={fileName:{grid:{host:"col col-sm-8 d-inline-block"}},primaryBitstream:{grid:{container:"col-12"},element:{container:"text-right"}},description:{grid:{host:"col-12 d-inline-block"}},embargo:{grid:{host:"col-12 d-inline-block"}},selectedFormat:{grid:{host:"col col-sm-6 d-inline-block"}},newFormat:{grid:{host:this.newFormatBaseLayout+" invisible"}},fileNamePrimaryContainer:{grid:{host:"row position-relative"}},descriptionContainer:{grid:{host:"row"}},formatContainer:{grid:{host:"row"}}},this.isIIIF=!1,this.subs=[]}ngOnInit(){this.itemId=this.route.snapshot.queryParams.itemId,this.entityType=this.route.snapshot.queryParams.entityType,this.bitstreamRD$=this.route.data.pipe((0,m.T)(r=>r.bitstream));const s=this.bitstreamRD$.pipe((0,O.yd)(),(0,O.Bo)()),o=s.pipe((0,f.n)(r=>r.bundle),(0,O.ak)()),c=o.pipe((0,D.Az)(),(0,f.n)(r=>this.bitstreamService.findByHref(r._links.primaryBitstream.href)),(0,O.ak)()),A=o.pipe((0,f.n)(r=>r.item),(0,O.ak)()),S=s.pipe((0,f.n)(r=>r.format),(0,O.ak)());this.subs.push((0,M.z)(s,o,c,A,S).subscribe(([r,P,d,a,n])=>{this.bitstream=r,this.bundle=P,this.selectedFormat=n,this.primaryBitstreamUUID=(0,D.a4)(d)?d.uuid:null,this.itemId=a.uuid,this.setIiifStatus(this.bitstream)}),S.pipe((0,g.s)(1)).subscribe(r=>this.originalFormat=r)),this.subs.push(this.translate.onLangChange.subscribe(()=>{this.updateFieldTranslations()}))}setForm(){this.formGroup=this.formService.createFormGroup(this.formModel),this.updateForm(this.bitstream),this.updateFieldTranslations()}updateForm(s){this.formGroup.patchValue({fileNamePrimaryContainer:{fileName:s.name,primaryBitstream:this.primaryBitstreamUUID===s.uuid},descriptionContainer:{description:s.firstMetadataValue("dc.description")},formatContainer:{selectedFormat:this.selectedFormat.shortDescription,newFormat:(0,D.a4)(s.firstMetadata("dc.format"))?s.firstMetadata("dc.format").value:void 0}}),this.isIIIF&&this.formGroup.patchValue({iiifLabelContainer:{iiifLabel:s.firstMetadataValue(this.IIIF_LABEL_METADATA)},iiifTocContainer:{iiifToc:s.firstMetadataValue(this.IIIF_TOC_METADATA)},iiifWidthContainer:{iiifWidth:s.firstMetadataValue(this.IMAGE_WIDTH_METADATA)},iiifHeightContainer:{iiifHeight:s.firstMetadataValue(this.IMAGE_HEIGHT_METADATA)}}),this.updateNewFormatLayout()}updateNewFormatLayout(){this.formLayout.newFormat.grid.host=this.isUnknownFormat()?this.newFormatBaseLayout:this.newFormatBaseLayout+" invisible"}isUnknownFormat(){return(0,D.a4)(this.selectedFormat)&&this.selectedFormat.supportLevel===Z.c.Unknown}updateFieldTranslations(){this.inputModels.forEach(s=>{this.updateFieldTranslation(s)})}updateFieldTranslation(s){s.label=this.translate.instant(this.KEY_PREFIX+s.id+this.LABEL_KEY_SUFFIX),s.id!==this.primaryBitstreamModel.id&&(s.hint=this.translate.instant(this.KEY_PREFIX+s.id+this.HINT_KEY_SUFFIX))}onChange(s){const o=s.model;o.id===this.selectedFormatModel.id&&(this.selectedFormat=o.value,this.updateNewFormatLayout())}onSubmit(){const s=this.formGroup.getRawValue(),o=this.formToBitstream(s),c=this.selectedFormat.id!==this.originalFormat.id,S=this.primaryBitstreamUUID===this.bitstream.uuid;let r,P,d=!1;if(S!==s.fileNamePrimaryContainer.primaryBitstream){let a;a=S?this.primaryBitstreamService.delete(this.bundle):(0,D.a4)(this.primaryBitstreamUUID)?this.primaryBitstreamService.put(this.bitstream,this.bundle):this.primaryBitstreamService.create(this.bitstream,this.bundle);const n=a.pipe((0,O.qD)());this.subs.push(n.pipe((0,y.p)(l=>l.hasFailed)).subscribe(l=>{this.notificationsService.error(this.translate.instant(this.NOTIFICATIONS_PREFIX+"error.primaryBitstream.title"),l.errorMessage),d=!0})),P=n.pipe((0,m.T)(l=>l.hasSucceeded?l.payload:this.bundle)),this.subs.push(P.pipe((0,D.Az)(),(0,f.n)(l=>this.bitstreamService.findByHref(l._links.primaryBitstream.href,!1)),(0,O.ak)()).subscribe(l=>{this.primaryBitstreamUUID=(0,D.a4)(l)?l.uuid:null}))}else P=(0,v.of)(this.bundle);r=c?this.bitstreamService.updateFormat(this.bitstream,this.selectedFormat).pipe((0,O.qD)(),(0,m.T)(a=>{if(!(0,D.a4)(a)||!a.hasFailed)return a.payload;this.notificationsService.error(this.translate.instant(this.NOTIFICATIONS_PREFIX+"error.format.title"),a.errorMessage)})):(0,v.of)(this.bitstream),(0,M.z)([P,r]).pipe((0,u.M)(([a])=>this.bundle=a),(0,f.n)(()=>this.bitstreamService.update(o).pipe((0,O.ak)()))).subscribe(()=>{this.bitstreamService.commitUpdates(),this.notificationsService.success(this.translate.instant(this.NOTIFICATIONS_PREFIX+"saved.title"),this.translate.instant(this.NOTIFICATIONS_PREFIX+"saved.content")),d||this.navigateToItemEditBitstreams()})}formToBitstream(s){const o=E()(this.bitstream),c=o.metadata;return $.O.setFirstValue(c,"dc.title",s.fileNamePrimaryContainer.fileName),(0,D.Im)(s.descriptionContainer.description)?delete c["dc.description"]:$.O.setFirstValue(c,"dc.description",s.descriptionContainer.description),this.isIIIF&&((0,D.Im)(s.iiifLabelContainer.iiifLabel)?delete c[this.IIIF_LABEL_METADATA]:$.O.setFirstValue(c,this.IIIF_LABEL_METADATA,s.iiifLabelContainer.iiifLabel),(0,D.Im)(s.iiifTocContainer.iiifToc)?delete c[this.IIIF_TOC_METADATA]:$.O.setFirstValue(c,this.IIIF_TOC_METADATA,s.iiifTocContainer.iiifToc),(0,D.Im)(s.iiifWidthContainer.iiifWidth)?delete c[this.IMAGE_WIDTH_METADATA]:$.O.setFirstValue(c,this.IMAGE_WIDTH_METADATA,s.iiifWidthContainer.iiifWidth),(0,D.Im)(s.iiifHeightContainer.iiifHeight)?delete c[this.IMAGE_HEIGHT_METADATA]:$.O.setFirstValue(c,this.IMAGE_HEIGHT_METADATA,s.iiifHeightContainer.iiifHeight)),(0,D.hj)(s.formatContainer.newFormat)&&$.O.setFirstValue(c,"dc.format",s.formatContainer.newFormat),o.metadata=c,o}onCancel(){this.navigateToItemEditBitstreams()}navigateToItemEditBitstreams(){this.router.navigate([(0,st.DL)(this.entityType,this.itemId),"bitstreams"])}setIiifStatus(s){const o=/OTHERCONTENT|THUMBNAIL|LICENSE/,c=/true|yes/i,A=this.bitstream.format.pipe((0,O.yd)(),(0,m.T)(d=>d.payload.mimetype.includes("image/"))),S=this.bitstream.bundle.pipe((0,O.yd)(),(0,m.T)(d=>null==this.dsoNameService.getName(d.payload).match(o))),r=this.bitstream.bundle.pipe((0,O.yd)(),(0,m.T)(d=>d.payload.item.pipe((0,O.yd)(),(0,m.T)(a=>a.payload.firstMetadataValue("dspace.iiif.enabled")&&null!==a.payload.firstMetadataValue("dspace.iiif.enabled").match(c))))),P=(0,M.z)(A,S,r).subscribe(([d,a,n])=>{d&&a&&n&&(this.isIIIF=!0,this.inputModels.push(this.iiifLabelModel),this.formModel.push(this.iiifLabelContainer),this.inputModels.push(this.iiifTocModel),this.formModel.push(this.iiifTocContainer),this.inputModels.push(this.iiifWidthModel),this.formModel.push(this.iiifWidthContainer),this.inputModels.push(this.iiifHeightModel),this.formModel.push(this.iiifHeightContainer)),this.setForm(),this.changeDetectorRef.detectChanges()});this.subs.push(P)}ngOnDestroy(){this.subs.filter(s=>(0,D.a4)(s)).forEach(s=>s.unsubscribe())}findAllFormatsServiceFactory(){return()=>this.bitstreamFormatService}static{this.\u0275fac=function(o){return new(o||I)(i.rXU(e.nX),i.rXU(e.Ix),i.rXU(i.gRc),i.rXU(h.J9r),i.rXU(p.c$),i.rXU(N.BitstreamDataService),i.rXU(q.f),i.rXU(V.I),i.rXU(W.BitstreamFormatDataService),i.rXU(z))}}static{this.\u0275cmp=i.VBU({type:I,selectors:[["ds-base-edit-bitstream-page"]],standalone:!0,features:[i.aNF],decls:2,vars:3,consts:[[4,"ngVar"],[1,"container"],[1,"row"],[3,"message"],[1,"col-md-2"],[3,"thumbnail"],[1,"col-md-10"],[1,"col-12"],[1,"h2","dont-break-out"],[1,"text-muted"],[3,"formId","formGroup","formModel","formLayout","submitLabel"],[3,"submitForm","cancel","dfChange","formId","formGroup","formModel","formLayout","submitLabel"],["additional","",1,"container","py-3"],[3,"routerLink"]],template:function(o,c){1&o&&(i.DNE(0,ft,5,3,"ng-container",0),i.nI1(1,"async")),2&o&&i.Y8G("ngVar",i.bMT(1,1,c.bitstreamRD$))},dependencies:[b.Jj,w.A,dt.s,nt.s,e.Wk,ot.v,mt.T,p.h,p.D9,lt.r],changeDetection:0})}}return I})()},80495:(L,B,t)=>{"use strict";t.d(B,{Q:()=>b});class b{constructor(h,p){this.text=h,this.url=p}}},74593:(L,B,t)=>{"use strict";t.d(B,{G:()=>C,o:()=>E});var b=t(96354),e=t(15343),h=t(89777),p=t(4093);const C=(M,v,m,f,...g)=>E(M,v,M.params.id,m,f,...g),E=(M,v,m,f,g,...y)=>g.findById(m,!0,!1,...y).pipe((0,p.qD)(),(0,p.Bo)(),(0,b.T)(u=>{if((0,h.a4)(u))return{provider:f,key:u,url:(0,e.wN)(u)}}))},46541:(L,B,t)=>{"use strict";t.d(B,{U:()=>y});var b=t(7673),e=t(47677),h=t(25558),p=t(96354),C=t(15343),E=t(80495),M=t(89777),v=t(4600),m=t(8177),f=t(43446),g=t(54438);let y=(()=>{class u{constructor(N,W){this.linkService=N,this.dsoNameService=W}getBreadcrumbs(N,W){const Y=this.dsoNameService.getName(N),V=new E.Q(Y,W),X=N.getParentLinkKey();return this.linkService.resolveLink(N,(0,v.s)(X))[X].pipe((0,e.I)(U=>U.hasSucceeded||204===U.statusCode),(0,h.n)(U=>{if((0,M.a4)(U)&&(0,M.a4)(U.payload)){const j=U.payload;return this.getBreadcrumbs(j,(0,C.wN)(j))}return(0,b.of)([])}),(0,p.T)(U=>[...U,V]))}static{this.\u0275fac=function(W){return new(W||u)(g.KVO(m._),g.KVO(f.f))}}static{this.\u0275prov=g.jDH({token:u,factory:u.\u0275fac,providedIn:"root"})}}return u})()},59072:(L,B,t)=>{"use strict";t.d(B,{S:()=>v});var b=t(54438),e=t(89777),h=t(54034),p=t(7673),C=t(80495);let M=(()=>{class m{getBreadcrumbs(g,y){return(0,p.of)([new C.Q(g+".breadcrumbs",y)])}static{this.\u0275fac=function(y){return new(y||m)}}static{this.\u0275prov=b.jDH({token:m,factory:m.\u0275fac,providedIn:"root"})}}return m})();const v=(m,f,g=(0,b.WQX)(M))=>{const y=m.data.breadcrumbKey;if((0,e.Tn)(y))throw new Error('You provided an i18nBreadcrumbResolver for url "'+m.url+"\" but no breadcrumbKey in the route's data");return{provider:g,key:y,url:(0,h.F)(m)}}},85360:(L,B,t)=>{"use strict";t.d(B,{L:()=>h});var b=t(96354),e=t(69944);const h=(p,C)=>(0,e.FO)(p,(E,M)=>C(E,M).pipe((0,b.T)(v=>[v])))},69944:(L,B,t)=>{"use strict";t.d(B,{FO:()=>M});var b=t(96354),e=t(89777),h=t(4093),p=t(8245);const E=v=>(m,f)=>{const g=(v=>{let m=v;for(;(0,e.Tn)(m.params.id)&&(0,e.a4)(m.parent);)m=m.parent;return m})(m);return v(g,f).pipe((0,h.Hz)(),(0,b.T)(y=>y.self))},M=(v,m,f=E,g)=>(0,p.h)((y,u)=>m(y,u),f(v()),g)},46828:(L,B,t)=>{"use strict";t.d(B,{z:()=>M});var b=t(7673),e=t(99437),h=t(96354),p=t(79096),C=t(32506),E=t(54438);let M=(()=>{class v{constructor(f,g){this.appConfig=f,this.restService=g}getLinks(f){return this.restService.get(`${this.appConfig.rest.baseUrl}/signposting/links/${f}`).pipe((0,e.W)(y=>(0,b.of)([])),(0,h.T)(y=>200===y.statusCode?y.payload:[]))}static{this.\u0275fac=function(g){return new(g||v)(E.KVO(p.vQ),E.KVO(C.Y))}}static{this.\u0275prov=E.jDH({token:v,factory:v.\u0275fac,providedIn:"root"})}}return v})()},13170:(L,B,t)=>{var b={"./custom/app/bitstream-page/edit-bitstream-page/edit-bitstream-page.component":[5445,5445]};function e(h){if(!t.o(b,h))return Promise.resolve().then(()=>{var E=new Error("Cannot find module '"+h+"'");throw E.code="MODULE_NOT_FOUND",E});var p=b[h],C=p[0];return t.e(p[1]).then(()=>t(C))}e.keys=()=>Object.keys(b),e.id=13170,L.exports=e}}]);