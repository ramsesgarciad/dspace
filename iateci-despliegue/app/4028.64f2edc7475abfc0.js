"use strict";(self.webpackChunkdspace_angular=self.webpackChunkdspace_angular||[]).push([[4028],{4028:(Ve,B,a)=>{a.r(B),a.d(B,{ROUTES:()=>Ue});var H=a(59072),K=a(7673),U=a(6170);const W=(0,a(61457).L)(()=>(0,K.of)(U._.IsCollectionAdmin));var Q=a(12808),Z=a(60892),q=a(38285),tt=a(8667),v=a(60177),T=a(58003),m=a(68018),y=a(84412),I=a(84572),u=a(96354),h=a(25558),et=a(99172),$=a(96697),V=a(43446),O=a(70998),nt=a(61206),ot=a(93136),c=a(4093),it=a(94314),st=a(82584),Y=a(50553),A=a(2180),d=a(89777),M=a(9847),F=a(89417),p=a(7901),at=a(92767),D=a(79104),lt=a(14744),J=a(15202),ct=a(2175),E=a(50186),rt=a(95386),dt=a(26773),t=a(54438);const P=()=>["dc.contributor.author","dc.creator","dc.contributor.*"],ut=o=>["/collections",o],pt=(o,l)=>({"btn-danger":o,"btn-primary":l});function mt(o,l){1&o&&(t.j41(0,"th",8),t.EFF(1),t.nI1(2,"translate"),t.k0s()),2&o&&(t.R7$(),t.JRh(t.bMT(2,1,"item.select.table.collection")))}function ht(o,l){if(1&o&&(t.j41(0,"a",10),t.EFF(1),t.k0s()),2&o){const e=t.XpG().ngVar,n=t.XpG(5);t.Y8G("routerLink",t.eq3(2,ut,null==e?null:e.id)),t.R7$(),t.SpI(" ",n.dsoNameService.getName(e)," ")}}function ft(o,l){if(1&o&&(t.j41(0,"span"),t.DNE(1,ht,2,4,"a",10),t.k0s()),2&o){const e=l.ngVar;t.R7$(),t.vxM(e?1:-1)}}function vt(o,l){if(1&o&&(t.j41(0,"td"),t.DNE(1,ft,2,1,"span",1),t.nI1(2,"async"),t.k0s()),2&o){let e;const n=t.XpG().$implicit;t.R7$(),t.Y8G("ngVar",null==(e=t.bMT(2,1,n.dso.owningCollection))?null:e.payload)}}function bt(o,l){if(1&o&&(t.j41(0,"span"),t.EFF(1),t.k0s()),2&o){const e=t.XpG().$implicit;t.R7$(),t.JRh(e.dso.firstMetadataValue(t.lJ4(1,P)))}}function Ct(o,l){if(1&o){const e=t.RV6();t.j41(0,"tr")(1,"td")(2,"input",9,0),t.nI1(4,"async"),t.nI1(5,"async"),t.nI1(6,"translate"),t.bIt("change",function(){const i=t.eBV(e).$implicit,s=t.XpG(3);return t.Njj(s.switch(i.dso.id))}),t.k0s()(),t.DNE(7,vt,3,3,"td"),t.j41(8,"td"),t.DNE(9,bt,2,2,"span"),t.k0s(),t.j41(10,"td")(11,"a",10),t.EFF(12),t.k0s()()()}if(2&o){const e=l.$implicit,n=t.sdS(3),i=t.XpG(3);t.R7$(2),t.FS9("name",e.dso.id),t.Y8G("disabled",!1===t.bMT(4,8,e.canSelect$))("ngModel",t.bMT(5,10,e.selected$)),t.BMQ("aria-label",t.bMT(6,12,n.checked?"item.select.table.deselect":"item.select.table.select")),t.R7$(5),t.vxM(i.hideCollection?-1:7),t.R7$(2),t.vxM(e.dso.hasMetadata(t.lJ4(14,P))?9:-1),t.R7$(2),t.Y8G("routerLink",e.route),t.R7$(),t.JRh(i.dsoNameService.getName(e.dso))}}function _t(o,l){if(1&o&&(t.j41(0,"ds-pagination",2)(1,"div",5)(2,"table",6)(3,"thead")(4,"tr")(5,"th")(6,"span",7),t.EFF(7),t.nI1(8,"translate"),t.k0s()(),t.DNE(9,mt,3,3,"th",8),t.j41(10,"th",8),t.EFF(11),t.nI1(12,"translate"),t.k0s(),t.j41(13,"th",8),t.EFF(14),t.nI1(15,"translate"),t.k0s()()(),t.j41(16,"tbody"),t.Z7z(17,Ct,13,15,"tr",null,t.fX1),t.nI1(19,"async"),t.k0s()()()()),2&o){const e=t.XpG().ngVar,n=t.XpG();t.Y8G("paginationOptions",n.paginationOptions)("sortOptions",n.sortOptions)("collectionSize",null==e||null==e.payload?null:e.payload.totalElements)("hidePagerWhenSinglePage",!0)("hideGear",!0),t.R7$(7),t.JRh(t.bMT(8,9,"item.select.table.selected")),t.R7$(2),t.vxM(n.hideCollection?-1:9),t.R7$(2),t.JRh(t.bMT(12,11,"item.select.table.author")),t.R7$(3),t.JRh(t.bMT(15,13,"item.select.table.title")),t.R7$(3),t.Dyx(t.bMT(19,15,n.selectItems$))}}function gt(o,l){1&o&&(t.j41(0,"div",3),t.EFF(1),t.nI1(2,"translate"),t.k0s()),2&o&&(t.R7$(),t.SpI(" ",t.bMT(2,1,"item.select.empty")," "))}function St(o,l){1&o&&(t.nrm(0,"ds-error",4),t.nI1(1,"translate")),2&o&&t.FS9("message",t.bMT(1,1,"error.items"))}function Tt(o,l){1&o&&(t.nrm(0,"ds-loading",4),t.nI1(1,"translate")),2&o&&t.FS9("message",t.bMT(1,1,"loading.items"))}function It(o,l){if(1&o){const e=t.RV6();t.j41(0,"div")(1,"button",11),t.bIt("click",function(){t.eBV(e);const i=t.XpG(2);return t.Njj(i.onCancel())}),t.EFF(2),t.nI1(3,"translate"),t.k0s(),t.j41(4,"button",12),t.bIt("click",function(){t.eBV(e);const i=t.XpG(2);return t.Njj(i.confirmSelected())}),t.EFF(5),t.nI1(6,"translate"),t.k0s()()}if(2&o){const e=l.ngVar,n=t.XpG(2);t.R7$(2),t.JRh(t.bMT(3,4,n.cancelButton)),t.R7$(2),t.Y8G("ngClass",t.l_i(8,pt,n.dangerConfirm,!n.dangerConfirm))("dsBtnDisabled",0===(null==e?null:e.length)),t.R7$(),t.SpI(" ",t.bMT(6,6,n.confirmButton)," ")}}function Rt(o,l){if(1&o&&(t.qex(0),t.DNE(1,_t,20,17,"ds-pagination",2)(2,gt,3,3,"div",3)(3,St,2,3,"ds-error",4)(4,Tt,2,3,"ds-loading",4)(5,It,7,11,"div",1),t.nI1(6,"async"),t.bVm()),2&o){const e=l.ngVar,n=t.XpG();t.R7$(),t.vxM((null==e||null==e.payload?null:e.payload.totalElements)>0?1:-1),t.R7$(),t.vxM(0===(null==e||null==e.payload?null:e.payload.totalElements)||0===(null==e||null==e.payload||null==e.payload.page?null:e.payload.page.length)?2:-1),t.R7$(),t.vxM(null!=e&&e.hasFailed?3:-1),t.R7$(),t.vxM(!e||null!=e&&e.isLoading?4:-1),t.R7$(),t.Y8G("ngVar",t.bMT(6,5,n.selectedIds$))}}let yt=(()=>{class o extends dt.h{constructor(){super(...arguments),this.hideCollection=!1}ngOnInit(){super.ngOnInit(),(0,d.hj)(this.confirmButton)||(this.confirmButton="item.select.confirm"),this.selectItems$=this.dsoRD$.pipe((0,d.Az)(),(0,c.Hz)(),(0,u.T)(e=>e.page.map(n=>Object.assign(new rt.A,{dso:n,canSelect$:this.canSelect(n),selected$:this.getSelected(n.id),route:(0,at._o)(n)}))))}static{this.\u0275fac=(()=>{let e;return function(i){return(e||(e=t.xGo(o)))(i||o)}})()}static{this.\u0275cmp=t.VBU({type:o,selectors:[["ds-item-select"]],inputs:{hideCollection:"hideCollection"},standalone:!0,features:[t.Vt3,t.aNF],decls:2,vars:3,consts:[["selectItemBtn",""],[4,"ngVar"],[3,"paginationOptions","sortOptions","collectionSize","hidePagerWhenSinglePage","hideGear"],["role","alert",1,"alert","alert-info","w-100"],[3,"message"],[1,"table-responsive","mt-2"],["id","item-select",1,"table","table-striped","table-hover"],[1,"sr-only"],["scope","col"],["type","checkbox",1,"item-checkbox",3,"change","disabled","ngModel","name"],[3,"routerLink"],[1,"btn","btn-outline-secondary","item-cancel","float-start",3,"click"],[1,"btn","item-confirm","float-end",3,"click","ngClass","dsBtnDisabled"]],template:function(n,i){1&n&&(t.DNE(0,Rt,7,7,"ng-container",1),t.nI1(1,"async")),2&n&&t.Y8G("ngVar",t.bMT(1,1,i.dsoRD$))},dependencies:[v.Jj,D.A,lt.A,F.YN,F.Zm,F.BC,F.vS,v.YU,ct.e,p.Wk,J.v,m.h,m.D9,E.r],encapsulation:2})}}return o})();var $t=a(30726),Mt=a(43144),Ft=a(33745),L=a(4600);const jt=["tabs"],Dt=o=>({name:o});function Et(o,l){if(1&o){const e=t.RV6();t.j41(0,"div",11)(1,"ds-item-select",12),t.nI1(2,"async"),t.bIt("confirm",function(i){t.eBV(e);const s=t.XpG();return t.Njj(s.mapItems(i,!0))})("cancel",function(){t.eBV(e);const i=t.XpG();return t.Njj(i.onCancel())}),t.k0s()()}if(2&o){let e;const n=t.XpG();t.R7$(),t.Y8G("key","browse")("dsoRD$",n.collectionItemsRD$)("paginationOptions",null==(e=t.bMT(2,7,n.searchOptions$))?null:e.pagination)("confirmButton","collection.edit.item-mapper.remove")("cancelButton","collection.edit.item-mapper.cancel")("dangerConfirm",!0)("hideCollection",!0)}}function Nt(o,l){if(1&o){const e=t.RV6();t.j41(0,"div")(1,"ds-item-select",17),t.nI1(2,"async"),t.bIt("confirm",function(i){t.eBV(e);const s=t.XpG(2);return t.Njj(s.mapItems(i))})("cancel",function(){t.eBV(e);const i=t.XpG(2);return t.Njj(i.onCancel())}),t.k0s()()}if(2&o){let e;const n=t.XpG(2);t.R7$(),t.Y8G("key","map")("dsoRD$",n.mappedItemsRD$)("paginationOptions",null==(e=t.bMT(2,6,n.searchOptions$))?null:e.pagination)("featureId",n.FeatureIds.CanManageMappings)("confirmButton","collection.edit.item-mapper.confirm")("cancelButton","collection.edit.item-mapper.cancel")}}function Gt(o,l){1&o&&(t.j41(0,"div",16),t.EFF(1),t.nI1(2,"translate"),t.k0s()),2&o&&(t.R7$(),t.SpI(" ",t.bMT(2,1,"collection.edit.item-mapper.no-search")," "))}function xt(o,l){if(1&o){const e=t.RV6();t.j41(0,"div",13)(1,"div",14)(2,"ds-search-form",15),t.nI1(3,"async"),t.nI1(4,"async"),t.nI1(5,"translate"),t.bIt("submitSearch",function(){t.eBV(e);const i=t.XpG();return t.Njj(i.performedSearch=!0)}),t.k0s()()(),t.DNE(6,Nt,3,8,"div")(7,Gt,3,3,"div",16)}if(2&o){let e,n;const i=t.XpG();t.R7$(2),t.Y8G("query",null==(e=t.bMT(3,7,i.searchOptions$))?null:e.query)("scope",null==(n=t.bMT(4,9,i.searchOptions$))?null:n.scope)("currentUrl","./")("inPlaceSearch",!0)("searchPlaceholder",t.bMT(5,11,"collection.edit.item-mapper.search-form.placeholder")),t.R7$(4),t.vxM(i.performedSearch?6:-1),t.R7$(),t.vxM(i.performedSearch?-1:7)}}let Xt=(()=>{class o{constructor(e,n,i,s,r,f,b,_){this.route=e,this.router=n,this.searchConfigService=i,this.searchService=s,this.notificationsService=r,this.itemDataService=f,this.translateService=b,this.dsoNameService=_,this.FeatureIds=U._,this.defaultSortOptions=new O.z("dc.title",O.U.ASC),this.performedSearch=!1}ngOnInit(){this.collectionRD$=this.route.parent.data.pipe((0,u.T)(e=>e.dso),(0,c.yd)()),this.collectionName$=this.collectionRD$.pipe((0,u.T)(e=>this.dsoNameService.getName(e.payload))),this.searchOptions$=this.searchConfigService.paginatedSearchOptions,this.loadItemLists()}loadItemLists(){this.shouldUpdate$=new y.t(!0);const e=(0,I.z)(this.collectionRD$,this.searchOptions$,this.shouldUpdate$);this.collectionItemsRD$=e.pipe((0,h.n)(([n,i,s])=>(!0===s&&this.shouldUpdate$.next(!1),this.itemDataService.findListByHref(n.payload._links.mappedItems.href,Object.assign(i,{currentPage:i.pagination.currentPage,elementsPerPage:i.pagination.pageSize,sort:this.defaultSortOptions}),!s,!1,(0,L.s)("owningCollection")).pipe((0,c.v7)())))),this.mappedItemsRD$=e.pipe((0,h.n)(([n,i,s])=>this.searchService.search(Object.assign(new $t.C(i),{query:this.buildQuery(n.payload.id,i.query),scope:void 0,dsoTypes:[ot.W.ITEM],sort:this.defaultSortOptions}),1e4,void 0,void 0,(0,L.s)("owningCollection")).pipe((0,c.jY)(),(0,et.Z)(void 0))))}mapItems(e,n){const i=this.collectionRD$.pipe((0,c.yd)(),(0,u.T)(s=>s.payload),(0,h.n)(s=>(0,I.z)(e.map(r=>n?this.itemDataService.removeMappingFromCollection(r,s.id).pipe((0,c.qD)()):this.itemDataService.mapToCollection(r,s._links.self.href).pipe((0,c.qD)())))));this.showNotifications(i,n)}showNotifications(e,n){const i=n?"unmap":"map";e.subscribe(s=>{const r=s.filter(b=>b.hasSucceeded),f=s.filter(b=>b.hasFailed);r.length>0&&((0,I.z)(this.translateService.get(`collection.edit.item-mapper.notifications.${i}.success.head`),this.translateService.get(`collection.edit.item-mapper.notifications.${i}.success.content`,{amount:r.length})).subscribe(([_,R])=>{this.notificationsService.success(_,R)}),this.shouldUpdate$.next(!0)),f.length>0&&(0,I.z)(this.translateService.get(`collection.edit.item-mapper.notifications.${i}.error.head`),this.translateService.get(`collection.edit.item-mapper.notifications.${i}.error.content`,{amount:f.length})).subscribe(([_,R])=>{this.notificationsService.error(_,R)}),this.switchToFirstTab()})}tabChange(e){this.performedSearch=!1,this.router.navigateByUrl(this.getCurrentUrl())}getCurrentUrl(){return this.router.url.indexOf("?")>-1?this.router.url.substring(0,this.router.url.indexOf("?")):this.router.url}buildQuery(e,n){const i=`-location.coll:"${e}"`;return(0,d.hj)(n)?`${i} AND ${n}`:i}switchToFirstTab(){this.tabs.select("browseTab")}onCancel(){this.collectionRD$.pipe((0,c.yd)(),(0,c.Bo)(),(0,$.s)(1)).subscribe(e=>{this.router.navigate(["/collections/",e.id])})}static{this.\u0275fac=function(n){return new(n||o)(t.rXU(p.nX),t.rXU(p.Ix),t.rXU(Y.EN),t.rXU(it.S),t.rXU(M.I),t.rXU(nt.ItemDataService),t.rXU(m.c$),t.rXU(V.f))}}static{this.\u0275cmp=t.VBU({type:o,selectors:[["ds-collection-item-mapper"]],viewQuery:function(n,i){if(1&n&&t.GBs(jt,5),2&n){let s;t.mGM(s=t.lsd())&&(i.tabs=s.first)}},standalone:!0,features:[t.Jv_([{provide:Y.EN,useClass:st.g}]),t.aNF],decls:26,vars:26,consts:[["tabs","ngbNav"],[1,"container"],[1,"row"],[1,"col-12"],["id","collection-name",3,"innerHTML"],["ngbNav","",1,"nav-tabs",3,"navChange","destroyOnHide"],["role","presentation","data-test","browseTab",3,"ngbNavItem"],["ngbNavLink",""],["ngbNavContent",""],["role","presentation","data-test","mapTab",3,"ngbNavItem"],[3,"ngbNavOutlet"],[1,"mt-2"],[1,"mt-2",3,"confirm","cancel","key","dsoRD$","paginationOptions","confirmButton","cancelButton","dangerConfirm","hideCollection"],[1,"row","mt-2"],[1,"col-12","col-lg-6"],["id","search-form",3,"submitSearch","query","scope","currentUrl","inPlaceSearch","searchPlaceholder"],["role","alert",1,"alert","alert-info","w-100"],[1,"mt-2",3,"confirm","cancel","key","dsoRD$","paginationOptions","featureId","confirmButton","cancelButton"]],template:function(n,i){if(1&n){const s=t.RV6();t.j41(0,"div",1)(1,"div",2)(2,"div",3)(3,"h2"),t.EFF(4),t.nI1(5,"translate"),t.k0s(),t.nrm(6,"p",4),t.nI1(7,"async"),t.nI1(8,"translate"),t.j41(9,"p"),t.EFF(10),t.nI1(11,"translate"),t.k0s(),t.j41(12,"ul",5,0),t.bIt("navChange",function(f){return t.eBV(s),t.Njj(i.tabChange(f))}),t.j41(14,"li",6)(15,"a",7),t.EFF(16),t.nI1(17,"translate"),t.k0s(),t.DNE(18,Et,3,9,"ng-template",8),t.k0s(),t.j41(19,"li",9),t.nI1(20,"dsBrowserOnly"),t.j41(21,"a",7),t.EFF(22),t.nI1(23,"translate"),t.k0s(),t.DNE(24,xt,8,13,"ng-template",8),t.k0s()(),t.nrm(25,"div",10),t.k0s()()()}if(2&n){const s=t.sdS(13);t.R7$(4),t.JRh(t.bMT(5,9,"collection.edit.item-mapper.head")),t.R7$(2),t.Y8G("innerHTML",t.i5U(8,13,"collection.edit.item-mapper.collection",t.eq3(24,Dt,t.bMT(7,11,i.collectionName$))),t.npT),t.R7$(4),t.JRh(t.bMT(11,16,"collection.edit.item-mapper.description")),t.R7$(2),t.Y8G("destroyOnHide",!0),t.R7$(2),t.Y8G("ngbNavItem","browseTab"),t.R7$(2),t.JRh(t.bMT(17,18,"collection.edit.item-mapper.tabs.browse")),t.R7$(3),t.Y8G("ngbNavItem",t.bMT(20,20,"mapTab")),t.R7$(3),t.JRh(t.bMT(23,22,"collection.edit.item-mapper.tabs.map")),t.R7$(3),t.Y8G("ngbNavOutlet",s)}},dependencies:[v.Jj,Ft.L,yt,T.Pv,T.Um,T.X9,T.sy,T.Ri,T.m_,Mt.d,m.h,m.D9],data:{animation:[A.qG,A.Ws]},changeDetection:0})}}return o})();var kt=a(21200);function Bt(o,l){1&o&&t.nrm(0,"ds-access-control-form-container",0),2&o&&t.Y8G("itemRD",l)("showLimitToSpecificBitstreams",!1)}let Ut=(()=>{class o{constructor(e){this.route=e}ngOnInit(){this.itemRD$=this.route.parent.parent.data.pipe((0,u.T)(e=>e.dso)).pipe((0,c.yd)())}static{this.\u0275fac=function(n){return new(n||o)(t.rXU(p.nX))}}static{this.\u0275cmp=t.VBU({type:o,selectors:[["ds-collection-access-control"]],standalone:!0,features:[t.aNF],decls:2,vars:3,consts:[["titleMessage","collection-access-control-title",3,"itemRD","showLimitToSpecificBitstreams"]],template:function(n,i){if(1&n&&(t.DNE(0,Bt,1,2,"ds-access-control-form-container",0),t.nI1(1,"async")),2&n){let s;t.vxM((s=t.bMT(1,1,i.itemRD$))?0:-1,s)}},dependencies:[kt.o,v.Jj]})}}return o})();var N=a(61594),Vt=a(80781);let Ot=(()=>{class o{constructor(e){this.route=e}ngOnInit(){this.dsoRD$=this.route.parent.parent.data.pipe((0,N.$)(),(0,u.T)(e=>e.dso))}static{this.\u0275fac=function(n){return new(n||o)(t.rXU(p.nX))}}static{this.\u0275cmp=t.VBU({type:o,selectors:[["ds-collection-authorizations"]],standalone:!0,features:[t.aNF],decls:3,vars:4,consts:[[1,"container"],[3,"resourceType","resourceUUID"]],template:function(n,i){if(1&n&&(t.j41(0,"div",0),t.nrm(1,"ds-resource-policies",1),t.nI1(2,"async"),t.k0s()),2&n){let s;t.R7$(),t.Y8G("resourceType","collection")("resourceUUID",null==(s=t.bMT(2,2,i.dsoRD$))||null==s.payload?null:s.payload.id)}},dependencies:[v.Jj,Vt.e],encapsulation:2})}}return o})();var j=a(5964),Yt=a(1144);const At=o=>({collection:o});let Jt=(()=>{class o{constructor(e,n){this.route=e,this.dsoNameService=n}ngOnInit(){this.dsoRD$=this.route.parent.data.pipe((0,$.s)(1),(0,u.T)(e=>e.dso)),this.collectionName$=this.dsoRD$.pipe((0,j.p)(e=>(0,d.a4)(e)),(0,u.T)(e=>this.dsoNameService.getName(e.payload)))}static{this.\u0275fac=function(n){return new(n||o)(t.rXU(p.nX),t.rXU(V.f))}}static{this.\u0275cmp=t.VBU({type:o,selectors:[["ds-collection-curate"]],standalone:!0,features:[t.aNF],decls:7,vars:11,consts:[[1,"container"],[3,"dsoHandle"]],template:function(n,i){if(1&n&&(t.j41(0,"div",0)(1,"h2"),t.EFF(2),t.nI1(3,"async"),t.nI1(4,"translate"),t.k0s(),t.nrm(5,"ds-curation-form",1),t.nI1(6,"async"),t.k0s()),2&n){let s;t.R7$(2),t.JRh(t.i5U(4,4,"collection.curate.header",t.eq3(9,At,t.bMT(3,2,i.collectionName$)))),t.R7$(3),t.Y8G("dsoHandle",null==(s=t.bMT(6,7,i.dsoRD$))?null:s.payload.handle)}},dependencies:[v.Jj,Yt.X,m.h,m.D9],encapsulation:2})}}return o})();var G=a(69295),Pt=a(58939),x=a(3601),Lt=a(48145),zt=a(15862),Ht=a(99125),Kt=a(22749),z=a(47067);function wt(o,l){if(1&o){const e=t.RV6();t.j41(0,"button",8),t.bIt("click",function(){t.eBV(e);const i=t.XpG(2);return t.Njj(i.addItemTemplate())}),t.nrm(1,"i",9),t.j41(2,"span",10),t.EFF(3),t.nI1(4,"translate"),t.k0s()()}2&o&&(t.R7$(3),t.SpI("\xa0",t.bMT(4,1,"collection.edit.template.add-button"),""))}function Wt(o,l){if(1&o){const e=t.RV6();t.j41(0,"button",11),t.bIt("click",function(){t.eBV(e);const i=t.XpG(2);return t.Njj(i.deleteItemTemplate())}),t.nrm(1,"i",12),t.j41(2,"span",10),t.EFF(3),t.nI1(4,"translate"),t.k0s()()}2&o&&(t.R7$(3),t.SpI("\xa0",t.bMT(4,1,"collection.edit.template.delete-button"),""))}function Qt(o,l){if(1&o&&(t.j41(0,"button",7),t.nI1(1,"async"),t.nrm(2,"i",13),t.j41(3,"span",10),t.EFF(4),t.nI1(5,"translate"),t.k0s()()),2&o){let e;const n=t.XpG(2);t.Y8G("routerLink","/collections/"+(null==(e=t.bMT(1,2,n.dsoRD$))?null:e.payload.uuid)+"/itemtemplate"),t.R7$(4),t.SpI("\xa0",t.bMT(5,4,"collection.edit.template.edit-button"),"")}}function Zt(o,l){if(1&o&&(t.j41(0,"div",2)(1,"span",3),t.EFF(2),t.nI1(3,"translate"),t.k0s(),t.j41(4,"div",4),t.DNE(5,wt,5,3,"button",5)(6,Wt,5,3,"button",6)(7,Qt,6,6,"button",7),t.k0s()()),2&o){const e=l.ngVar;t.R7$(2),t.JRh(t.bMT(3,4,"collection.edit.template.label")),t.R7$(3),t.vxM(null!=e&&e.payload?-1:5),t.R7$(),t.vxM(null!=e&&e.payload?6:-1),t.R7$(),t.vxM(null!=e&&e.payload?7:-1)}}let qt=(()=>{class o extends Ht.W{constructor(e,n,i,s,r,f,b,_){super(e,i,s,r,f),this.collectionDataService=e,this.itemTemplateService=n,this.router=i,this.route=s,this.notificationsService=r,this.translate=f,this.requestService=b,this.chd=_,this.frontendURL="/collections/",this.type=Lt.p.type}ngOnInit(){this.router.events.subscribe(e=>{(e instanceof p.wF||e instanceof p.OY&&e.routerEvent instanceof p.wF)&&(super.ngOnInit(),this.initTemplateItem(),this.chd.detectChanges())})}initTemplateItem(){this.itemTemplateRD$=this.dsoRD$.pipe((0,c.ak)(),(0,h.n)(e=>this.itemTemplateService.findByCollectionID(e.uuid)))}addItemTemplate(){const e=this.dsoRD$.pipe((0,c.ak)()),n=e.pipe((0,h.n)(s=>this.itemTemplateService.createByCollectionID(new zt.q,s.uuid).pipe((0,c.ak)()))),i=e.pipe((0,h.n)(s=>this.itemTemplateService.getCollectionEndpoint(s.id)));(0,I.z)(e,n,i).subscribe(([s,r,f])=>{this.requestService.setStaleByHrefSubstring(f),this.router.navigate([(0,z.dv)(s.uuid)])})}deleteItemTemplate(){this.dsoRD$.pipe((0,c.ak)(),(0,h.n)(e=>this.itemTemplateService.findByCollectionID(e.uuid)),(0,c.ak)(),(0,h.n)(e=>this.itemTemplateService.delete(e.uuid)),(0,c.qD)(),(0,u.T)(e=>(0,d.a4)(e)&&e.hasSucceeded)).subscribe(e=>{e?this.notificationsService.success(null,this.translate.get("collection.edit.template.notifications.delete.success")):this.notificationsService.error(null,this.translate.get("collection.edit.template.notifications.delete.error")),this.initTemplateItem()})}static{this.\u0275fac=function(n){return new(n||o)(t.rXU(G.CollectionDataService),t.rXU(Pt.d),t.rXU(p.Ix),t.rXU(p.nX),t.rXU(M.I),t.rXU(m.c$),t.rXU(x.B),t.rXU(t.gRc))}}static{this.\u0275cmp=t.VBU({type:o,selectors:[["ds-collection-metadata"]],standalone:!0,features:[t.Vt3,t.aNF],decls:4,vars:7,consts:[["class","container-fluid mb-2",4,"ngVar"],[3,"submitForm","back","finish","dso","isCreation"],[1,"container-fluid","mb-2"],[1,"d-inline-block","mb-2"],[1,"button-row","space-children-mr"],[1,"btn","btn-success"],[1,"btn","btn-danger"],[1,"btn","btn-primary",3,"routerLink"],[1,"btn","btn-success",3,"click"],["aria-hidden","true",1,"fas","fa-plus"],[1,"d-none","d-sm-inline"],[1,"btn","btn-danger",3,"click"],["aria-hidden","true",1,"fas","fa-trash-alt"],["aria-hidden","true",1,"fas","fa-edit"]],template:function(n,i){if(1&n&&(t.DNE(0,Zt,8,6,"div",0),t.nI1(1,"async"),t.j41(2,"ds-collection-form",1),t.nI1(3,"async"),t.bIt("submitForm",function(r){return i.onSubmit(r)})("back",function(){return i.navigateToHomePage()})("finish",function(){return i.navigateToHomePage()}),t.k0s()),2&n){let s;t.Y8G("ngVar",t.bMT(1,3,i.itemTemplateRD$)),t.R7$(2),t.Y8G("dso",null==(s=t.bMT(3,5,i.dsoRD$))?null:s.payload)("isCreation",!1)}},dependencies:[v.Jj,Kt.q,p.Wk,m.h,m.D9,E.r],encapsulation:2})}}return o})();var te=a(60185);function ee(o,l){if(1&o&&(t.nrm(0,"ds-comcol-role",1),t.nI1(1,"async")),2&o){const e=l.$implicit,n=t.XpG();t.Y8G("dso",t.bMT(1,2,n.collection$))("comcolRole",e)}}let ne=(()=>{class o{constructor(e){this.route=e}ngOnInit(){this.dsoRD$=this.route.parent.data.pipe((0,N.$)(),(0,u.T)(e=>e.dso)),this.collection$=this.dsoRD$.pipe((0,c.yd)(),(0,c.Bo)()),this.comcolRoles$=this.collection$.pipe((0,u.T)(e=>{let n=(0,d.a4)(e._links.workflowGroups)?e._links.workflowGroups:[];return Array.isArray(n)||(n=[n]),[{name:"collection-admin",href:e._links.adminGroup.href},{name:"submitters",href:e._links.submittersGroup.href},{name:"item_read",href:e._links.itemReadGroup.href},{name:"bitstream_read",href:e._links.bitstreamReadGroup.href},...n]}))}static{this.\u0275fac=function(n){return new(n||o)(t.rXU(p.nX))}}static{this.\u0275cmp=t.VBU({type:o,selectors:[["ds-collection-roles"]],standalone:!0,features:[t.aNF],decls:4,vars:2,consts:[[1,"custom-alignment"],[3,"dso","comcolRole"]],template:function(n,i){1&n&&(t.j41(0,"div",0),t.Z7z(1,ee,2,4,"ds-comcol-role",1,t.fX1),t.nI1(3,"async"),t.k0s()),2&n&&(t.R7$(),t.Dyx(t.bMT(3,0,i.comcolRoles$)))},dependencies:[v.Jj,te.J],encapsulation:2})}}return o})();var g=a(1473),oe=a(84418),X=a.n(oe),ie=a(78544),se=a(16289),S=a(43125),ae=a(86332),le=a(55929),k=a(88141),ce=a(4266),re=a(96766),de=a(60696),ue=a(50039),C=a(4589),pe=a(21626);function me(o,l){if(1&o){const e=t.RV6();t.j41(0,"button",5),t.bIt("click",function(){t.eBV(e);const i=t.XpG(2).ngVar,s=t.XpG();return t.Njj(s.testConfiguration(i))}),t.j41(1,"span"),t.EFF(2),t.nI1(3,"translate"),t.k0s()()}if(2&o){const e=t.XpG(3);t.Y8G("dsBtnDisabled",!e.isEnabled),t.R7$(2),t.JRh(t.bMT(3,2,"collection.source.controls.test.submit"))}}function he(o,l){1&o&&(t.j41(0,"button",3),t.nrm(1,"span",6),t.j41(2,"span"),t.EFF(3),t.nI1(4,"translate"),t.k0s()()),2&o&&(t.Y8G("dsBtnDisabled",!0),t.R7$(3),t.JRh(t.bMT(4,2,"collection.source.controls.test.running")))}function fe(o,l){if(1&o){const e=t.RV6();t.j41(0,"button",7),t.bIt("click",function(){t.eBV(e);const i=t.XpG(3);return t.Njj(i.importNow())}),t.j41(1,"span",8),t.EFF(2),t.nI1(3,"translate"),t.k0s()()}if(2&o){const e=t.XpG(3);t.Y8G("dsBtnDisabled",!e.isEnabled),t.R7$(2),t.JRh(t.bMT(3,2,"collection.source.controls.import.submit"))}}function ve(o,l){1&o&&(t.j41(0,"button",4),t.nrm(1,"span",6),t.j41(2,"span",8),t.EFF(3),t.nI1(4,"translate"),t.k0s()()),2&o&&(t.Y8G("dsBtnDisabled",!0),t.R7$(3),t.JRh(t.bMT(4,2,"collection.source.controls.import.running")))}function be(o,l){if(1&o){const e=t.RV6();t.j41(0,"button",7),t.bIt("click",function(){t.eBV(e);const i=t.XpG(3);return t.Njj(i.resetAndReimport())}),t.j41(1,"span",8),t.EFF(2),t.nI1(3,"translate"),t.k0s()()}if(2&o){const e=t.XpG(3);t.Y8G("dsBtnDisabled",!e.isEnabled),t.R7$(2),t.SpI("\xa0",t.bMT(3,2,"collection.source.controls.reset.submit"),"")}}function Ce(o,l){1&o&&(t.j41(0,"button",4),t.nrm(1,"span",6),t.j41(2,"span",8),t.EFF(3),t.nI1(4,"translate"),t.k0s()()),2&o&&(t.Y8G("dsBtnDisabled",!0),t.R7$(3),t.SpI("\xa0",t.bMT(4,2,"collection.source.controls.reset.running"),""))}function _e(o,l){if(1&o&&(t.j41(0,"div",1)(1,"h3"),t.EFF(2),t.nI1(3,"translate"),t.k0s(),t.j41(4,"div")(5,"span",2),t.EFF(6),t.nI1(7,"translate"),t.k0s(),t.j41(8,"span"),t.EFF(9),t.k0s()(),t.j41(10,"div")(11,"span",2),t.EFF(12),t.nI1(13,"translate"),t.k0s(),t.j41(14,"span"),t.EFF(15),t.nI1(16,"translate"),t.k0s()(),t.j41(17,"div")(18,"span",2),t.EFF(19),t.nI1(20,"translate"),t.k0s(),t.j41(21,"span"),t.EFF(22),t.nI1(23,"translate"),t.k0s()(),t.j41(24,"div")(25,"span",2),t.EFF(26),t.nI1(27,"translate"),t.k0s(),t.j41(28,"span"),t.EFF(29),t.nI1(30,"translate"),t.k0s()(),t.DNE(31,me,4,4,"button",3),t.nI1(32,"async"),t.DNE(33,he,5,4,"button",3),t.nI1(34,"async"),t.DNE(35,fe,4,4,"button",4),t.nI1(36,"async"),t.DNE(37,ve,5,4,"button",4),t.nI1(38,"async"),t.DNE(39,be,4,4,"button",4),t.nI1(40,"async"),t.DNE(41,Ce,5,4,"button",4),t.nI1(42,"async"),t.k0s()),2&o){const e=t.XpG().ngVar,n=t.XpG();t.R7$(2),t.JRh(t.bMT(3,15,"collection.source.controls.head")),t.R7$(4),t.JRh(t.bMT(7,17,"collection.source.controls.harvest.status")),t.R7$(3),t.JRh(null==e?null:e.harvestStatus),t.R7$(3),t.JRh(t.bMT(13,19,"collection.source.controls.harvest.start")),t.R7$(3),t.JRh(null!=e&&e.harvestStartTime?null==e?null:e.harvestStartTime:t.bMT(16,21,"collection.source.controls.harvest.no-information")),t.R7$(4),t.JRh(t.bMT(20,23,"collection.source.controls.harvest.last")),t.R7$(3),t.JRh(null!=e&&e.lastHarvested?null==e?null:e.lastHarvested:t.bMT(23,25,"collection.source.controls.harvest.no-information")),t.R7$(4),t.JRh(t.bMT(27,27,"collection.source.controls.harvest.message")),t.R7$(3),t.JRh(null!=e&&e.message?null==e?null:e.message:t.bMT(30,29,"collection.source.controls.harvest.no-information")),t.R7$(2),t.vxM(!0!==t.bMT(32,31,n.testConfigRunning$)?31:-1),t.R7$(2),t.vxM(t.bMT(34,33,n.testConfigRunning$)?33:-1),t.R7$(2),t.vxM(!0!==t.bMT(36,35,n.importRunning$)?35:-1),t.R7$(2),t.vxM(t.bMT(38,37,n.importRunning$)?37:-1),t.R7$(2),t.vxM(!0!==t.bMT(40,39,n.reImportRunning$)?39:-1),t.R7$(2),t.vxM(t.bMT(42,41,n.reImportRunning$)?41:-1)}}function ge(o,l){if(1&o&&(t.j41(0,"div"),t.DNE(1,_e,43,43,"div",1),t.k0s()),2&o){const e=t.XpG();t.R7$(),t.vxM(e.shouldShow?1:-1)}}let Se=(()=>{class o{constructor(e,n,i,s,r,f,b,_){this.scriptDataService=e,this.processDataService=n,this.requestService=i,this.notificationsService=s,this.collectionService=r,this.translateService=f,this.httpClient=b,this.bitstreamService=_,this.subs=[],this.autoRefreshIDs=[],this.testConfigRunning$=new y.t(!1),this.importRunning$=new y.t(!1),this.reImportRunning$=new y.t(!1)}ngOnInit(){this.contentSource$=this.collectionService.findByHref(this.collection._links.self.href,!1).pipe((0,c.Hz)(),(0,h.n)(e=>this.collectionService.getContentSource(e.uuid,!1)),(0,c.Hz)())}testConfiguration(e){this.testConfigRunning$.next(!0),this.subs.push(this.scriptDataService.invoke("harvest",[{name:"-g",value:null},{name:"-a",value:e.oaiSource},{name:"-i",value:(new ue.f).Serialize(e.oaiSetId)}],[]).pipe((0,c.qD)(),(0,k.M)(n=>{n.hasFailed&&(this.notificationsService.error(this.translateService.get("collection.source.controls.test.submit.error")),this.testConfigRunning$.next(!1))}),(0,j.p)(n=>n.hasSucceeded&&(0,d.a4)(n.payload)),(0,h.n)(n=>(this.autoRefreshIDs.push(n.payload.processId),this.processDataService.autoRefreshUntilCompletion(n.payload.processId))),(0,u.T)(n=>n.payload)).subscribe(n=>{n.processStatus.toString()===C.K[C.K.FAILED].toString()&&(this.notificationsService.error(this.translateService.get("collection.source.controls.test.failed")),this.testConfigRunning$.next(!1)),n.processStatus.toString()===C.K[C.K.COMPLETED].toString()&&(this.bitstreamService.findByHref(n._links.output.href).pipe((0,c.ak)()).subscribe(i=>{this.httpClient.get(i._links.content.href,{responseType:"text"}).subscribe(s=>{const r=s.replaceAll(new RegExp(".*\\@(.*)","g"),"$1").replaceAll("The script has started","").replaceAll("The script has completed","");this.notificationsService.info(this.translateService.get("collection.source.controls.test.completed"),r)})}),this.testConfigRunning$.next(!1))}))}importNow(){this.importRunning$.next(!0),this.subs.push(this.scriptDataService.invoke("harvest",[{name:"-r",value:null},{name:"-c",value:this.collection.uuid}],[]).pipe((0,c.qD)(),(0,k.M)(e=>{e.hasFailed?(this.notificationsService.error(this.translateService.get("collection.source.controls.import.submit.error")),this.importRunning$.next(!1)):this.notificationsService.success(this.translateService.get("collection.source.controls.import.submit.success"))}),(0,j.p)(e=>e.hasSucceeded&&(0,d.a4)(e.payload)),(0,h.n)(e=>(this.autoRefreshIDs.push(e.payload.processId),this.processDataService.autoRefreshUntilCompletion(e.payload.processId))),(0,u.T)(e=>e.payload)).subscribe(e=>{e.processStatus.toString()===C.K[C.K.FAILED].toString()&&(this.notificationsService.error(this.translateService.get("collection.source.controls.import.failed")),this.importRunning$.next(!1)),e.processStatus.toString()===C.K[C.K.COMPLETED].toString()&&(this.notificationsService.success(this.translateService.get("collection.source.controls.import.completed")),this.requestService.setStaleByHrefSubstring(this.collection._links.self.href),this.importRunning$.next(!1))}))}resetAndReimport(){this.reImportRunning$.next(!0),this.subs.push(this.scriptDataService.invoke("harvest",[{name:"-o",value:null},{name:"-c",value:this.collection.uuid}],[]).pipe((0,c.qD)(),(0,k.M)(e=>{e.hasFailed?(this.notificationsService.error(this.translateService.get("collection.source.controls.reset.submit.error")),this.reImportRunning$.next(!1)):this.notificationsService.success(this.translateService.get("collection.source.controls.reset.submit.success"))}),(0,j.p)(e=>e.hasSucceeded&&(0,d.a4)(e.payload)),(0,h.n)(e=>(this.autoRefreshIDs.push(e.payload.processId),this.processDataService.autoRefreshUntilCompletion(e.payload.processId))),(0,u.T)(e=>e.payload)).subscribe(e=>{e.processStatus.toString()===C.K[C.K.FAILED].toString()&&(this.notificationsService.error(this.translateService.get("collection.source.controls.reset.failed")),this.reImportRunning$.next(!1)),e.processStatus.toString()===C.K[C.K.COMPLETED].toString()&&(this.notificationsService.success(this.translateService.get("collection.source.controls.reset.completed")),this.requestService.setStaleByHrefSubstring(this.collection._links.self.href),this.reImportRunning$.next(!1))}))}ngOnDestroy(){this.subs.forEach(e=>{(0,d.a4)(e)&&e.unsubscribe()}),this.autoRefreshIDs.forEach(e=>{this.processDataService.stopAutoRefreshing(e)})}static{this.\u0275fac=function(n){return new(n||o)(t.rXU(de.ScriptDataService),t.rXU(re.ProcessDataService),t.rXU(x.B),t.rXU(M.I),t.rXU(G.CollectionDataService),t.rXU(m.c$),t.rXU(pe.Qq),t.rXU(ce.BitstreamDataService))}}static{this.\u0275cmp=t.VBU({type:o,selectors:[["ds-collection-source-controls"]],inputs:{isEnabled:"isEnabled",collection:"collection",shouldShow:"shouldShow"},standalone:!0,features:[t.aNF],decls:2,vars:3,consts:[[4,"ngVar"],[1,"container-fluid","space-children-mr"],[1,"fw-bold"],[1,"btn","btn-secondary",3,"dsBtnDisabled"],[1,"btn","btn-primary",3,"dsBtnDisabled"],[1,"btn","btn-secondary",3,"click","dsBtnDisabled"],["role","status","aria-hidden","true",1,"spinner-border","spinner-border-sm","spinner-button"],[1,"btn","btn-primary",3,"click","dsBtnDisabled"],[1,"d-none","d-sm-inline"]],template:function(n,i){1&n&&(t.DNE(0,ge,2,1,"div",0),t.nI1(1,"async")),2&n&&t.Y8G("ngVar",t.bMT(1,1,i.contentSource$))},dependencies:[v.Jj,D.A,m.h,m.D9,E.r],styles:[".spinner-button[_ngcontent-%COMP%]{margin-bottom:calc((var(--bs-line-height-base) * 1rem - var(--bs-font-size-base)) / 2)}"]})}}return o})();function Te(o,l){if(1&o){const e=t.RV6();t.j41(0,"button",13),t.nI1(1,"async"),t.bIt("click",function(){t.eBV(e);const i=t.XpG();return t.Njj(i.discard())}),t.nrm(2,"i",14),t.j41(3,"span",6),t.EFF(4),t.nI1(5,"translate"),t.k0s()()}if(2&o){const e=t.XpG();t.Y8G("dsBtnDisabled",!0!==t.bMT(1,2,e.hasChanges$)),t.R7$(4),t.SpI("\xa0",t.bMT(5,4,"item.edit.metadata.discard-button"),"")}}function Ie(o,l){if(1&o){const e=t.RV6();t.j41(0,"button",15),t.bIt("click",function(){t.eBV(e);const i=t.XpG();return t.Njj(i.reinstate())}),t.nrm(1,"i",16),t.j41(2,"span",6),t.EFF(3),t.nI1(4,"translate"),t.k0s()()}2&o&&(t.R7$(3),t.SpI("\xa0",t.bMT(4,1,"item.edit.metadata.reinstate-button"),""))}function Re(o,l){if(1&o){const e=t.RV6();t.j41(0,"div",7)(1,"input",17),t.bIt("change",function(){t.eBV(e);const i=t.XpG();return t.Njj(i.changeExternalSource())}),t.k0s(),t.j41(2,"label",18),t.EFF(3),t.nI1(4,"translate"),t.k0s()()}if(2&o){const e=t.XpG();t.R7$(),t.Y8G("checked",(null==e.contentSource?null:e.contentSource.harvestType)!==e.harvestTypeNone),t.R7$(2),t.JRh(t.bMT(4,2,"collection.edit.tabs.source.external"))}}function ye(o,l){1&o&&(t.nrm(0,"ds-loading",8),t.nI1(1,"translate")),2&o&&t.Y8G("message",t.bMT(1,1,"loading.content-source"))}function $e(o,l){1&o&&(t.j41(0,"h3"),t.EFF(1),t.nI1(2,"translate"),t.k0s()),2&o&&(t.R7$(),t.JRh(t.bMT(2,1,"collection.edit.tabs.source.form.head")))}function Me(o,l){if(1&o){const e=t.RV6();t.j41(0,"ds-form",19),t.bIt("dfChange",function(i){t.eBV(e);const s=t.XpG();return t.Njj(s.onChange(i))})("submitForm",function(){t.eBV(e);const i=t.XpG();return t.Njj(i.onSubmit())})("cancel",function(){t.eBV(e);const i=t.XpG();return t.Njj(i.onCancel())}),t.k0s()}if(2&o){const e=t.XpG();t.Y8G("formId","collection-source-form-id")("formGroup",e.formGroup)("formModel",e.formModel)("formLayout",e.formLayout)("displaySubmit",!1)("displayCancel",!1)}}function Fe(o,l){if(1&o){const e=t.RV6();t.j41(0,"button",13),t.nI1(1,"async"),t.bIt("click",function(){t.eBV(e);const i=t.XpG(2);return t.Njj(i.discard())}),t.nrm(2,"i",14),t.j41(3,"span",6),t.EFF(4),t.nI1(5,"translate"),t.k0s()()}if(2&o){const e=t.XpG(2);t.Y8G("dsBtnDisabled",!0!==t.bMT(1,2,e.hasChanges$)),t.R7$(4),t.SpI("\xa0",t.bMT(5,4,"item.edit.metadata.discard-button"),"")}}function je(o,l){if(1&o){const e=t.RV6();t.j41(0,"button",15),t.bIt("click",function(){t.eBV(e);const i=t.XpG(2);return t.Njj(i.reinstate())}),t.nrm(1,"i",16),t.j41(2,"span",6),t.EFF(3),t.nI1(4,"translate"),t.k0s()()}2&o&&(t.R7$(3),t.SpI("\xa0",t.bMT(4,1,"item.edit.metadata.reinstate-button"),""))}function De(o,l){if(1&o){const e=t.RV6();t.j41(0,"div",11)(1,"div",9)(2,"div",20)(3,"div",21),t.DNE(4,Fe,6,6,"button",2),t.nI1(5,"async"),t.DNE(6,je,5,3,"button",3),t.nI1(7,"async"),t.j41(8,"button",4),t.nI1(9,"async"),t.bIt("click",function(){t.eBV(e);const i=t.XpG();return t.Njj(i.onSubmit())}),t.nrm(10,"i",5),t.j41(11,"span",6),t.EFF(12),t.nI1(13,"translate"),t.k0s()()()()()()}if(2&o){const e=t.XpG();t.R7$(4),t.vxM(!0!==t.bMT(5,4,e.isReinstatable$)?4:-1),t.R7$(2),t.vxM(t.bMT(7,6,e.isReinstatable$)?6:-1),t.R7$(2),t.Y8G("dsBtnDisabled",!0!==t.bMT(9,8,e.hasChanges$)||!e.isValid()||e.initialHarvestType===e.harvestTypeNone&&e.contentSource.harvestType===e.initialHarvestType),t.R7$(4),t.SpI("\xa0",t.bMT(13,10,"item.edit.metadata.save-button"),"")}}let Ee=(()=>{class o extends le.F{constructor(e,n,i,s,r,f,b,_,R){super(e,n,i,s),this.objectUpdatesService=e,this.notificationsService=n,this.translateService=i,this.router=s,this.location=r,this.formService=f,this.route=b,this.collectionService=_,this.requestService=R,this.LABEL_KEY_PREFIX="collection.edit.tabs.source.form.",this.ERROR_KEY_PREFIX="collection.edit.tabs.source.form.errors.",this.OPTIONS_KEY_PREFIX="collection.edit.tabs.source.form.options.",this.oaiSourceModel=new g.rA_({id:"oaiSource",name:"oaiSource",required:!0,validators:{required:null},errorMessages:{required:"You must provide a set id of the target collection."}}),this.oaiSetIdModel=new g.rA_({id:"oaiSetId",name:"oaiSetId"}),this.metadataConfigIdModel=new g.z4z({id:"metadataConfigId",name:"metadataConfigId"}),this.harvestTypeModel=new g.tK_({id:"harvestType",name:"harvestType",options:[{value:S.s.Metadata},{value:S.s.MetadataAndRef},{value:S.s.MetadataAndBitstreams}]}),this.inputModels=[this.oaiSourceModel,this.oaiSetIdModel,this.metadataConfigIdModel,this.harvestTypeModel],this.formModel=[new g.iO5({id:"oaiSourceContainer",group:[this.oaiSourceModel]}),new g.iO5({id:"oaiSetContainer",group:[this.oaiSetIdModel,this.metadataConfigIdModel]}),new g.iO5({id:"harvestTypeContainer",group:[this.harvestTypeModel]})],this.formLayout={oaiSource:{grid:{host:"col-12 d-inline-block"}},oaiSetId:{grid:{host:"col col-sm-6 d-inline-block"}},metadataConfigId:{grid:{host:"col col-sm-6 d-inline-block"}},harvestType:{grid:{host:"col-12",option:"btn-outline-secondary"}},oaiSetContainer:{grid:{host:"row"}},oaiSourceContainer:{grid:{host:"row"}},harvestTypeContainer:{grid:{host:"row"}}},this.harvestTypeNone=S.s.None,this.previouslySelectedHarvestType=S.s.Metadata,this.displayedNotifications=[],this.subs=[]}ngOnInit(){super.ngOnInit(),this.notificationsPrefix="collection.edit.tabs.source.notifications.",this.discardTimeOut=ie.c.collection.edit.undoTimeout,this.formGroup=this.formService.createFormGroup(this.formModel),this.collectionRD$=this.route.parent.data.pipe((0,N.$)(),(0,u.T)(e=>e.dso)),this.collectionRD$.pipe((0,c.yd)(),(0,u.T)(e=>e.payload.uuid),(0,h.n)(e=>this.collectionService.getContentSource(e)),(0,c.qD)()).subscribe(e=>{this.initializeOriginalContentSource(e.payload)}),this.updateFieldTranslations(),this.subs.push(this.translateService.onLangChange.subscribe(()=>{this.updateFieldTranslations()}))}initializeOriginalContentSource(e){this.contentSource=e,this.initialHarvestType=e.harvestType,this.initializeMetadataConfigs();const n=X()(this.contentSource);this.objectUpdatesService.initialize(this.url,[n],new Date),this.update$=this.objectUpdatesService.getFieldUpdates(this.url,[n]).pipe((0,u.T)(i=>i[n.uuid])),this.subs.push(this.update$.subscribe(i=>{if(i){const s=i.field;let r;(0,d.a4)(this.contentSource)&&(0,d.hj)(this.contentSource.metadataConfigs)&&(r=this.contentSource.metadataConfigs[0].id),(0,d.a4)(s)&&(0,d.a4)(s.metadataConfigId)&&(r=s.metadataConfigId),(0,d.a4)(s)&&(this.formGroup.patchValue({oaiSourceContainer:{oaiSource:s.oaiSource},oaiSetContainer:{oaiSetId:s.oaiSetId,metadataConfigId:r},harvestTypeContainer:{harvestType:s.harvestType}}),this.contentSource=X()(s)),this.contentSource.metadataConfigId=r}}))}initializeMetadataConfigs(){this.metadataConfigIdModel.options=this.contentSource.metadataConfigs.map(e=>Object.assign({value:e.id,label:e.label})),this.metadataConfigIdModel.options.length>0&&this.formGroup.patchValue({oaiSetContainer:{metadataConfigId:this.metadataConfigIdModel.options[0].value}})}updateFieldTranslations(){this.inputModels.forEach(e=>{this.updateFieldTranslation(e)})}updateFieldTranslation(e){e.label=this.translateService.instant(this.LABEL_KEY_PREFIX+e.id),(0,d.hj)(e.validators)&&(e.errorMessages={},Object.keys(e.validators).forEach(n=>{e.errorMessages[n]=this.translateService.instant(this.ERROR_KEY_PREFIX+e.id+"."+n)})),e instanceof g.X7I&&(0,d.hj)(e.options)&&e.options.forEach(n=>{(0,d.Tn)(n.label)&&(n.label=this.translateService.instant(this.OPTIONS_KEY_PREFIX+e.id+"."+n.value))})}onChange(e){this.updateContentSourceField(e.model,!0),this.saveFieldUpdate()}onSubmit(){this.collectionRD$.pipe((0,c.yd)(),(0,u.T)(e=>e.payload.uuid),(0,h.n)(e=>this.collectionService.getHarvesterEndpoint(e)),(0,$.s)(1)).subscribe(e=>this.requestService.removeByHrefSubstring(e)),this.requestService.setStaleByHrefSubstring(this.contentSource._links.self.href),this.collectionRD$.pipe((0,c.yd)(),(0,u.T)(e=>e.payload.uuid),(0,h.n)(e=>this.collectionService.updateContentSource(e,this.contentSource)),(0,$.s)(1)).subscribe(e=>{(0,d.a4)(e.harvestType)?(this.clearNotifications(),this.initializeOriginalContentSource(e),this.displayedNotifications.push(this.notificationsService.success(this.getNotificationTitle("saved"),this.getNotificationContent("saved")))):this.displayedNotifications.push(e)})}onCancel(){this.location.back()}isValid(){return this.contentSource.harvestType===S.s.None||this.formGroup.valid}changeExternalSource(){this.contentSource.harvestType===S.s.None?this.contentSource.harvestType=this.previouslySelectedHarvestType:(this.previouslySelectedHarvestType=this.contentSource.harvestType,this.contentSource.harvestType=S.s.None),this.updateContentSource(!1)}updateContentSource(e){this.inputModels.forEach(n=>{this.updateContentSourceField(n,e)}),this.saveFieldUpdate()}updateContentSourceField(e,n){(0,d.a4)(e.value)&&(e.id!==this.harvestTypeModel.id||n)&&(this.contentSource[e.id]=e.value)}saveFieldUpdate(){this.objectUpdatesService.saveAddFieldUpdate(this.url,X()(this.contentSource))}clearNotifications(){this.displayedNotifications.forEach(e=>{this.notificationsService.remove(e)}),this.displayedNotifications=[]}ngOnDestroy(){this.subs.forEach(e=>e.unsubscribe())}static{this.\u0275fac=function(n){return new(n||o)(t.rXU(se.F),t.rXU(M.I),t.rXU(m.c$),t.rXU(p.Ix),t.rXU(v.aZ),t.rXU(g.J9r),t.rXU(p.nX),t.rXU(G.CollectionDataService),t.rXU(x.B))}}static{this.\u0275cmp=t.VBU({type:o,selectors:[["ds-collection-source"]],standalone:!0,features:[t.Vt3,t.aNF],decls:24,vars:27,consts:[[1,"container-fluid"],[1,"d-inline-block","float-end","space-children-mr"],[1,"btn","btn-danger",3,"dsBtnDisabled"],[1,"btn","btn-warning"],[1,"btn","btn-primary",3,"click","dsBtnDisabled"],[1,"fas","fa-save"],[1,"d-none","d-sm-inline"],[1,"form-check","mb-4"],[3,"message"],[1,"row"],[3,"formId","formGroup","formModel","formLayout","displaySubmit","displayCancel"],[1,"container","mt-2"],[3,"isEnabled","shouldShow","collection"],[1,"btn","btn-danger",3,"click","dsBtnDisabled"],[1,"fas","fa-times"],[1,"btn","btn-warning",3,"click"],[1,"fas","fa-undo-alt"],["type","checkbox","id","externalSourceCheck",1,"form-check-input",3,"change","checked"],["for","externalSourceCheck",1,"form-check-label"],[3,"dfChange","submitForm","cancel","formId","formGroup","formModel","formLayout","displaySubmit","displayCancel"],[1,"col-12"],[1,"d-inline-block","float-end","ms-1","space-children-mr"]],template:function(n,i){if(1&n&&(t.j41(0,"div",0)(1,"div",1),t.DNE(2,Te,6,6,"button",2),t.nI1(3,"async"),t.DNE(4,Ie,5,3,"button",3),t.nI1(5,"async"),t.j41(6,"button",4),t.nI1(7,"async"),t.bIt("click",function(){return i.onSubmit()}),t.nrm(8,"i",5),t.j41(9,"span",6),t.EFF(10),t.nI1(11,"translate"),t.k0s()()(),t.j41(12,"h2"),t.EFF(13),t.nI1(14,"translate"),t.k0s(),t.DNE(15,Re,5,4,"div",7)(16,ye,2,3,"ds-loading",8)(17,$e,3,3,"h3"),t.k0s(),t.j41(18,"div",9),t.DNE(19,Me,1,6,"ds-form",10),t.k0s(),t.DNE(20,De,14,12,"div",11),t.nrm(21,"ds-collection-source-controls",12),t.nI1(22,"async"),t.nI1(23,"async")),2&n){let s;t.R7$(2),t.vxM(!0!==t.bMT(3,13,i.isReinstatable$)?2:-1),t.R7$(2),t.vxM(t.bMT(5,15,i.isReinstatable$)?4:-1),t.R7$(2),t.Y8G("dsBtnDisabled",!0!==t.bMT(7,17,i.hasChanges$)||!i.isValid()||i.initialHarvestType===i.harvestTypeNone&&i.contentSource.harvestType===i.initialHarvestType),t.R7$(4),t.SpI("\xa0",t.bMT(11,19,"item.edit.metadata.save-button"),""),t.R7$(3),t.JRh(t.bMT(14,21,"collection.edit.tabs.source.head")),t.R7$(2),t.vxM(i.contentSource?15:-1),t.R7$(),t.vxM(i.contentSource?-1:16),t.R7$(),t.vxM(i.contentSource&&(null==i.contentSource?null:i.contentSource.harvestType)!==i.harvestTypeNone?17:-1),t.R7$(2),t.vxM(i.formGroup&&i.contentSource&&(null==i.contentSource?null:i.contentSource.harvestType)!==i.harvestTypeNone?19:-1),t.R7$(),t.vxM((null==i.contentSource?null:i.contentSource.harvestType)!==i.harvestTypeNone?20:-1),t.R7$(),t.Y8G("isEnabled",!0!==t.bMT(22,23,i.hasChanges$))("shouldShow",(null==i.contentSource?null:i.contentSource.harvestType)!==i.harvestTypeNone)("collection",null==(s=t.bMT(23,25,i.collectionRD$))?null:s.payload)}},dependencies:[v.Jj,D.A,Se,ae.s,J.v,m.h,m.D9],encapsulation:2})}}return o})();var Ne=a(41744);const Ge=o=>({active:o}),xe=o=>[o];function Xe(o,l){if(1&o&&(t.j41(0,"li",9)(1,"a",14),t.EFF(2),t.nI1(3,"translate"),t.k0s()()),2&o){const e=l.$implicit,n=t.XpG();t.R7$(),t.Y8G("ngClass",t.eq3(7,Ge,e===n.currentPage))("routerLink",t.eq3(9,xe,"./"+e)),t.BMQ("aria-selected",e===n.currentPage)("data-test",e),t.R7$(),t.SpI(" ",t.bMT(3,5,n.type+".edit.tabs."+e+".head")," ")}}function ke(o,l){if(1&o&&(t.j41(0,"a",13),t.nI1(1,"async"),t.nrm(2,"i",15),t.EFF(3),t.nI1(4,"translate"),t.k0s()),2&o){let e;const n=t.XpG();t.Y8G("routerLink",n.getPageUrl(null==(e=t.bMT(1,2,n.dsoRD$))?null:e.payload)),t.R7$(3),t.SpI(" ",t.bMT(4,4,n.type+".edit.return")," ")}}const Ue=[{path:"",resolve:{breadcrumb:H.S},data:{breadcrumbKey:"collection.edit"},component:(()=>{class o extends Ne.M{constructor(e,n){super(e,n),this.router=e,this.route=n,this.type="collection"}getPageUrl(e){return(0,z.JW)(e.id)}static{this.\u0275fac=function(n){return new(n||o)(t.rXU(p.Ix),t.rXU(p.nX))}}static{this.\u0275cmp=t.VBU({type:o,selectors:[["ds-edit-collection"]],standalone:!0,features:[t.Vt3,t.aNF],decls:22,vars:10,consts:[[1,"container"],[1,"row"],[1,"col-12"],[1,"d-flex","justify-content-between","border-bottom"],[1,"my-auto"],["data-test","delete-button",1,"btn","btn-danger",3,"routerLink"],["aria-hidden","true",1,"fas","fa-trash"],[1,"pt-2"],["role","tablist",1,"nav","nav-tabs","justify-content-start","mb-2"],["role","presentation",1,"nav-item"],[1,"tab-pane","active"],[1,"mb-4"],[1,"col-12","text-end","custom-alignment"],[1,"btn","btn-outline-secondary",3,"routerLink"],["role","tab",1,"nav-link",3,"ngClass","routerLink"],["aria-hidden","true",1,"fas","fa-arrow-left"]],template:function(n,i){if(1&n&&(t.j41(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"h1"),t.EFF(5),t.nI1(6,"translate"),t.k0s(),t.j41(7,"div",4)(8,"a",5),t.nI1(9,"async"),t.nrm(10,"i",6),t.EFF(11),t.nI1(12,"translate"),t.k0s()()(),t.j41(13,"div",7)(14,"ul",8),t.Z7z(15,Xe,4,11,"li",9,t.fX1),t.k0s(),t.j41(17,"div",10)(18,"div",11),t.nrm(19,"router-outlet"),t.k0s(),t.j41(20,"div",12),t.DNE(21,ke,5,6,"a",13),t.k0s()()()()()()),2&n){let s;t.R7$(5),t.JRh(t.bMT(6,4,i.type+".edit.head")),t.R7$(3),t.Y8G("routerLink",("community"===i.type?"/communities/":"/collections/")+(null==(s=t.bMT(9,6,i.dsoRD$))?null:s.payload.uuid)+"/delete"),t.R7$(3),t.SpI(" ",t.bMT(12,8,i.type+".edit.delete"),""),t.R7$(4),t.Dyx(i.pages),t.R7$(6),t.vxM(i.hideReturnButton?-1:21)}},dependencies:[v.Jj,v.YU,p.Wk,p.n3,m.h,m.D9],styles:["[_nghost-%COMP%]     #oaiSetContainer>:first-child{padding-left:0}[_nghost-%COMP%]     #oaiSetContainer>:last-child{padding-right:0}"]})}}return o})(),canActivate:[W],children:[{path:"",redirectTo:"metadata",pathMatch:"full"},{path:"metadata",component:qt,data:{title:"collection.edit.tabs.metadata.title",hideReturnButton:!0,showBreadcrumbs:!0}},{path:"roles",component:ne,data:{title:"collection.edit.tabs.roles.title",showBreadcrumbs:!0}},{path:"source",component:Ee,data:{title:"collection.edit.tabs.source.title",showBreadcrumbs:!0}},{path:"curate",component:Jt,data:{title:"collection.edit.tabs.curate.title",showBreadcrumbs:!0}},{path:"access-control",component:Ut,data:{title:"collection.edit.tabs.access-control.title",showBreadcrumbs:!0}},{path:"authorizations",data:{showBreadcrumbs:!0},children:[{path:"create",resolve:{resourcePolicyTarget:tt.Q},component:Q.m,data:{title:"resource-policies.create.page.title"}},{path:"edit",resolve:{resourcePolicy:q.n},component:Z._,data:{title:"resource-policies.edit.page.title"}},{path:"",component:Ot,data:{title:"collection.edit.tabs.authorizations.title",showBreadcrumbs:!0}}]},{path:"mapper",component:Xt,data:{title:"collection.edit.tabs.item-mapper.title",hideReturnButton:!0,showBreadcrumbs:!0}}]}]}}]);