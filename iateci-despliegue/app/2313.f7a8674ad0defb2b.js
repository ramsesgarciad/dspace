"use strict";(self.webpackChunkdspace_angular=self.webpackChunkdspace_angular||[]).push([[2313,3017],{33017:(J,S,s)=>{s.r(S),s.d(S,{ResourcePolicyDataService:()=>Q});var y=s(21626),t=s(96354),R=s(61594),P=s(89777),F=s(9847),A=s(57775),E=s(10186),L=s(81948),N=s(18328),W=s(72073),d=s(20881),j=s(4318),p=s(60796),$=s(96443),K=s(36343),m=s(49755),O=s(3601),h=s(74642),v=s(13817),T=s(2086),M=s(7094),e=s(4093),b=s(54438);let Q=(()=>{class X extends d.W{constructor(n,l,I,D,U,C,V,x){super("resourcepolicies",n,l,I,D),this.requestService=n,this.rdbService=l,this.objectCache=I,this.halService=D,this.notificationsService=U,this.comparator=C,this.ePersonService=V,this.groupService=x,this.searchByEPersonMethod="eperson",this.searchByGroupMethod="group",this.searchByResourceMethod="resource",this.createData=new N.V(this.linkPath,n,l,I,D,U,this.responseMsToLive),this.searchData=new p.X(this.linkPath,n,l,I,D,this.responseMsToLive),this.patchData=new j.n(this.linkPath,n,l,I,D,C,this.responseMsToLive,this.constructIdEndpoint),this.deleteData=new W.I(this.linkPath,n,l,I,D,U,this.responseMsToLive,this.constructIdEndpoint)}create(n,l,I,D){const U=[];return U.push(new E.x("resource",l)),(0,P.hj)(I)?U.push(new E.x("eperson",I)):(0,P.hj)(D)&&U.push(new E.x("group",D)),this.createData.create(n,...U)}delete(n){return this.deleteData.delete(n).pipe((0,e.qD)(),(0,t.T)(l=>l.hasSucceeded))}update(n){return this.patchData.update(n)}getDefaultAccessConditionsFor(n,l){return this.findListByHref(n._links.defaultAccessConditions.href,l)}searchByEPerson(n,l,I=!0,D=!0,...U){const C=new K._;return C.searchParams=[new E.x("uuid",n)],(0,P.hj)(l)&&C.searchParams.push(new E.x("resource",l)),this.searchData.searchBy(this.searchByEPersonMethod,C,I,D,...U)}searchByGroup(n,l,I=!0,D=!0,...U){const C=new K._;return C.searchParams=[new E.x("uuid",n)],(0,P.hj)(l)&&C.searchParams.push(new E.x("resource",l)),this.searchData.searchBy(this.searchByGroupMethod,C,I,D,...U)}searchByResource(n,l,I=!0,D=!0,...U){const C=new K._;return C.searchParams=[new E.x("uuid",n)],(0,P.hj)(l)&&C.searchParams.push(new E.x("action",l)),this.searchData.searchBy(this.searchByResourceMethod,C,I,D,...U)}updateTarget(n,l,I,D){const C=("eperson"===D?this.ePersonService:this.groupService).getIDHrefObs(I),V=Object.create({});let x=new y.Lr;x=x.append("Content-Type","text/uri-list"),V.headers=x;const z=this.requestService.generateRequestId();return C.pipe((0,R.$)()).subscribe(Z=>{const u=new m.v_(z,l+"/"+D,Z,V);Object.assign(u,{getResponseParser:()=>h.M}),this.requestService.send(u)}),this.rdbService.buildFromRequestUUIDAndAwait(z,()=>this.invalidateByHref(l))}static{this.\u0275fac=function(l){return new(l||X)(b.KVO(O.B),b.KVO(A.o),b.KVO(L.$),b.KVO(M.Y),b.KVO(F.I),b.KVO($.Y),b.KVO(v.EPersonDataService),b.KVO(T.GroupDataService))}}static{this.\u0275prov=b.jDH({token:X,factory:X.\u0275fac,providedIn:"root"})}}return X})()},12808:(J,S,s)=>{s.d(S,{m:()=>p});var y=s(68018),t=s(84412),R=s(96354),P=s(96697),F=s(43446),A=s(33017),E=s(4093),L=s(55743),N=s(9847),W=s(14120),d=s(54438),j=s(7901);let p=(()=>{class ${constructor(m,O,h,v,T,M){this.dsoNameService=m,this.notificationsService=O,this.resourcePolicyService=h,this.route=v,this.router=T,this.translate=M,this.processing$=new t.t(!1)}ngOnInit(){this.route.data.pipe((0,R.T)(m=>m),(0,P.s)(1)).subscribe(m=>{this.targetResourceUUID=m.resourcePolicyTarget.payload.id,this.targetResourceName=this.dsoNameService.getName(m.resourcePolicyTarget.payload)})}isProcessing(){return this.processing$.asObservable()}redirectToAuthorizationsPage(){this.router.navigate([`../../${L.K4}`],{relativeTo:this.route})}createResourcePolicy(m){let O;this.processing$.next(!0),O="eperson"===m.target.type?this.resourcePolicyService.create(m.object,this.targetResourceUUID,m.target.uuid):this.resourcePolicyService.create(m.object,this.targetResourceUUID,null,m.target.uuid),O.pipe((0,E.qD)()).subscribe(h=>{this.processing$.next(!1),h.hasSucceeded?(this.notificationsService.success(null,this.translate.get("resource-policies.create.page.success.content")),this.redirectToAuthorizationsPage()):this.notificationsService.error(null,this.translate.get("resource-policies.create.page.failure.content"))})}static{this.\u0275fac=function(O){return new(O||$)(d.rXU(F.f),d.rXU(N.I),d.rXU(A.ResourcePolicyDataService),d.rXU(j.nX),d.rXU(j.Ix),d.rXU(y.c$))}}static{this.\u0275cmp=d.VBU({type:$,selectors:[["ds-resource-policy-create"]],standalone:!0,features:[d.aNF],decls:5,vars:5,consts:[[1,"container"],[1,"mb-3"],[3,"reset","submit","isProcessing"]],template:function(O,h){1&O&&(d.j41(0,"div",0)(1,"h1",1),d.EFF(2),d.nI1(3,"translate"),d.k0s(),d.j41(4,"ds-resource-policy-form",2),d.bIt("reset",function(){return h.redirectToAuthorizationsPage()})("submit",function(T){return h.createResourcePolicy(T)}),d.k0s()()),2&O&&(d.R7$(2),d.Lme("",d.bMT(3,3,"resource-policies.create.page.heading")," ",h.targetResourceName,""),d.R7$(2),d.Y8G("isProcessing",h.isProcessing()))},dependencies:[W.y,y.h,y.D9],encapsulation:2})}}return $})()},60892:(J,S,s)=>{s.d(S,{_:()=>K});var y=s(68018),t=s(84412),R=s(7673),P=s(84572),F=s(96354),A=s(96697),E=s(10129),L=s(33017),N=s(4093),W=s(55743),d=s(9847),j=s(14120),p=s(54438),$=s(7901);let K=(()=>{class m{constructor(h,v,T,M,e){this.notificationsService=h,this.resourcePolicyService=v,this.route=T,this.router=M,this.translate=e,this.processing$=new t.t(!1)}ngOnInit(){this.route.data.pipe((0,F.T)(h=>h),(0,A.s)(1)).subscribe(h=>{this.resourcePolicy=h.resourcePolicy.payload})}isProcessing(){return this.processing$.asObservable()}redirectToAuthorizationsPage(){this.router.navigate([`../../${W.K4}`],{relativeTo:this.route})}updateResourcePolicy(h){this.processing$.next(!0);const v=Object.assign({},h.object,{id:this.resourcePolicy.id,type:E.O.value,_links:this.resourcePolicy._links}),T=h.updateTarget?this.resourcePolicyService.updateTarget(this.resourcePolicy.id,this.resourcePolicy._links.self.href,h.target.uuid,h.target.type).pipe((0,N.qD)(),(0,F.T)(e=>e&&e.hasSucceeded)):(0,R.of)(!0),M=this.resourcePolicyService.update(v).pipe((0,N.qD)(),(0,F.T)(e=>e&&e.hasSucceeded));(0,P.z)([T,M]).subscribe(([e,b])=>{this.processing$.next(!1),e&&b?(this.notificationsService.success(null,this.translate.get("resource-policies.edit.page.success.content")),this.redirectToAuthorizationsPage()):this.notificationsService.error(null,this.translate.get(b?"resource-policies.edit.page.target-failure.content":e?"resource-policies.edit.page.other-failure.content":"resource-policies.edit.page.failure.content"))})}static{this.\u0275fac=function(v){return new(v||m)(p.rXU(d.I),p.rXU(L.ResourcePolicyDataService),p.rXU($.nX),p.rXU($.Ix),p.rXU(y.c$))}}static{this.\u0275cmp=p.VBU({type:m,selectors:[["ds-resource-policy-edit"]],standalone:!0,features:[p.aNF],decls:5,vars:6,consts:[[1,"container"],[1,"mb-3"],[3,"reset","submit","resourcePolicy","isProcessing"]],template:function(v,T){1&v&&(p.j41(0,"div",0)(1,"h1",1),p.EFF(2),p.nI1(3,"translate"),p.k0s(),p.j41(4,"ds-resource-policy-form",2),p.bIt("reset",function(){return T.redirectToAuthorizationsPage()})("submit",function(e){return T.updateResourcePolicy(e)}),p.k0s()()),2&v&&(p.R7$(2),p.Lme("",p.bMT(3,4,"resource-policies.edit.page.heading")," ",T.resourcePolicy.id,""),p.R7$(2),p.Y8G("resourcePolicy",T.resourcePolicy)("isProcessing",T.isProcessing()))},dependencies:[j.y,y.h,y.D9],encapsulation:2})}}return m})()},14120:(J,S,s)=>{s.d(S,{y:()=>oe});var y=s(60177),t=s(54438),R=s(58003),P=s(1473),F=s(68018),A=s(7673),E=s(84412),L=s(84572),N=s(96354),W=s(5964),d=s(96697),j=s(43446),p=s(3601),$=s(13817),K=s(2086),m=s(77123),O=s(10129),h=s(4093),v=s(79104),T=s(50813),M=s(89777),e=s(80094),b=s(6549),Q=s(58901),X=s(86332),ee=s(70338),n=s(32795),l=s(36835);const I=[{label:l.t.TYPE_SUBMISSION,value:l.t.TYPE_SUBMISSION},{label:l.t.TYPE_WORKFLOW,value:l.t.TYPE_WORKFLOW},{label:l.t.TYPE_INHERITED,value:l.t.TYPE_INHERITED},{label:l.t.TYPE_CUSTOM,value:l.t.TYPE_CUSTOM}],D=[{label:n.X.READ.toString(),value:n.X.READ},{label:n.X.WRITE.toString(),value:n.X.WRITE},{label:n.X.REMOVE.toString(),value:n.X.REMOVE},{label:n.X.ADMIN.toString(),value:n.X.ADMIN},{label:n.X.DELETE.toString(),value:n.X.DELETE},{label:n.X.WITHDRAWN_READ.toString(),value:n.X.WITHDRAWN_READ},{label:n.X.DEFAULT_BITSTREAM_READ.toString(),value:n.X.DEFAULT_BITSTREAM_READ},{label:n.X.DEFAULT_ITEM_READ.toString(),value:n.X.DEFAULT_ITEM_READ}],U={id:"name",label:"resource-policies.form.name.label",maxLength:30,hint:"resource-policies.form.name.hint",metadataFields:[],repeatable:!1,submissionId:"",hasSelectableMetadata:!1},C={id:"description",label:"resource-policies.form.description.label",metadataFields:[],repeatable:!1,rows:10,submissionId:"",hasSelectableMetadata:!1},V={id:"policyType",label:"resource-policies.form.policy-type.label",options:I,required:!0,validators:{required:null},errorMessages:{required:"resource-policies.form.policy-type.required"}},x={id:"action",label:"resource-policies.form.action-type.label",options:D,required:!0,validators:{required:null},errorMessages:{required:"resource-policies.form.action-type.required"}},z={id:"date",group:[]},Z={element:{control:"row"}},w={id:"start",label:"resource-policies.form.date.start.label",placeholder:"resource-policies.form.date.start.label",inline:!1,toggleIcon:"far fa-calendar-alt"},u={element:{container:"p-0",label:"col-form-label"},grid:{host:"col-md-6"}},Y={id:"end",label:"resource-policies.form.date.end.label",placeholder:"resource-policies.form.date.end.label",inline:!1,toggleIcon:"far fa-calendar-alt"},i={element:{container:"p-0",label:"col-form-label"},grid:{host:"col-md-6"}},a=["content"];function o(f,q){if(1&f&&t.nrm(0,"ds-form",3,2),2&f){const r=t.XpG();t.Y8G("formId",r.formId)("formModel",r.formModel)("displaySubmit",!1)("displayCancel",!1)}}function B(f,q){if(1&f){const r=t.RV6();t.j41(0,"ds-eperson-group-list",16),t.bIt("select",function(_){t.eBV(r);const g=t.XpG();return t.Njj(g.updateObjectSelected(_,!0))}),t.k0s()}}function G(f,q){if(1&f){const r=t.RV6();t.j41(0,"ds-eperson-group-list",17),t.bIt("select",function(_){t.eBV(r);const g=t.XpG();return t.Njj(g.updateObjectSelected(_,!1))}),t.k0s()}2&f&&t.Y8G("isListOfEPerson",!1)}function te(f,q){1&f&&(t.j41(0,"span"),t.nrm(1,"i",18),t.EFF(2),t.nI1(3,"translate"),t.k0s()),2&f&&(t.R7$(2),t.SpI(" ",t.bMT(3,1,"submission.workflow.tasks.generic.processing")," "))}function se(f,q){1&f&&(t.j41(0,"span"),t.EFF(1),t.nI1(2,"translate"),t.k0s()),2&f&&(t.R7$(),t.SpI(" ",t.bMT(2,1,"form.submit")," "))}function re(f,q){if(1&f){const r=t.RV6();t.j41(0,"div",19)(1,"h4",20),t.EFF(2),t.nI1(3,"translate"),t.k0s(),t.j41(4,"button",21),t.bIt("click",function(){const _=t.eBV(r).$implicit;return t.Njj(_.close())}),t.k0s()(),t.j41(5,"div",22)(6,"div",23)(7,"div",24),t.nrm(8,"i",25),t.k0s(),t.j41(9,"div"),t.nrm(10,"p",26),t.nI1(11,"translate"),t.nrm(12,"p",27),t.nI1(13,"translate"),t.k0s()()(),t.j41(14,"div",28)(15,"button",29),t.bIt("click",function(){const _=t.eBV(r).$implicit;return t.Njj(_.close())}),t.EFF(16),t.nI1(17,"translate"),t.k0s()()}if(2&f){const r=t.XpG();t.R7$(2),t.JRh(t.bMT(3,4,"resource-policies.form.eperson-group-list.modal.header")),t.R7$(8),t.Y8G("innerHTML",t.bMT(11,6,"eperson"===r.navActiveId?"resource-policies.form.eperson-group-list.modal.text1.toGroup":"resource-policies.form.eperson-group-list.modal.text1.toEPerson"),t.npT),t.R7$(2),t.Y8G("innerHTML",t.bMT(13,8,"resource-policies.form.eperson-group-list.modal.text2"),t.npT),t.R7$(4),t.JRh(t.bMT(17,10,"resource-policies.form.eperson-group-list.modal.close"))}}let oe=(()=>{class f{constructor(r,c,_,g,k,H){this.dsoNameService=r,this.ePersonService=c,this.formService=_,this.groupService=g,this.requestService=k,this.modalService=H,this.isProcessing=(0,A.of)(!1),this.reset=new t.bkB,this.submit=new t.bkB,this.resourcePolicyTargetName$=new E.t(""),this.subs=[],this.resourcePolicyTargetUpdated=!1}ngOnInit(){if(this.isActive=!0,this.formId=this.formService.getUniqueId("resource-policy-form"),this.formModel=this.buildResourcePolicyForm(),this.isBeingEdited()){const r=this.ePersonService.findByHref(this.resourcePolicy._links.eperson.href,!1).pipe((0,h.yd)()),c=this.groupService.findByHref(this.resourcePolicy._links.group.href,!1).pipe((0,h.yd)()),_=(0,L.z)([r,c]).pipe((0,N.T)(g=>g.find(k=>(0,M.hj)(k.payload))),(0,M.Az)());this.subs.push(_.pipe((0,W.p)(()=>this.isActive)).subscribe(g=>{this.resourcePolicyGrant=g.payload,this.navActiveId=String(g.payload.type),this.resourcePolicyTargetName$.next(this.getResourcePolicyTargetName())}))}}isFormValid(){return this.formService.isValid(this.formId).pipe((0,N.T)(r=>r&&(0,M.hj)(this.resourcePolicyGrant)))}buildResourcePolicyForm(){const r=[];r.push(new b.C(U),new Q.E(C),new P.z4z(V),new P.z4z(x));const c=new P.dku(w,u),_=new P.dku(Y,i),g=Object.assign({},z,{group:[]});return g.group.push(c,_),r.push(new P.iO5(g,Z)),this.initModelsValue(r),r}initModelsValue(r){return this.resourcePolicy&&r.forEach(c=>{"date"===c.id?((0,M.a4)(this.resourcePolicy.startDate)&&(c.get(0).value=(0,T.PR)(this.resourcePolicy.startDate)),(0,M.a4)(this.resourcePolicy.endDate)&&(c.get(1).value=(0,T.PR)(this.resourcePolicy.endDate))):this.resourcePolicy.hasOwnProperty(c.id)&&this.resourcePolicy[c.id]&&(c.value=this.resourcePolicy[c.id])}),r}isBeingEdited(){return!(0,M.Im)(this.resourcePolicy)}getResourcePolicyTargetName(){return(0,M.hj)(this.resourcePolicyGrant)?this.dsoNameService.getName(this.resourcePolicyGrant):""}updateObjectSelected(r,c){this.resourcePolicyTargetUpdated=!0,this.resourcePolicyGrant=r,this.resourcePolicyGrantType=c?"eperson":"group",this.resourcePolicyTargetName$.next(this.getResourcePolicyTargetName())}onReset(){this.reset.emit()}onSubmit(){this.formService.getFormData(this.formId).pipe((0,d.s)(1)).subscribe(r=>{const c=Object.create({});c.object=this.createResourcePolicyByFormData(r),c.target={type:this.resourcePolicyGrantType,uuid:this.resourcePolicyGrant.id},c.updateTarget=this.resourcePolicyTargetUpdated,this.submit.emit(c)})}createResourcePolicyByFormData(r){const c=new m.h;return c.name=r.name?r.name[0].value:null,c.description=r.description?r.description[0].value:null,c.policyType=r.policyType?r.policyType[0].value:null,c.action=r.action?r.action[0].value:null,c.startDate=r.date&&r.date.start?(0,T.Sd)(r.date.start[0].value):null,c.endDate=r.date&&r.date.end?(0,T.Sd)(r.date.end[0].value):null,c.type=O.O,c}ngOnDestroy(){this.isActive=!1,this.formModel=null,this.subs.filter(r=>(0,M.a4)(r)).forEach(r=>r.unsubscribe())}onNavChange(r){this.isBeingEdited()&&(r.preventDefault(),this.modalService.open(this.content))}static{this.\u0275fac=function(c){return new(c||f)(t.rXU(j.f),t.rXU($.EPersonDataService),t.rXU(ee.u),t.rXU(K.GroupDataService),t.rXU(p.B),t.rXU(R.Bq))}}static{this.\u0275cmp=t.VBU({type:f,selectors:[["ds-resource-policy-form"]],viewQuery:function(c,_){if(1&c&&t.GBs(a,5),2&c){let g;t.mGM(g=t.lsd())&&(_.content=g.first)}},inputs:{resourcePolicy:"resourcePolicy",isProcessing:"isProcessing"},outputs:{reset:"reset",submit:"submit"},standalone:!0,features:[t.aNF],decls:38,vars:34,consts:[["nav","ngbNav"],["content",""],["formRef","formComponent"],[3,"formId","formModel","displaySubmit","displayCancel"],[1,"container-fluid"],["for","ResourcePolicyObject"],["id","ResourcePolicyObject","type","text",1,"form-control","mb-3",3,"value"],["ngbNav","",1,"nav-pills",3,"activeIdChange","navChange","activeId"],["role","presentation",3,"ngbNavItem"],["ngbNavLink",""],["ngbNavContent",""],[3,"ngbNavOutlet"],[1,"mb-3","row"],[1,"col","text-end"],["type","reset",1,"btn","btn-default",3,"click","dsBtnDisabled"],["type","button",1,"btn","btn-primary",3,"click","dsBtnDisabled"],[3,"select"],[3,"select","isListOfEPerson"],[1,"fas","fa-circle-notch","fa-spin"],[1,"modal-header"],["id","modal-basic-title",1,"modal-title"],["type","button","aria-label","Close",1,"btn-close",3,"click"],[1,"modal-body"],[1,"d-flex","flex-row"],[1,"me-3"],[1,"fas","fa-info-circle","fa-2x","text-info"],[1,"fw-bold",3,"innerHTML"],[3,"innerHTML"],[1,"modal-footer"],["type","button",1,"btn","btn-secondary",3,"click"]],template:function(c,_){if(1&c){const g=t.RV6();t.j41(0,"div"),t.DNE(1,o,2,4,"ds-form",3),t.j41(2,"div",4)(3,"label",5),t.EFF(4),t.nI1(5,"translate"),t.k0s(),t.nrm(6,"input",6),t.nI1(7,"async"),t.j41(8,"ul",7,0),t.mxI("activeIdChange",function(H){return t.eBV(g),t.DH7(_.navActiveId,H)||(_.navActiveId=H),t.Njj(H)}),t.bIt("navChange",function(H){return t.eBV(g),t.Njj(_.onNavChange(H))}),t.j41(10,"li",8)(11,"a",9),t.EFF(12),t.nI1(13,"translate"),t.k0s(),t.DNE(14,B,1,0,"ng-template",10),t.k0s(),t.j41(15,"li",8)(16,"a",9),t.EFF(17),t.nI1(18,"translate"),t.k0s(),t.DNE(19,G,1,1,"ng-template",10),t.k0s()(),t.nrm(20,"div",11),t.j41(21,"div"),t.nrm(22,"hr"),t.j41(23,"div",12)(24,"div",13)(25,"button",14),t.nI1(26,"async"),t.bIt("click",function(){return t.eBV(g),t.Njj(_.onReset())}),t.EFF(27),t.nI1(28,"translate"),t.k0s(),t.j41(29,"button",15),t.nI1(30,"async"),t.nI1(31,"async"),t.bIt("click",function(){return t.eBV(g),t.Njj(_.onSubmit())}),t.DNE(32,te,4,3,"span"),t.nI1(33,"async"),t.DNE(34,se,3,3,"span"),t.nI1(35,"async"),t.k0s()()()()()(),t.DNE(36,re,18,12,"ng-template",null,1,t.C5r)}if(2&c){const g=t.sdS(9);t.R7$(),t.vxM(_.formModel?1:-1),t.R7$(3),t.JRh(t.bMT(5,14,"resource-policies.form.eperson-group-list.label")),t.R7$(2),t.Y8G("value",t.bMT(7,16,_.resourcePolicyTargetName$)),t.R7$(2),t.R50("activeId",_.navActiveId),t.R7$(2),t.Y8G("ngbNavItem","eperson"),t.R7$(2),t.JRh(t.bMT(13,18,"resource-policies.form.eperson-group-list.tab.eperson")),t.R7$(3),t.Y8G("ngbNavItem","group"),t.R7$(2),t.JRh(t.bMT(18,20,"resource-policies.form.eperson-group-list.tab.group")),t.R7$(3),t.Y8G("ngbNavOutlet",g),t.R7$(5),t.Y8G("dsBtnDisabled",t.bMT(26,22,_.isProcessing)),t.R7$(2),t.JRh(t.bMT(28,24,"form.cancel")),t.R7$(2),t.Y8G("dsBtnDisabled",!0!==t.bMT(30,26,_.isFormValid())||t.bMT(31,28,_.isProcessing)),t.R7$(3),t.vxM(t.bMT(33,30,_.isProcessing)?32:-1),t.R7$(2),t.vxM(!0!==t.bMT(35,32,_.isProcessing)?34:-1)}},dependencies:[y.Jj,v.A,e.T,X.s,R.Pv,R.Um,R.X9,R.sy,R.Ri,R.m_,F.h,F.D9],encapsulation:2})}}return f})()},8667:(J,S,s)=>{s.d(S,{Q:()=>N});var y=s(54438),t=s(7901),R=s(25558),P=s(79096),F=s(44583),A=s(4093),E=s(44043),L=s(89777);const N=(W,d,j=(0,y.WQX)(P.l9),p=(0,y.WQX)(y.zZn),$=(0,y.WQX)(t.Ix))=>{const K=W.queryParamMap.get("targetType"),m=W.queryParamMap.get("policyTargetId");((0,L.Im)(K)||(0,L.Im)(m))&&$.navigateByUrl("/404",{skipLocationChange:!0});const O=new E.v(K);return(0,F.M)(j,O.value,p).pipe((0,R.n)(v=>v.findById(m)),(0,A.qD)())}},38285:(J,S,s)=>{s.d(S,{n:()=>E});var y=s(54438),t=s(7901),R=s(33017),P=s(4093),F=s(89777),A=s(4600);const E=(L,N,W=(0,y.WQX)(t.Ix),d=(0,y.WQX)(R.ResourcePolicyDataService))=>{const j=L.queryParamMap.get("policyId");return(0,F.Im)(j)&&W.navigateByUrl("/404",{skipLocationChange:!0}),d.findById(j,!0,!1,(0,A.s)("eperson"),(0,A.s)("group")).pipe((0,P.qD)())}},80781:(J,S,s)=>{s.d(S,{e:()=>w});var y=s(60177),t=s(68018),R=s(84412),P=s(22806),F=s(5964),A=s(19852),E=s(96354),L=s(23294),N=s(70274),W=s(31943),d=s(96697),j=s(43446),p=s(3601),$=s(13817),K=s(2086),m=s(33017),O=s(4093),h=s(79104),v=s(89777),T=s(9847),M=s(4600),e=s(54438),b=s(89417),Q=s(42589),X=s(50813),ee=s(27432),n=s(7901);const l=["ds-resource-policy-entry",""];function I(u,Y){if(1&u){const i=e.RV6();e.j41(0,"button",6),e.nI1(1,"translate"),e.bIt("click",function(){e.eBV(i);const o=e.XpG();return e.Njj(o.redirectToGroupEditPage())}),e.nrm(2,"i",9),e.k0s()}2&u&&e.Y8G("title",e.bMT(1,1,"resource-policies.table.headers.edit.group"))}let D=(()=>{class u{constructor(i,a,o,B){this.dsoNameService=i,this.groupService=a,this.route=o,this.router=B,this.toggleCheckbox=new e.bkB}ngOnInit(){this.epersonName$=this.getName$(this.entry.policy.eperson),this.groupName$=this.getName$(this.entry.policy.group)}getName$(i){return i.pipe((0,O.v7)(),(0,E.T)(a=>{if((0,v.a4)(a?.payload))return this.dsoNameService.getName(a.payload)}))}formatDate(i){return(0,v.hj)(i)?(0,X.$T)((0,X.PR)(i)):""}redirectToResourcePolicyEditPage(){this.router.navigate(["./edit"],{relativeTo:this.route,queryParams:{policyId:this.entry.policy.id}})}redirectToGroupEditPage(){this.groupService.findByHref(this.entry.policy._links.group.href,!1).pipe((0,O.ak)(),(0,E.T)(i=>i.id)).subscribe(i=>{this.router.navigate([(0,Q.xl)(i)])})}static{this.\u0275fac=function(a){return new(a||u)(e.rXU(j.f),e.rXU(K.GroupDataService),e.rXU(n.nX),e.rXU(n.Ix))}}static{this.\u0275cmp=e.VBU({type:u,selectors:[["tr","ds-resource-policy-entry",""]],inputs:{entry:"entry"},outputs:{toggleCheckbox:"toggleCheckbox"},standalone:!0,features:[e.aNF],attrs:l,decls:33,vars:26,consts:[[1,"text-center"],["type","checkbox",1,"form-check-input",3,"ngModelChange","id","ngModel"],[1,"form-check-label",3,"for"],[1,"sr-only"],["scope","row"],[1,"btn-group","edit-field"],[1,"btn","btn-outline-primary","btn-sm",3,"click","title"],["aria-hidden","true",1,"fas","fa-edit","fa-fw"],[1,"btn","btn-outline-primary","btn-sm",3,"title"],["aria-hidden","true",1,"fas","fa-users","fa-fw"]],template:function(a,o){1&a&&(e.j41(0,"td",0)(1,"div")(2,"input",1),e.bIt("ngModelChange",function(G){return o.toggleCheckbox.emit(G)}),e.k0s(),e.j41(3,"label",2)(4,"span",3),e.EFF(5),e.nI1(6,"translate"),e.k0s()()()(),e.j41(7,"th",4),e.EFF(8),e.k0s(),e.j41(9,"td"),e.EFF(10),e.k0s(),e.j41(11,"td"),e.EFF(12),e.k0s(),e.j41(13,"td"),e.EFF(14),e.k0s(),e.j41(15,"td"),e.EFF(16),e.nI1(17,"async"),e.k0s(),e.j41(18,"td"),e.EFF(19),e.nI1(20,"async"),e.k0s(),e.j41(21,"td"),e.EFF(22),e.k0s(),e.j41(23,"td"),e.EFF(24),e.k0s(),e.j41(25,"td",0)(26,"div",5)(27,"button",6),e.nI1(28,"translate"),e.bIt("click",function(){return o.redirectToResourcePolicyEditPage()}),e.nrm(29,"i",7),e.k0s(),e.DNE(30,I,3,3,"button",8),e.nI1(31,"async"),e.nI1(32,"dsHasValue"),e.k0s()()),2&a&&(e.R7$(2),e.Y8G("id",o.entry.id)("ngModel",o.entry.checked),e.R7$(),e.Y8G("for",o.entry.id),e.R7$(2),e.JRh(e.bMT(6,14,o.entry.checked?"resource-policies.table.headers.deselect":"resource-policies.table.headers.select")),e.R7$(3),e.SpI(" ",o.entry.id,"\n"),e.R7$(2),e.JRh(o.entry.policy.name),e.R7$(2),e.JRh(o.entry.policy.policyType),e.R7$(2),e.JRh(o.entry.policy.action),e.R7$(2),e.SpI(" ",e.bMT(17,16,o.epersonName$),"\n"),e.R7$(3),e.SpI(" ",e.bMT(20,18,o.groupName$),"\n"),e.R7$(3),e.JRh(o.formatDate(o.entry.policy.startDate)),e.R7$(2),e.JRh(o.formatDate(o.entry.policy.endDate)),e.R7$(3),e.Y8G("title",e.bMT(28,20,"resource-policies.table.headers.edit.policy")),e.R7$(3),e.vxM(e.bMT(32,24,e.bMT(31,22,o.groupName$))?30:-1))},dependencies:[y.Jj,b.YN,b.Zm,b.BC,b.vS,ee.a,t.h,t.D9],encapsulation:2})}}return u})();function U(u,Y){if(1&u&&e.EFF(0),2&u){const i=e.XpG();e.SpI(" (",i.resourceUUID,") ")}}function C(u,Y){1&u&&(e.j41(0,"span"),e.nrm(1,"i",11),e.EFF(2),e.nI1(3,"translate"),e.k0s()),2&u&&(e.R7$(2),e.SpI(" ",e.bMT(3,1,"submission.workflow.tasks.generic.processing")," "))}function V(u,Y){1&u&&(e.j41(0,"span"),e.nrm(1,"i",12),e.EFF(2),e.nI1(3,"translate"),e.k0s()),2&u&&(e.R7$(2),e.SpI(" ",e.bMT(3,1,"resource-policies.delete.btn")," "))}function x(u,Y){if(1&u){const i=e.RV6();e.j41(0,"tr",10)(1,"th")(2,"div")(3,"input",13,0),e.bIt("change",function(o){e.eBV(i);const B=e.XpG();return e.Njj(B.selectAllCheckbox(o))}),e.k0s(),e.j41(5,"label",14)(6,"span",15),e.EFF(7),e.nI1(8,"translate"),e.k0s()()()(),e.j41(9,"th"),e.EFF(10),e.nI1(11,"translate"),e.k0s(),e.j41(12,"th"),e.EFF(13),e.nI1(14,"translate"),e.k0s(),e.j41(15,"th"),e.EFF(16),e.nI1(17,"translate"),e.k0s(),e.j41(18,"th"),e.EFF(19),e.nI1(20,"translate"),e.k0s(),e.j41(21,"th"),e.EFF(22),e.nI1(23,"translate"),e.k0s(),e.j41(24,"th"),e.EFF(25),e.nI1(26,"translate"),e.k0s(),e.j41(27,"th"),e.EFF(28),e.nI1(29,"translate"),e.k0s(),e.j41(30,"th"),e.EFF(31),e.nI1(32,"translate"),e.k0s(),e.j41(33,"th"),e.EFF(34),e.nI1(35,"translate"),e.k0s()()}if(2&u){const i=e.sdS(4),a=e.XpG();e.R7$(3),e.Y8G("id","selectAll_"+a.resourceUUID),e.R7$(2),e.Y8G("for","selectAll_"+a.resourceUUID),e.R7$(2),e.JRh(e.bMT(8,12,i.checked?"resource-policies.table.headers.deselect-all":"resource-policies.table.headers.select-all")),e.R7$(3),e.JRh(e.bMT(11,14,"resource-policies.table.headers.id")),e.R7$(3),e.JRh(e.bMT(14,16,"resource-policies.table.headers.name")),e.R7$(3),e.JRh(e.bMT(17,18,"resource-policies.table.headers.policyType")),e.R7$(3),e.JRh(e.bMT(20,20,"resource-policies.table.headers.action")),e.R7$(3),e.JRh(e.bMT(23,22,"resource-policies.table.headers.eperson")),e.R7$(3),e.JRh(e.bMT(26,24,"resource-policies.table.headers.group")),e.R7$(3),e.JRh(e.bMT(29,26,"resource-policies.table.headers.date.start")),e.R7$(3),e.JRh(e.bMT(32,28,"resource-policies.table.headers.date.end")),e.R7$(3),e.JRh(e.bMT(35,30,"resource-policies.table.headers.edit"))}}function z(u,Y){if(1&u){const i=e.RV6();e.j41(0,"tr",17),e.bIt("toggleCheckbox",function(o){const B=e.eBV(i).$implicit,G=e.XpG(2);return e.Njj(G.selectCheckbox(B,o))}),e.k0s()}2&u&&e.Y8G("entry",Y.$implicit)}function Z(u,Y){if(1&u&&(e.j41(0,"tbody"),e.Z7z(1,z,1,1,"tr",16,e.fX1),e.nI1(3,"async"),e.k0s()),2&u){const i=e.XpG();e.R7$(),e.Dyx(e.bMT(3,0,i.getResourcePolicies()))}}let w=(()=>{class u{constructor(i,a,o,B,G,te,se,re,oe,f){this.cdr=i,this.dsoNameService=a,this.ePersonService=o,this.groupService=B,this.notificationsService=G,this.requestService=te,this.resourcePolicyService=se,this.route=re,this.router=oe,this.translate=f,this.processingDelete$=new R.t(!1),this.resourcePoliciesEntries$=new R.t([]),this.subs=[]}ngOnInit(){this.isActive=!0,this.initResourcePolicyList()}canDelete(){return(0,P.H)(this.resourcePoliciesEntries$.value).pipe((0,F.p)(i=>i.checked),(0,A.T)((i,a)=>[...i,a],[]),(0,E.T)(i=>(0,v.hj)(i)),(0,L.F)())}deleteSelectedResourcePolicies(){this.processingDelete$.next(!0);const i=this.resourcePoliciesEntries$.value.filter(a=>a.checked);this.subs.push((0,P.H)(i).pipe((0,N.H)(a=>this.resourcePolicyService.delete(a.policy.id)),(0,W.S)((a,o)=>[...a,o],[]),(0,F.p)(a=>a.length===i.length),(0,d.s)(1)).subscribe(a=>{const o=a.filter(B=>!B);(0,v.Im)(o)?this.notificationsService.success(null,this.translate.get("resource-policies.delete.success.content")):this.notificationsService.error(null,this.translate.get("resource-policies.delete.failure.content")),this.processingDelete$.next(!1)}))}getResourcePolicies(){return this.resourcePoliciesEntries$.asObservable()}initResourcePolicyList(){this.subs.push(this.resourcePolicyService.searchByResource(this.resourceUUID,null,!1,!0,(0,M.s)("eperson"),(0,M.s)("group")).pipe((0,F.p)(()=>this.isActive),(0,O.v7)()).subscribe(i=>{const a=i.payload.page.map(o=>({id:o.id,policy:o,checked:!1}));this.resourcePoliciesEntries$.next(a),this.cdr.detectChanges()}))}isProcessingDelete(){return this.processingDelete$.asObservable()}redirectToResourcePolicyCreatePage(){this.router.navigate(["./create"],{relativeTo:this.route,queryParams:{policyTargetId:this.resourceUUID,targetType:this.resourceType}})}selectAllCheckbox(i){const a=i.target.checked;this.resourcePoliciesEntries$.value.forEach(o=>o.checked=a)}selectCheckbox(i,a){i.checked=a}ngOnDestroy(){this.isActive=!1,this.resourcePoliciesEntries$=null,this.subs.filter(i=>(0,v.a4)(i)).forEach(i=>i.unsubscribe())}static{this.\u0275fac=function(a){return new(a||u)(e.rXU(e.gRc),e.rXU(j.f),e.rXU($.EPersonDataService),e.rXU(K.GroupDataService),e.rXU(T.I),e.rXU(p.B),e.rXU(m.ResourcePolicyDataService),e.rXU(n.nX),e.rXU(n.Ix),e.rXU(t.c$))}}static{this.\u0275cmp=e.VBU({type:u,selectors:[["ds-resource-policies"]],inputs:{resourceUUID:"resourceUUID",resourceType:"resourceType",resourceName:"resourceName"},standalone:!0,features:[e.aNF],decls:31,vars:34,consts:[["selectAllBtn",""],[1,"table-responsive"],[1,"table","table-striped","table-bordered","table-hover"],["colspan","10"],[1,"d-flex","justify-content-between","align-items-center","m-0"],[1,"text-info"],[1,"space-children-mr","flex-shrink-0"],[1,"btn","btn-danger","p-1",3,"click","dsBtnDisabled","title"],[1,"btn","btn-success","p-1",3,"click","dsBtnDisabled","title"],["aria-hidden","true",1,"fas","fa-plus"],[1,"text-center"],["aria-hidden","true",1,"fas","fa-circle-notch","fa-spin"],["aria-hidden","true",1,"fas","fa-trash-alt","fa-fw"],["type","checkbox",1,"form-check-input",3,"change","id"],[1,"form-check-label",3,"for"],[1,"sr-only"],["ds-resource-policy-entry","",3,"entry"],["ds-resource-policy-entry","",3,"toggleCheckbox","entry"]],template:function(a,o){if(1&a&&(e.j41(0,"div",1)(1,"table",2)(2,"thead")(3,"tr")(4,"th",3)(5,"div",4)(6,"span"),e.EFF(7),e.nI1(8,"translate"),e.j41(9,"span",5),e.EFF(10),e.k0s(),e.DNE(11,U,1,1),e.k0s(),e.j41(12,"div",6)(13,"button",7),e.nI1(14,"async"),e.nI1(15,"async"),e.nI1(16,"translate"),e.bIt("click",function(){return o.deleteSelectedResourcePolicies()}),e.DNE(17,C,4,3,"span"),e.nI1(18,"async"),e.DNE(19,V,4,3,"span"),e.nI1(20,"async"),e.k0s(),e.j41(21,"button",8),e.nI1(22,"async"),e.nI1(23,"translate"),e.bIt("click",function(){return o.redirectToResourcePolicyCreatePage()}),e.nrm(24,"i",9),e.EFF(25),e.nI1(26,"translate"),e.k0s()()()()(),e.DNE(27,x,36,32,"tr",10),e.nI1(28,"async"),e.k0s(),e.DNE(29,Z,4,2,"tbody"),e.nI1(30,"async"),e.k0s()()),2&a){let B,G;e.R7$(7),e.SpI(" ",e.bMT(8,12,"resource-policies.table.headers.title.for."+o.resourceType)," "),e.R7$(3),e.SpI(" ",o.resourceName," "),e.R7$(),e.vxM("item"!==o.resourceType?11:-1),e.R7$(2),e.Y8G("dsBtnDisabled",!0!==e.bMT(14,14,o.canDelete())||e.bMT(15,16,o.isProcessingDelete()))("title",e.bMT(16,18,"resource-policies.delete.btn.title")),e.R7$(4),e.vxM(e.bMT(18,20,o.isProcessingDelete())?17:-1),e.R7$(2),e.vxM(!0!==e.bMT(20,22,o.isProcessingDelete())?19:-1),e.R7$(2),e.Y8G("dsBtnDisabled",e.bMT(22,24,o.isProcessingDelete()))("title",e.bMT(23,26,"resource-policies.add.for."+o.resourceType)),e.R7$(4),e.SpI(" ",e.bMT(26,28,"resource-policies.add.button")," "),e.R7$(2),e.vxM((null==(B=e.bMT(28,30,o.getResourcePolicies()))?null:B.length)>0?27:-1),e.R7$(2),e.vxM((null==(G=e.bMT(30,32,o.getResourcePolicies()))?null:G.length)>0?29:-1)}},dependencies:[y.Jj,h.A,D,t.h,t.D9],styles:["td[_ngcontent-%COMP%]   .btn-link[_ngcontent-%COMP%]:focus{box-shadow:none!important}"]})}}return u})()},27432:(J,S,s)=>{s.d(S,{a:()=>R});var y=s(89777),t=s(54438);let R=(()=>{class P{transform(A){return(0,y.a4)(A)}static{this.\u0275fac=function(E){return new(E||P)}}static{this.\u0275pipe=t.EJ8({name:"dsHasValue",type:P,pure:!0,standalone:!0})}}return P})()}}]);