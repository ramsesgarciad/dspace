(self.webpackChunkdspace_angular=self.webpackChunkdspace_angular||[]).push([[9494],{59072:(G,j,i)=>{"use strict";i.d(j,{S:()=>C});var D=i(54438),n=i(89777),t=i(54034),m=i(7673),A=i(80495);let v=(()=>{class F{getBreadcrumbs(h,r){return(0,m.of)([new A.Q(h+".breadcrumbs",r)])}static{this.\u0275fac=function(r){return new(r||F)}}static{this.\u0275prov=D.jDH({token:F,factory:F.\u0275fac,providedIn:"root"})}}return F})();const C=(F,B,h=(0,D.WQX)(v))=>{const r=F.data.breadcrumbKey;if((0,n.Tn)(r))throw new Error('You provided an i18nBreadcrumbResolver for url "'+F.url+"\" but no breadcrumbKey in the route's data");return{provider:h,key:r,url:(0,t.F)(F)}}},20439:(G,j,i)=>{"use strict";i.d(j,{t:()=>B});var D=i(40031),n=i(60177),t=i(54438),m=i(40940),x=(i(73685),i(47619)),v=i(46878),C=i(19795);function F(h,r){if(1&h){const l=t.RV6();t.j41(0,"ds-dso-edit-metadata-value",3),t.bIt("edit",function(){const g=t.eBV(l).$implicit;return t.Njj(g.editing=!0)})("confirm",function(g){const O=t.eBV(l).$implicit,R=t.XpG();return O.confirmChanges(g),R.form.resetReinstatable(),t.Njj(R.valueSaved.emit())})("remove",function(){const g=t.eBV(l),O=g.$implicit,R=g.$index,V=t.XpG();return O.change===V.DsoEditMetadataChangeTypeEnum.ADD?V.form.remove(V.mdField,R):O.change=V.DsoEditMetadataChangeTypeEnum.REMOVE,V.form.resetReinstatable(),t.Njj(V.valueSaved.emit())})("undo",function(){const g=t.eBV(l),O=g.$implicit,R=g.$index,V=t.XpG();return O.change===V.DsoEditMetadataChangeTypeEnum.ADD?V.form.remove(V.mdField,R):O.discard(),t.Njj(V.valueSaved.emit())})("dragging",function(g){t.eBV(l);const O=t.XpG();return t.Njj(O.draggingMdField$.next(g?O.mdField:null))}),t.k0s()}if(2&h){const l=r.$implicit,p=t.XpG();t.Y8G("dso",p.dso)("context",p.Context.EditMetadata)("mdValue",l)("mdField",p.mdField)("dsoType",p.dsoType)("saving$",p.saving$)("isOnlyValue",1===p.form.fields[p.mdField].length)}}let B=(()=>{class h{constructor(){this.valueSaved=new t.bkB,this.DsoEditMetadataChangeTypeEnum=x.QR,this.Context=m.o}drop(l){(0,D.HD)(this.form.fields[this.mdField],l.previousIndex,l.currentIndex),this.form.fields[this.mdField].forEach((O,R)=>{O.newValue.place=R,O.confirmChanges()}),this.form.resetReinstatable(),this.valueSaved.emit()}static{this.\u0275fac=function(p){return new(p||h)}}static{this.\u0275cmp=t.VBU({type:h,selectors:[["ds-dso-edit-metadata-field-values"]],inputs:{dso:"dso",form:"form",mdField:"mdField",dsoType:"dsoType",saving$:"saving$",draggingMdField$:"draggingMdField$"},outputs:{valueSaved:"valueSaved"},standalone:!0,features:[t.aNF],decls:6,vars:7,consts:[["cdkDropList","","role","table",1,"flex-grow-1","ds-drop-list","h-100",3,"cdkDropListDropped"],["role","presentation",3,"dsoType"],["role","presentation",3,"dso","context","mdValue","mdField","dsoType","saving$","isOnlyValue"],["role","presentation",3,"edit","confirm","remove","undo","dragging","dso","context","mdValue","mdField","dsoType","saving$","isOnlyValue"]],template:function(p,g){1&p&&(t.j41(0,"div",0),t.nI1(1,"async"),t.nI1(2,"async"),t.bIt("cdkDropListDropped",function(R){return g.drop(R)}),t.nrm(3,"ds-dso-edit-metadata-value-headers",1),t.Z7z(4,F,1,7,"ds-dso-edit-metadata-value",2,t.fX1),t.k0s()),2&p&&(t.AVh("disabled",t.bMT(1,3,g.draggingMdField$)&&t.bMT(2,5,g.draggingMdField$)!==g.mdField),t.R7$(3),t.Y8G("dsoType",g.dsoType),t.R7$(),t.Dyx(g.form.fields[g.mdField]))},dependencies:[n.Jj,D.O7,v.o,C.c],styles:[".ds-drop-list[_ngcontent-%COMP%]{background-color:var(--bs-gray-500)}.ds-drop-list.disabled[_ngcontent-%COMP%]{opacity:.3}"]})}}return h})()},47619:(G,j,i)=>{"use strict";i.d(j,{QR:()=>C,qf:()=>B});class D{constructor(r,l){this.op=r,this.field=l}}let n=(()=>{class h extends D{static{this.operationType="add"}constructor(l,p){super(h.operationType,l),this.value=p}toOperation(){return{op:this.op,path:`/metadata/${this.field}/-`,value:this.value}}}return h})(),t=(()=>{class h extends D{static{this.operationType="move"}constructor(l,p,g){super(h.operationType,l),this.from=p,this.to=g}toOperation(){return{op:this.op,from:`/metadata/${this.field}/${this.from}`,path:`/metadata/${this.field}/${this.to}`}}}return h})(),m=(()=>{class h extends D{static{this.operationType="remove"}constructor(l,p){super(h.operationType,l),this.place=p}toOperation(){return{op:this.op,path:`/metadata/${this.field}/${this.place}`}}}return h})(),A=(()=>{class h extends D{static{this.operationType="replace"}constructor(l,p,g){super(h.operationType,l),this.place=p,this.value=g}toOperation(){return{op:this.op,path:`/metadata/${this.field}/${this.place}`,value:this.value}}}return h})();var x=i(54095),v=i(89777),C=function(h){return h[h.UPDATE=1]="UPDATE",h[h.ADD=2]="ADD",h[h.REMOVE=3]="REMOVE",h}(C||{});class F{constructor(r,l=!1){this.editing=!1,this.reordered=!1,this.originalValue=r,this.newValue=Object.assign(new x.vD,r),l&&(this.change=C.ADD,this.editing=!0)}confirmChanges(r=!1){this.reordered=this.originalValue.place!==this.newValue.place,((0,v.Tn)(this.change)||this.change===C.UPDATE)&&(this.change=this.originalValue.value!==this.newValue.value||this.originalValue.language!==this.newValue.language||this.originalValue.authority!==this.newValue.authority||this.originalValue.confidence!==this.newValue.confidence?C.UPDATE:void 0),r&&(this.editing=!1)}hasChanges(){return(0,v.a4)(this.change)||this.reordered}discardAndMarkReinstatable(){(this.change===C.UPDATE||this.reordered)&&(this.reinstatableValue=this.newValue),this.reinstatableChange=this.change,this.discard(!1)}discard(r=!0){this.change=void 0;const l=this.newValue.place;this.newValue=Object.assign(new x.vD,this.originalValue),r&&(this.newValue.place=l),this.confirmChanges(!0)}reinstate(){(0,v.a4)(this.reinstatableValue)&&(this.newValue=this.reinstatableValue,this.reinstatableValue=void 0),(0,v.a4)(this.reinstatableChange)&&(this.change=this.reinstatableChange,this.reinstatableChange=void 0),this.confirmChanges()}isReinstatable(){return(0,v.a4)(this.reinstatableValue)||(0,v.a4)(this.reinstatableChange)}resetReinstatable(){this.reinstatableValue=void 0,this.reinstatableChange=void 0}}class B{constructor(r){this.originalFieldKeys=[],this.fieldKeys=[],this.fields={},this.reinstatableNewValues={},Object.entries(r).forEach(([l,p])=>{this.originalFieldKeys.push(l),this.fieldKeys.push(l),this.setValuesForFieldSorted(l,p.map(g=>new F(g)))}),this.sortFieldKeys()}add(){(0,v.Tn)(this.newValue)&&(this.newValue=new F(new x.vD,!0))}setMetadataField(r){this.newValue.editing=!1,this.addValueToField(this.newValue,r);const l=this.fields[r].length-1;this.fields[r][l].originalValue.place=l,this.fields[r][l].newValue.place=l,this.newValue=void 0}addValueToField(r,l){(0,v.Im)(this.fields[l])&&(this.fieldKeys.push(l),this.sortFieldKeys(),this.fields[l]=[]),this.fields[l].push(r)}remove(r,l){(0,v.hj)(this.fields[r])&&(this.fields[r].splice(l,1),0===this.fields[r].length&&(this.fieldKeys.splice(this.fieldKeys.indexOf(r),1),delete this.fields[r]))}hasChanges(){return Object.values(this.fields).some(r=>r.some(l=>l.hasChanges()))}hasOrderChanges(r){return this.fields[r].some(l=>l.originalValue.place!==l.newValue.place)}discard(){this.resetReinstatable(),Object.entries(this.fields).forEach(([r,l])=>{let p=-1;l.forEach((g,O)=>{g.change===C.ADD?((0,v.Im)(this.reinstatableNewValues[r])&&(this.reinstatableNewValues[r]=[]),this.reinstatableNewValues[r].push(g),-1===p&&(p=O)):g.discardAndMarkReinstatable()}),p>-1&&this.fields[r].splice(p,this.fields[r].length-p)}),this.fieldKeys.forEach(r=>{this.originalFieldKeys.indexOf(r)<0&&delete this.fields[r]}),this.fieldKeys=[...this.originalFieldKeys],this.sortFieldKeys(),this.fieldKeys.forEach(r=>{this.setValuesForFieldSorted(r,this.fields[r])})}resetOrder(r){this.fields[r].forEach(l=>{l.newValue.place=l.originalValue.place,l.confirmChanges()}),this.setValuesForFieldSorted(r,this.fields[r])}sortFieldKeys(){this.fieldKeys.sort((r,l)=>r.localeCompare(l))}reinstate(){Object.values(this.fields).forEach(r=>{r.forEach(l=>{l.reinstate()})}),Object.entries(this.reinstatableNewValues).forEach(([r,l])=>{l.forEach(p=>{this.addValueToField(p,r)})}),this.fieldKeys.forEach(r=>{this.setValuesForFieldSorted(r,this.fields[r])}),this.reinstatableNewValues={}}isReinstatable(){return(0,v.hj)(this.reinstatableNewValues)||Object.values(this.fields).some(r=>r.some(l=>l.isReinstatable()))}resetReinstatable(){this.reinstatableNewValues={},Object.values(this.fields).forEach(r=>{r.forEach(l=>{l.resetReinstatable()})})}setValuesForFieldSorted(r,l){this.fields[r]=l.sort((p,g)=>p.newValue.place-g.newValue.place)}getOperations(r){const l=[];return Object.entries(this.fields).forEach(([p,g])=>{const O=[],R=[],V=[];[...g].sort((u,U)=>u.originalValue.place-U.originalValue.place).forEach(u=>{(0,v.a4)(u.change)&&(u.change===C.UPDATE?(u.originalValue.value!==u.newValue.value||u.originalValue.language!==u.newValue.language||u.originalValue.authority!==u.newValue.authority||u.originalValue.confidence!==u.newValue.confidence)&&O.push(new A(p,u.originalValue.place,{value:u.newValue.value,language:u.newValue.language,authority:u.newValue.authority,confidence:u.newValue.confidence})):u.change===C.REMOVE?R.push(new m(p,u.originalValue.place)):u.change===C.ADD?V.push(new n(p,{value:u.newValue.value,language:u.newValue.language,authority:u.newValue.authority,confidence:u.newValue.confidence})):console.warn("Illegal metadata change state detected for",u))}),l.push(...O.map(u=>u.toOperation())),l.push(...R.sort((u,U)=>U.place-u.place).map(u=>u.toOperation())),l.push(...V.map(u=>u.toOperation()))}),Object.entries(this.fields).forEach(([p,g])=>{const O=g.filter(V=>V.change!==C.REMOVE),R=r.diff([...O].sort((V,u)=>V.originalValue.place-u.originalValue.place).map(V=>V.originalValue.place),[...O].sort((V,u)=>V.newValue.place-u.newValue.place).map(V=>V.originalValue.place)).map(V=>new t(p,+V.from.substr(1),+V.path.substr(1)).toOperation());l.push(...R)}),l}}},5051:(G,j,i)=>{"use strict";i.d(j,{L:()=>t});var D=i(68018),n=i(54438);let t=(()=>{class m{static{this.\u0275fac=function(v){return new(v||m)}}static{this.\u0275cmp=n.VBU({type:m,selectors:[["ds-dso-edit-metadata-headers"]],inputs:{dsoType:"dsoType"},standalone:!0,features:[n.aNF],decls:18,vars:12,consts:[[1,"d-flex","flex-row","ds-field-row","ds-header-row"],[1,"lbl-cell"],[1,"flex-grow-1"],[1,"d-flex","flex-row"],[1,"flex-grow-1","ds-flex-cell","ds-value-cell"],[1,"dont-break-out","preserve-line-breaks"],[1,"ds-flex-cell","ds-lang-cell"],[1,"text-center","ds-flex-cell","ds-edit-cell"]],template:function(v,C){1&v&&(n.j41(0,"div",0)(1,"div",1),n.EFF(2),n.nI1(3,"translate"),n.k0s(),n.j41(4,"div",2)(5,"div",3)(6,"div",4)(7,"b",5),n.EFF(8),n.nI1(9,"translate"),n.k0s()(),n.j41(10,"div",6)(11,"b"),n.EFF(12),n.nI1(13,"translate"),n.k0s()(),n.j41(14,"div",7)(15,"b"),n.EFF(16),n.nI1(17,"translate"),n.k0s()()()()()),2&v&&(n.R7$(2),n.JRh(n.bMT(3,4,C.dsoType+".edit.metadata.headers.field")),n.R7$(6),n.JRh(n.bMT(9,6,C.dsoType+".edit.metadata.headers.value")),n.R7$(4),n.JRh(n.bMT(13,8,C.dsoType+".edit.metadata.headers.language")),n.R7$(4),n.JRh(n.bMT(17,10,C.dsoType+".edit.metadata.headers.edit")))},dependencies:[D.h,D.D9],styles:[".lbl-cell[_ngcontent-%COMP%]{min-width:var(--ds-dso-edit-field-width);max-width:var(--ds-dso-edit-field-width);background-color:var(--bs-gray-100);font-weight:700;padding:1rem;border:1px solid var(--bs-gray-200)}.ds-header-row[_ngcontent-%COMP%]{background-color:var(--bs-gray-100)}",".ds-field-row[_ngcontent-%COMP%]{border:1px solid var(--bs-gray-400)}.ds-flex-cell[_ngcontent-%COMP%]{padding:1rem;border:1px solid var(--bs-gray-200)}.ds-lang-cell[_ngcontent-%COMP%]{min-width:var(--ds-dso-edit-lang-width);max-width:var(--ds-dso-edit-lang-width)}.ds-edit-cell[_ngcontent-%COMP%]{min-width:var(--ds-dso-edit-actions-width)}.ds-value-row[_ngcontent-%COMP%]{background-color:#fff}.ds-value-row[_ngcontent-%COMP%]:active{cursor:grabbing}.ds-value-row.ds-warning[_ngcontent-%COMP%]{background-color:var(--ds-warning-bg-subtle)}.ds-value-row.ds-warning[_ngcontent-%COMP%]   .ds-flex-cell[_ngcontent-%COMP%]{border:1px solid var(--bs-warning-border-subtle)}.ds-value-row.ds-danger[_ngcontent-%COMP%]{background-color:var(--ds-danger-bg-subtle)}.ds-value-row.ds-danger[_ngcontent-%COMP%]   .ds-flex-cell[_ngcontent-%COMP%]{border:1px solid var(--bs-danger-border-subtle)}.ds-value-row.ds-success[_ngcontent-%COMP%]{background-color:var(--ds-success-bg-subtle)}.ds-value-row.ds-success[_ngcontent-%COMP%]   .ds-flex-cell[_ngcontent-%COMP%]{border:1px solid var(--bs-success-border-subtle)}"]})}}return m})()},19795:(G,j,i)=>{"use strict";i.d(j,{c:()=>t});var D=i(68018),n=i(54438);let t=(()=>{class m{static{this.\u0275fac=function(v){return new(v||m)}}static{this.\u0275cmp=n.VBU({type:m,selectors:[["ds-dso-edit-metadata-value-headers"]],inputs:{dsoType:"dsoType"},standalone:!0,features:[n.aNF],decls:10,vars:9,consts:[["role","row",1,"visually-hidden"],["role","columnheader"]],template:function(v,C){1&v&&(n.j41(0,"div",0)(1,"div",1),n.EFF(2),n.nI1(3,"translate"),n.k0s(),n.j41(4,"div",1),n.EFF(5),n.nI1(6,"translate"),n.k0s(),n.j41(7,"div",1),n.EFF(8),n.nI1(9,"translate"),n.k0s()()),2&v&&(n.R7$(2),n.JRh(n.bMT(3,3,C.dsoType+".edit.metadata.headers.value")),n.R7$(3),n.JRh(n.bMT(6,5,C.dsoType+".edit.metadata.headers.language")),n.R7$(3),n.JRh(n.bMT(9,7,C.dsoType+".edit.metadata.headers.edit")))},dependencies:[D.h,D.D9],styles:[".ds-field-row[_ngcontent-%COMP%]{border:1px solid var(--bs-gray-400)}.ds-flex-cell[_ngcontent-%COMP%]{padding:1rem;border:1px solid var(--bs-gray-200)}.ds-lang-cell[_ngcontent-%COMP%]{min-width:var(--ds-dso-edit-lang-width);max-width:var(--ds-dso-edit-lang-width)}.ds-edit-cell[_ngcontent-%COMP%]{min-width:var(--ds-dso-edit-actions-width)}.ds-value-row[_ngcontent-%COMP%]{background-color:#fff}.ds-value-row[_ngcontent-%COMP%]:active{cursor:grabbing}.ds-value-row.ds-warning[_ngcontent-%COMP%]{background-color:var(--ds-warning-bg-subtle)}.ds-value-row.ds-warning[_ngcontent-%COMP%]   .ds-flex-cell[_ngcontent-%COMP%]{border:1px solid var(--bs-warning-border-subtle)}.ds-value-row.ds-danger[_ngcontent-%COMP%]{background-color:var(--ds-danger-bg-subtle)}.ds-value-row.ds-danger[_ngcontent-%COMP%]   .ds-flex-cell[_ngcontent-%COMP%]{border:1px solid var(--bs-danger-border-subtle)}.ds-value-row.ds-success[_ngcontent-%COMP%]{background-color:var(--ds-success-bg-subtle)}.ds-value-row.ds-success[_ngcontent-%COMP%]   .ds-flex-cell[_ngcontent-%COMP%]{border:1px solid var(--bs-success-border-subtle)}"]})}}return m})()},46878:(G,j,i)=>{"use strict";i.d(j,{o:()=>It});var D=i(40031),n=i(60177),t=i(54438),m=i(89417),A=i(7901),x=i(58003),v=i(68018),C=i(983),F=i(96354),B=i(43446),h=i(87433),r=i(75082),l=i(14379),O=(i(40940),i(73685),i(83808)),R=i(92767),V=i(79104),u=i(89777),U=i(48457),tt=i(91880),X=i(19370),et=i(47619),J=i(7673),K=i(25558),Y=i(61206),e=i(4093),at=i(90306),z=i(4600);let Z=(()=>{class d{constructor(a,c){this.itemService=a,this.vocabularyService=c}findDsoFieldVocabulary(a,c){return(0,u.hj)(c)?this.itemService.findByHref(a._links.self.href,!0,!0,(0,z.s)("owningCollection")).pipe((0,e.ak)(),(0,K.n)(b=>b.owningCollection),(0,e.ak)()).pipe((0,K.n)(b=>this.vocabularyService.getVocabularyByMetadataAndCollection(c,b.uuid).pipe((0,e.ak)()))):(0,J.of)(void 0)}static{this.\u0275fac=function(c){return new(c||d)(t.KVO(Y.ItemDataService),t.KVO(at.g))}}static{this.\u0275prov=t.jDH({token:d,factory:d.\u0275fac,providedIn:"root"})}}return d})();var E=function(d){return d.PLAIN_TEXT="PLAIN_TEXT",d.ENTITY_TYPE="ENTITY_TYPE",d.AUTHORITY="AUTHORITY",d}(E||{}),k=i(43764),T=i(60163),M=i(21193),I=i(84412),$=i(88141),L=i(96697),nt=i(27502),it=i(1622),st=i(83124),ot=i(18190),y=i(8428),N=i(95720),s=i(9847);let f=(()=>{class d{constructor(){this.confirm=new t.bkB}static{this.\u0275fac=function(c){return new(c||d)}}static{this.\u0275cmp=t.VBU({type:d,selectors:[["ds-abstract-dso-edit-metadata-value-field"]],inputs:{context:"context",dso:"dso",dsoType:"dsoType",type:"type",mdField:"mdField",mdValue:"mdValue"},outputs:{confirm:"confirm"},standalone:!0,features:[t.aNF],decls:0,vars:0,template:function(c,o){},encapsulation:2})}}return d})();function _(d,w){if(1&d){const a=t.RV6();t.j41(0,"textarea",5),t.nI1(1,"translate"),t.mxI("ngModelChange",function(o){t.eBV(a);const b=t.XpG(2);return t.DH7(b.mdValue.newValue.value,o)||(b.mdValue.newValue.value=o),t.Njj(o)}),t.bIt("onDebounce",function(){t.eBV(a);const o=t.XpG(2);return t.Njj(o.confirm.emit(!1))}),t.EFF(2,"    "),t.k0s()}if(2&d){const a=t.XpG(2);t.R50("ngModel",a.mdValue.newValue.value),t.Y8G("dsDebounce",300),t.BMQ("aria-label",t.bMT(1,3,a.dsoType+".edit.metadata.edit.value"))}}function P(d,w){if(1&d){const a=t.RV6();t.j41(0,"ds-dynamic-scrollable-dropdown",6),t.bIt("change",function(o){t.eBV(a);const b=t.XpG(2);return t.Njj(b.onChangeAuthorityField(o))}),t.k0s()}if(2&d){const a=t.XpG(2);t.Y8G("bindId",a.mdField)("group",a.group)("model",a.getModel())}}function W(d,w){if(1&d){const a=t.RV6();t.j41(0,"ds-dynamic-onebox",7),t.bIt("change",function(o){t.eBV(a);const b=t.XpG(2);return t.Njj(b.onChangeAuthorityField(o))}),t.k0s()}if(2&d){const a=t.XpG(2);t.Y8G("group",a.group)("model",a.getModel())}}function H(d,w){if(1&d){const a=t.RV6();t.j41(0,"button",8),t.nI1(1,"translate"),t.bIt("click",function(){t.eBV(a);const o=t.XpG(2);return t.Njj(o.toggleFreeTextEdition())}),t.nrm(2,"i",9),t.EFF(3),t.nI1(4,"translate"),t.k0s()}if(2&d){const a=t.XpG(2);t.Y8G("title",a.enabledFreeTextEditing?a.dsoType+".edit.metadata.edit.buttons.disable-free-text-editing":t.bMT(1,3,a.dsoType+".edit.metadata.edit.buttons.enable-free-text-editing")),t.R7$(2),t.Y8G("ngClass",a.enabledFreeTextEditing?"fa-lock":"fa-unlock"),t.R7$(),t.SpI(" ",t.bMT(4,5,a.enabledFreeTextEditing?a.dsoType+".edit.metadata.edit.buttons.disable-free-text-editing":a.dsoType+".edit.metadata.edit.buttons.enable-free-text-editing")," ")}}function q(d,w){if(1&d){const a=t.RV6();t.j41(0,"button",15),t.nI1(1,"translate"),t.nI1(2,"translate"),t.bIt("click",function(){t.eBV(a);const o=t.XpG(3);return t.Njj(o.onChangeEditingAuthorityStatus(!1))}),t.nrm(3,"i",16),t.k0s()}if(2&d){const a=t.XpG(3);t.FS9("ngbTooltip",t.bMT(1,2,a.dsoType+".edit.metadata.edit.buttons.close-authority-edition")),t.Y8G("title",t.bMT(2,4,a.dsoType+".edit.metadata.edit.buttons.close-authority-edition"))}}function lt(d,w){if(1&d){const a=t.RV6();t.j41(0,"button",17),t.nI1(1,"translate"),t.nI1(2,"translate"),t.bIt("click",function(){t.eBV(a);const o=t.XpG(3);return t.Njj(o.onChangeEditingAuthorityStatus(!0))}),t.nrm(3,"i",18),t.k0s()}if(2&d){const a=t.XpG(3);t.FS9("ngbTooltip",t.bMT(1,2,a.dsoType+".edit.metadata.edit.buttons.open-authority-edition")),t.Y8G("title",t.bMT(2,4,a.dsoType+".edit.metadata.edit.buttons.open-authority-edition"))}}function rt(d,w){if(1&d){const a=t.RV6();t.j41(0,"div",4)(1,"div",10),t.nrm(2,"i",11),t.j41(3,"input",12),t.nI1(4,"translate"),t.mxI("ngModelChange",function(o){t.eBV(a);const b=t.XpG(2);return t.DH7(b.mdValue.newValue.authority,o)||(b.mdValue.newValue.authority=o),t.Njj(o)}),t.bIt("change",function(){t.eBV(a);const o=t.XpG(2);return t.Njj(o.onChangeAuthorityKey())}),t.k0s(),t.DNE(5,q,4,6,"button",13)(6,lt,4,6,"button",14),t.k0s()()}if(2&d){const a=t.XpG(2);t.R7$(2),t.Y8G("authorityValue",a.mdValue.newValue.confidence)("iconMode",!0),t.R7$(),t.R50("ngModel",a.mdValue.newValue.authority),t.Y8G("disabled",!a.editingAuthority),t.BMQ("aria-label",t.bMT(4,6,a.dsoType+".edit.metadata.edit.authority.key")),t.R7$(2),t.vxM(a.editingAuthority?5:6)}}function ct(d,w){if(1&d&&(t.DNE(0,_,3,5,"textarea",0),t.nI1(1,"async"),t.nI1(2,"async"),t.DNE(3,P,1,3,"ds-dynamic-scrollable-dropdown",1),t.nI1(4,"async"),t.DNE(5,W,1,2,"ds-dynamic-onebox",2),t.nI1(6,"async"),t.nI1(7,"async"),t.DNE(8,H,5,7,"button",3),t.nI1(9,"async"),t.nI1(10,"async"),t.DNE(11,rt,7,8,"div",4),t.nI1(12,"async"),t.nI1(13,"async")),2&d){const a=t.XpG();t.vxM(!0!==t.bMT(1,5,a.isAuthorityControlled$)||a.enabledFreeTextEditing&&!0!==t.bMT(2,7,a.isSuggesterVocabulary$)?0:-1),t.R7$(3),t.vxM(t.bMT(4,9,a.isScrollableVocabulary$)&&!a.enabledFreeTextEditing?3:-1),t.R7$(2),t.vxM(t.bMT(6,11,a.isHierarchicalVocabulary$)&&!a.enabledFreeTextEditing||t.bMT(7,13,a.isSuggesterVocabulary$)?5:-1),t.R7$(3),t.vxM(t.bMT(9,15,a.isHierarchicalVocabulary$)||t.bMT(10,17,a.isScrollableVocabulary$)?8:-1),t.R7$(3),t.vxM(t.bMT(12,19,a.isAuthorityControlled$)&&t.bMT(13,21,a.isSuggesterVocabulary$)?11:-1)}}let ut=(()=>{class d extends f{constructor(a,c,o,b,S,Q){super(),this.cdr=a,this.dsoEditMetadataFieldService=c,this.itemService=o,this.notificationsService=b,this.registryService=S,this.translate=Q,this.editingAuthority=!1,this.enabledFreeTextEditing=!1,this.group=new m.J3({authorityField:new m.hs}),this.model$=new I.t(null)}ngOnInit(){this.initAuthorityProperties()}initAuthorityProperties(){this.vocabulary$=this.dsoEditMetadataFieldService.findDsoFieldVocabulary(this.dso,this.mdField),this.isAuthorityControlled$=this.vocabulary$.pipe((0,$.M)(a=>this.model$.next(this.createModel(a))),(0,F.T)(a=>(0,u.hj)(a))),this.isHierarchicalVocabulary$=this.vocabulary$.pipe((0,F.T)(a=>(0,u.hj)(a)&&a.hierarchical)),this.isScrollableVocabulary$=this.vocabulary$.pipe((0,F.T)(a=>(0,u.hj)(a)&&a.scrollable)),this.isSuggesterVocabulary$=this.vocabulary$.pipe((0,F.T)(a=>(0,u.hj)(a)&&!a.hierarchical&&!a.scrollable))}createModel(a){if((0,u.hj)(a)){let c;(0,u.hj)(this.mdValue.newValue.value)?(c=new N.e,c.value=this.mdValue.newValue.value,c.display=this.mdValue.newValue.value,this.mdValue.newValue.authority&&(c.authority=this.mdValue.newValue.authority,c.confidence=this.mdValue.newValue.confidence)):c=this.mdValue.newValue.value;const o=a?{closed:!1,name:a.name}:null;return a.scrollable?new y.j({id:"authorityField",label:`${this.dsoType}.edit.metadata.edit.value`,placeholder:`${this.dsoType}.edit.metadata.edit.value`,vocabularyOptions:o,metadataFields:[this.mdField],value:c,repeatable:!1,submissionId:"edit-metadata",hasSelectableMetadata:!1,maxOptions:10}):new st.K({id:"authorityField",label:`${this.dsoType}.edit.metadata.edit.value`,vocabularyOptions:o,metadataFields:[this.mdField],value:c,repeatable:!1,submissionId:"edit-metadata",hasSelectableMetadata:!1})}return null}ngOnChanges(a){(0,u.hj)(a.mdField)&&!a.mdField.firstChange&&(0,u.hj)(a.mdField.currentValue)&&((0,u.hj)(a.mdField.previousValue)&&a.mdField.previousValue!==a.mdField.currentValue&&(this.mdValue.newValue.authority=null,this.mdValue.newValue.confidence=l.l.CF_UNSET),a.mdField.currentValue.includes(".")&&this.validateMetadataField().subscribe(c=>{c&&(this.initAuthorityProperties(),this.cdr.detectChanges())}))}validateMetadataField(){return this.registryService.queryMetadataFields(this.mdField,null,!0,!1,(0,z.s)("schema")).pipe((0,e.qD)(),(0,K.n)(a=>a.hasSucceeded?(0,J.of)(a).pipe((0,e.LB)(),(0,L.s)(1),(0,F.T)(c=>c.indexOf(this.mdField)>-1)):(this.notificationsService.error(this.translate.instant(`${this.dsoType}.edit.metadata.metadatafield.error`),a.errorMessage),[!1])))}onChangeAuthorityField(a){a?(this.mdValue.newValue.value=a.value,a.authority?(this.mdValue.newValue.authority=a.authority,this.mdValue.newValue.confidence=l.l.CF_ACCEPTED):(this.mdValue.newValue.authority=null,this.mdValue.newValue.confidence=l.l.CF_UNSET),this.confirm.emit(!1)):(this.mdValue.newValue.value="",this.mdValue.newValue.authority=null,this.mdValue.newValue.confidence=l.l.CF_UNSET,this.confirm.emit(!1))}getModel(){return this.model$.value}onChangeEditingAuthorityStatus(a){this.editingAuthority=a}onChangeAuthorityKey(){""===this.mdValue.newValue.authority?(this.mdValue.newValue.confidence=l.l.CF_NOVALUE,this.confirm.emit(!1)):this.mdValue.newValue.authority!==this.mdValue.originalValue.authority&&(this.mdValue.newValue.confidence=l.l.CF_ACCEPTED,this.confirm.emit(!1))}toggleFreeTextEdition(){this.enabledFreeTextEditing&&this.getModel().value!==this.mdValue.newValue.value&&this.initAuthorityProperties(),this.enabledFreeTextEditing=!this.enabledFreeTextEditing}static{this.\u0275fac=function(c){return new(c||d)(t.rXU(t.gRc),t.rXU(Z),t.rXU(Y.ItemDataService),t.rXU(s.I),t.rXU(nt.x),t.rXU(v.c$))}}static{this.\u0275cmp=t.VBU({type:d,selectors:[["ds-dso-edit-metadata-authority-field"]],standalone:!0,features:[t.Vt3,t.OA$,t.aNF],decls:1,vars:1,consts:[["rows","5",1,"form-control",3,"ngModel","dsDebounce"],[3,"bindId","group","model"],[3,"group","model"],[1,"btn","btn-secondary","w-100","mt-2",3,"title"],[1,"mt-2"],["rows","5",1,"form-control",3,"ngModelChange","onDebounce","ngModel","dsDebounce"],[3,"change","bindId","group","model"],[3,"change","group","model"],[1,"btn","btn-secondary","w-100","mt-2",3,"click","title"],[1,"fas","fa-fw",3,"ngClass"],[1,"btn-group","w-75"],["dsAuthorityConfidenceState","","aria-hidden","true",1,"fas","fa-fw","p-0","me-1","mt-auto","mb-auto",3,"authorityValue","iconMode"],["data-test","authority-input",1,"form-control","form-outline",3,"ngModelChange","change","ngModel","disabled"],["id","metadata-confirm-btn",1,"btn","btn-outline-success","btn-sm","ng-star-inserted",3,"title","ngbTooltip"],["id","metadata-confirm-btn",1,"btn","btn-outline-secondary","btn-sm","ng-star-inserted",3,"title","ngbTooltip"],["id","metadata-confirm-btn",1,"btn","btn-outline-success","btn-sm","ng-star-inserted",3,"click","title","ngbTooltip"],[1,"fas","fa-lock-open","fa-fw"],["id","metadata-confirm-btn",1,"btn","btn-outline-secondary","btn-sm","ng-star-inserted",3,"click","title","ngbTooltip"],[1,"fas","fa-lock","fa-fw"]],template:function(c,o){1&c&&t.DNE(0,ct,14,23),2&c&&t.vxM(o.mdValue.editing?0:-1)},dependencies:[n.Jj,U.K,X.R,it.d,ot.s,m.YN,m.me,m.BC,m.vS,x.n8,x.md,n.YU,v.h,v.D9]})}}return d})();var mt=i(67685);const pt=(d,w)=>w.label;function ht(d,w){if(1&d&&(t.j41(0,"option",1),t.EFF(1),t.k0s()),2&d){const a=w.$implicit;t.Y8G("value","none"===a.label?void 0:a.label),t.R7$(),t.SpI(" ",a.label," ")}}let ft=(()=>{class d extends f{constructor(a){super(),this.entityTypeService=a}ngOnInit(){this.entities$=this.entityTypeService.findAll({elementsPerPage:100,currentPage:1}).pipe((0,e.Ar)())}static{this.\u0275fac=function(c){return new(c||d)(t.rXU(mt.f))}}static{this.\u0275cmp=t.VBU({type:d,selectors:[["ds-dso-edit-metadata-entity-field"]],standalone:!0,features:[t.Vt3,t.aNF],decls:5,vars:6,consts:[[1,"form-select",3,"ngModelChange","ngModel"],[3,"value"]],template:function(c,o){1&c&&(t.j41(0,"select",0),t.nI1(1,"translate"),t.mxI("ngModelChange",function(S){return t.DH7(null==o.mdValue?null:o.mdValue.newValue.value,S)||((null==o.mdValue?null:o.mdValue.newValue).value=S),S}),t.bIt("ngModelChange",function(){return o.confirm.emit(!1)}),t.Z7z(2,ht,2,2,"option",1,pt),t.nI1(4,"async"),t.k0s()),2&c&&(t.R50("ngModel",null==o.mdValue?null:o.mdValue.newValue.value),t.BMQ("aria-label",t.bMT(1,2,o.dsoType+".edit.metadata.edit.value")),t.R7$(2),t.Dyx(t.bMT(4,4,o.entities$)))},dependencies:[n.Jj,m.YN,m.xH,m.y7,m.wz,m.BC,m.vS,v.h,v.D9]})}}return d})();const dt=new Map([[E.PLAIN_TEXT,new Map([[M.A2,new Map([[M.SS,(()=>{class d extends f{static{this.\u0275fac=(()=>{let a;return function(o){return(a||(a=t.xGo(d)))(o||d)}})()}static{this.\u0275cmp=t.VBU({type:d,selectors:[["ds-dso-edit-metadata-text-field"]],standalone:!0,features:[t.Vt3,t.aNF],decls:2,vars:5,consts:[["rows","5",1,"form-control",3,"ngModelChange","onDebounce","ngModel","dsDebounce"]],template:function(c,o){1&c&&(t.j41(0,"textarea",0),t.nI1(1,"translate"),t.mxI("ngModelChange",function(S){return t.DH7(null==o.mdValue?null:o.mdValue.newValue.value,S)||((null==o.mdValue?null:o.mdValue.newValue).value=S),S}),t.bIt("onDebounce",function(){return o.confirm.emit(!1)}),t.k0s()),2&c&&(t.R50("ngModel",null==o.mdValue?null:o.mdValue.newValue.value),t.Y8G("dsDebounce",300),t.BMQ("aria-label",t.bMT(1,3,o.dsoType+".edit.metadata.edit.value")))},dependencies:[X.R,m.YN,m.me,m.BC,m.vS,v.h,v.D9]})}}return d})()]])]])],[E.ENTITY_TYPE,new Map([[M.A2,new Map([[M.SS,ft]])]])],[E.AUTHORITY,new Map([[M.A2,new Map([[M.SS,ut]])]])]]),_t=E.PLAIN_TEXT;function vt(d,w){}let Mt=(()=>{class d extends k.e{constructor(){super(...arguments),this.confirm=new t.bkB,this.inputNamesDependentForComponent=["context","type"],this.inputNames=["context","dso","dsoType","type","mdField","mdValue"],this.outputNames=["confirm"]}getComponent(){return function bt(d,w=M.A2,a=M.SS){if(d){const c=dt.get(d);if((0,u.a4)(c)){const o=c.get(w);if((0,u.a4)(o)){const b=(0,M.eW)(o,a);if((0,u.a4)(b))return b;if((0,u.a4)(o.get(M.SS)))return o.get(M.SS)}if((0,u.a4)(c.get(M.A2))&&(0,u.a4)(c.get(M.A2).get(M.SS)))return c.get(M.A2).get(M.SS)}}return dt.get(_t).get(M.A2).get(M.SS)}(this.type,this.context,this.themeService.getThemeName())}static{this.\u0275fac=(()=>{let a;return function(o){return(a||(a=t.xGo(d)))(o||d)}})()}static{this.\u0275cmp=t.VBU({type:d,selectors:[["ds-dso-edit-metadata-value-field-loader"]],inputs:{context:"context",dso:"dso",dsoType:"dsoType",type:"type",mdField:"mdField",mdValue:"mdValue"},outputs:{confirm:"confirm"},standalone:!0,features:[t.Vt3,t.aNF],decls:2,vars:0,consts:[["DynamicComponentLoader",""],["dsDynamicComponentLoader",""]],template:function(c,o){1&c&&t.DNE(0,vt,0,0,"ng-template",1,0,t.C5r)},dependencies:[T.z],encapsulation:2})}}return d})();const yt=(d,w,a,c)=>({"ds-warning":d,"ds-danger":w,"ds-success":a,"h-100":c});function Tt(d,w){if(1&d&&(t.j41(0,"div",2),t.EFF(1),t.k0s()),2&d){const a=t.XpG();t.R7$(),t.JRh(a.mdValue.newValue.value)}}function Ct(d,w){if(1&d){const a=t.RV6();t.j41(0,"ds-dso-edit-metadata-value-field-loader",19),t.nI1(1,"async"),t.bIt("confirm",function(o){t.eBV(a);const b=t.XpG();return t.Njj(b.confirm.emit(o))}),t.k0s()}if(2&d){const a=t.XpG();t.Y8G("context",a.context)("dso",a.dso)("dsoType",a.dsoType)("mdField",a.mdField)("mdValue",a.mdValue)("type",t.bMT(1,6,a.fieldType$))}}function Vt(d,w){if(1&d&&(t.j41(0,"div")(1,"span",20),t.nrm(2,"i",21),t.EFF(3),t.nI1(4,"translate"),t.k0s()()),2&d){const a=t.XpG();t.R7$(2),t.Y8G("authorityValue",a.mdValue.newValue)("iconMode",!0),t.R7$(),t.Lme(" ",t.bMT(4,4,a.dsoType+".edit.metadata.authority.label")," ",a.mdValue.newValue.authority," ")}}function Et(d,w){if(1&d&&(t.j41(0,"div",4)(1,"a",22),t.nI1(2,"async"),t.EFF(3),t.nI1(4,"async"),t.k0s(),t.nrm(5,"ds-type-badge",23),t.k0s()),2&d){const a=t.XpG(),c=t.r8f(2);t.R7$(),t.Y8G("routerLink",t.bMT(2,3,a.mdRepresentationItemRoute$)),t.R7$(2),t.JRh(t.bMT(4,5,a.mdRepresentationName$)),t.R7$(2),t.Y8G("object",c)}}function Dt(d,w){if(1&d){const a=t.RV6();t.j41(0,"input",24),t.nI1(1,"translate"),t.mxI("ngModelChange",function(o){t.eBV(a);const b=t.XpG();return t.DH7(b.mdValue.newValue.language,o)||(b.mdValue.newValue.language=o),t.Njj(o)}),t.bIt("onDebounce",function(){t.eBV(a);const o=t.XpG();return t.Njj(o.confirm.emit(!1))}),t.k0s()}if(2&d){const a=t.XpG();t.R50("ngModel",a.mdValue.newValue.language),t.Y8G("dsDebounce",300),t.BMQ("aria-label",t.bMT(1,3,a.dsoType+".edit.metadata.edit.language"))}}function Ft(d,w){if(1&d&&(t.j41(0,"div",2),t.EFF(1),t.k0s()),2&d){const a=t.XpG();t.R7$(),t.JRh(a.mdValue.newValue.language)}}function Ot(d,w){if(1&d){const a=t.RV6();t.j41(0,"button",25),t.nI1(1,"translate"),t.nI1(2,"translate"),t.bIt("click",function(){t.eBV(a);const o=t.XpG();return t.Njj(o.confirm.emit(!0))}),t.nrm(3,"i",26),t.k0s()}if(2&d){const a=t.XpG(),c=t.r8f(0),o=t.r8f(17);t.FS9("ngbTooltip",t.bMT(1,3,a.dsoType+".edit.metadata.edit.buttons.confirm")),t.Y8G("title",t.bMT(2,5,a.dsoType+".edit.metadata.edit.buttons.confirm"))("dsBtnDisabled",c||o)}}function xt(d,w){if(1&d){const a=t.RV6();t.j41(0,"button",27),t.nI1(1,"translate"),t.nI1(2,"translate"),t.bIt("click",function(){t.eBV(a);const o=t.XpG();return t.Njj(o.edit.emit())}),t.nrm(3,"i",28),t.k0s()}if(2&d){const a=t.XpG(),c=t.r8f(0),o=t.r8f(17);t.FS9("ngbTooltip",t.bMT(1,3,a.dsoType+".edit.metadata.edit.buttons.edit")),t.Y8G("title",t.bMT(2,5,a.dsoType+".edit.metadata.edit.buttons.edit"))("dsBtnDisabled",c||a.mdValue.change===a.DsoEditMetadataChangeTypeEnum.REMOVE||o)}}let It=(()=>{class d{constructor(a,c,o,b){this.relationshipService=a,this.dsoNameService=c,this.metadataService=o,this.dsoEditMetadataFieldService=b,this.isOnlyValue=!1,this.edit=new t.bkB,this.confirm=new t.bkB,this.remove=new t.bkB,this.undo=new t.bkB,this.dragging=new t.bkB,this.DsoEditMetadataChangeTypeEnum=et.QR,this.ConfidenceTypeEnum=l.l}ngOnInit(){this.initVirtualProperties()}ngOnChanges(a){a.mdField&&(this.fieldType$=this.getFieldType())}initVirtualProperties(){this.mdRepresentation$=this.metadataService.isVirtual(this.mdValue.newValue)?this.relationshipService.resolveMetadataRepresentation(this.mdValue.newValue,this.dso,"Item").pipe((0,F.T)(a=>a.representationType===O.d.Item?a:null)):C.w,this.mdRepresentationItemRoute$=this.mdRepresentation$.pipe((0,F.T)(a=>a?(0,R._o)(a):null)),this.mdRepresentationName$=this.mdRepresentation$.pipe((0,F.T)(a=>a?this.dsoNameService.getName(a):null))}getFieldType(){return this.dsoEditMetadataFieldService.findDsoFieldVocabulary(this.dso,this.mdField).pipe((0,F.T)(a=>(0,u.a4)(a)?E.AUTHORITY:"dspace.entity.type"===this.mdField?E.ENTITY_TYPE:E.PLAIN_TEXT))}static{this.\u0275fac=function(c){return new(c||d)(t.rXU(h.RelationshipDataService),t.rXU(B.f),t.rXU(r.T),t.rXU(Z))}}static{this.\u0275cmp=t.VBU({type:d,selectors:[["ds-dso-edit-metadata-value"]],inputs:{context:"context",dso:"dso",mdField:"mdField",mdValue:"mdValue",dsoType:"dsoType",saving$:"saving$",isOnlyValue:"isOnlyValue"},outputs:{edit:"edit",confirm:"confirm",remove:"remove",undo:"undo",dragging:"dragging"},standalone:!0,features:[t.OA$,t.aNF],decls:33,vars:46,consts:[["role","row","cdkDrag","",1,"d-flex","flex-row","ds-value-row",3,"cdkDragStarted","cdkDragEnded","ngClass"],["role","cell",1,"flex-grow-1","ds-flex-cell","ds-value-cell","d-flex","flex-column"],[1,"dont-break-out","preserve-line-breaks"],[1,"w-100",3,"context","dso","dsoType","mdField","mdValue","type"],[1,"d-flex"],["role","cell",1,"ds-flex-cell","ds-lang-cell"],["type","text",1,"form-control",3,"ngModel","dsDebounce"],["role","cell",1,"text-center","ds-flex-cell","ds-edit-cell"],[1,"btn-group"],[1,"edit-field"],[1,"btn-group","edit-buttons",3,"ngbTooltip"],["data-test","metadata-confirm-btn",1,"btn","btn-outline-success","btn-sm","ng-star-inserted",3,"title","ngbTooltip","dsBtnDisabled"],["data-test","metadata-edit-btn",1,"btn","btn-outline-primary","btn-sm","ng-star-inserted",3,"title","ngbTooltip","dsBtnDisabled"],["data-test","metadata-remove-btn",1,"btn","btn-outline-danger","btn-sm",3,"click","title","ngbTooltip","dsBtnDisabled"],[1,"fas","fa-trash-alt","fa-fw"],["data-test","metadata-undo-btn",1,"btn","btn-outline-warning","btn-sm",3,"click","title","ngbTooltip","dsBtnDisabled"],[1,"fas","fa-undo-alt","fa-fw"],["data-test","metadata-drag-btn","cdkDragHandle","",1,"btn","btn-outline-secondary","ds-drag-handle","btn-sm",3,"cdkDragHandleDisabled","dsBtnDisabled","title","ngbTooltip"],[1,"fas","fa-grip-vertical","fa-fw"],[1,"w-100",3,"confirm","context","dso","dsoType","mdField","mdValue","type"],[1,"badge","bg-light","border"],["dsAuthorityConfidenceState","","aria-hidden","true",1,"fas","fa-fw","p-0",3,"authorityValue","iconMode"],["target","_blank",1,"me-2",3,"routerLink"],[3,"object"],["type","text",1,"form-control",3,"ngModelChange","onDebounce","ngModel","dsDebounce"],["data-test","metadata-confirm-btn",1,"btn","btn-outline-success","btn-sm","ng-star-inserted",3,"click","title","ngbTooltip","dsBtnDisabled"],[1,"fas","fa-check","fa-fw"],["data-test","metadata-edit-btn",1,"btn","btn-outline-primary","btn-sm","ng-star-inserted",3,"click","title","ngbTooltip","dsBtnDisabled"],[1,"fas","fa-edit","fa-fw"]],template:function(c,o){if(1&c){const b=t.RV6();t.SS7(0),t.j41(1,"div",0),t.bIt("cdkDragStarted",function(){return t.eBV(b),t.Njj(o.dragging.emit(!0))})("cdkDragEnded",function(){return t.eBV(b),t.Njj(o.dragging.emit(!1))}),t.SS7(2),t.nI1(3,"async"),t.j41(4,"div",1),t.DNE(5,Tt,2,1,"div",2)(6,Ct,2,8,"ds-dso-edit-metadata-value-field-loader",3)(7,Vt,5,6,"div")(8,Et,6,7,"div",4),t.k0s(),t.j41(9,"div",5),t.DNE(10,Dt,2,5,"input",6)(11,Ft,2,1,"div",2),t.k0s(),t.j41(12,"div",7)(13,"div",8)(14,"div",9)(15,"div",10),t.nI1(16,"translate"),t.SS7(17),t.nI1(18,"async"),t.DNE(19,Ot,4,7,"button",11)(20,xt,4,7,"button",12),t.j41(21,"button",13),t.nI1(22,"translate"),t.nI1(23,"translate"),t.bIt("click",function(){return t.eBV(b),t.Njj(o.remove.emit())}),t.nrm(24,"i",14),t.k0s(),t.j41(25,"button",15),t.nI1(26,"translate"),t.nI1(27,"translate"),t.bIt("click",function(){return t.eBV(b),t.Njj(o.undo.emit())}),t.nrm(28,"i",16),t.k0s(),t.j41(29,"button",17),t.nI1(30,"translate"),t.nI1(31,"translate"),t.nrm(32,"i",18),t.k0s()()()()()()}if(2&c){const b=t.bH3(o.metadataService.isVirtual(o.mdValue.newValue));t.R7$(),t.Y8G("ngClass",t.ziG(41,yt,o.mdValue.reordered||o.mdValue.change===o.DsoEditMetadataChangeTypeEnum.UPDATE,o.mdValue.change===o.DsoEditMetadataChangeTypeEnum.REMOVE,o.mdValue.change===o.DsoEditMetadataChangeTypeEnum.ADD,o.isOnlyValue)),t.R7$();const S=t.bH3(t.bMT(3,21,o.mdRepresentation$));t.R7$(3),t.vxM(o.mdValue.editing||S?-1:5),t.R7$(),t.vxM(o.mdValue.editing&&!S?6:-1),t.R7$(),t.vxM(b||o.mdValue.editing||!o.mdValue.newValue.authority||o.mdValue.newValue.confidence===o.ConfidenceTypeEnum.CF_UNSET||o.mdValue.newValue.confidence===o.ConfidenceTypeEnum.CF_NOVALUE?-1:7),t.R7$(),t.vxM(S?8:-1),t.R7$(2),t.vxM(o.mdValue.editing?10:11),t.R7$(5),t.Y8G("ngbTooltip",b?t.bMT(16,24,o.dsoType+".edit.metadata.edit.buttons.virtual"):null),t.R7$(2);const Q=t.bH3(t.bMT(18,26,o.saving$));t.R7$(2),t.vxM(o.mdValue.editing?19:20),t.R7$(2),t.FS9("ngbTooltip",t.bMT(22,29,o.dsoType+".edit.metadata.edit.buttons.remove")),t.Y8G("title",t.bMT(23,31,o.dsoType+".edit.metadata.edit.buttons.remove"))("dsBtnDisabled",b||o.mdValue.change&&o.mdValue.change!==o.DsoEditMetadataChangeTypeEnum.ADD||o.mdValue.editing||Q),t.R7$(4),t.FS9("ngbTooltip",t.bMT(26,33,o.dsoType+".edit.metadata.edit.buttons.undo")),t.Y8G("title",t.bMT(27,35,o.dsoType+".edit.metadata.edit.buttons.undo"))("dsBtnDisabled",b||!o.mdValue.change&&o.mdValue.reordered||!o.mdValue.change&&!o.mdValue.editing||Q),t.R7$(4),t.AVh("disabled",o.isOnlyValue||Q),t.FS9("ngbTooltip",t.bMT(30,37,o.dsoType+".edit.metadata.edit.buttons.drag")),t.Y8G("cdkDragHandleDisabled",o.isOnlyValue||Q)("dsBtnDisabled",o.isOnlyValue||Q)("title",t.bMT(31,39,o.dsoType+".edit.metadata.edit.buttons.drag"))}},dependencies:[n.Jj,U.K,V.A,D.T1,D.Fb,X.R,Mt,m.YN,m.me,m.BC,m.vS,x.n8,x.md,n.YU,A.Wk,tt.C,v.h,v.D9],styles:[".ds-success[_ngcontent-%COMP%]{background-color:var(--ds-success-bg);border:1px solid var(--bs-success)}.ds-drag-handle[_ngcontent-%COMP%]:not(.disabled){cursor:grab}  .edit-field>ngb-tooltip-window .tooltip-inner{min-width:var(--ds-dso-edit-virtual-tooltip-min-width)}.cdk-drag-placeholder[_ngcontent-%COMP%]{opacity:0}.badge.bg-light[_ngcontent-%COMP%]{color:var(--bs-gray-900)}",".ds-field-row[_ngcontent-%COMP%]{border:1px solid var(--bs-gray-400)}.ds-flex-cell[_ngcontent-%COMP%]{padding:1rem;border:1px solid var(--bs-gray-200)}.ds-lang-cell[_ngcontent-%COMP%]{min-width:var(--ds-dso-edit-lang-width);max-width:var(--ds-dso-edit-lang-width)}.ds-edit-cell[_ngcontent-%COMP%]{min-width:var(--ds-dso-edit-actions-width)}.ds-value-row[_ngcontent-%COMP%]{background-color:#fff}.ds-value-row[_ngcontent-%COMP%]:active{cursor:grabbing}.ds-value-row.ds-warning[_ngcontent-%COMP%]{background-color:var(--ds-warning-bg-subtle)}.ds-value-row.ds-warning[_ngcontent-%COMP%]   .ds-flex-cell[_ngcontent-%COMP%]{border:1px solid var(--bs-warning-border-subtle)}.ds-value-row.ds-danger[_ngcontent-%COMP%]{background-color:var(--ds-danger-bg-subtle)}.ds-value-row.ds-danger[_ngcontent-%COMP%]   .ds-flex-cell[_ngcontent-%COMP%]{border:1px solid var(--bs-danger-border-subtle)}.ds-value-row.ds-success[_ngcontent-%COMP%]{background-color:var(--ds-success-bg-subtle)}.ds-value-row.ds-success[_ngcontent-%COMP%]   .ds-flex-cell[_ngcontent-%COMP%]{border:1px solid var(--bs-success-border-subtle)}"]})}}return d})()},76148:(G,j,i)=>{"use strict";i.r(j),i.d(j,{DsoEditMetadataComponent:()=>ot});var D=i(60177),n=i(68018),t=i(84412),m=i(84572),A=i(7673),x=i(96354),v=i(88141),C=i(73028),F=i(79096),B=i(44583),h=i(40940),l=(i(73685),i(4093)),p=i(44043),g=i(64972),O=i(74082),R=i(79104),V=i(89777),u=i(15202),U=i(9847),tt=i(20439),X=i(47619),et=i(5051),J=i(46878),K=i(19795),Y=i(30003),e=i(54438),at=i(7901),z=i(40031);let Z=(()=>{class y{diff(s,f){return this.getMoves(s,f).map(_=>Object.assign({op:"move",from:"/"+_[0],path:"/"+_[1]}))}getMoves(s,f){const _=[...f];return s.reduce((P,W,H)=>{if((0,V.a4)(W)&&W!==_[H]){const q=_.lastIndexOf(W);(0,z.HD)(_,q,H),P.unshift([H,q])}return P},[])}static{this.\u0275fac=function(f){return new(f||y)}}static{this.\u0275prov=e.jDH({token:y,factory:y.\u0275fac,providedIn:"root"})}}return y})();function E(y,N){if(1&y){const s=e.RV6();e.j41(0,"button",17),e.nI1(1,"async"),e.nI1(2,"translate"),e.nI1(3,"translate"),e.bIt("click",function(){e.eBV(s);const _=e.XpG(2);return e.Njj(_.reinstate())}),e.nrm(4,"i",18),e.j41(5,"span",4),e.EFF(6),e.nI1(7,"translate"),e.k0s()()}if(2&y){const s=e.XpG(2);e.Y8G("dsBtnDisabled",e.bMT(1,4,s.saving$))("title",e.bMT(2,6,s.dsoType+".edit.metadata.reinstate-button")),e.BMQ("aria-label",e.bMT(3,8,s.dsoType+".edit.metadata.reinstate-button")),e.R7$(6),e.SpI("\xa0",e.bMT(7,10,s.dsoType+".edit.metadata.reinstate-button"),"")}}function k(y,N){if(1&y){const s=e.RV6();e.j41(0,"button",19),e.nI1(1,"translate"),e.nI1(2,"async"),e.nI1(3,"translate"),e.bIt("click",function(){e.eBV(s);const _=e.XpG(2);return e.Njj(_.discard())}),e.nrm(4,"i",20),e.j41(5,"span",4),e.EFF(6),e.nI1(7,"translate"),e.k0s()()}if(2&y){const s=e.XpG(2);e.Y8G("title",e.bMT(1,4,s.dsoType+".edit.metadata.discard-button"))("dsBtnDisabled",!s.hasChanges||e.bMT(2,6,s.saving$)),e.BMQ("aria-label",e.bMT(3,8,s.dsoType+".edit.metadata.discard-button")),e.R7$(6),e.SpI("\xa0",e.bMT(7,10,s.dsoType+".edit.metadata.discard-button"),"")}}function T(y,N){if(1&y){const s=e.RV6();e.j41(0,"div",11)(1,"div",21)(2,"ds-metadata-field-selector",22),e.mxI("mdFieldChange",function(_){e.eBV(s);const P=e.XpG(2);return e.DH7(P.newMdField,_)||(P.newMdField=_),e.Njj(_)}),e.k0s()(),e.j41(3,"div",23)(4,"div",9),e.nrm(5,"ds-dso-edit-metadata-value-headers",24),e.j41(6,"ds-dso-edit-metadata-value",25),e.bIt("confirm",function(_){e.eBV(s);const P=e.XpG(2);return e.Njj(P.confirmNewValue(_))})("remove",function(){e.eBV(s);const _=e.XpG(2);return e.Njj(_.form.newValue=void 0)})("undo",function(){e.eBV(s);const _=e.XpG(2);return e.Njj(_.form.newValue=void 0)}),e.k0s()()()()}if(2&y){const s=e.XpG(2);e.R7$(2),e.Y8G("dsoType",s.dsoType),e.R50("mdField",s.newMdField),e.Y8G("autofocus",!0),e.R7$(3),e.Y8G("dsoType",s.dsoType),e.R7$(),e.Y8G("dso",s.dso)("context",s.Context.AddMetadata)("mdValue",s.form.newValue)("dsoType",s.dsoType)("saving$",s.savingOrLoadingFieldValidation$)("isOnlyValue",!0)("mdField",s.newMdField)}}function M(y,N){if(1&y){const s=e.RV6();e.j41(0,"div",30),e.bIt("click",function(){e.eBV(s);const _=e.XpG().$implicit,P=e.XpG(2);return P.form.resetOrder(_),e.Njj(P.onValueSaved())}),e.EFF(1),e.nI1(2,"translate"),e.k0s()}if(2&y){const s=e.XpG(3);e.R7$(),e.SpI(" ",e.bMT(2,1,s.dsoType+".edit.metadata.reset-order-button")," ")}}function I(y,N){if(1&y){const s=e.RV6();e.j41(0,"div",11)(1,"div",26)(2,"span",27),e.EFF(3),e.k0s(),e.DNE(4,M,3,3,"div",28),e.k0s(),e.j41(5,"ds-dso-edit-metadata-field-values",29),e.bIt("valueSaved",function(){e.eBV(s);const _=e.XpG(2);return e.Njj(_.onValueSaved())}),e.k0s()()}if(2&y){const s=N.$implicit,f=e.XpG(2);e.R7$(3),e.JRh(s),e.R7$(),e.vxM(f.form.hasOrderChanges(s)?4:-1),e.R7$(),e.Y8G("dso",f.dso)("form",f.form)("dsoType",f.dsoType)("saving$",f.saving$)("draggingMdField$",f.draggingMdField$)("mdField",s)}}function $(y,N){if(1&y&&(e.j41(0,"div"),e.nrm(1,"ds-alert",31),e.k0s()),2&y){const s=e.XpG(2);e.R7$(),e.Y8G("content",s.dsoType+".edit.metadata.empty")("type",s.AlertTypeEnum.Info)}}function L(y,N){if(1&y){const s=e.RV6();e.j41(0,"button",32),e.nI1(1,"async"),e.nI1(2,"translate"),e.nI1(3,"translate"),e.bIt("click",function(){e.eBV(s);const _=e.XpG(2);return e.Njj(_.reinstate())}),e.nrm(4,"i",18),e.EFF(5),e.nI1(6,"translate"),e.k0s()}if(2&y){const s=e.XpG(2);e.Y8G("dsBtnDisabled",e.bMT(1,4,s.saving$))("title",e.bMT(2,6,s.dsoType+".edit.metadata.reinstate-button")),e.BMQ("aria-label",e.bMT(3,8,s.dsoType+".edit.metadata.reinstate-button")),e.R7$(5),e.SpI(" ",e.bMT(6,10,s.dsoType+".edit.metadata.reinstate-button")," ")}}function nt(y,N){if(1&y){const s=e.RV6();e.j41(0,"button",33),e.nI1(1,"translate"),e.nI1(2,"async"),e.nI1(3,"translate"),e.bIt("click",function(){e.eBV(s);const _=e.XpG(2);return e.Njj(_.discard())}),e.nrm(4,"i",20),e.EFF(5),e.nI1(6,"translate"),e.k0s()}if(2&y){const s=e.XpG(2);e.Y8G("title",e.bMT(1,4,s.dsoType+".edit.metadata.discard-button"))("dsBtnDisabled",!s.hasChanges||e.bMT(2,6,s.saving$)),e.BMQ("aria-label",e.bMT(3,8,s.dsoType+".edit.metadata.discard-button")),e.R7$(5),e.SpI(" ",e.bMT(6,10,s.dsoType+".edit.metadata.discard-button")," ")}}function it(y,N){if(1&y){const s=e.RV6();e.j41(0,"div",0)(1,"div",1)(2,"button",2),e.nI1(3,"async"),e.nI1(4,"translate"),e.nI1(5,"translate"),e.bIt("click",function(){e.eBV(s);const _=e.XpG();return e.Njj(_.add())}),e.nrm(6,"i",3),e.j41(7,"span",4),e.EFF(8),e.nI1(9,"translate"),e.k0s()(),e.DNE(10,E,8,12,"button",5),e.j41(11,"button",6),e.nI1(12,"async"),e.nI1(13,"translate"),e.nI1(14,"translate"),e.bIt("click",function(){e.eBV(s);const _=e.XpG();return e.Njj(_.submit())}),e.nrm(15,"i",7),e.j41(16,"span",4),e.EFF(17),e.nI1(18,"translate"),e.k0s()(),e.DNE(19,k,8,12,"button",8),e.k0s(),e.j41(20,"div",9),e.nI1(21,"translate"),e.nrm(22,"ds-dso-edit-metadata-headers",10),e.DNE(23,T,7,11,"div",11),e.Z7z(24,I,6,8,"div",11,e.fX1),e.k0s(),e.DNE(26,$,2,2,"div"),e.j41(27,"div",12)(28,"div",13),e.DNE(29,L,7,12,"button",14),e.j41(30,"button",15),e.nI1(31,"async"),e.nI1(32,"translate"),e.nI1(33,"translate"),e.bIt("click",function(){e.eBV(s);const _=e.XpG();return e.Njj(_.submit())}),e.nrm(34,"i",7),e.EFF(35),e.nI1(36,"translate"),e.k0s(),e.DNE(37,nt,7,12,"button",16),e.k0s()()()}if(2&y){const s=e.XpG();e.R7$(2),e.Y8G("dsBtnDisabled",s.form.newValue||e.bMT(3,20,s.saving$))("title",e.bMT(4,22,s.dsoType+".edit.metadata.add-button")),e.BMQ("aria-label",e.bMT(5,24,s.dsoType+".edit.metadata.add-button")),e.R7$(6),e.SpI("\xa0",e.bMT(9,26,s.dsoType+".edit.metadata.add-button"),""),e.R7$(2),e.vxM(s.isReinstatable?10:-1),e.R7$(),e.Y8G("dsBtnDisabled",!s.hasChanges||e.bMT(12,28,s.saving$))("title",e.bMT(13,30,s.dsoType+".edit.metadata.save-button")),e.BMQ("aria-label",e.bMT(14,32,s.dsoType+".edit.metadata.save-button")),e.R7$(6),e.SpI("\xa0",e.bMT(18,34,s.dsoType+".edit.metadata.save-button"),""),e.R7$(2),e.vxM(s.isReinstatable?-1:19),e.R7$(),e.BMQ("aria-label",e.bMT(21,36,"item.edit.head")),e.R7$(2),e.Y8G("dsoType",s.dsoType),e.R7$(),e.vxM(s.form.newValue?23:-1),e.R7$(),e.Dyx(s.form.fieldKeys),e.R7$(2),e.vxM(s.isEmpty&&!s.form.newValue?26:-1),e.R7$(3),e.vxM(s.isReinstatable?29:-1),e.R7$(),e.Y8G("dsBtnDisabled",!s.hasChanges||e.bMT(31,38,s.saving$))("title",e.bMT(32,40,s.dsoType+".edit.metadata.save-button")),e.BMQ("aria-label",e.bMT(33,42,s.dsoType+".edit.metadata.save-button")),e.R7$(5),e.SpI(" ",e.bMT(36,44,s.dsoType+".edit.metadata.save-button")," "),e.R7$(2),e.vxM(s.isReinstatable?-1:37)}}function st(y,N){1&y&&e.nrm(0,"ds-loading")}let ot=(()=>{class y{constructor(s,f,_,P,W,H,q){this.route=s,this.notificationsService=f,this.translateService=_,this.parentInjector=P,this.arrayMoveChangeAnalyser=W,this.cdr=H,this.dataServiceMap=q,this.saving$=new t.t(!1),this.draggingMdField$=new t.t(null),this.loadingFieldValidation$=new t.t(!1),this.AlertTypeEnum=O.v,this.Context=h.o}ngOnInit(){(0,V.Tn)(this.dso)?this.dsoUpdateSubscription=(0,m.z)([this.route.data,this.route.parent.data]).pipe((0,x.T)(([s,f])=>Object.assign({},s,f)),(0,v.M)(s=>this.initDSO(s.dso.payload)),(0,C.Z)(()=>this.retrieveDataService())).subscribe(s=>{this.initDataService(s),this.initForm()}):(this.initDSOType(this.dso),this.retrieveDataService().subscribe(s=>{this.initDataService(s),this.initForm()})),this.savingOrLoadingFieldValidation$=(0,m.z)([this.saving$,this.loadingFieldValidation$]).pipe((0,x.T)(([s,f])=>s||f))}retrieveDataService(){return(0,V.Tn)(this.updateDataService)?(0,B.M)(this.dataServiceMap,this.dsoType,this.parentInjector):(0,A.of)(this.updateDataService)}initDSO(s){this.dso=s,this.initDSOType(s)}initDSOType(s){let f;f="string"==typeof s.type?new p.v(s.type):s.type,this.dsoType=f.value}initDataService(s){(0,V.hj)(s)&&(this.updateDataService=s)}initForm(){this.form=new X.qf(this.dso.metadata),this.onValueSaved(),this.cdr.detectChanges()}onValueSaved(){this.hasChanges=this.form.hasChanges(),this.isReinstatable=this.form.isReinstatable(),this.isEmpty=0===Object.keys(this.form.fields).length}submit(){this.saving$.next(!0),this.updateDataService.patch(this.dso,this.form.getOperations(this.arrayMoveChangeAnalyser)).pipe((0,l.qD)()).subscribe(s=>{this.saving$.next(!1),s.hasFailed?this.notificationsService.error(this.translateService.instant(`${this.dsoType}.edit.metadata.notifications.error.title`),s.errorMessage):(this.notificationsService.success(this.translateService.instant(`${this.dsoType}.edit.metadata.notifications.saved.title`),this.translateService.instant(`${this.dsoType}.edit.metadata.notifications.saved.content`)),this.dso=s.payload,this.initForm())})}confirmNewValue(s){s&&this.setMetadataField()}setMetadataField(){this.form.resetReinstatable(),this.loadingFieldValidation$.next(!0),this.metadataFieldSelectorComponent.validate().subscribe(s=>{this.loadingFieldValidation$.next(!1),s&&(this.form.setMetadataField(this.newMdField),this.onValueSaved())})}add(){this.newMdField=void 0,this.form.add()}discard(){this.form.discard(),this.onValueSaved()}reinstate(){this.form.reinstate(),this.onValueSaved()}ngOnDestroy(){(0,V.a4)(this.dsoUpdateSubscription)&&this.dsoUpdateSubscription.unsubscribe()}static{this.\u0275fac=function(f){return new(f||y)(e.rXU(at.nX),e.rXU(U.I),e.rXU(n.c$),e.rXU(e.zZn),e.rXU(Z),e.rXU(e.gRc),e.rXU(F.l9))}}static{this.\u0275cmp=e.VBU({type:y,selectors:[["ds-base-dso-edit-metadata"]],viewQuery:function(f,_){if(1&f&&e.GBs(Y.g,5),2&f){let P;e.mGM(P=e.lsd())&&(_.metadataFieldSelectorComponent=P.first)}},inputs:{dso:"dso",updateDataService:"updateDataService"},standalone:!0,features:[e.aNF],decls:2,vars:2,consts:[[1,"item-metadata"],[1,"button-row","top","d-flex","my-2","space-children-mr","ms-gap"],["id","dso-add-btn",1,"me-auto","btn","btn-success",3,"click","dsBtnDisabled","title"],["aria-hidden","true",1,"fas","fa-plus"],[1,"d-none","d-sm-inline"],["id","dso-reinstate-btn",1,"btn","btn-warning","ms-1",3,"dsBtnDisabled","title"],["id","dso-save-btn",1,"btn","btn-primary","ms-1",3,"click","dsBtnDisabled","title"],["aria-hidden","true",1,"fas","fa-save"],["id","dso-discard-btn",1,"btn","btn-danger","ms-1",3,"title","dsBtnDisabled"],["role","table"],[3,"dsoType"],["role","row",1,"d-flex","flex-row","ds-field-row"],[1,"button-row","bottom","d-inline-block","w-100"],[1,"mt-2","float-end","space-children-mr","ms-gap"],[1,"btn","btn-warning",3,"dsBtnDisabled","title"],[1,"btn","btn-primary",3,"click","dsBtnDisabled","title"],[1,"btn","btn-danger",3,"title","dsBtnDisabled"],["id","dso-reinstate-btn",1,"btn","btn-warning","ms-1",3,"click","dsBtnDisabled","title"],["aria-hidden","true",1,"fas","fa-undo-alt"],["id","dso-discard-btn",1,"btn","btn-danger","ms-1",3,"click","title","dsBtnDisabled"],["aria-hidden","true",1,"fas","fa-times"],["role","rowheader",1,"lbl-cell","ds-success"],[3,"mdFieldChange","dsoType","mdField","autofocus"],["role","cell",1,"flex-grow-1","ds-drop-list"],["role","presentation",3,"dsoType"],[3,"confirm","remove","undo","dso","context","mdValue","dsoType","saving$","isOnlyValue","mdField"],["role","rowheader",1,"lbl-cell"],[1,"dont-break-out","preserve-line-breaks"],[1,"btn","btn-warning","reset-order-button","mt-2","w-100"],["role","cell",1,"flex-grow-1",3,"valueSaved","dso","form","dsoType","saving$","draggingMdField$","mdField"],[1,"btn","btn-warning","reset-order-button","mt-2","w-100",3,"click"],[3,"content","type"],[1,"btn","btn-warning",3,"click","dsBtnDisabled","title"],[1,"btn","btn-danger",3,"click","title","dsBtnDisabled"]],template:function(f,_){1&f&&e.DNE(0,it,38,46,"div",0)(1,st,1,0,"ds-loading"),2&f&&(e.vxM(_.form?0:-1),e.R7$(),e.vxM(_.form?-1:1))},dependencies:[g.C,D.Jj,R.A,tt.t,et.L,J.o,K.c,Y.g,u.v,n.h,n.D9],styles:[".lbl-cell[_ngcontent-%COMP%]{min-width:var(--ds-dso-edit-field-width);max-width:var(--ds-dso-edit-field-width);background-color:var(--bs-gray-100);font-weight:700;padding:1rem;border:1px solid var(--bs-gray-200)}.lbl-cell.ds-success[_ngcontent-%COMP%]{background-color:var(--ds-success-bg);border:1px solid var(--bs-success)}.ds-field-row[_ngcontent-%COMP%]{border:1px solid var(--bs-gray-400)}.reset-order-button[_ngcontent-%COMP%]:hover{cursor:pointer}"]})}}return y})()},30003:(G,j,i)=>{"use strict";i.d(j,{g:()=>Z});var D=i(60177),n=i(54438),t=i(89417),m=i(68018),A=i(86820),x=i(84412),v=i(84572),C=i(7673),F=i(70152),B=i(99172),h=i(25558),r=i(96697),l=i(96354),p=i(88141),g=i(70998),O=i(27502),R=i(4093),V=i(89777),u=i(15202),U=i(9847),tt=i(38133),X=i(4600);const et=["mdFieldInput"],J=E=>({"is-invalid":E}),K=E=>({show:E});function Y(E,k){if(1&E&&(n.j41(0,"div",4),n.EFF(1),n.nI1(2,"translate"),n.k0s()),2&E){const T=n.XpG();n.R7$(),n.JRh(n.bMT(2,1,T.dsoType+".edit.metadata.metadatafield.invalid"))}}function e(E,k){if(1&E){const T=n.RV6();n.j41(0,"button",10,1),n.bIt("click",function(){const I=n.eBV(T).$implicit,$=n.XpG(2);return n.Njj($.select(I))}),n.nrm(2,"span",11),n.k0s()}if(2&E){const T=k.$implicit;n.R7$(2),n.Y8G("innerHTML",T,n.npT)}}function at(E,k){if(1&E&&(n.Z7z(0,e,3,1,"button",9,n.fX1),n.nI1(2,"async")),2&E){const T=n.XpG();n.Dyx(n.bMT(2,0,T.mdFieldOptions$))}}function z(E,k){1&E&&(n.j41(0,"button",8),n.nrm(1,"ds-loading",12),n.k0s()),2&E&&(n.R7$(),n.Y8G("showMessage",!1))}let Z=(()=>{class E{constructor(T,M,I){this.registryService=T,this.notificationsService=M,this.translate=I,this.autofocus=!1,this.mdFieldChange=new n.bkB,this.mdFieldOptions$=new x.t([]),this.input=new t.hs,this.query$=new x.t(null),this.debounceTime=300,this.selectedValueLoading=!1,this.showInvalid=!1,this.subs=[],this.currentPage$=new x.t(1),this.hasNextPage=!1,this.loading=!1,this.pageOptions={elementsPerPage:20,sort:new g.z("fieldName",g.U.ASC)}}ngOnInit(){this.subs.push(this.input.valueChanges.pipe((0,F.B)(this.debounceTime),(0,B.Z)("")).subscribe(T=>{this.currentPage$.next(1),this.selectedValueLoading||this.query$.next(T),this.mdField=T,this.mdFieldChange.emit(this.mdField)})),this.subs.push((0,v.z)(this.query$,this.currentPage$).pipe((0,h.n)(([T,M])=>(this.loading=!0,1===M&&this.mdFieldOptions$.next([]),this.search(T,M)))).subscribe(T=>{this.selectedValueLoading||this.updateList(T)}))}ngAfterViewInit(){this.autofocus&&this.mdFieldInput.nativeElement.focus()}validate(){return this.registryService.queryMetadataFields(this.mdField,Object.assign({},this.pageOptions,{currentPage:1}),!0,!1,(0,X.s)("schema")).pipe((0,R.qD)(),(0,h.n)(T=>T.hasSucceeded?(0,C.of)(T).pipe((0,R.LB)(),(0,r.s)(1),(0,l.T)(M=>M.indexOf(this.mdField)>-1),(0,p.M)(M=>this.showInvalid=!M)):(this.notificationsService.error(this.translate.instant(`${this.dsoType}.edit.metadata.metadatafield.error`),T.errorMessage),[!1])))}select(T){this.selectedValueLoading=!0,this.input.setValue(T)}onScrollDown(){this.hasNextPage&&!this.loading&&this.currentPage$.next(this.currentPage$.value+1)}updateList(T){this.loading=!1,this.hasNextPage=T.length>0;const M=this.mdFieldOptions$.getValue();this.mdFieldOptions$.next([...M,...T]),this.selectedValueLoading=!1}search(T,M,I=!0){return this.registryService.queryMetadataFields(T,Object.assign({},this.pageOptions,{currentPage:M}),I,!1,(0,X.s)("schema")).pipe((0,R.v7)(),(0,R.LB)())}ngOnDestroy(){this.subs.filter(T=>(0,V.a4)(T)).forEach(T=>T.unsubscribe())}static{this.\u0275fac=function(M){return new(M||E)(n.rXU(O.x),n.rXU(U.I),n.rXU(m.c$))}}static{this.\u0275cmp=n.VBU({type:E,selectors:[["ds-metadata-field-selector"]],viewQuery:function(M,I){if(1&M&&n.GBs(et,7),2&M){let $;n.mGM($=n.lsd())&&(I.mdFieldInput=$.first)}},inputs:{dsoType:"dsoType",mdField:"mdField",autofocus:"autofocus"},outputs:{mdFieldChange:"mdFieldChange"},standalone:!0,features:[n.aNF],decls:12,vars:22,consts:[["mdFieldInput",""],["listEntryElement",""],[1,"w-100","position-relative"],["type","text",1,"form-control",3,"focusin","dsClickOutside","click","keyup","ngClass","value","formControl"],[1,"invalid-feedback","show-feedback"],["id","scrollable-metadata-field-selector",1,"dropdown-menu","scrollable-menu",3,"ngClass"],[1,"dropdown-list"],["infiniteScroll","",3,"scrolled","infiniteScrollDistance","infiniteScrollThrottle","infiniteScrollContainer","fromRoot"],[1,"list-group-item","list-group-item-action","border-0","list-entry"],["dsHoverClass","ds-hover",1,"d-block","dropdown-item"],["dsHoverClass","ds-hover",1,"d-block","dropdown-item",3,"click"],[3,"innerHTML"],[3,"showMessage"]],template:function(M,I){if(1&M){const $=n.RV6();n.j41(0,"div",2)(1,"input",3,0),n.nI1(3,"translate"),n.bIt("focusin",function(){return n.eBV($),n.Njj(I.query$.next(I.mdField))})("dsClickOutside",function(){return n.eBV($),n.Njj(I.query$.next(null))})("click",function(nt){return n.eBV($),n.Njj(nt.stopPropagation())})("keyup",function(){return n.eBV($),n.Njj(I.selectedValueLoading=!1)}),n.k0s(),n.DNE(4,Y,3,3,"div",4),n.j41(5,"div",5),n.nI1(6,"async"),n.j41(7,"div",6)(8,"div",7),n.bIt("scrolled",function(){return n.eBV($),n.Njj(I.onScrollDown())}),n.DNE(9,at,3,2),n.nI1(10,"async"),n.DNE(11,z,2,1,"button",8),n.k0s()()()()}if(2&M){let $;n.R7$(),n.Y8G("ngClass",n.eq3(18,J,I.showInvalid))("value",I.mdField)("formControl",I.input),n.BMQ("aria-label",n.bMT(3,12,I.dsoType+".edit.metadata.metadatafield")),n.R7$(3),n.vxM(I.showInvalid?4:-1),n.R7$(),n.Y8G("ngClass",n.eq3(20,K,(null==($=n.bMT(6,14,I.mdFieldOptions$))?null:$.length)>0)),n.R7$(3),n.Y8G("infiniteScrollDistance",1)("infiniteScrollThrottle",0)("infiniteScrollContainer","#scrollable-metadata-field-selector")("fromRoot",!0),n.R7$(),n.vxM(n.bMT(10,16,I.mdFieldOptions$)?9:-1),n.R7$(2),n.vxM(I.loading?11:-1)}},dependencies:[D.Jj,tt.z,t.YN,t.me,t.BC,A.e,A.D,D.YU,t.X1,t.l_,u.v,m.h,m.D9],styles:[".scrollable-menu[_ngcontent-%COMP%]{height:auto;max-height:var(--ds-dso-selector-list-max-height);overflow:scroll}"]})}}return E})()},92307:(G,j,i)=>{"use strict";i.d(j,{Q:()=>v}),i(73685);var n=i(29710),m=(i(76148),i(54438));const A=["*"];function x(C,F){}let v=(()=>{class C extends n.J{constructor(){super(...arguments),this.inAndOutputNames=["dso","updateDataService"]}getComponentName(){return"DsoEditMetadataComponent"}importThemedComponent(B){return i(30207)(`./${B}/app/dso-shared/dso-edit-metadata/dso-edit-metadata.component`)}importUnthemedComponent(){return Promise.resolve().then(i.bind(i,76148))}static{this.\u0275fac=(()=>{let B;return function(r){return(B||(B=m.xGo(C)))(r||C)}})()}static{this.\u0275cmp=m.VBU({type:C,selectors:[["ds-dso-edit-metadata"]],inputs:{dso:"dso",updateDataService:"updateDataService"},standalone:!0,features:[m.Vt3,m.aNF],ngContentSelectors:A,decls:5,vars:0,consts:[["vcr",""],["content",""]],template:function(h,r){1&h&&(m.NAR(),m.DNE(0,x,0,0,"ng-template",null,0,m.C5r),m.j41(2,"div",null,1),m.SdG(4),m.k0s())},encapsulation:2})}}return C})()},30207:(G,j,i)=>{var D={"./custom/app/dso-shared/dso-edit-metadata/dso-edit-metadata.component":[89568,9568]};function n(t){if(!i.o(D,t))return Promise.resolve().then(()=>{var x=new Error("Cannot find module '"+t+"'");throw x.code="MODULE_NOT_FOUND",x});var m=D[t],A=m[0];return i.e(m[1]).then(()=>i(A))}n.keys=()=>Object.keys(D),n.id=30207,G.exports=n}}]);