"use strict";(self.webpackChunkdspace_angular=self.webpackChunkdspace_angular||[]).push([[9532],{13260:(B,T,a)=>{a.d(T,{f:()=>U});var C=a(21626),r=a(5964),u=a(96354),R=a(47677),d=a(89777),P=a(57775),f=a(7094),M=a(4093),O=a(88906),I=a(76456),h=a(54438);let v=(()=>{class E{parse(c,n){const l=n.payload,e=Object.assign(new O.cH,l);return new I.hT(n.statusCode,void 0,e)}static{this.\u0275fac=function(n){return new(n||E)}}static{this.\u0275prov=h.jDH({token:E,factory:E.\u0275fac,providedIn:"root"})}}return E})();var g=a(49755),A=a(3601);let U=(()=>{class E{constructor(c,n,l){this.requestService=c,this.rdbService=n,this.halService=l,this.linkPath="registrations",this.searchByTokenPath="/search/findByToken?token="}getRegistrationEndpoint(){return this.halService.getEndpoint(this.linkPath)}getTokenSearchEndpoint(c){return this.halService.getEndpoint(this.linkPath).pipe((0,r.p)(n=>(0,d.hj)(n)),(0,u.T)(n=>`${n}${this.searchByTokenPath}${c}`))}registerEmail(c,n=null,l){const e=new O.cH;e.email=c;const _=this.requestService.generateRequestId(),D=this.getRegistrationEndpoint(),F=Object.create({});let m=new C.Lr;return n&&(m=m.append("x-captcha-payload",n)),F.headers=m,(0,d.a4)(l)&&(F.params=l?new C.Nl({fromString:"accountRequestType="+l}):new C.Nl),D.pipe((0,R.I)(b=>(0,d.a4)(b)),(0,u.T)(b=>{const k=new g.Qf(_,b,e,F);this.requestService.send(k)})).subscribe(),this.rdbService.buildFromRequestUUID(_).pipe((0,M.qD)())}searchByTokenAndUpdateData(c){const n=this.requestService.generateRequestId(),l=this.getTokenSearchEndpoint(c).pipe((0,R.I)(e=>(0,d.a4)(e)));return l.subscribe(e=>{const _=new g.IP(n,e);Object.assign(_,{getResponseParser:()=>v}),this.requestService.send(_,!0)}),this.rdbService.buildSingle(l).pipe((0,u.T)(e=>e.hasSucceeded&&(0,d.a4)(e.payload)?Object.assign(e,{payload:Object.assign(new O.cH,{email:e.payload.email,token:c,user:e.payload.user})}):e))}searchByTokenAndHandleError(c){const n=this.requestService.generateRequestId(),l=this.getTokenSearchEndpoint(c).pipe((0,R.I)(e=>(0,d.a4)(e)));return l.subscribe(e=>{const _=new g.IP(n,e);Object.assign(_,{getResponseParser:()=>v}),this.requestService.send(_,!0)}),this.rdbService.buildSingle(l)}patchUpdateRegistration(c,n,l,e,_){const D=this.requestService.generateRequestId();return this.getRegistrationEndpoint().pipe((0,R.I)(m=>(0,d.a4)(m)),(0,u.T)(m=>`${m}/${l}?token=${e}`)).subscribe(m=>{const b=this.generateOperations(c,n,_),k=new g.EA(D,m,b);this.requestService.send(k)}),this.rdbService.buildFromRequestUUID(D)}generateOperations(c,n,l){let e=[];return c.length>0&&(0,d.a4)(n)&&(e=[{op:l,path:`/${n}`,value:c}]),e}static{this.\u0275fac=function(n){return new(n||E)(h.KVO(A.B),h.KVO(P.o),h.KVO(f.Y))}}static{this.\u0275prov=h.jDH({token:E,factory:E.\u0275fac,providedIn:"root"})}}return E})()},19532:(B,T,a)=>{a.r(T),a.d(T,{RegisterEmailFormComponent:()=>V,TYPE_REQUEST_FORGOT:()=>W,TYPE_REQUEST_REGISTER:()=>$});var C=a(60177),r=a(89417),u=a(68018),R=a(84412),d=a(84572),P=a(25558),f=a(7673),M=a(96354),O=a(96697),I=a(99172),h=a(94925),v=a(13260),g=a(44242),A=a(4093),U=a(64972),E=a(74082),j=a(79104),c=a(89777),n=a(80540),l=a(9847),e=a(54438),_=a(7901),D=a(67138),F=a(89564);const m=o=>({domains:o});function b(o,S){if(1&o&&(e.j41(0,"p"),e.EFF(1),e.nI1(2,"translate"),e.k0s()),2&o){const t=e.XpG();e.R7$(),e.Lme(" ",e.bMT(2,2,t.MESSAGE_PREFIX+".info.maildomain")," ",t.validMailDomains.join(", ")," ")}}function k(o,S){if(1&o&&(e.j41(0,"span",11),e.EFF(1),e.nI1(2,"translate"),e.k0s()),2&o){const t=e.XpG(2);e.R7$(),e.SpI(" ",e.bMT(2,1,t.MESSAGE_PREFIX+".email.error.required")," ")}}function y(o,S){if(1&o&&(e.EFF(0),e.nI1(1,"translate")),2&o){const t=e.XpG(3);e.SpI(" ",e.i5U(1,1,t.MESSAGE_PREFIX+".email.error.not-valid-domain",e.eq3(4,m,t.validMailDomains.join(", ")))," ")}}function G(o,S){if(1&o&&(e.j41(0,"span",12),e.EFF(1),e.nI1(2,"translate"),e.DNE(3,y,2,6),e.k0s()),2&o){const t=e.XpG(2);e.R7$(),e.SpI(" ",e.bMT(2,2,t.MESSAGE_PREFIX+".email.error.not-email-form")," "),e.R7$(2),e.vxM(t.validMailDomains.length>0?3:-1)}}function x(o,S){if(1&o&&(e.j41(0,"div",7),e.DNE(1,k,3,3,"span",11)(2,G,4,4,"span",12),e.k0s()),2&o){const t=e.XpG();e.R7$(),e.vxM(t.email.errors&&t.email.errors.required?1:-1),e.R7$(),e.vxM(t.email.errors&&(t.email.errors.pattern&&t.typeRequest===t.TYPE_REQUEST_REGISTER||t.email.errors.email)?2:-1)}}function X(o,S){if(1&o){const t=e.RV6();e.j41(0,"ds-alert",8),e.nrm(1,"p",13),e.nI1(2,"translate"),e.j41(3,"p",14)(4,"a",15),e.bIt("click",function(){e.eBV(t);const i=e.XpG();return e.Njj(i.orejimeService.showSettings())}),e.EFF(5),e.nI1(6,"translate"),e.k0s()()()}if(2&o){const t=e.XpG();e.Y8G("type",t.AlertTypeEnum.Warning),e.R7$(),e.Y8G("innerHTML",e.bMT(2,3,t.MESSAGE_PREFIX+".google-recaptcha.must-accept-cookies"),e.npT),e.R7$(4),e.JRh(e.bMT(6,5,t.MESSAGE_PREFIX+".google-recaptcha.open-cookie-settings"))}}function N(o,S){if(1&o){const t=e.RV6();e.j41(0,"div",9)(1,"ds-google-recaptcha",16),e.nI1(2,"async"),e.bIt("executeRecaptcha",function(i){e.eBV(t);const p=e.XpG();return e.Njj(p.register(i))})("checkboxChecked",function(i){e.eBV(t);const p=e.XpG();return e.Njj(p.onCheckboxChecked(i))})("showNotification",function(i){e.eBV(t);const p=e.XpG();return e.Njj(p.showNotification(i))}),e.k0s()()}if(2&o){const t=e.XpG();e.R7$(),e.Y8G("captchaMode",e.bMT(2,1,t.captchaMode$))}}function K(o,S){if(1&o){const t=e.RV6();e.j41(0,"button",17),e.bIt("click",function(){e.eBV(t);const i=e.XpG();return e.Njj(i.register())}),e.EFF(1),e.nI1(2,"translate"),e.k0s()}if(2&o){const t=e.XpG();e.Y8G("dsBtnDisabled",t.form.invalid||t.registrationVerification&&!t.isRecaptchaCookieAccepted()||t.disableUntilChecked),e.R7$(),e.SpI(" ",e.bMT(2,2,t.MESSAGE_PREFIX+".submit")," ")}}function L(o,S){if(1&o){const t=e.RV6();e.j41(0,"button",17),e.bIt("click",function(){e.eBV(t);const i=e.XpG();return e.Njj(i.executeRecaptcha())}),e.EFF(1),e.nI1(2,"translate"),e.k0s()}if(2&o){const t=e.XpG();e.Y8G("dsBtnDisabled",t.form.invalid),e.R7$(),e.SpI(" ",e.bMT(2,2,t.MESSAGE_PREFIX+".submit")," ")}}const W="forgot",$="register";let V=(()=>{class o{constructor(t,s,i,p,w,Y,z,H,Q,Z,J){this.epersonRegistrationService=t,this.notificationService=s,this.translateService=i,this.router=p,this.formBuilder=w,this.configService=Y,this.googleRecaptchaService=z,this.cookieService=H,this.orejimeService=Q,this.changeDetectorRef=Z,this.notificationsService=J,this.typeRequest=null,this.AlertTypeEnum=E.v,this.registrationVerification=!1,this.checkboxCheckedSubject$=new R.t(!1),this.disableUntilChecked=!0,this.TYPE_REQUEST_REGISTER=$,this.subscriptions=[]}ngOnDestroy(){this.subscriptions.forEach(t=>t.unsubscribe())}ngOnInit(){this.captchaVersion$=this.googleRecaptchaService.captchaVersion(),this.captchaMode$=this.googleRecaptchaService.captchaMode();const t=[r.k0.required,r.k0.email,r.k0.pattern("^[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$")];this.form=this.formBuilder.group({email:new r.hs("",{validators:t})}),this.validMailDomains=[],this.typeRequest===$&&this.subscriptions.push(this.configService.findByPropertyName("authentication-password.domain.valid").pipe((0,A.Hz)()).subscribe(s=>{this.validMailDomains=s.values;for(const i of s.values)0!==this.validMailDomains.length&&(this.form.get("email").setValidators([...t,r.k0.pattern(this.validMailDomains.map(p=>"(^.*"+p.replace(new RegExp("\\.","g"),"\\.")+"$)").join("|"))]),this.form.updateValueAndValidity());this.changeDetectorRef.detectChanges()})),this.subscriptions.push(this.configService.findByPropertyName("registration.verification.enabled").pipe((0,A.ak)(),(0,M.T)(s=>"true"===s?.values[0].toLowerCase())).subscribe(s=>{this.registrationVerification=s})),this.subscriptions.push(this.disableUntilCheckedFcn().subscribe(s=>{this.disableUntilChecked=s,this.changeDetectorRef.detectChanges()}))}executeRecaptcha(){this.googleRecaptchaService.executeRecaptcha()}register(t){this.form.invalid||(this.registrationVerification?this.subscriptions.push((0,d.z)([this.captchaVersion$,this.captchaMode$]).pipe((0,P.n)(([s,i])=>"v3"===s?this.googleRecaptchaService.getRecaptchaToken("register_email"):"v2"===s&&"checkbox"===i?(0,f.of)(this.googleRecaptchaService.getRecaptchaTokenResponse()):"v2"===s&&"invisible"===i?(0,f.of)(t):(console.error(`Invalid reCaptcha configuration: version = ${s}, mode = ${i}`),void this.showNotification("error"))),(0,O.s)(1)).subscribe(s=>{(0,c.hj)(s)?this.registration(s):(console.error("reCaptcha error"),this.showNotification("error"))})):this.registration())}registration(t=null){const s=this.epersonRegistrationService.registerEmail(this.email.value,t||null,this.typeRequest);this.subscriptions.push(s.subscribe(i=>{i.hasSucceeded?(this.notificationService.success(this.translateService.get(`${this.MESSAGE_PREFIX}.success.head`),this.translateService.get(`${this.MESSAGE_PREFIX}.success.content`,{email:this.email.value})),this.router.navigate(["/home"])):this.notificationService.error(this.translateService.get(`${this.MESSAGE_PREFIX}.error.head`),422===i.statusCode?this.translateService.get(`${this.MESSAGE_PREFIX}.error.maildomain`,{domains:this.validMailDomains.join(", ")}):this.translateService.get(`${this.MESSAGE_PREFIX}.error.content`,{email:this.email.value}))}))}isRecaptchaCookieAccepted(){const t=this.cookieService.get("orejime-anonymous");return!!(0,c.hj)(t)&&t[g.BA]}disableUntilCheckedFcn(){const t=this.checkboxCheckedSubject$.asObservable();return(0,d.z)([this.captchaVersion$,this.captchaMode$,t]).pipe((0,P.n)(([s,i,p])=>(0,f.of)("v2"===s&&"checkbox"===i&&!p)),(0,I.Z)(!0))}get email(){return this.form.get("email")}onCheckboxChecked(t){this.checkboxCheckedSubject$.next(t)}showNotification(t){const s=this.translateService.get(this.MESSAGE_PREFIX+".google-recaptcha.notification.title"),i=this.translateService.get(this.MESSAGE_PREFIX+".google-recaptcha.notification.message.error"),p=this.translateService.get(this.MESSAGE_PREFIX+".google-recaptcha.notification.message.expired");switch(t){case"expired":this.notificationsService.warning(s,p);break;case"error":this.notificationsService.error(s,i);break;default:console.warn(`Unimplemented notification '${t}' from reCaptcha service`)}}static{this.\u0275fac=function(s){return new(s||o)(e.rXU(v.f),e.rXU(l.I),e.rXU(u.c$),e.rXU(_.Ix),e.rXU(r.ze),e.rXU(h.ConfigurationDataService),e.rXU(g.wq),e.rXU(D.O),e.rXU(F.B,8),e.rXU(e.gRc),e.rXU(l.I))}}static{this.\u0275cmp=e.VBU({type:o,selectors:[["ds-base-register-email-form"]],inputs:{MESSAGE_PREFIX:"MESSAGE_PREFIX",typeRequest:"typeRequest"},standalone:!0,features:[e.aNF],decls:28,vars:32,consts:[[1,"container"],[3,"formGroup"],[1,"mb-3"],[1,"row"],[1,"col-12"],["for","email",1,"fw-bold","form-label"],["type","text","id","email","formControlName","email",3,"className"],[1,"invalid-feedback","show-feedback"],[3,"type"],[1,"my-3"],[1,"btn","btn-primary",3,"dsBtnDisabled"],["id","email-errors-required"],["id","email-error-not-valid"],[1,"m-0",3,"innerHTML"],[1,"m-0"],["href","javascript:void(0);",3,"click"],[3,"executeRecaptcha","checkboxChecked","showNotification","captchaMode"],[1,"btn","btn-primary",3,"click","dsBtnDisabled"]],template:function(s,i){1&s&&(e.j41(0,"div",0)(1,"h1"),e.EFF(2),e.nI1(3,"translate"),e.k0s(),e.j41(4,"p"),e.EFF(5),e.nI1(6,"translate"),e.k0s(),e.DNE(7,b,3,4,"p"),e.j41(8,"form",1)(9,"div",2)(10,"div",3)(11,"div",4)(12,"label",5),e.EFF(13),e.nI1(14,"translate"),e.k0s(),e.nrm(15,"input",6),e.nI1(16,"translate"),e.DNE(17,x,3,2,"div",7),e.k0s(),e.j41(18,"div",4),e.EFF(19),e.nI1(20,"translate"),e.k0s()()(),e.DNE(21,X,7,7,"ds-alert",8)(22,N,3,3,"div",9),e.nI1(23,"async"),e.DNE(24,K,3,4,"button",10),e.nI1(25,"async"),e.nI1(26,"async"),e.DNE(27,L,3,4,"button",10),e.k0s()()),2&s&&(e.R7$(2),e.JRh(e.bMT(3,16,i.MESSAGE_PREFIX+".header")),e.R7$(3),e.JRh(e.bMT(6,18,i.MESSAGE_PREFIX+".info")),e.R7$(2),e.vxM(0!==i.validMailDomains.length&&i.typeRequest===i.TYPE_REQUEST_REGISTER?7:-1),e.R7$(),e.HbH("ng-invalid"),e.Y8G("formGroup",i.form),e.R7$(5),e.JRh(e.bMT(14,20,i.MESSAGE_PREFIX+".email")),e.R7$(2),e.Y8G("className",i.email.invalid&&(i.email.dirty||i.email.touched)?"form-control is-invalid":"form-control"),e.BMQ("aria-label",e.bMT(16,22,i.MESSAGE_PREFIX+".aria.label"))("aria-describedby",i.email.errors?i.email.errors.required?"email-errors-required":"email-error-not-valid":"")("aria-invalid",i.email.invalid),e.R7$(2),e.vxM(i.email.invalid&&(i.email.dirty||i.email.touched)?17:-1),e.R7$(2),e.SpI(" ",e.bMT(20,24,i.MESSAGE_PREFIX+".email.hint")," "),e.R7$(2),e.vxM(i.registrationVerification&&!i.isRecaptchaCookieAccepted()?21:-1),e.R7$(),e.vxM(i.isRecaptchaCookieAccepted()&&"v2"===e.bMT(23,26,i.captchaVersion$)?22:-1),e.R7$(2),e.vxM(!i.registrationVerification||"v2"!==e.bMT(25,28,i.captchaVersion$)&&"invisible"===e.bMT(26,30,i.captchaMode$)?24:27))},dependencies:[U.C,C.Jj,j.A,r.YN,r.qT,r.me,r.BC,r.cb,n.U,r.X1,r.j4,r.JD,u.h,u.D9],encapsulation:2})}}return o})()},80540:(B,T,a)=>{a.d(T,{U:()=>f});var C=a(60177),r=a(54438),u=a(19252),R=a(94925),d=a(4093),P=a(89777);let f=(()=>{class M{constructor(I,h){this._window=I,this.configService=h,this.executeRecaptcha=new r.bkB,this.checkboxChecked=new r.bkB,this.showNotification=new r.bkB,this.dataCallbackFcn=v=>{switch(this.captchaMode){case"invisible":this.executeRecaptcha.emit(v);break;case"checkbox":this.checkboxChecked.emit((0,P.hj)(v));break;default:console.error(`Invalid reCaptcha mode '${this.captchaMode}`),this.showNotification.emit("error")}},this.expiredCallbackFcn=()=>{this.checkboxChecked.emit(!1),this.showNotification.emit("expired")},this.errorCallbackFcn=()=>{this.showNotification.emit("error")}}ngOnInit(){this.recaptchaKey$=this.configService.findByPropertyName("google.recaptcha.key.site").pipe((0,d.ak)()),this._window.nativeWindow.dataCallback=this.dataCallbackFcn,this._window.nativeWindow.expiredCallback=this.expiredCallbackFcn,this._window.nativeWindow.errorCallback=this.errorCallbackFcn}static{this.\u0275fac=function(h){return new(h||M)(r.rXU(u.lc),r.rXU(R.ConfigurationDataService))}}static{this.\u0275cmp=r.VBU({type:M,selectors:[["ds-google-recaptcha"]],inputs:{captchaMode:"captchaMode"},outputs:{executeRecaptcha:"executeRecaptcha",checkboxChecked:"checkboxChecked",showNotification:"showNotification"},standalone:!0,features:[r.aNF],decls:2,vars:7,consts:[[1,"g-recaptcha"]],template:function(h,v){if(1&h&&(r.nrm(0,"div",0),r.nI1(1,"async")),2&h){let g;r.BMQ("data-callback","dataCallback")("data-expired-callback","expiredCallback")("data-error-callback","errorCallback")("data-sitekey",null==(g=r.bMT(1,5,v.recaptchaKey$))?null:g.values[0])("data-size","invisible"===v.captchaMode?"invisible":null)}},dependencies:[C.Jj]})}}return M})()}}]);