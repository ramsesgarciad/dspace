(self.webpackChunkdspace_angular=self.webpackChunkdspace_angular||[]).push([[2306,9545,1271,9938,6106,3017,9832,2384],{59072:(z,R,n)=>{"use strict";n.d(R,{S:()=>g});var C=n(54438),t=n(89777),p=n(54034),h=n(7673),c=n(80495);let I=(()=>{class u{getBreadcrumbs(a,_){return(0,h.of)([new c.Q(a+".breadcrumbs",_)])}static{this.\u0275fac=function(_){return new(_||u)}}static{this.\u0275prov=C.jDH({token:u,factory:u.\u0275fac,providedIn:"root"})}}return u})();const g=(u,y,a=(0,C.WQX)(I))=>{const _=u.data.breadcrumbKey;if((0,t.Tn)(_))throw new Error('You provided an i18nBreadcrumbResolver for url "'+u.url+"\" but no breadcrumbKey in the route's data");return{provider:a,key:_,url:(0,p.F)(u)}}},84963:(z,R,n)=>{"use strict";n.d(R,{O:()=>h});var C=n(96354),t=n(20881),p=n(4093);class h extends t.W{findByHref(S,I=!0,g=!0,...u){return super.findByHref(S,I,g,...u).pipe((0,p.qD)(),(0,C.T)(y=>{if(y.hasFailed)throw new Error("Couldn't retrieve the config");return y}))}findByName(S,I=!0,g=!0,...u){return super.findById(S,I,g,...u)}}},61271:(z,R,n)=>{"use strict";n.r(R),n.d(R,{SubmissionAccessesConfigDataService:()=>I});var C=n(57775),t=n(81948),p=n(3601),h=n(7094),c=n(84963),S=n(54438);let I=(()=>{class g extends c.O{constructor(y,a,_,d){super("submissionaccessoptions",y,a,_,d),this.requestService=y,this.rdbService=a,this.objectCache=_,this.halService=d}findByHref(y,a=!0,_=!0,...d){return super.findByHref(y,a,_,...d)}static{this.\u0275fac=function(a){return new(a||g)(S.KVO(p.B),S.KVO(C.o),S.KVO(t.$),S.KVO(h.Y))}}static{this.\u0275prov=S.jDH({token:g,factory:g.\u0275fac,providedIn:"root"})}}return g})()},12384:(z,R,n)=>{"use strict";n.r(R),n.d(R,{SubmissionFormsConfigDataService:()=>I});var C=n(57775),t=n(81948),p=n(3601),h=n(7094),c=n(84963),S=n(54438);let I=(()=>{class g extends c.O{constructor(y,a,_,d){super("submissionforms",y,a,_,d),this.requestService=y,this.rdbService=a,this.objectCache=_,this.halService=d}findByHref(y,a=!0,_=!0,...d){return super.findByHref(y,a,_,...d)}static{this.\u0275fac=function(a){return new(a||g)(S.KVO(p.B),S.KVO(C.o),S.KVO(t.$),S.KVO(h.Y))}}static{this.\u0275prov=S.jDH({token:g,factory:g.\u0275fac,providedIn:"root"})}}return g})()},99545:(z,R,n)=>{"use strict";n.r(R),n.d(R,{SubmissionUploadsConfigDataService:()=>I});var C=n(57775),t=n(81948),p=n(3601),h=n(7094),c=n(84963),S=n(54438);let I=(()=>{class g extends c.O{constructor(y,a,_,d){super("submissionuploads",y,a,_,d),this.requestService=y,this.rdbService=a,this.objectCache=_,this.halService=d}findByHref(y,a=!0,_=!0,...d){return super.findByHref(y,a,_,...d)}static{this.\u0275fac=function(a){return new(a||g)(S.KVO(p.B),S.KVO(C.o),S.KVO(t.$),S.KVO(h.Y))}}static{this.\u0275prov=S.jDH({token:g,factory:g.\u0275fac,providedIn:"root"})}}return g})()},39592:(z,R,n)=>{"use strict";n.d(R,{C:()=>u});var C=n(50813),t=n(89777),p=n(72887),h=n(95720),c=n(13627),S=n(46755),I=n(54438),g=n(59640);let u=(()=>{class y{constructor(_){this.store=_}add(_,d,f=!1,D=!1){this.store.dispatch(new S.X2(_.rootElement,_.subRootElement,_.path,this.prepareValue(d,D,f)))}replace(_,d,f=!1){(0,t.Tn)(d)||"object"==typeof d&&(0,t.Tn)(d.value)?this.remove(_):this.store.dispatch(new S.kM(_.rootElement,_.subRootElement,_.path,this.prepareValue(d,f,!1)))}move(_,d){this.store.dispatch(new S.td(_.rootElement,_.subRootElement,d,_.path))}remove(_){this.store.dispatch(new S.QZ(_.rootElement,_.subRootElement,_.path))}flushOperation(_){this.store.dispatch(new S.qy(_.rootElement,_.subRootElement,_.path))}prepareValue(_,d,f){let D=null;return(0,t.a4)(_)&&(d?D=_:Array.isArray(_)?(D=[],_.forEach(P=>{D.push("object"==typeof P?this.prepareObjectValue(P):new h.e(P))})):D="object"==typeof _?this.prepareObjectValue(_):new h.e(_)),f&&!Array.isArray(D)?[D]:D}prepareObjectValue(_){let d=Object.create({});return(0,t.Im)(_)||_ instanceof h.e?d=_:_ instanceof Date?d=new h.e((0,C.Sd)(_)):_ instanceof c.b?d=this.prepareAuthorityValue(_):_ instanceof p.r?d=new h.e(_.value,_.language):_.hasOwnProperty("authority")?d=new h.e(_.value,_.language,_.authority):(0,C.z5)(_)?d=new h.e((0,C.$T)(_)):_.hasOwnProperty("value")?d=new h.e(_.value):Object.keys(_).forEach(f=>{d[f]="object"==typeof _[f]?this.prepareObjectValue(_[f]):_[f]}),d}prepareAuthorityValue(_){let d;return d=(0,t.hj)(_.authority)?new h.e(_.value,_.language,_.authority):new h.e(_.value,_.language),d}static{this.\u0275fac=function(d){return new(d||y)(I.KVO(g.il))}}static{this.\u0275prov=I.jDH({token:y,factory:y.\u0275fac,providedIn:"root"})}}return y})()},33017:(z,R,n)=>{"use strict";n.r(R),n.d(R,{ResourcePolicyDataService:()=>L});var C=n(21626),t=n(96354),p=n(61594),h=n(89777),c=n(9847),S=n(57775),I=n(10186),g=n(81948),u=n(18328),y=n(72073),a=n(20881),_=n(4318),d=n(60796),f=n(96443),D=n(36343),P=n(49755),j=n(3601),k=n(74642),O=n(13817),U=n(2086),v=n(7094),F=n(4093),B=n(54438);let L=(()=>{class T extends a.W{constructor(W,K,tt,N,J,Q,nt,Z){super("resourcepolicies",W,K,tt,N),this.requestService=W,this.rdbService=K,this.objectCache=tt,this.halService=N,this.notificationsService=J,this.comparator=Q,this.ePersonService=nt,this.groupService=Z,this.searchByEPersonMethod="eperson",this.searchByGroupMethod="group",this.searchByResourceMethod="resource",this.createData=new u.V(this.linkPath,W,K,tt,N,J,this.responseMsToLive),this.searchData=new d.X(this.linkPath,W,K,tt,N,this.responseMsToLive),this.patchData=new _.n(this.linkPath,W,K,tt,N,Q,this.responseMsToLive,this.constructIdEndpoint),this.deleteData=new y.I(this.linkPath,W,K,tt,N,J,this.responseMsToLive,this.constructIdEndpoint)}create(W,K,tt,N){const J=[];return J.push(new I.x("resource",K)),(0,h.hj)(tt)?J.push(new I.x("eperson",tt)):(0,h.hj)(N)&&J.push(new I.x("group",N)),this.createData.create(W,...J)}delete(W){return this.deleteData.delete(W).pipe((0,F.qD)(),(0,t.T)(K=>K.hasSucceeded))}update(W){return this.patchData.update(W)}getDefaultAccessConditionsFor(W,K){return this.findListByHref(W._links.defaultAccessConditions.href,K)}searchByEPerson(W,K,tt=!0,N=!0,...J){const Q=new D._;return Q.searchParams=[new I.x("uuid",W)],(0,h.hj)(K)&&Q.searchParams.push(new I.x("resource",K)),this.searchData.searchBy(this.searchByEPersonMethod,Q,tt,N,...J)}searchByGroup(W,K,tt=!0,N=!0,...J){const Q=new D._;return Q.searchParams=[new I.x("uuid",W)],(0,h.hj)(K)&&Q.searchParams.push(new I.x("resource",K)),this.searchData.searchBy(this.searchByGroupMethod,Q,tt,N,...J)}searchByResource(W,K,tt=!0,N=!0,...J){const Q=new D._;return Q.searchParams=[new I.x("uuid",W)],(0,h.hj)(K)&&Q.searchParams.push(new I.x("action",K)),this.searchData.searchBy(this.searchByResourceMethod,Q,tt,N,...J)}updateTarget(W,K,tt,N){const Q=("eperson"===N?this.ePersonService:this.groupService).getIDHrefObs(tt),nt=Object.create({});let Z=new C.Lr;Z=Z.append("Content-Type","text/uri-list"),nt.headers=Z;const rt=this.requestService.generateRequestId();return Q.pipe((0,p.$)()).subscribe(A=>{const lt=new P.v_(rt,K+"/"+N,A,nt);Object.assign(lt,{getResponseParser:()=>k.M}),this.requestService.send(lt)}),this.rdbService.buildFromRequestUUIDAndAwait(rt,()=>this.invalidateByHref(K))}static{this.\u0275fac=function(K){return new(K||T)(B.KVO(j.B),B.KVO(S.o),B.KVO(g.$),B.KVO(v.Y),B.KVO(c.I),B.KVO(f.Y),B.KVO(O.EPersonDataService),B.KVO(U.GroupDataService))}}static{this.\u0275prov=B.jDH({token:T,factory:T.\u0275fac,providedIn:"root"})}}return T})()},1818:(z,R,n)=>{"use strict";n.d(R,{S:()=>h});var C=n(25558),t=n(4093),p=n(41570);const h=(c,S,I)=>I.findById(c.params.id,!0,!1,...p.X).pipe((0,t.qD)(),(0,C.n)(g=>g.payload.item),(0,t.qD)())},29901:(z,R,n)=>{"use strict";n.d(R,{q:()=>h});var C=n(96354),t=n(4093),p=n(41570);class h{constructor(S,I){this.dataService=S,this.breadcrumbService=I}resolve(S,I){return this.dataService.findById(S.params.id,!0,!1,...p.X).pipe((0,t.qD)(),(0,t.Bo)(),(0,C.T)(g=>({provider:this.breadcrumbService,key:g})))}}},6106:(z,R,n)=>{"use strict";n.r(R),n.d(R,{SubmissionCcLicenseDataService:()=>g});var C=n(57775),t=n(81948),p=n(90066),h=n(88667),c=n(3601),S=n(7094),I=n(54438);let g=(()=>{class u extends p.L{constructor(a,_,d,f){super("submissioncclicenses",a,_,d,f),this.requestService=a,this.rdbService=_,this.objectCache=d,this.halService=f,this.linkPath="submissioncclicenses",this.findAllData=new h.H(this.linkPath,a,_,d,f,this.responseMsToLive)}findAll(a,_,d,...f){return this.findAllData.findAll(a,_,d,...f)}static{this.\u0275fac=function(_){return new(_||u)(I.KVO(c.B),I.KVO(C.o),I.KVO(t.$),I.KVO(S.Y))}}static{this.\u0275prov=I.jDH({token:u,factory:u.\u0275fac,providedIn:"root"})}}return u})()},9938:(z,R,n)=>{"use strict";n.r(R),n.d(R,{SubmissionCcLicenseUrlDataService:()=>_});var C=n(25558),t=n(96354),p=n(57775),h=n(10186),c=n(81948),S=n(90066),I=n(60796),g=n(3601),u=n(7094),y=n(4093),a=n(54438);let _=(()=>{class d extends S.L{constructor(D,P,j,k){super("submissioncclicenseUrls-search",D,P,j,k),this.requestService=D,this.rdbService=P,this.objectCache=j,this.halService=k,this.searchData=new I.X(this.linkPath,D,P,j,k,this.responseMsToLive,(O,U)=>`${O}/${U}`)}getCcLicenseLink(D,P){return this.searchData.getSearchByHref("rightsByQuestions",{searchParams:[new h.x("license",D.id),...D.fields.map(j=>new h.x(`answer_${j.id}`,P.get(j).id))]}).pipe((0,C.n)(j=>this.findByHref(j)),(0,y.yd)(),(0,y.Bo)(),(0,t.T)(j=>j.url))}searchBy(D,P,j,k,...O){return this.searchData.searchBy(D,P,j,k,...O)}static{this.\u0275fac=function(P){return new(P||d)(a.KVO(g.B),a.KVO(p.o),a.KVO(c.$),a.KVO(u.Y))}}static{this.\u0275prov=a.jDH({token:d,factory:d.\u0275fac,providedIn:"root"})}}return d})()},26143:(z,R,n)=>{"use strict";n.d(R,{i:()=>_});var C=n(7673),t=n(84572),p=n(25558),h=n(15343),c=n(89777),S=n(30250),I=n(46541),g=n(43446),u=n(69295),y=n(4093),a=n(54438);let _=(()=>{class d{constructor(D,P,j,k){this.dsoNameService=D,this.dsoBreadcrumbsService=P,this.submissionService=j,this.collectionService=k}getBreadcrumbs(D){return(0,c.Im)(D)?(0,C.of)([]):(0,t.z)([D.collection.pipe((0,y.qD)(),(0,y.Bo)()),this.submissionService.getSubmissionCollectionId(D.id)]).pipe((0,p.n)(([P,j])=>(0,c.a4)(j)?this.collectionService.findById(j).pipe((0,y.qD)(),(0,y.Bo)()):(0,C.of)(P)),(0,p.n)(P=>this.dsoBreadcrumbsService.getBreadcrumbs(P,(0,h.wN)(P))))}static{this.\u0275fac=function(P){return new(P||d)(a.KVO(g.f),a.KVO(I.U),a.KVO(S.E),a.KVO(u.CollectionDataService))}}static{this.\u0275prov=a.jDH({token:d,factory:d.\u0275fac,providedIn:"root"})}}return d})()},72887:(z,R,n)=>{"use strict";n.d(R,{r:()=>C});class C{constructor(p,h){this.value=p,this.language=h}}},62186:(z,R,n)=>{"use strict";n.r(R),n.d(R,{SubmissionEditComponent:()=>P});var C=n(84412),t=n(25558),p=n(5964),h=n(70152),c=n(61206),S=n(4093),I=n(28690),g=n(89777),u=n(9847),y=n(3110),a=n(30250),_=n(676),d=n(54438),f=n(7901),D=n(68018);let P=(()=>{class j{constructor(O,U,v,F,B,L,T,b){this.changeDetectorRef=O,this.notificationsService=U,this.route=v,this.router=F,this.itemDataService=B,this.submissionService=L,this.translate=T,this.submissionJsonPatchOperationsService=b,this.collectionModifiable=null,this.subs=[],this.itemLink$=new C.t(void 0)}ngOnInit(){this.collectionModifiable=this.route.snapshot.data?.collectionModifiable??null,this.subs.push(this.route.paramMap.pipe((0,t.n)(O=>this.submissionService.retrieveSubmission(O.get("id"))),(0,p.p)(O=>(0,g.Pe)(O))).subscribe(O=>{if(O.hasSucceeded)if((0,g.Im)(O.payload))this.notificationsService.info(null,this.translate.get("submission.general.cannot_submit")),this.router.navigate(["/mydspace"]);else{const{errors:U}=O.payload;this.submissionErrors=(0,_.A)(U),this.submissionId=O.payload.id.toString(),this.collectionId=O.payload.collection.id,this.selfUrl=O.payload._links.self.href,this.sections=O.payload.sections,this.itemLink$.next(O.payload._links.item.href),this.item=O.payload.item,this.submissionDefinition=O.payload.submissionDefinition}else 404===O.statusCode&&this.router.navigate(["/404"],{skipLocationChange:!0})}),this.itemLink$.pipe((0,g.VT)(),(0,t.n)(O=>this.itemDataService.findByHref(O)),(0,S.v7)(),(0,h.B)(300)).subscribe(O=>{this.item=O.payload,this.changeDetectorRef.detectChanges()}))}ngOnDestroy(){this.subs.filter(O=>(0,g.a4)(O)).forEach(O=>O.unsubscribe()),this.submissionJsonPatchOperationsService.deletePendingJsonPatchOperations()}static{this.\u0275fac=function(U){return new(U||j)(d.rXU(d.gRc),d.rXU(u.I),d.rXU(f.nX),d.rXU(f.Ix),d.rXU(c.ItemDataService),d.rXU(a.E),d.rXU(D.c$),d.rXU(I.U))}}static{this.\u0275cmp=d.VBU({type:j,selectors:[["ds-base-submission-edit"]],standalone:!0,features:[d.aNF],decls:2,vars:8,consts:[[1,"submission-submit-container"],[3,"collectionId","sections","selfUrl","submissionDefinition","submissionErrors","item","collectionModifiable","submissionId"]],template:function(U,v){1&U&&(d.j41(0,"div",0),d.nrm(1,"ds-submission-form",1),d.k0s()),2&U&&(d.R7$(),d.Y8G("collectionId",v.collectionId)("sections",v.sections)("selfUrl",v.selfUrl)("submissionDefinition",v.submissionDefinition)("submissionErrors",v.submissionErrors)("item",v.item)("collectionModifiable",v.collectionModifiable)("submissionId",v.submissionId))},dependencies:[y.p]})}}return j})()},50526:(z,R,n)=>{"use strict";n.d(R,{r:()=>S});var C=n(29710),p=(n(62186),n(54438));const h=["*"];function c(I,g){}let S=(()=>{class I extends C.J{getComponentName(){return"SubmissionEditComponent"}importThemedComponent(u){return n(9048)(`./${u}/app/submission/edit/submission-edit.component`)}importUnthemedComponent(){return Promise.resolve().then(n.bind(n,62186))}static{this.\u0275fac=(()=>{let u;return function(a){return(u||(u=p.xGo(I)))(a||I)}})()}static{this.\u0275cmp=p.VBU({type:I,selectors:[["ds-submission-edit"]],standalone:!0,features:[p.Vt3,p.aNF],ngContentSelectors:h,decls:5,vars:0,consts:[["vcr",""],["content",""]],template:function(y,a){1&y&&(p.NAR(),p.DNE(0,c,0,0,"ng-template",null,0,p.C5r),p.j41(2,"div",null,1),p.SdG(4),p.k0s())},encapsulation:2})}}return I})()},71758:(z,R,n)=>{"use strict";n.d(R,{Q:()=>W});var C=n(60177),t=n(54438),p=n(58003),h=n(68018),c=n(84412),S=n(7673),I=n(47677),g=n(96354),u=n(73028),y=n(43446),a=n(69295),_=n(33553),d=n(39592),f=n(4093),D=n(28690),P=n(79104),j=n(69620),k=n(5598),O=n(89777),U=n(12443),v=n(67707),F=n(30250);function B(K,tt){if(1&K&&(t.j41(0,"div",1)(1,"span",3),t.EFF(2),t.nI1(3,"translate"),t.k0s(),t.j41(4,"span",3),t.EFF(5),t.nI1(6,"async"),t.k0s()()),2&K){const N=t.XpG();t.R7$(2),t.JRh(t.bMT(3,2,"submission.sections.general.collection")),t.R7$(3),t.JRh(t.bMT(6,4,N.selectedCollectionName$))}}function L(K,tt){1&K&&(t.j41(0,"span"),t.nrm(1,"i",9),t.k0s())}function T(K,tt){if(1&K&&(t.j41(0,"span"),t.EFF(1),t.nI1(2,"async"),t.k0s()),2&K){const N=t.XpG(2);t.R7$(),t.JRh(t.bMT(2,1,N.selectedCollectionName$))}}function b(K,tt){if(1&K){const N=t.RV6();t.j41(0,"div",4,0),t.bIt("openChange",function(Q){t.eBV(N);const nt=t.XpG();return t.Njj(nt.toggled(Q))}),t.j41(2,"span",5),t.EFF(3),t.nI1(4,"translate"),t.k0s(),t.j41(5,"button",6),t.nI1(6,"async"),t.bIt("blur",function(){t.eBV(N);const Q=t.XpG();return t.Njj(Q.onClose())})("click",function(){t.eBV(N);const Q=t.XpG();return t.Njj(Q.onClose())}),t.DNE(7,L,2,0,"span"),t.nI1(8,"async"),t.DNE(9,T,3,3,"span"),t.nI1(10,"async"),t.k0s(),t.j41(11,"div",7)(12,"ds-collection-dropdown",8),t.bIt("selectionChange",function(Q){t.eBV(N);const nt=t.XpG();return t.Njj(nt.onSelect(Q))}),t.k0s()()()}if(2&K){const N=t.XpG();t.R7$(3),t.SpI(" ",t.bMT(4,4,"submission.sections.general.collection")," "),t.R7$(2),t.Y8G("dsBtnDisabled",t.bMT(6,6,N.processingChange$)||!1===N.collectionModifiable||N.isReadonly),t.R7$(2),t.vxM(t.bMT(8,8,N.processingChange$)?7:-1),t.R7$(2),t.vxM(!0!==t.bMT(10,10,N.processingChange$)?9:-1)}}let W=(()=>{class K{constructor(N,J,Q,nt,Z,rt,A){this.cdr=N,this.collectionDataService=J,this.operationsBuilder=Q,this.operationsService=nt,this.submissionService=Z,this.sectionsService=rt,this.dsoNameService=A,this.collectionModifiable=null,this.isReadonly=!1,this.collectionChange=new t.bkB,this.processingChange$=new c.t(!1),this.subs=[]}ngOnChanges(N){(0,O.a4)(N.currentCollectionId)&&(0,O.a4)(N.currentCollectionId.currentValue)&&(this.selectedCollectionId=this.currentCollectionId,this.selectedCollectionName$=this.collectionDataService.findById(this.currentCollectionId).pipe((0,I.I)(J=>(0,O.hj)(J.payload)),(0,g.T)(J=>this.dsoNameService.getName(J.payload))))}ngOnInit(){this.pathCombiner=new _.S("sections","collection"),this.available$=this.sectionsService.isSectionTypeAvailable(this.submissionId,v.l.Collection)}ngOnDestroy(){this.subs.filter(N=>(0,O.a4)(N)).forEach(N=>N.unsubscribe())}onSelect(N){this.processingChange$.next(!0),this.operationsBuilder.replace(this.pathCombiner.getPath(),N.collection.id,!0),this.subs.push(this.operationsService.jsonPatchByResourceID(this.submissionService.getSubmissionObjectLinkName(),this.submissionId,"sections","collection").pipe((0,u.Z)(J=>this.submissionService.retrieveSubmission(J[0].id).pipe((0,f.ak)()))).subscribe(J=>{this.selectedCollectionId=N.collection.id,this.selectedCollectionName$=(0,S.of)(N.collection.name),this.collectionChange.emit(J),this.submissionService.changeSubmissionCollection(this.submissionId,N.collection.id),this.processingChange$.next(!1),this.cdr.detectChanges()}))}onClose(){this.collectionDropdown?.reset()}toggled(N){N||this.collectionDropdown?.reset()}static{this.\u0275fac=function(J){return new(J||K)(t.rXU(t.gRc),t.rXU(a.CollectionDataService),t.rXU(d.C),t.rXU(D.U),t.rXU(F.E),t.rXU(U.c),t.rXU(y.f))}}static{this.\u0275cmp=t.VBU({type:K,selectors:[["ds-submission-form-collection"]],viewQuery:function(J,Q){if(1&J&&t.GBs(j.CollectionDropdownComponent,5),2&J){let nt;t.mGM(nt=t.lsd())&&(Q.collectionDropdown=nt.first)}},inputs:{currentCollectionId:"currentCollectionId",currentDefinition:"currentDefinition",collectionModifiable:"collectionModifiable",submissionId:"submissionId",isReadonly:"isReadonly"},outputs:{collectionChange:"collectionChange"},standalone:!0,features:[t.OA$,t.aNF],decls:5,vars:6,consts:[["collectionControls","ngbDropdown"],[1,"input-group","mb-3"],["ngbDropdown","",1,"btn-group","input-group"],[1,"input-group-text"],["ngbDropdown","",1,"btn-group","input-group",3,"openChange"],["id","collectionControlsMenuLabel",1,"input-group-text"],["aria-describedby","collectionControlsMenuLabel","id","collectionControlsMenuButton","ngbDropdownToggle","",1,"btn","btn-outline-primary",3,"blur","click","dsBtnDisabled"],["ngbDropdownMenu","","id","collectionControlsDropdownMenu","aria-labelledby","collectionControlsMenuButton",1,"dropdown-menu","p-0"],[3,"selectionChange"],[1,"fas","fa-circle-notch","fa-spin"]],template:function(J,Q){1&J&&(t.j41(0,"div"),t.DNE(1,B,7,6,"div",1),t.nI1(2,"async"),t.DNE(3,b,13,12,"div",2),t.nI1(4,"async"),t.k0s()),2&J&&(t.R7$(),t.vxM(!0!==t.bMT(2,2,Q.available$)?1:-1),t.R7$(2),t.vxM(t.bMT(4,4,Q.available$)?3:-1))},dependencies:[P.A,C.MD,C.Jj,p.zH,p.tg,p.do,p.U0,k.m,h.h,h.D9],styles:[".scrollable-menu[_ngcontent-%COMP%]{height:auto;max-height:var(--ds-dropdown-menu-max-height);overflow-x:hidden}.collection-item[_ngcontent-%COMP%]{border-bottom:var(--bs-dropdown-border-width) solid var(--bs-dropdown-border-color)}#collectionControlsDropdownMenu[_ngcontent-%COMP%]{outline:0;left:0!important;box-shadow:var(--bs-btn-focus-box-shadow)}"]})}}return K})()},79284:(z,R,n)=>{"use strict";n.r(R),n.d(R,{SubmissionFormFooterComponent:()=>F});var C=n(60177),t=n(68018),p=n(7673),h=n(96354),c=n(55121),S=n(61989),I=n(79104),g=n(89777),u=n(33745),y=n(30250),a=n(54438),_=n(58003);function d(B,L){if(1&B){const T=a.RV6();a.j41(0,"button",11),a.nI1(1,"async"),a.nI1(2,"async"),a.nI1(3,"dsBrowserOnly"),a.bIt("click",function(W){a.eBV(T);const K=a.XpG(2),tt=a.sdS(2);return W.preventDefault(),a.Njj(K.confirmDiscard(tt))}),a.nrm(4,"i",12),a.EFF(5),a.nI1(6,"translate"),a.k0s()}if(2&B){const T=a.XpG(2);a.Y8G("dsBtnDisabled",a.bMT(1,3,T.processingSaveStatus)||a.bMT(2,5,T.processingDepositStatus)),a.BMQ("data-test",a.bMT(3,7,"discard")),a.R7$(5),a.SpI(" ",a.bMT(6,9,"submission.general.discard.submit")," ")}}function f(B,L){1&B&&(a.j41(0,"span"),a.nrm(1,"i",13),a.EFF(2),a.nI1(3,"translate"),a.k0s()),2&B&&(a.R7$(2),a.SpI(" ",a.bMT(3,1,"submission.general.info.saved")," "))}function D(B,L){1&B&&(a.j41(0,"span"),a.nrm(1,"i",14),a.EFF(2),a.nI1(3,"translate"),a.k0s()),2&B&&(a.R7$(2),a.SpI(" ",a.bMT(3,1,"submission.general.info.pending-changes")," "))}function P(B,L){1&B&&(a.j41(0,"div",17),a.EFF(1,"Saving..."),a.k0s()),2&B&&a.xc7("width","100%")}function j(B,L){1&B&&(a.j41(0,"div",17),a.EFF(1,"Depositing..."),a.k0s()),2&B&&a.xc7("width","100%")}function k(B,L){if(1&B&&(a.j41(0,"div",5)(1,"div",15),a.DNE(2,P,2,2,"div",16),a.nI1(3,"async"),a.DNE(4,j,2,2,"div",16),a.nI1(5,"async"),a.k0s()()),2&B){const T=a.XpG(2);a.R7$(2),a.vxM(a.bMT(3,2,T.processingSaveStatus)?2:-1),a.R7$(2),a.vxM(a.bMT(5,4,T.processingDepositStatus)?4:-1)}}function O(B,L){if(1&B){const T=a.RV6();a.j41(0,"button",18),a.nI1(1,"async"),a.nI1(2,"async"),a.nI1(3,"dsBrowserOnly"),a.bIt("click",function(W){a.eBV(T);const K=a.XpG(2);return a.Njj(K.deposit(W))}),a.j41(4,"span"),a.nrm(5,"i",19),a.EFF(6),a.nI1(7,"translate"),a.k0s()()}if(2&B){const T=a.XpG(2);a.Y8G("dsBtnDisabled",a.bMT(1,3,T.processingSaveStatus)||a.bMT(2,5,T.processingDepositStatus)),a.BMQ("data-test",a.bMT(3,7,"deposit")),a.R7$(6),a.SpI(" ",a.bMT(7,9,"submission.general.deposit"),"")}}function U(B,L){if(1&B){const T=a.RV6();a.j41(0,"div",1)(1,"div",2),a.DNE(2,d,7,11,"button",3),a.nI1(3,"async"),a.k0s(),a.j41(4,"div",4),a.DNE(5,f,4,3,"span"),a.nI1(6,"async"),a.nI1(7,"async"),a.nI1(8,"async"),a.DNE(9,D,4,3,"span"),a.nI1(10,"async"),a.nI1(11,"async"),a.nI1(12,"async"),a.DNE(13,k,6,6,"div",5),a.nI1(14,"async"),a.nI1(15,"async"),a.j41(16,"div",6)(17,"button",7),a.nI1(18,"async"),a.nI1(19,"async"),a.nI1(20,"dsBrowserOnly"),a.bIt("click",function(W){a.eBV(T);const K=a.XpG();return a.Njj(K.save(W))}),a.j41(21,"span"),a.nrm(22,"i",8),a.EFF(23),a.nI1(24,"translate"),a.k0s()(),a.j41(25,"button",9),a.nI1(26,"async"),a.nI1(27,"async"),a.nI1(28,"async"),a.nI1(29,"async"),a.nI1(30,"dsBrowserOnly"),a.bIt("click",function(W){a.eBV(T);const K=a.XpG();return a.Njj(K.saveLater(W))}),a.j41(31,"span"),a.nrm(32,"i",8),a.EFF(33),a.nI1(34,"translate"),a.k0s()(),a.DNE(35,O,8,11,"button",10),a.nI1(36,"async"),a.k0s()()()}if(2&B){const T=a.XpG();a.R7$(2),a.vxM(a.bMT(3,15,T.showDepositAndDiscard)?2:-1),a.R7$(3),a.vxM(!0!==a.bMT(6,17,T.hasUnsavedModification)&&!0!==a.bMT(7,19,T.processingSaveStatus)&&!0!==a.bMT(8,21,T.processingDepositStatus)?5:-1),a.R7$(4),a.vxM(a.bMT(10,23,T.hasUnsavedModification)&&!0!==a.bMT(11,25,T.processingSaveStatus)&&!0!==a.bMT(12,27,T.processingDepositStatus)?9:-1),a.R7$(4),a.vxM(a.bMT(14,29,T.processingSaveStatus)||a.bMT(15,31,T.processingDepositStatus)?13:-1),a.R7$(4),a.Y8G("dsBtnDisabled",a.bMT(18,33,T.processingSaveStatus)||!0!==a.bMT(19,35,T.hasUnsavedModification)),a.BMQ("data-test",a.bMT(20,37,"save")),a.R7$(6),a.SpI(" ",a.bMT(24,39,"submission.general.save"),""),a.R7$(2),a.AVh("btn-primary",!0!==a.bMT(26,41,T.showDepositAndDiscard))("btn-secondary",a.bMT(27,43,T.showDepositAndDiscard)),a.Y8G("dsBtnDisabled",a.bMT(28,45,T.processingSaveStatus)||a.bMT(29,47,T.processingDepositStatus)),a.BMQ("data-test",a.bMT(30,49,"save-for-later")),a.R7$(8),a.SpI(" ",a.bMT(34,51,"submission.general.save-later"),""),a.R7$(2),a.vxM(a.bMT(36,53,T.showDepositAndDiscard)?35:-1)}}function v(B,L){if(1&B){const T=a.RV6();a.j41(0,"div",20)(1,"h4",21),a.EFF(2),a.nI1(3,"translate"),a.k0s(),a.j41(4,"button",22),a.bIt("click",function(){const W=a.eBV(T).dismiss;return a.Njj(W("cancel"))}),a.k0s()(),a.j41(5,"div",23)(6,"p"),a.EFF(7),a.nI1(8,"translate"),a.k0s()(),a.j41(9,"div",24)(10,"button",25),a.bIt("click",function(){const W=a.eBV(T).close;return a.Njj(W("cancel"))}),a.EFF(11),a.nI1(12,"translate"),a.k0s(),a.j41(13,"button",26),a.bIt("click",function(){const W=a.eBV(T).close;return a.Njj(W("ok"))}),a.EFF(14),a.nI1(15,"translate"),a.k0s()()}2&B&&(a.R7$(2),a.JRh(a.bMT(3,4,"submission.general.discard.confirm.title")),a.R7$(5),a.JRh(a.bMT(8,6,"submission.general.discard.confirm.info")),a.R7$(4),a.JRh(a.bMT(12,8,"submission.general.discard.confirm.cancel")),a.R7$(3),a.JRh(a.bMT(15,10,"submission.general.discard.confirm.submit")))}let F=(()=>{class B{constructor(T,b,W){this.modalService=T,this.restService=b,this.submissionService=W,this.submissionIsInvalid=(0,p.of)(!0)}ngOnChanges(T){(0,g.hj)(this.submissionId)&&(this.submissionIsInvalid=this.submissionService.getSubmissionStatus(this.submissionId).pipe((0,h.T)(b=>!1===b)),this.processingSaveStatus=this.submissionService.getSubmissionSaveProcessingStatus(this.submissionId),this.processingDepositStatus=this.submissionService.getSubmissionDepositProcessingStatus(this.submissionId),this.showDepositAndDiscard=(0,p.of)(this.submissionService.getSubmissionScope()===S.L.WorkspaceItem),this.hasUnsavedModification=this.submissionService.hasUnsavedModification())}save(T){this.submissionService.dispatchSave(this.submissionId,!0)}saveLater(T){this.submissionService.dispatchSaveForLater(this.submissionId)}deposit(T){this.submissionService.dispatchDeposit(this.submissionId)}confirmDiscard(T){this.modalService.open(T).result.then(b=>{"ok"===b&&this.submissionService.dispatchDiscard(this.submissionId)})}static{this.\u0275fac=function(b){return new(b||B)(a.rXU(_.Bq),a.rXU(c.O),a.rXU(y.E))}}static{this.\u0275cmp=a.VBU({type:B,selectors:[["ds-base-submission-form-footer"]],inputs:{submissionId:"submissionId"},standalone:!0,features:[a.OA$,a.aNF],decls:3,vars:1,consts:[["content",""],[1,"d-flex","flex-row","gap-1","justify-content-between"],[1,"flex-grow-0"],["type","button","id","discard",1,"btn","btn-danger",3,"dsBtnDisabled"],[1,"text-end","d-flex","justify-content-end","align-items-center"],[1,"col","d-flex","justify-content-end","align-items-center"],[1,"ms-2","space-children-mr"],["type","button","id","save",1,"btn","btn-secondary",3,"click","dsBtnDisabled"],[1,"fas","fa-save"],["type","button","id","saveForLater",1,"btn",3,"click","dsBtnDisabled"],["type","button","id","deposit",1,"btn","btn-success",3,"dsBtnDisabled"],["type","button","id","discard",1,"btn","btn-danger",3,"click","dsBtnDisabled"],[1,"fas","fa-trash"],[1,"fas","fa-check-circle"],[1,"fas","fa-exclamation-circle"],[1,"progress","w-75"],["role","progressbar","aria-valuenow","100","aria-valuemin","0","aria-valuemax","100",1,"progress-bar","progress-bar-striped","progress-bar-animated","bg-info",3,"width"],["role","progressbar","aria-valuenow","100","aria-valuemin","0","aria-valuemax","100",1,"progress-bar","progress-bar-striped","progress-bar-animated","bg-info"],["type","button","id","deposit",1,"btn","btn-success",3,"click","dsBtnDisabled"],[1,"fas","fa-plus"],[1,"modal-header"],[1,"modal-title","text-danger"],["type","button","aria-label","Close",1,"btn-close",3,"click"],[1,"modal-body"],[1,"modal-footer","space-children-mr"],["type","button","id","discard_cancel",1,"btn","btn-secondary",3,"click"],["type","button","id","discard_submit",1,"btn","btn-danger",3,"click"]],template:function(b,W){1&b&&a.DNE(0,U,37,55,"div",1)(1,v,16,12,"ng-template",null,0,a.C5r),2&b&&a.vxM(W.submissionId?0:-1)},dependencies:[C.Jj,u.L,I.A,t.D9]})}}return B})()},35360:(z,R,n)=>{"use strict";n.d(R,{a:()=>S});var C=n(29710),p=(n(79284),n(54438));const h=["*"];function c(I,g){}let S=(()=>{class I extends C.J{constructor(){super(...arguments),this.inAndOutputNames=["submissionId"]}getComponentName(){return"SubmissionFormFooterComponent"}importThemedComponent(u){return n(46274)(`./${u}/app/submission/form/footer/submission-form-footer.component`)}importUnthemedComponent(){return Promise.resolve().then(n.bind(n,79284))}static{this.\u0275fac=(()=>{let u;return function(a){return(u||(u=p.xGo(I)))(a||I)}})()}static{this.\u0275cmp=p.VBU({type:I,selectors:[["ds-submission-form-footer"]],inputs:{submissionId:"submissionId"},standalone:!0,features:[p.Vt3,p.aNF],ngContentSelectors:h,decls:5,vars:0,consts:[["vcr",""],["content",""]],template:function(y,a){1&y&&(p.NAR(),p.DNE(0,c,0,0,"ng-template",null,0,p.C5r),p.j41(2,"div",null,1),p.SdG(4),p.k0s())},encapsulation:2})}}return I})()},85152:(z,R,n)=>{"use strict";n.d(R,{E:()=>f});var C=n(60177),t=n(58003),p=n(68018),h=n(96354),c=n(79104),S=n(50842),I=n(12443),g=n(30250),u=n(54438);const y=D=>({"w-100":D});function a(D,P){if(1&D&&(u.j41(0,"button",2),u.nI1(1,"async"),u.nI1(2,"async"),u.EFF(3),u.nI1(4,"translate"),u.nrm(5,"i",6),u.k0s()),2&D){const j=u.XpG();u.Y8G("dsBtnDisabled",!0!==u.bMT(1,3,j.hasSections$))("ngClass",u.eq3(9,y,u.bMT(2,5,j.isXs$))),u.R7$(3),u.SpI(" ",u.bMT(4,7,"submission.sections.general.add-more")," ")}}function _(D,P){1&D&&(u.j41(0,"button",4),u.EFF(1),u.nI1(2,"translate"),u.k0s()),2&D&&(u.R7$(),u.SpI(" ",u.bMT(2,1,"submission.sections.general.no-sections")," "))}function d(D,P){if(1&D){const j=u.RV6();u.j41(0,"button",7),u.bIt("click",function(){const O=u.eBV(j).$implicit,U=u.XpG();return u.Njj(U.addSection(O.id))}),u.EFF(1),u.nI1(2,"translate"),u.k0s()}if(2&D){const j=P.$implicit;u.R7$(),u.SpI(" ",u.bMT(2,1,"submission.sections."+j.header)," ")}}let f=(()=>{class D{constructor(j,k,O){this.sectionService=j,this.submissionService=k,this.windowService=O}ngOnInit(){this.sectionList$=this.submissionService.getDisabledSectionsList(this.submissionId),this.hasSections$=this.sectionList$.pipe((0,h.T)(j=>j.length>0)),this.isXs$=this.windowService.isXs()}addSection(j){this.sectionService.addSection(this.submissionId,j)}static{this.\u0275fac=function(k){return new(k||D)(u.rXU(I.c),u.rXU(g.E),u.rXU(S.CV))}}static{this.\u0275cmp=u.VBU({type:D,selectors:[["ds-submission-form-section-add"]],inputs:{collectionId:"collectionId",submissionId:"submissionId"},standalone:!0,features:[u.aNF],decls:11,vars:16,consts:[["sectionAdd","ngbDropdown"],["ngbDropdown","","placement","bottom-right",1,"d-inline-block",3,"ngClass"],["id","sectionControls","ngbDropdownToggle","",1,"btn","btn-outline-primary","dropdown-toggle",3,"dsBtnDisabled","ngClass"],["ngbDropdownMenu","","aria-labelledby","sectionControls",1,"sections-dropdown-menu",3,"ngClass"],[1,"dropdown-item","disabled"],[1,"dropdown-item"],["aria-hidden","true",1,"fa","fa-plus"],[1,"dropdown-item",3,"click"]],template:function(k,O){1&k&&(u.j41(0,"div",1,0),u.DNE(2,a,6,11,"button",2),u.nI1(3,"async"),u.j41(4,"div",3),u.nI1(5,"async"),u.DNE(6,_,3,3,"button",4),u.nI1(7,"async"),u.Z7z(8,d,3,3,"button",5,u.fX1),u.nI1(10,"async"),u.k0s()()),2&k&&(u.Y8G("ngClass",u.eq3(12,y,O.isXs$)),u.R7$(2),u.vxM(u.bMT(3,4,O.hasSections$)?2:-1),u.R7$(2),u.Y8G("ngClass",u.eq3(14,y,u.bMT(5,6,O.isXs$))),u.R7$(2),u.vxM(!0!==u.bMT(7,8,O.hasSections$)?6:-1),u.R7$(2),u.Dyx(u.bMT(10,10,O.sectionList$)))},dependencies:[c.A,C.MD,C.YU,C.Jj,t.zH,t.tg,t.do,t.U0,p.h,p.D9],styles:[".dropdown-toggle[_ngcontent-%COMP%]:after{display:none}.sections-dropdown-menu[_ngcontent-%COMP%]{z-index:var(--ds-submission-header-z-index)}"]})}}return D})()},34790:(z,R,n)=>{"use strict";n.r(R),n.d(R,{SubmissionFormComponent:()=>nt});var C=n(60177),t=n(68018),p=n(48125),h=n.n(p),c=n(7673),S=n(5964),I=n(96354),g=n(23294),u=n(25558),y=n(94196),_=(n(52711),n(7094)),f=(n(15862),n(89777)),D=n(15202),P=n(89291),j=n(79092),k=n(12443),O=n(67707),U=n(52043),v=n(30250),F=n(71758),B=n(35360),L=n(85152),T=n(69906),b=n(54438);function W(Z,rt){if(1&Z&&(b.j41(0,"div",6),b.nrm(1,"ds-submission-upload-files",11)(2,"div",12),b.k0s()),2&Z){const A=b.XpG(2);b.R7$(),b.Y8G("submissionId",A.submissionId)("collectionId",A.collectionId)("uploadFilesOptions",A.uploadFilesOptions)}}function K(Z,rt){if(1&Z){const A=b.RV6();b.j41(0,"ds-submission-form-collection",13),b.bIt("collectionChange",function(lt){b.eBV(A);const r=b.XpG(2);return b.Njj(r.onCollectionChange(lt))}),b.k0s()}if(2&Z){const A=b.XpG(2);b.Y8G("currentCollectionId",A.collectionId)("currentDefinition",A.definitionId)("submissionId",A.submissionId)("collectionModifiable",A.collectionModifiable)("isReadonly",A.isSectionReadonly)}}function tt(Z,rt){if(1&Z&&(b.j41(0,"div",1),b.DNE(1,W,3,3,"div",6),b.nI1(2,"async"),b.j41(3,"div",7),b.DNE(4,K,1,5,"ds-submission-form-collection",8),b.k0s(),b.j41(5,"div",9),b.nrm(6,"ds-submission-form-section-add",10),b.k0s()()),2&Z){const A=b.XpG();b.R7$(),b.vxM(b.bMT(2,4,A.uploadEnabled$)?1:-1),b.R7$(3),b.vxM(A.isSectionHidden?-1:4),b.R7$(2),b.Y8G("collectionId",A.collectionId)("submissionId",A.submissionId)}}function N(Z,rt){1&Z&&(b.nrm(0,"ds-loading",3),b.nI1(1,"translate")),2&Z&&b.Y8G("message",b.bMT(1,1,"form.loading"))}function J(Z,rt){if(1&Z&&b.nrm(0,"ds-submission-section-container",4),2&Z){const A=rt.$implicit,H=b.XpG();b.Y8G("collectionId",H.collectionId)("submissionId",H.submissionId)("sectionData",A)}}function Q(Z,rt){if(1&Z&&(b.j41(0,"div",5),b.nrm(1,"ds-submission-form-footer",14),b.k0s()),2&Z){const A=b.XpG();b.R7$(),b.Y8G("submissionId",A.submissionId)}}let nt=(()=>{class Z{constructor(A,H,lt,r,Ct){this.authService=A,this.changeDetectorRef=H,this.halService=lt,this.submissionService=r,this.sectionsService=Ct,this.collectionModifiable=null,this.isLoading$=(0,c.of)(!0),this.uploadFilesOptions=new P.H,this.subs=[],this.isActive=!0}ngOnChanges(A){A.collectionId&&this.collectionId&&A.submissionId&&this.submissionId&&(this.isActive=!0,this.submissionSections=this.submissionService.getSubmissionObject(this.submissionId).pipe((0,S.p)(()=>this.isActive),(0,I.T)(H=>H.isLoading),(0,I.T)(H=>H),(0,g.F)(),(0,u.n)(H=>H?(0,c.of)([]):this.getSectionsList())),this.uploadEnabled$=this.sectionsService.isSectionTypeAvailable(this.submissionId,O.l.Upload),this.isLoading$=this.submissionService.getSubmissionObject(this.submissionId).pipe((0,S.p)(()=>this.isActive),(0,I.T)(H=>H.isLoading),(0,I.T)(H=>H),(0,g.F)()),this.subs.push(this.halService.getEndpoint(this.submissionService.getSubmissionObjectLinkName()).pipe((0,S.p)(H=>(0,f.hj)(H)),(0,g.F)()).subscribe(H=>{this.uploadFilesOptions.authToken=this.authService.buildAuthHeader(),this.uploadFilesOptions.impersonatingID=this.authService.getImpersonateID(),this.uploadFilesOptions.url=H.concat(`/${this.submissionId}`),this.definitionId=this.submissionDefinition.name,this.submissionService.dispatchInit(this.collectionId,this.submissionId,this.selfUrl,this.submissionDefinition,this.sections,this.item,this.submissionErrors),this.changeDetectorRef.detectChanges()})),this.submissionService.startAutoSave(this.submissionId))}getCollectionVisibility(){const A=this.submissionDefinition.sections.page.find(H=>h()(H.sectionType,O.l.Collection));return(0,f.EA)(A.visibility)?A.visibility:null}get isSectionHidden(){const A=this.getCollectionVisibility();return(0,f.a4)(A)&&h()(A.main,U.x.HIDDEN)&&h()(A.other,U.x.HIDDEN)}get isSectionReadonly(){const A=this.getCollectionVisibility();return(0,f.a4)(A)&&h()(A.main,U.x.READONLY)&&h()(A.other,U.x.READONLY)}ngOnDestroy(){this.isActive=!1,this.submissionService.stopAutoSave(),this.submissionService.resetAllSubmissionObjects(),this.subs.filter(A=>(0,f.a4)(A)).forEach(A=>A.unsubscribe())}onCollectionChange(A){this.definitionId!==A.submissionDefinition.name?(this.sections=A.sections,this.submissionDefinition=A.submissionDefinition,this.definitionId=this.submissionDefinition.name,this.submissionService.resetSubmissionObject(A.collection.id,this.submissionId,A._links.self.href,this.submissionDefinition,this.sections,this.item)):this.changeDetectorRef.detectChanges()}getSectionsList(){return this.submissionService.getSubmissionSections(this.submissionId).pipe((0,S.p)(A=>(0,f.hj)(A)),(0,I.T)(A=>A.filter(H=>!h()(H.sectionType,O.l.Collection))))}static{this.\u0275fac=function(H){return new(H||Z)(b.rXU(y.uR),b.rXU(b.gRc),b.rXU(_.Y),b.rXU(v.E),b.rXU(k.c))}}static{this.\u0275cmp=b.VBU({type:Z,selectors:[["ds-base-submission-form"]],inputs:{collectionId:"collectionId",item:"item",collectionModifiable:"collectionModifiable",sections:"sections",submissionErrors:"submissionErrors",selfUrl:"selfUrl",submissionDefinition:"submissionDefinition",submissionId:"submissionId"},standalone:!0,features:[b.OA$,b.aNF],decls:11,vars:11,consts:[[1,"container-fluid"],[1,"submission-form-header","mb-3","d-flex","flex-wrap","position-sticky"],[1,"submission-form-content"],[3,"message"],[3,"collectionId","submissionId","sectionData"],[1,"submission-form-footer","mt-3","mb-3","position-sticky"],[1,"w-100"],[1,"submission-form-header-item","mb-3","mb-sm-0","flex-sm-grow-1","flex-md-grow-0"],[3,"currentCollectionId","currentDefinition","submissionId","collectionModifiable","isReadonly"],[1,"submission-form-header-item","text-end"],[3,"collectionId","submissionId"],[3,"submissionId","collectionId","uploadFilesOptions"],[1,"clearfix"],[3,"collectionChange","currentCollectionId","currentDefinition","submissionId","collectionModifiable","isReadonly"],[3,"submissionId"]],template:function(H,lt){1&H&&(b.j41(0,"div",0),b.DNE(1,tt,7,6,"div",1),b.nI1(2,"async"),b.j41(3,"div",2),b.DNE(4,N,2,3,"ds-loading",3),b.nI1(5,"async"),b.Z7z(6,J,1,3,"ds-submission-section-container",4,b.fX1),b.nI1(8,"async"),b.k0s(),b.DNE(9,Q,2,1,"div",5),b.nI1(10,"async"),b.k0s()),2&H&&(b.R7$(),b.vxM(!0!==b.bMT(2,3,lt.isLoading$)?1:-1),b.R7$(3),b.vxM(b.bMT(5,5,lt.isLoading$)?4:-1),b.R7$(2),b.Dyx(b.bMT(8,7,lt.submissionSections)),b.R7$(3),b.vxM(!0!==b.bMT(10,9,lt.isLoading$)?9:-1))},dependencies:[C.MD,C.Jj,F.Q,L.E,D.v,B.a,j.P,T.H,t.D9],styles:[".submission-form-header[_ngcontent-%COMP%]{background-color:#fffffff7;padding:calc(var(--bs-spacer) / 2) 0 calc(var(--bs-spacer) / 2) 0;top:0;z-index:var(--ds-submission-header-z-index)}.submission-form-header-item[_ngcontent-%COMP%]{flex-grow:1}.submission-form-footer[_ngcontent-%COMP%]{border-radius:var(--bs-card-border-radius);bottom:0;background-color:var(--bs-gray-400);padding:calc(var(--bs-spacer) / 2);z-index:var(--ds-submission-footer-z-index)}.btn-link-focus[_ngcontent-%COMP%]{font-weight:400;color:#066;text-decoration:none}.btn-link-focus[_ngcontent-%COMP%]:hover{color:#001a1a;text-decoration:underline}.btn-link-focus[_ngcontent-%COMP%]:disabled, .btn-link-focus.disabled[_ngcontent-%COMP%]{color:#6c757d;pointer-events:none}.btn-link-focus[_ngcontent-%COMP%]:focus, .btn-link-focus.focus[_ngcontent-%COMP%]{text-decoration:underline}"]})}}return Z})()},91600:(z,R,n)=>{"use strict";n.r(R),n.d(R,{SubmissionUploadFilesComponent:()=>j});var C=n(7673),t=n(61594),p=n(96697),h=n(28690),c=n(74242),S=n(89777),I=n(9847),g=n(84780),y=(n(89291),n(12443)),a=n(67707),_=n(30250),d=n(676),f=n(54438),D=n(68018);function P(k,O){if(1&k){const U=f.RV6();f.j41(0,"ds-uploader",1),f.bIt("onCompleteItem",function(F){f.eBV(U);const B=f.XpG();return f.Njj(B.onCompleteItem(F))})("onUploadError",function(){f.eBV(U);const F=f.XpG();return f.Njj(F.onUploadError())}),f.k0s()}if(2&k){const U=f.XpG();f.Y8G("dropMsg",U.dropMsg)("dropOverDocumentMsg",U.dropOverDocumentMsg)("enableDragOverDocument",U.enableDragOverDocument)("onBeforeUpload",U.onBeforeUpload)("uploadFilesOptions",U.uploadFilesOptions)}}let j=(()=>{class k{constructor(U,v,F,B,L){this.notificationsService=U,this.operationsService=v,this.sectionService=F,this.submissionService=B,this.translate=L,this.enableDragOverDocument=!0,this.dropOverDocumentMsg="submission.sections.upload.drop-message",this.dropMsg="submission.sections.upload.drop-message",this.subs=[],this.uploadEnabled=(0,C.of)(!1),this.onBeforeUpload=()=>{const T=this.operationsService.jsonPatchByResourceType(this.submissionService.getSubmissionObjectLinkName(),this.submissionId,"sections").subscribe();return this.subs.push(T),T}}ngOnChanges(){this.uploadEnabled=this.sectionService.isSectionTypeAvailable(this.submissionId,a.l.Upload)}onCompleteItem(U){this.subs.push(this.uploadEnabled.pipe((0,t.$)()).subscribe(v=>{if(v){const{sections:F}=U,{errors:B}=U,L=(0,d.A)(B);F&&(0,S.hj)(F)&&Object.keys(F).forEach(T=>{const b=(0,c.Z5)(F[T]),W=L[T];this.sectionService.isSectionType(this.submissionId,T,a.l.Upload).pipe((0,p.s)(1)).subscribe(K=>{K&&((0,S.Im)(W)?this.notificationsService.success(null,this.translate.get("submission.sections.upload.upload-successful")):this.notificationsService.error(null,this.translate.get("submission.sections.upload.upload-failed")))}),this.sectionService.updateSectionData(this.submissionId,T,b,W,W)})}}))}onUploadError(){this.notificationsService.error(null,this.translate.get("submission.sections.upload.upload-failed"))}ngOnDestroy(){this.subs.filter(U=>(0,S.a4)(U)).forEach(U=>U.unsubscribe())}static{this.\u0275fac=function(v){return new(v||k)(f.rXU(I.I),f.rXU(h.U),f.rXU(y.c),f.rXU(_.E),f.rXU(D.c$))}}static{this.\u0275cmp=f.VBU({type:k,selectors:[["ds-base-submission-upload-files"]],inputs:{collectionId:"collectionId",submissionId:"submissionId",uploadFilesOptions:"uploadFilesOptions"},standalone:!0,features:[f.OA$,f.aNF],decls:1,vars:1,consts:[[3,"dropMsg","dropOverDocumentMsg","enableDragOverDocument","onBeforeUpload","uploadFilesOptions"],[3,"onCompleteItem","onUploadError","dropMsg","dropOverDocumentMsg","enableDragOverDocument","onBeforeUpload","uploadFilesOptions"]],template:function(v,F){1&v&&f.DNE(0,P,1,5,"ds-uploader",0),2&v&&f.vxM(F.uploadFilesOptions.url?0:-1)},dependencies:[g.y],encapsulation:2})}}return k})()},69906:(z,R,n)=>{"use strict";n.d(R,{H:()=>I});var C=n(29710),h=(n(89291),n(91600),n(54438));const c=["*"];function S(g,u){}let I=(()=>{class g extends C.J{constructor(){super(...arguments),this.inAndOutputNames=["collectionId","submissionId","uploadFilesOptions"]}getComponentName(){return"SubmissionUploadFilesComponent"}importThemedComponent(y){return n(28767)(`./${y}/app/submission/form/submission-upload-files/submission-upload-files.component.ts`)}importUnthemedComponent(){return Promise.resolve().then(n.bind(n,91600))}static{this.\u0275fac=(()=>{let y;return function(_){return(y||(y=h.xGo(g)))(_||g)}})()}static{this.\u0275cmp=h.VBU({type:g,selectors:[["ds-submission-upload-files"]],inputs:{collectionId:"collectionId",submissionId:"submissionId",uploadFilesOptions:"uploadFilesOptions"},standalone:!0,features:[h.Vt3,h.aNF],ngContentSelectors:c,decls:5,vars:0,consts:[["vcr",""],["content",""]],template:function(a,_){1&a&&(h.NAR(),h.DNE(0,S,0,0,"ng-template",null,0,h.C5r),h.j41(2,"div",null,1),h.SdG(4),h.k0s())},encapsulation:2})}}return g})()},3110:(z,R,n)=>{"use strict";n.d(R,{p:()=>g}),n(52711),n(15862);var p=n(29710),c=(n(34790),n(54438));const S=["*"];function I(u,y){}let g=(()=>{class u extends p.J{constructor(){super(...arguments),this.inAndOutputNames=["collectionId","item","collectionModifiable","sections","submissionErrors","selfUrl","submissionDefinition","submissionId"]}getComponentName(){return"SubmissionFormComponent"}importThemedComponent(a){return n(21392)(`./${a}/app/submission/form/submission-form.component`)}importUnthemedComponent(){return Promise.resolve().then(n.bind(n,34790))}static{this.\u0275fac=(()=>{let a;return function(d){return(a||(a=c.xGo(u)))(d||u)}})()}static{this.\u0275cmp=c.VBU({type:u,selectors:[["ds-submission-form"]],inputs:{collectionId:"collectionId",item:"item",collectionModifiable:"collectionModifiable",sections:"sections",submissionErrors:"submissionErrors",selfUrl:"selfUrl",submissionDefinition:"submissionDefinition",submissionId:"submissionId"},standalone:!0,features:[c.Vt3,c.aNF],ngContentSelectors:S,decls:5,vars:0,consts:[["vcr",""],["content",""]],template:function(_,d){1&_&&(c.NAR(),c.DNE(0,I,0,0,"ng-template",null,0,c.C5r),c.j41(2,"div",null,1),c.SdG(4),c.k0s())},encapsulation:2})}}return u})()},63309:(z,R,n)=>{"use strict";n.r(R),n.d(R,{SubmissionSectionContainerComponent:()=>ts});var C=n(60177),t=n(54438),p=n(58003),h=n(68018),c=n(64972),S=n(74082),I=n(44845),g=n(1473),u=n(84572),y=n(7673),a=n(96697),_=n(5964),d=n(73028),f=n(96354),D=n(61271),P=n(33553),j=n(39592),k=n(4093),O=n(28690),U=n(50813),v=n(89777),F=n(49838),B=n(86332),L=n(70338),T=n(93583),b=n(48125),W=n.n(b),K=n(83278),tt=n.n(K),N=n(13627),J=n(38511),Q=n(72887),nt=n(95720);let Z=(()=>{class s{constructor(i,e){this.formBuilder=i,this.operationsBuilder=e}dispatchOperationsFromEvent(i,e,o,l){switch(e.type){case"remove":this.dispatchOperationsFromRemoveEvent(i,e,o);break;case"change":this.dispatchOperationsFromChangeEvent(i,e,o,l);break;case"move":this.dispatchOperationsFromMoveEvent(i,e,o)}}getArrayIndexFromEvent(i){let e;return(0,v.hj)(i)&&((0,g.hDs)(i)?(0,v.kZ)(i.context)?this.isPartOfArrayOfGroup(i.model)&&(e=i.model.parent.parent.index):e=i.context.index:e=i?.index),(0,v.EA)(e)?e:0}isPartOfArrayOfGroup(i){return(0,v.Pe)(i.parent)&&i.parent.type===g.wnr&&i.parent.parent&&i.parent.parent.context&&i.parent.parent.context.type===g.WlY}getQualdropValueMap(i){const e=new Map;return(this.formBuilder.isQualdropGroup(i.model)?i.model.parent.context:i.model.parent.parent.context).groups.forEach(l=>{const E=l.group[0],M=e.get(E.qualdropId)?e.get(E.qualdropId):[];E.value&&(M.push(E.value),e.set(E.qualdropId,M))}),e}getFieldPathFromEvent(i){const e=this.getArrayIndexFromEvent(i),o=this.getFieldPathSegmentedFromChangeEvent(i);return(0,v.EA)(e)?o+"/"+e:o}getQualdropItemPathFromEvent(i){const e=this.getArrayIndexFromEvent(i),o=new Map;let l=null;return(this.formBuilder.isQualdropGroup(i.model)?i.model.parent.context:i.model.parent.parent.context).groups.forEach((M,G)=>{const Y=M.group[0],ot=o.get(Y.qualdropId)?o.get(Y.qualdropId):[];Y.value&&(ot.push(Y.value),o.set(Y.qualdropId,ot)),G===e&&(l=Y.qualdropId+"/"+(ot.length-1))}),l}getFieldPathSegmentedFromChangeEvent(i){let e;return e=this.formBuilder.isQualdropGroup(i.model)?i.model.qualdropId:this.formBuilder.isQualdropGroup(i.model.parent)?i.model.parent.qualdropId:this.formBuilder.getId(i.model),e}getFieldValueFromChangeEvent(i){let e;const o=i.model.value;if(this.formBuilder.isModelInCustomGroup(i.model))e=i.model.parent.value;else if(this.formBuilder.isRelationGroup(i.model))e=i.model.getGroupValue();else if(i.model.hasLanguages){const l=i.model.language;i.model.hasAuthority?Array.isArray(o)?(o.forEach((E,M)=>{E=Object.assign(new N.b,E,{language:l}),o[M]=E}),e=o):e=Object.assign(new N.b,o,{language:l}):e=new nt.e(o,l)}else e=(0,U.z5)(o)?new nt.e((0,U.$T)(o)):o instanceof Q.r||o instanceof N.b||o instanceof J.M||tt()(o)?o:new nt.e(o);return e}getValueMap(i){const e=new Map;return i.forEach(o=>{Object.keys(o).forEach(l=>{const E=e.get(l)?e.get(l):[];E.push(o[l]),e.set(l,E)})}),e}dispatchOperationsFromRemoveEvent(i,e,o){const l=this.getFieldPathFromEvent(e),E=this.getFieldValueFromChangeEvent(e);this.formBuilder.isQualdropGroup(e.model)?this.dispatchOperationsFromMap(this.getQualdropValueMap(e),i,e,o):e.context&&e.context instanceof g.fHx?this.handleArrayGroupPatch(i,e,e.context.context,o):((0,v.hj)(E)&&"string"==typeof E||(0,v.hj)(E)&&E instanceof nt.e&&E.hasValue())&&this.operationsBuilder.remove(i.getPath(l))}dispatchOperationsFromAddEvent(i,e){const o=this.getFieldPathSegmentedFromChangeEvent(e),l=(0,T.Go)(this.getFieldValueFromChangeEvent(e));(0,v.hj)(l)&&(l.place=this.getArrayIndexFromEvent(e),(0,v.a4)(e.group)&&(0,v.a4)(e.group.value)&&(1===e.group.value.map(M=>Object.values(M)).reduce((M,G)=>M.concat(G)).filter(M=>(0,v.hj)(M)).length?this.operationsBuilder.add(i.getPath([o]),[l],!1):this.operationsBuilder.add(i.getPath([o,"-"]),l,!1)))}dispatchOperationsFromChangeEvent(i,e,o,l){if(e.context&&e.context instanceof g.fHx)return void this.handleArrayGroupPatch(i,e,e.context.context,o);const E=this.getFieldPathFromEvent(e),M=this.getFieldPathSegmentedFromChangeEvent(e),G=this.getFieldValueFromChangeEvent(e);if(this.formBuilder.isQualdropGroup(e.model.parent)||this.formBuilder.isQualdropGroup(e.model))this.dispatchOperationsFromMap(this.getQualdropValueMap(e),i,e,o);else if(this.formBuilder.isRelationGroup(e.model))this.dispatchOperationsFromMap(this.getValueMap(G),i,e,o);else if(this.formBuilder.hasArrayGroupValue(e.model))this.operationsBuilder.add(i.getPath(M),G,!0);else if(o.isPathEqual(this.formBuilder.getPath(e.model))||l&&(0,v.hj)(o.value)){if((0,v.a4)(e.$event)&&(0,v.a4)(e.$event.previousIndex))if(e.$event.previousIndex<0)this.operationsBuilder.add(i.getPath(M),G,!0);else{const Y=i.getPath(E),ot=i.getPath(M+"/"+e.$event.previousIndex);(0,v.hj)(ot.path)&&(0,v.hj)(Y.path)&&ot.path!==Y.path&&this.operationsBuilder.move(Y,ot.path)}else(0,v.hj)(G)&&!G.hasValue()?0===this.getArrayIndexFromEvent(e)?this.operationsBuilder.remove(i.getPath(M)):this.operationsBuilder.remove(i.getPath(E)):this.operationsBuilder.replace(i.getPath(E),G);o.delete()}else G.hasValue()&&((0,v.b0)(this.getArrayIndexFromEvent(e))||0===this.getArrayIndexFromEvent(e)?this.operationsBuilder.add(i.getPath(M),G,!0):this.operationsBuilder.add(i.getPath(E),G))}dispatchOperationsFromMap(i,e,o,l){const E=i;if("remove"===o.type){const M=this.getQualdropItemPathFromEvent(o);this.operationsBuilder.remove(e.getPath(M))}else l.isPathEqual(this.formBuilder.getPath(o.model))&&l.value.forEach((M,G)=>{const Y=E.get(G);Y?(W()(M,Y)||this.operationsBuilder.add(e.getPath(G),Y,!0),E.delete(G)):Y||this.operationsBuilder.remove(e.getPath(G))}),E.forEach((M,G)=>{1===M.length&&(0,v.kZ)(M[0])?this.operationsBuilder.remove(e.getPath(G)):this.operationsBuilder.add(e.getPath(G),M,!0)});l.delete()}dispatchOperationsFromMoveEvent(i,e,o){return this.handleArrayGroupPatch(i,e.$event,e.$event.arrayModel,o)}handleArrayGroupPatch(i,e,o,l){const E=this.formBuilder.getValueFromModel([o]),M=this.getFieldPathSegmentedFromChangeEvent(e);(0,v.hj)(E)?this.operationsBuilder.add(i.getPath(M),E[M],!1):l.isPathEqual(this.formBuilder.getPath(e.model))&&this.operationsBuilder.remove(i.getPath(M))}static{this.\u0275fac=function(e){return new(e||s)(t.KVO(F.j),t.KVO(j.C))}}static{this.\u0275prov=t.jDH({token:s,factory:s.\u0275fac,providedIn:"root"})}}return s})();var rt=n(99172);let A=(()=>{class s{constructor(i,e,o){this.injectedCollectionId=i,this.injectedSectionData=e,this.injectedSubmissionId=o,this.collectionId=i,this.sectionData=e,this.submissionId=o}ngOnInit(){this.onSectionInit(),this.updateSectionStatus()}updateSectionStatus(){this.sectionStatusSub=this.getSectionStatus().pipe((0,_.p)(i=>(0,v.EA)(i)),(0,rt.Z)(!0)).subscribe(i=>{this.sectionService.setSectionStatus(this.submissionId,this.sectionData.id,i)})}ngOnDestroy(){(0,v.a4)(this.sectionStatusSub)&&this.sectionStatusSub.unsubscribe(),this.onSectionDestroy()}static{this.\u0275fac=function(e){return new(e||s)(t.rXU("collectionIdProvider"),t.rXU("sectionDataProvider"),t.rXU("submissionIdProvider"))}}static{this.\u0275cmp=t.VBU({type:s,selectors:[["ds-section-model"]],standalone:!0,features:[t.aNF],decls:0,vars:0,template:function(e,o){},encapsulation:2})}}return s})();var H=n(12443);const lt={id:"discoverable",name:"discoverable"},r={element:{container:"custom-control custom-checkbox ps-1",control:"custom-control-input",label:"custom-control-label pt-1"}},Ct={id:"accessConditionGroup",group:[]},Rt={element:{host:"mb-3 access-condition-group col",container:"ps-1 pe-1",control:"row "}},Bt={id:"accessCondition",groupFactory:null},Mt={grid:{group:"row pt-4"}},Tt={id:"name",label:"submission.sections.accesses.form.access-condition-label",hint:"submission.sections.accesses.form.access-condition-hint",options:[]},Ot={element:{host:"col-12",label:"col-form-label name-label"}},xt={id:"startDate",label:"submission.sections.accesses.form.from-label",hint:"submission.sections.accesses.form.from-hint",placeholder:"submission.sections.accesses.form.from-placeholder",inline:!1,toggleIcon:"far fa-calendar-alt",relations:[{match:g.AjF,operator:g.fXj,when:[]}],required:!0,validators:{required:null},errorMessages:{required:"submission.sections.accesses.form.date-required-from"}},Ut={element:{label:"col-form-label"},grid:{host:"col-6"}},jt={id:"endDate",label:"submission.sections.accesses.form.until-label",hint:"submission.sections.accesses.form.until-hint",placeholder:"submission.sections.accesses.form.until-placeholder",inline:!1,toggleIcon:"far fa-calendar-alt",relations:[{match:g.AjF,operator:g.fXj,when:[]}],required:!0,validators:{required:null},errorMessages:{required:"submission.sections.accesses.form.date-required-until"}},At={element:{label:"col-form-label"},grid:{host:"col-6"}};var vt=n(23294),Lt=n(91261),$t=n(59640);let q=(()=>{class s{constructor(i){this.store=i}getAccessesData(i,e){return this.store.select((0,Lt.on)(i,e)).pipe((0,_.p)(o=>(0,v.EA)(o)),(0,vt.F)())}static{this.\u0275fac=function(e){return new(e||s)(t.KVO($t.il))}}static{this.\u0275prov=t.jDH({token:s,factory:s.\u0275fac,providedIn:"root"})}}return s})();const bt=["formRef"];function x(s,m){if(1&s){const i=t.RV6();t.j41(0,"ds-form",2,0),t.bIt("dfChange",function(o){t.eBV(i);const l=t.XpG();return t.Njj(l.onChange(o))})("removeArrayItem",function(o){t.eBV(i);const l=t.XpG();return t.Njj(l.onRemove(o))}),t.k0s()}if(2&s){const i=t.XpG();t.Y8G("formId",i.formId)("formModel",i.formModel)("displaySubmit",!1)("displayCancel",!1)}}let $=(()=>{class s extends A{constructor(i,e,o,l,E,M,G,Y,ot,dt,pt){super(void 0,dt,pt),this.sectionService=i,this.formBuilderService=e,this.accessesConfigService=o,this.accessesService=l,this.formOperationsService=E,this.operationsBuilder=M,this.formService=G,this.translate=Y,this.operationsService=ot,this.injectedSectionData=dt,this.injectedSubmissionId=pt,this.subs=[]}initModelData(i){this.accessesData.accessConditions.forEach((e,o)=>{Array.of("name","startDate","endDate").filter(l=>e.hasOwnProperty(l)&&(0,v.hj)(e[l])).forEach(l=>{const E=this.formBuilderService.findById(l,i,o);if(E)if(E.type===g.fQD){const M=new Date(e[l]);E.value={year:M.getUTCFullYear(),month:M.getUTCMonth()+1,day:M.getUTCDate()}}else E.value=e[l]})})}onChange(i){if(i.model.type===g.eU4){const e=this.formOperationsService.getFieldPathSegmentedFromChangeEvent(i),o=this.formOperationsService.getFieldValueFromChangeEvent(i);this.operationsBuilder.replace(this.pathCombiner.getPath(e),o.value,!0)}else{if(i.model.id===Tt.id){const e=i.control.parent.get("startDate"),o=i.control.parent.get("endDate");e?.markAsUntouched(),o?.markAsUntouched(),e?.setValue(null),o?.setValue(null),i.control.parent.markAsDirty()}this.formService.validateAllFormFields(this.formRef.formGroup),this.formService.isValid(this.formId).pipe((0,a.s)(1),(0,_.p)(e=>e),(0,d.Z)(()=>this.formService.getFormData(this.formId)),(0,a.s)(1)).subscribe(e=>{const o=[];e.accessCondition.map(l=>l.accessConditionGroup).filter(l=>(0,v.hj)(l)).forEach(l=>{let E;if(this.availableAccessConditionOptions.filter(M=>(0,v.Pe)(l.name)&&M.name===l.name[0].value).forEach(M=>E=M),E){const M=Object.assign({},l);if(M.name=this.retrieveValueFromField(l.name),E.hasStartDate){if(l.startDate){const G=this.retrieveValueFromField(l.startDate);M.startDate=(0,U.Sd)(G)}}else delete M.startDate;if(E.hasEndDate){if(l.endDate){const G=this.retrieveValueFromField(l.endDate);M.endDate=(0,U.Sd)(G)}}else delete M.endDate;o.push(M)}}),this.operationsBuilder.add(this.pathCombiner.getPath("accessConditions"),o,!0)})}}onRemove(i){const o="accessConditions/"+this.formOperationsService.getArrayIndexFromEvent(i);this.operationsBuilder.remove(this.pathCombiner.getPath(o))}onSectionDestroy(){this.subs.filter(i=>(0,v.a4)(i)).forEach(i=>i.unsubscribe())}onSectionInit(){this.pathCombiner=new P.S("sections",this.sectionData.id),this.formId=this.formService.getUniqueId(this.sectionData.id);const i=this.accessesConfigService.findByHref(this.sectionData.config,!0,!1).pipe((0,k.yd)(),(0,f.T)(o=>o.payload)),e=this.accessesService.getAccessesData(this.submissionId,this.sectionData.id);(0,u.z)([i,e]).subscribe(([o,l])=>{this.availableAccessConditionOptions=(0,v.hj)(o.accessConditionOptions)?o.accessConditionOptions:[],this.canChangeDiscoverable=!!o.canChangeDiscoverable,this.accessesData=l,this.formModel=this.buildFileEditForm()})}getSectionStatus(){return(0,y.of)(!0)}buildFileEditForm(){const i=[];if(this.canChangeDiscoverable){const at=Object.assign({},lt,{label:this.translate.instant("submission.sections.accesses.form.discoverable-label"),hint:this.translate.instant("submission.sections.accesses.form.discoverable-description"),value:this.accessesData.discoverable});i.push(new g.M7d(at,r))}const e=Object.assign({},Tt),o=Object.assign({},Bt),l=[];for(const at of this.availableAccessConditionOptions)l.push({label:at.name,value:at.name});e.options=l;const E=[],M=[];let G,Y;this.availableAccessConditionOptions.forEach(at=>{if(at.hasStartDate&&(E.push({id:"name",value:at.name}),at.maxStartDate)){const ut=new Date(at.maxStartDate);G={year:ut.getUTCFullYear(),month:ut.getUTCMonth()+1,day:ut.getUTCDate()}}if(at.hasEndDate&&(M.push({id:"name",value:at.name}),at.maxEndDate)){const ut=new Date(at.maxEndDate);Y={year:ut.getUTCFullYear(),month:ut.getUTCMonth()+1,day:ut.getUTCDate()}}});const ot={relations:[{match:g.AjF,operator:g.fXj,when:E}]},dt={relations:[{match:g.AjF,operator:g.fXj,when:M}]},pt=E.length>0,gt=M.length>0;return o.groupFactory=()=>{const at=new g.z4z(e,Ot),ut=Object.assign({},xt,ot);G&&(ut.max=G);const It=Object.assign({},jt,dt);Y&&(It.max=Y);const is=new g.dku(ut,Ut),es=new g.dku(It,At),Pt=Object.assign({},Ct);return Pt.group=[at],pt&&Pt.group.push(is),gt&&Pt.group.push(es),[new g.iO5(Pt,Rt)]},o.initialCount=(0,v.hj)(this.accessesData.accessConditions)?this.accessesData.accessConditions.length:1,i.push(new g.UqU(o,Mt)),this.initModelData(i),i}retrieveValueFromField(i){const e=Array.isArray(i)?i[0]:i;return e?e.value:void 0}static{this.\u0275fac=function(e){return new(e||s)(t.rXU(H.c),t.rXU(F.j),t.rXU(D.SubmissionAccessesConfigDataService),t.rXU(q),t.rXU(Z),t.rXU(j.C),t.rXU(L.u),t.rXU(h.c$),t.rXU(O.U),t.rXU("sectionDataProvider"),t.rXU("submissionIdProvider"))}}static{this.\u0275cmp=t.VBU({type:s,selectors:[["ds-section-accesses"]],viewQuery:function(e,o){if(1&e&&t.GBs(bt,5),2&e){let l;t.mGM(l=t.lsd())&&(o.formRef=l.first)}},standalone:!0,features:[t.Vt3,t.aNF],decls:1,vars:1,consts:[["formRef","formComponent"],[3,"formId","formModel","displaySubmit","displayCancel"],[3,"dfChange","removeArrayItem","formId","formModel","displaySubmit","displayCancel"]],template:function(e,o){1&e&&t.DNE(0,x,2,4,"ds-form",1),2&e&&t.vxM(o.formModel?0:-1)},dependencies:[B.s],styles:[".access-condition-group{position:relative;top:-2.3rem;margin-bottom:-2.3rem}"]})}}return s})();var X=n(89417),w=n(86820),V=n(88141),it=n(94925),et=n(16868),_t=n(6106),mt=n(9938),ht=n(79104);const Dt=[[["",8,"selection"]],[["",8,"menu"]]],Xt=[".selection",".menu"];function Nt(s,m){if(1&s&&(t.j41(0,"span",1),t.EFF(1),t.nI1(2,"translate"),t.k0s()),2&s){const i=t.XpG();t.R7$(),t.SpI(" ",t.bMT(2,1,i.label)," ")}}let Gt=(()=>{class s{constructor(){this.toggled=new t.bkB,this.close=new t.bkB}static{this.\u0275fac=function(e){return new(e||s)}}static{this.\u0275cmp=t.VBU({type:s,selectors:[["ds-select"]],inputs:{label:"label",disabled:"disabled"},outputs:{toggled:"toggled",close:"close"},standalone:!0,features:[t.aNF],ngContentSelectors:Xt,decls:8,vars:2,consts:[["ngbDropdown","",1,"btn-group",3,"openChange"],["id","dsSelectMenuLabel",1,"input-group-text"],["aria-describedby","dsSelectMenuLabel","id","dsSelectMenuButton","ngbDropdownToggle","",1,"btn","btn-outline-primary","selection",3,"blur","click","dsBtnDisabled"],["ngbDropdownMenu","","id","dsSelectDropdownMenu","aria-labelledby","dsSelectMenuButton",1,"dropdown-menu"]],template:function(e,o){1&e&&(t.NAR(Dt),t.j41(0,"div")(1,"div",0),t.bIt("openChange",function(E){return o.toggled.emit(E)}),t.DNE(2,Nt,3,3,"span",1),t.j41(3,"button",2),t.bIt("blur",function(E){return o.close.emit(E)})("click",function(E){return o.close.emit(E)}),t.SdG(4),t.k0s(),t.j41(5,"div",3)(6,"div"),t.SdG(7,1),t.k0s()()()()),2&e&&(t.R7$(2),t.vxM(o.label?2:-1),t.R7$(),t.Y8G("dsBtnDisabled",o.disabled))},dependencies:[ht.A,p.zH,p.tg,p.do,p.U0,h.h,h.D9]})}}return s})();var yt=n(15202),ct=n(50186),st=n(67707);const Ft=(s,m)=>m.id,Kt=()=>({standalone:!0});function Vt(s,m){1&s&&(t.j41(0,"button",6),t.EFF(1),t.nI1(2,"translate"),t.k0s()),2&s&&(t.R7$(),t.SpI(" ",t.bMT(2,1,"submission.sections.ccLicense.none")," "))}function St(s,m){if(1&s){const i=t.RV6();t.j41(0,"button",8),t.bIt("click",function(){const o=t.eBV(i).$implicit,l=t.XpG(3);return t.Njj(l.selectCcLicense(o))}),t.EFF(1),t.k0s()}if(2&s){const i=m.$implicit;t.R7$(),t.SpI(" ",i.name," ")}}function Zt(s,m){if(1&s&&t.Z7z(0,St,2,1,"button",7,Ft),2&s){const i=t.XpG(2);t.Dyx(i.submissionCcLicenses)}}function qt(s,m){if(1&s){const i=t.RV6();t.j41(0,"div",2)(1,"div",3)(2,"input",4,0),t.nI1(4,"translate"),t.nI1(5,"translate"),t.mxI("ngModelChange",function(o){t.eBV(i);const l=t.XpG();return t.DH7(l.selectedCcLicense.name,o)||(l.selectedCcLicense.name=o),t.Njj(o)}),t.k0s(),t.j41(6,"div",5),t.bIt("scroll",function(o){t.eBV(i);const l=t.XpG();return t.Njj(l.onScroll(o))}),t.DNE(7,Vt,3,3,"button",6)(8,Zt,2,0),t.k0s()()()}if(2&s){const i=t.XpG();t.R7$(2),t.FS9("placeholder",i.storedCcLicenseLink?t.bMT(5,11,"submission.sections.ccLicense.change"):t.bMT(4,9,"submission.sections.ccLicense.select")),t.R50("ngModel",i.selectedCcLicense.name),t.Y8G("ngModelOptions",t.lJ4(13,Kt)),t.R7$(4),t.Y8G("infiniteScrollDistance",5)("infiniteScrollThrottle",300)("infiniteScrollUpDistance",1.5)("fromRoot",!0)("scrollWindow",!1),t.R7$(),t.vxM(0===(null==i.submissionCcLicenses?null:i.submissionCcLicenses.length)?7:8)}}function ti(s,m){if(1&s&&(t.j41(0,"div",9)(1,"h5"),t.EFF(2),t.k0s(),t.nrm(3,"div",18),t.k0s()),2&s){const i=m.$implicit;t.R7$(2),t.SpI(" ",i.label," "),t.R7$(),t.Y8G("innerHTML",i.description,t.npT)}}function ii(s,m){if(1&s){const i=t.RV6();t.j41(0,"div")(1,"div",14)(2,"div")(3,"h4"),t.EFF(4),t.k0s(),t.nrm(5,"div",15),t.k0s(),t.j41(6,"button",16),t.bIt("click",function(){t.eBV(i);const o=t.XpG(3);return t.Njj(o.closeInfoModal())}),t.k0s()(),t.j41(7,"div",17),t.Z7z(8,ti,4,2,"div",9,t.fX1),t.k0s()()}if(2&s){const i=t.XpG().$implicit;t.R7$(4),t.SpI(" ",i.label," "),t.R7$(),t.Y8G("innerHTML",i.description,t.npT),t.R7$(3),t.Dyx(i.enums)}}function ei(s,m){if(1&s&&(t.j41(0,"span"),t.EFF(1),t.k0s()),2&s){const i=t.XpG().ngVar;t.R7$(),t.SpI(" ",i.label," ")}}function ni(s,m){1&s&&(t.j41(0,"span"),t.EFF(1),t.nI1(2,"translate"),t.k0s()),2&s&&(t.R7$(),t.SpI(" ",t.bMT(2,1,"submission.sections.ccLicense.option.select")," "))}function si(s,m){if(1&s&&(t.qex(0,22),t.DNE(1,ei,2,1,"span")(2,ni,3,3,"span"),t.bVm()),2&s){const i=m.ngVar;t.R7$(),t.vxM(i?1:-1),t.R7$(),t.vxM(i?-1:2)}}function oi(s,m){if(1&s){const i=t.RV6();t.j41(0,"button",8),t.bIt("click",function(){const o=t.eBV(i).$implicit,l=t.XpG(2).$implicit,E=t.XpG(2);return t.Njj(E.selectOption(E.getSelectedCcLicense(),l,o))}),t.EFF(1),t.k0s()}if(2&s){const i=m.$implicit;t.R7$(),t.SpI(" ",i.label," ")}}function ai(s,m){if(1&s&&(t.j41(0,"ds-select",13),t.DNE(1,si,3,2,"ng-container",19),t.qex(2,20),t.j41(3,"div",21),t.Z7z(4,oi,2,1,"button",7,t.fX1),t.k0s(),t.bVm(),t.k0s()),2&s){const i=t.XpG().$implicit,e=t.XpG(2);t.Y8G("disabled","jurisdiction"===i.id&&void 0!==e.defaultJurisdiction&&"none"!==e.defaultJurisdiction),t.R7$(),t.Y8G("ngVar",e.getSelectedOption(e.getSelectedCcLicense(),i)),t.R7$(3),t.Dyx(i.enums)}}function ri(s,m){if(1&s){const i=t.RV6();t.j41(0,"div",23)(1,"div",24),t.bIt("click",function(){const o=t.eBV(i).$implicit,l=t.XpG(2).$implicit,E=t.XpG(2);return t.Njj(E.selectOption(E.getSelectedCcLicense(),l,o))}),t.nrm(2,"input",25),t.j41(3,"span"),t.EFF(4),t.k0s()()()}if(2&s){const i=m.$implicit,e=t.XpG(2).$implicit,o=t.XpG(2);t.R7$(2),t.FS9("title",i.label),t.Y8G("checked",o.isSelectedOption(o.getSelectedCcLicense(),e,i)),t.R7$(2),t.JRh(i.label)}}function ci(s,m){if(1&s&&t.Z7z(0,ri,5,3,"div",23,t.fX1),2&s){const i=t.XpG().$implicit;t.Dyx(i.enums)}}function li(s,m){if(1&s){const i=t.RV6();t.j41(0,"div",9)(1,"div",10)(2,"div"),t.EFF(3),t.k0s(),t.j41(4,"button",11),t.bIt("click",function(){t.eBV(i);const o=t.sdS(7),l=t.XpG(2);return t.Njj(l.openInfoModal(o))}),t.nrm(5,"i",12),t.k0s()(),t.DNE(6,ii,10,2,"ng-template",null,1,t.C5r)(8,ai,6,2,"ds-select",13)(9,ci,2,0),t.k0s()}if(2&s){const i=m.$implicit;t.R7$(2),t.ZvI("fw-bold ",i.id,""),t.R7$(),t.SpI(" ",i.label," "),t.R7$(5),t.vxM((null==i.enums?null:i.enums.length)>5?8:-1),t.R7$(),t.vxM((null==i.enums?null:i.enums.length)<=5?9:-1)}}function di(s,m){if(1&s&&t.Z7z(0,li,10,6,"div",9,t.fX1),2&s){const i=t.XpG();t.Dyx(i.getSelectedCcLicense().fields)}}function mi(s,m){if(1&s){const i=t.RV6();t.j41(0,"div",26)(1,"div"),t.EFF(2),t.nI1(3,"translate"),t.k0s(),t.j41(4,"a",27),t.EFF(5),t.k0s(),t.j41(6,"div",28)(7,"div",24),t.bIt("click",function(){t.eBV(i);const o=t.XpG(2);return t.Njj(o.setAccepted(!o.accepted))}),t.nrm(8,"input",29),t.j41(9,"span"),t.EFF(10),t.nI1(11,"translate"),t.k0s()()()()}if(2&s){t.XpG();const i=t.r8f(0),e=t.XpG();t.R7$(2),t.SpI(" ",t.bMT(3,5,"submission.sections.ccLicense.link")," "),t.R7$(2),t.FS9("href",i,t.B4B),t.R7$(),t.SpI(" ",i," "),t.R7$(3),t.Y8G("checked",e.accepted),t.R7$(2),t.SpI(" ",t.bMT(11,7,"submission.sections.ccLicense.confirmation"),"")}}function ui(s,m){1&s&&t.nrm(0,"ds-loading")}function pi(s,m){if(1&s&&(t.SS7(0),t.nI1(1,"async"),t.DNE(2,mi,12,9,"div",26)(3,ui,1,0,"ds-loading")),2&s){const i=t.bH3(t.bMT(1,1,t.XpG().ccLicenseLink$));t.R7$(2),t.vxM(i?2:3)}}let _i=(()=>{class s extends A{get storedCcLicenseLink(){return this.data.uri}get accepted(){return void 0===this.data.accepted?!!this.data.uri:this.data.accepted}constructor(i,e,o,l,E,M,G,Y,ot,dt){super(Y,ot,dt),this.modalService=i,this.sectionService=e,this.submissionCcLicensesDataService=o,this.submissionCcLicenseUrlDataService=l,this.operationsBuilder=E,this.configService=M,this.ref=G,this.injectedCollectionId=Y,this.injectedSectionData=ot,this.injectedSubmissionId=dt,this.isLoading=!0,this.subscriptions=[],this.submissionCcLicenses=[],this.selectedCcLicense=new et.C,this.ccLicenceOptions={elementsPerPage:20,currentPage:1}}ngOnInit(){super.ngOnInit(),(0,v.Tn)(this.ccLicenseLink$)&&(this.ccLicenseLink$=this.getCcLicenseLink$())}ngOnChanges(i){((0,v.a4)(i.sectionData)||(0,v.a4)(i.submissionCcLicenses))&&(this.ccLicenseLink$=this.getCcLicenseLink$())}get data(){return this.sectionData.data}selectCcLicense(i){this.selectedCcLicense.id!==i.id&&(this.selectedCcLicense=i,this.setAccepted(!1),this.updateSectionData({ccLicense:{id:i.id,fields:{}},uri:void 0}),this.ccLicenseLink$=this.getCcLicenseLink$())}getSelectedCcLicense(){return this.submissionCcLicenses&&this.data.ccLicense?this.submissionCcLicenses.filter(i=>i.id===this.data.ccLicense.id)[0]:null}selectOption(i,e,o){this.isSelectedOption(i,e,o)||(this.updateSectionData({ccLicense:{id:i.id,fields:Object.assign({},this.data.ccLicense.fields,{[e.id]:o})},accepted:!1}),this.ccLicenseLink$=this.getCcLicenseLink$())}getSelectedOption(i,e){return"jurisdiction"===e.id&&void 0!==this.defaultJurisdiction&&"none"!==this.defaultJurisdiction?e.enums.find(o=>o.id===this.defaultJurisdiction):this.data.ccLicense.fields[e.id]}isSelectedOption(i,e,o){return this.getSelectedOption(i,e)&&this.getSelectedOption(i,e).id===o.id}getCcLicenseLink$(){if(this.storedCcLicenseLink)return(0,y.of)(this.storedCcLicenseLink);if(!this.getSelectedCcLicense()||this.getSelectedCcLicense().fields.some(e=>!this.getSelectedOption(this.getSelectedCcLicense(),e)))return;const i=this.getSelectedCcLicense();return this.submissionCcLicenseUrlDataService.getCcLicenseLink(i,new Map(i.fields.map(e=>[e,this.getSelectedOption(i,e)])))}openInfoModal(i){this.modalRef=this.modalService.open(i)}closeInfoModal(){this.modalRef.close()}getSectionStatus(){return(0,y.of)(this.accepted)}onSectionDestroy(){this.subscriptions.forEach(i=>i.unsubscribe())}onSectionInit(){this.pathCombiner=new P.S("sections",this.sectionData.id),this.subscriptions.push(this.sectionService.getSectionState(this.submissionId,this.sectionData.id,st.l.CcLicense).pipe((0,_.p)(i=>(0,v.hj)(i)&&((0,v.hj)(i.data)||(0,v.hj)(i.errorsToShow))),(0,vt.F)(),(0,f.T)(i=>i.data)).subscribe(i=>{if(this.data.accepted!==i.accepted){const e=this.pathCombiner.getPath("uri");i.accepted?this.getCcLicenseLink$().pipe((0,a.s)(1)).subscribe(o=>{this.operationsBuilder.add(e,o.toString(),!1,!0)}):this.data.uri&&this.operationsBuilder.remove(e)}this.sectionData.data=i}),this.configService.findByPropertyName("cc.license.jurisdiction").pipe((0,k.qD)(),(0,k.Bo)()).subscribe(i=>{this.defaultJurisdiction=void 0===i||0===i.values.length?"":i.values[0]})),this.loadCcLicences()}setAccepted(i){this.updateSectionData({accepted:i}),this.updateSectionStatus()}updateSectionData(i){this.sectionService.updateSectionData(this.submissionId,this.sectionData.id,Object.assign({},this.data,i))}onScroll(i){i.target.scrollTop+i.target.clientHeight>=i.target.scrollHeight&&!this.isLoading&&!this._isLastPage&&(this.ccLicenceOptions.currentPage++,this.loadCcLicences())}loadCcLicences(){this.isLoading=!0,this.subscriptions.push(this.submissionCcLicensesDataService.findAll(this.ccLicenceOptions).pipe((0,k.ak)(),(0,V.M)(i=>this._isLastPage=i.pageInfo.currentPage===i.pageInfo.totalPages),(0,f.T)(i=>i.page)).subscribe(i=>{this.submissionCcLicenses=[...this.submissionCcLicenses,...i],this.isLoading=!1,this.ref.detectChanges()}))}static{this.\u0275fac=function(e){return new(e||s)(t.rXU(p.Bq),t.rXU(H.c),t.rXU(_t.SubmissionCcLicenseDataService),t.rXU(mt.SubmissionCcLicenseUrlDataService),t.rXU(j.C),t.rXU(it.ConfigurationDataService),t.rXU(t.gRc),t.rXU("collectionIdProvider"),t.rXU("sectionDataProvider"),t.rXU("submissionIdProvider"))}}static{this.\u0275cmp=t.VBU({type:s,selectors:[["ds-submission-section-cc-licenses"]],standalone:!0,features:[t.Vt3,t.OA$,t.aNF],decls:3,vars:3,consts:[["script","ngModel"],["infoModal",""],[1,"mb-4","ccLicense-select"],["ngbDropdown",""],["id","cc-license-dropdown","ngbDropdownToggle","","role","combobox",1,"form-control",3,"ngModelChange","ngModel","placeholder","ngModelOptions"],["ngbDropdownMenu","","aria-labelledby","cc-license-dropdown","role","menu","infiniteScroll","",1,"w-100","scrollable-menu",3,"scroll","infiniteScrollDistance","infiniteScrollThrottle","infiniteScrollUpDistance","fromRoot","scrollWindow"],[1,"dropdown-item","disabled"],[1,"dropdown-item"],[1,"dropdown-item",3,"click"],[1,"mb-4"],[1,"d-flex","flex-row"],[1,"btn","btn-outline-info","btn-sm","ms-2",3,"click"],[1,"fas","fa-question"],[3,"disabled"],[1,"modal-header","mb-4"],[3,"innerHTML"],["type","button","aria-label","Close",1,"btn-close",3,"click"],[1,"modal-body"],[1,"fw-light",3,"innerHTML"],["class","selection",4,"ngVar"],[1,"menu"],[1,"options-select-menu","overflow-auto"],[1,"selection"],[1,"d-flex","flex-row","m-1"],[3,"click"],["type","radio",1,"me-1",3,"title","checked"],[1,"mt-2","p-4","bg-light","text-dark"],["target","_blank","rel","noopener noreferrer",1,"license-link",3,"href"],[1,"m-2"],["type","checkbox","title","accepted",1,"me-2",3,"checked"]],template:function(e,o){1&e&&t.DNE(0,qt,9,14,"div",2)(1,di,2,0)(2,pi,4,4),2&e&&(t.vxM(o.submissionCcLicenses?0:-1),t.R7$(),t.vxM(o.getSelectedCcLicense()?1:-1),t.R7$(),t.vxM(o.ccLicenseLink$?2:-1))},dependencies:[C.Jj,Gt,X.YN,X.me,X.BC,X.vS,w.e,w.D,p.zH,p.tg,p.do,p.U0,yt.v,h.h,h.D9,ct.r],styles:[".options-select-menu[_ngcontent-%COMP%]{max-height:25vh}.ccLicense-select[_ngcontent-%COMP%]{width:fit-content}.scrollable-menu[_ngcontent-%COMP%]{height:auto;max-height:var(--ds-dropdown-menu-max-height);overflow-x:hidden}"]})}}return s})();var hi=n(61880),fi=n(5127),vi=n(92767),Et=n(30250);function bi(s,m){1&s&&(t.j41(0,"div",2),t.EFF(1),t.nI1(2,"translate"),t.k0s()),2&s&&(t.R7$(),t.JRh(t.bMT(2,1,"submission.sections.duplicates.none")))}function Ci(s,m){if(1&s&&(t.j41(0,"div"),t.EFF(1),t.nI1(2,"translate"),t.k0s()),2&s){const i=m.$implicit;t.R7$(),t.Lme(" ",t.bMT(2,2,"item.preview."+i.key)," ",i.value," ")}}function Si(s,m){1&s&&(t.j41(0,"p"),t.EFF(1),t.nI1(2,"translate"),t.k0s()),2&s&&(t.R7$(),t.JRh(t.bMT(2,1,"submission.sections.duplicates.in-workspace")))}function Ei(s,m){1&s&&(t.j41(0,"p"),t.EFF(1),t.nI1(2,"translate"),t.k0s()),2&s&&(t.R7$(),t.JRh(t.bMT(2,1,"submission.sections.duplicates.in-workflow")))}function gi(s,m){if(1&s&&(t.j41(0,"div",4)(1,"a",5),t.EFF(2),t.k0s(),t.Z7z(3,Ci,3,4,"div",null,t.fX1),t.DNE(5,Si,3,3,"p")(6,Ei,3,3,"p"),t.k0s()),2&s){const i=m.$implicit,e=t.XpG(3);t.R7$(),t.Y8G("href",e.getItemLink(i.uuid),t.B4B),t.R7$(),t.JRh(i.title),t.R7$(),t.Dyx(e.Metadata.toViewModelList(i.metadata)),t.R7$(2),t.vxM(i.workspaceItemId?5:-1),t.R7$(),t.vxM(i.workflowItemId?6:-1)}}function Di(s,m){if(1&s&&(t.j41(0,"div",3),t.EFF(1),t.nI1(2,"translate"),t.k0s(),t.Z7z(3,gi,7,4,"div",4,t.fX1)),2&s){const i=t.XpG().ngVar;t.R7$(),t.JRh(t.bMT(2,1,"submission.sections.duplicates.detected")),t.R7$(2),t.Dyx(null==i?null:i.potentialDuplicates)}}function Ii(s,m){if(1&s&&(t.j41(0,"div",1),t.DNE(1,bi,3,3,"div",2)(2,Di,5,3),t.k0s()),2&s){const i=m.ngVar;t.R7$(),t.vxM(0===(null==i?null:i.potentialDuplicates.length)?1:-1),t.R7$(),t.vxM((null==i?null:i.potentialDuplicates.length)>0?2:-1)}}let Mi=(()=>{class s extends A{constructor(i,e,o,l,E,M){super(l,E,M),this.translate=i,this.sectionService=e,this.submissionService=o,this.injectedCollectionId=l,this.injectedSectionData=E,this.injectedSubmissionId=M,this.Metadata=hi.O,this.AlertTypeEnum=S.v,this.isLoading=!0,this.subs=[]}ngOnInit(){super.ngOnInit()}onSectionInit(){this.isLoading=!1}isReadOnly(){return!0}onSectionDestroy(){}getSectionStatus(){return(0,y.of)(!this.isLoading)}getDuplicateData(){return this.sectionService.getSectionData(this.submissionId,this.sectionData.id,this.sectionData.sectionType)}getItemLink(i){return new fi.t((0,vi.Fy)(),i).toString()}static{this.\u0275fac=function(e){return new(e||s)(t.rXU(h.c$),t.rXU(H.c),t.rXU(Et.E),t.rXU("collectionIdProvider"),t.rXU("sectionDataProvider"),t.rXU("submissionIdProvider"))}}static{this.\u0275cmp=t.VBU({type:s,selectors:[["ds-submission-section-duplicates"]],standalone:!0,features:[t.Vt3,t.aNF],decls:2,vars:3,consts:[["class","text-sm-start",4,"ngVar"],[1,"text-sm-start"],[1,"alert","alert-success","w-100"],[1,"alert","alert-warning","w-100"],[1,"ds-duplicate"],["target","_blank",3,"href"]],template:function(e,o){1&e&&(t.DNE(0,Ii,3,2,"div",0),t.nI1(1,"async")),2&e&&t.Y8G("ngVar",t.bMT(1,1,o.getDuplicateData()))},dependencies:[C.Jj,h.h,h.D9,ct.r],encapsulation:2})}}return s})();var Ti=n(48376),kt=n.n(Ti),Yt=n(47677),zt=n(78544),Oi=n(81948),yi=n(12384),Fi=n(3601),Pi=n(56327),Ri=n(84821),Bi=n(66903),Jt=n(61989);class xi{constructor(m=null,i=null){this._path=m,this._value=i}get path(){return this._path}set path(m){this._path=m}get value(){return this._value}set value(m){this._value=m}delete(){this._value=null,this._path=null}isPathEqual(m){return this._path&&W()(this._path,m)}}var Ui=n(9847),ji=n(94525),Wt=n(4600);const Ai=["formRef"];function Li(s,m){1&s&&t.nrm(0,"ds-loading",1)}function $i(s,m){if(1&s){const i=t.RV6();t.j41(0,"ds-form",3,0),t.bIt("dfChange",function(o){t.eBV(i);const l=t.XpG();return t.Njj(l.onChange(o))})("dfFocus",function(o){t.eBV(i);const l=t.XpG();return t.Njj(l.onFocus(o))})("remove",function(o){t.eBV(i);const l=t.XpG();return t.Njj(l.onRemove(o))})("ngbEvent",function(o){t.eBV(i);const l=t.XpG();return t.Njj(l.onCustomEvent(o))})("removeArrayItem",function(o){t.eBV(i);const l=t.XpG();return t.Njj(l.onRemove(o))}),t.k0s()}if(2&s){const i=t.XpG();t.Y8G("formId",i.formId)("formModel",i.formModel)("displaySubmit",!1)("displayCancel",!1)}}let Xi=(()=>{class s extends A{constructor(i,e,o,l,E,M,G,Y,ot,dt,pt,gt,at,ut,It){super(at,ut,It),this.cdr=i,this.formBuilderService=e,this.formOperationsService=o,this.formService=l,this.formConfigService=E,this.notificationsService=M,this.sectionService=G,this.submissionService=Y,this.translate=ot,this.submissionObjectService=dt,this.objectCache=pt,this.requestService=gt,this.injectedCollectionId=at,this.injectedSectionData=ut,this.injectedSubmissionId=It,this.isUpdating=!1,this.isLoading=!0,this.fieldsOnTheirWayToBeRemoved=new Map,this.formData=Object.create({}),this.previousValue=new xi,this.subs=[],this.isSectionReadonly=!1}onSectionInit(){this.pathCombiner=new P.S("sections",this.sectionData.id),this.formId=this.formService.getUniqueId(this.sectionData.id),this.sectionService.dispatchSetSectionFormId(this.submissionId,this.sectionData.id,this.formId),this.formConfigService.findByHref(this.sectionData.config).pipe((0,f.T)(i=>i.payload),(0,V.M)(i=>this.formConfig=i),(0,d.Z)(()=>(0,u.z)([this.sectionService.getSectionData(this.submissionId,this.sectionData.id,this.sectionData.sectionType),this.submissionObjectService.findById(this.submissionId,!0,!1,(0,Wt.s)("item")).pipe((0,k.yd)(),(0,k.Bo)()),this.sectionService.isSectionReadOnly(this.submissionId,this.sectionData.id,this.submissionService.getSubmissionScope())])),(0,a.s)(1)).subscribe(([i,e,o])=>{(0,v.b0)(this.formModel)&&(this.submissionObject=e,this.isSectionReadonly=o,this.initForm(i,this.sectionData.errorsToShow,this.sectionData.serverValidationErrors),this.sectionData.data=i,this.subscriptions(),this.isLoading=!1,this.cdr.detectChanges())})}onSectionDestroy(){this.subs.filter(i=>(0,v.a4)(i)).forEach(i=>i.unsubscribe())}getSectionStatus(){const i=this.formService.isValid(this.formId),e=this.sectionService.getSectionServerErrors(this.submissionId,this.sectionData.id).pipe((0,f.T)(o=>(0,v.Im)(o)));return(0,u.z)([i,e]).pipe((0,f.T)(([o,l])=>o&&l))}hasMetadataEnrichment(i){const e={};Object.keys(i).forEach(E=>{this.inCurrentSubmissionScope(E)&&(e[E]=i[E])});const o=[],l=(0,ji.iv)(e,this.formData);return Object.keys(l).forEach(E=>{l[E].forEach(M=>{M.hasOwnProperty("value")&&kt()(this.formData[E],{value:M.value})<0&&o.push(M)})}),(0,v.hj)(o)}inCurrentSubmissionScope(i){switch(this.formConfig?.rows.find(o=>o.fields?.[0]?.selectableMetadata?o.fields?.[0]?.selectableMetadata?.[0]?.metadata===i:!!o.fields?.[0]?.selectableRelationship&&o.fields?.[0]?.selectableRelationship.relationshipType===i.replace(/^relationship\./g,""))?.fields?.[0]?.scope){case Jt.L.WorkspaceItem.valueOf():return this.submissionObject.type===Ri.F.type.value;case Jt.L.WorkflowItem.valueOf():return this.submissionObject.type===Pi.t.type.value;default:return!0}}initForm(i,e,o){try{this.formModel=this.formBuilderService.modelFromConfiguration(this.submissionId,this.formConfig,this.collectionId,i,this.submissionService.getSubmissionScope(),this.isSectionReadonly);const l=this.sectionService.computeSectionConfiguredMetadata(this.formConfig);this.sectionService.updateSectionData(this.submissionId,this.sectionData.id,i,e,o,l)}catch(l){const M={message:this.translate.instant("error.submission.sections.init-form-error")+l.toString(),path:"/sections/"+this.sectionData.id};l instanceof Error&&console.error(l.stack),this.sectionService.setSectionError(this.submissionId,this.sectionData.id,M)}}updateForm(i){const e=i.data,o=i.errorsToShow;(0,v.hj)(e)&&!W()(e,this.sectionData.data)?(this.sectionData.data=e,this.hasMetadataEnrichment(e)?(this.isUpdating=!0,this.formModel=null,this.cdr.detectChanges(),this.initForm(e,o,i.serverValidationErrors),this.checksForErrors(o),this.isUpdating=!1,this.cdr.detectChanges()):((0,v.hj)(o)||(0,v.hj)(this.sectionData.errorsToShow))&&this.checksForErrors(o)):((0,v.hj)(o)||(0,v.hj)(this.sectionData.errorsToShow))&&this.checksForErrors(o)}checksForErrors(i){this.formService.isFormInitialized(this.formId).pipe((0,Yt.I)(e=>!0===e&&!this.isUpdating)).subscribe(()=>{this.sectionService.checkSectionErrors(this.submissionId,this.sectionData.id,this.formId,i,this.sectionData.errorsToShow),this.sectionData.errorsToShow=i,this.cdr.detectChanges()})}subscriptions(){this.subs.push(this.formService.getFormData(this.formId).pipe((0,vt.F)()).subscribe(i=>{this.formData=i}),this.sectionService.getSectionState(this.submissionId,this.sectionData.id,this.sectionData.sectionType).pipe((0,_.p)(i=>(0,v.hj)(i)&&((0,v.hj)(i.data)||(0,v.hj)(i.errorsToShow))),(0,vt.F)()).subscribe(i=>{this.fieldsOnTheirWayToBeRemoved=new Map,this.sectionMetadata=i.metadata,this.updateForm(i)}))}onChange(i){this.formOperationsService.dispatchOperationsFromEvent(this.pathCombiner,i,this.previousValue,this.hasStoredValue(this.formBuilderService.getId(i.model),this.formOperationsService.getArrayIndexFromEvent(i)));const e=this.formOperationsService.getFieldPathSegmentedFromChangeEvent(i),o=this.formOperationsService.getFieldValueFromChangeEvent(i);(-1!==zt.c.submission.autosave.metadata.indexOf(e)&&(0,v.hj)(o)||this.hasRelatedCustomError(e))&&this.submissionService.dispatchSave(this.submissionId)}hasRelatedCustomError(i){const e=kt()(this.sectionData.errorsToShow,{path:this.pathCombiner.getPath(i).path});if(-1!==e){const l=this.sectionData.errorsToShow[e].message.replace("error.validation.","");return!zt.c.form.validatorMap.hasOwnProperty(l)}return!1}onFocus(i){const e=this.formOperationsService.getFieldValueFromChangeEvent(i),o=this.formBuilderService.getPath(i.model);this.formBuilderService.hasMappedGroupValue(i.model)?(this.previousValue.path=o,this.previousValue.value=this.formOperationsService.getQualdropValueMap(i)):(0,v.hj)(e)&&("object"==typeof e&&(0,v.hj)(e.value)||"string"==typeof e)&&(this.previousValue.path=o,this.previousValue.value=e)}onRemove(i){const e=this.formBuilderService.getId(i.model),o=this.formOperationsService.getArrayIndexFromEvent(i);if(this.fieldsOnTheirWayToBeRemoved.has(e)){const l=this.fieldsOnTheirWayToBeRemoved.get(e);l.push(o),this.fieldsOnTheirWayToBeRemoved.set(e,l)}else this.fieldsOnTheirWayToBeRemoved.set(e,[o]);this.formOperationsService.dispatchOperationsFromEvent(this.pathCombiner,i,this.previousValue,this.hasStoredValue(e,o))}hasStoredValue(i,e){return!!(0,v.hj)(this.sectionData.data)&&this.sectionData.data.hasOwnProperty(i)&&(0,v.hj)(this.sectionData.data[i][e])&&!this.isFieldToRemove(i,e)}isFieldToRemove(i,e){return this.fieldsOnTheirWayToBeRemoved.has(i)&&this.fieldsOnTheirWayToBeRemoved.get(i).includes(e)}onCustomEvent(i){this.formOperationsService.dispatchOperationsFromEvent(this.pathCombiner,i,this.previousValue,null)}static{this.\u0275fac=function(e){return new(e||s)(t.rXU(t.gRc),t.rXU(F.j),t.rXU(Z),t.rXU(L.u),t.rXU(yi.SubmissionFormsConfigDataService),t.rXU(Ui.I),t.rXU(H.c),t.rXU(Et.E),t.rXU(h.c$),t.rXU(Bi.$),t.rXU(Oi.$),t.rXU(Fi.B),t.rXU("collectionIdProvider"),t.rXU("sectionDataProvider"),t.rXU("submissionIdProvider"))}}static{this.\u0275cmp=t.VBU({type:s,selectors:[["ds-submission-section-form"]],viewQuery:function(e,o){if(1&e&&t.GBs(Ai,5),2&e){let l;t.mGM(l=t.lsd())&&(o.formRef=l.first)}},standalone:!0,features:[t.Vt3,t.aNF],decls:2,vars:2,consts:[["formRef","formComponent"],["message","Loading..."],[3,"formId","formModel","displaySubmit","displayCancel"],[3,"dfChange","dfFocus","remove","ngbEvent","removeArrayItem","formId","formModel","displaySubmit","displayCancel"]],template:function(e,o){1&e&&t.DNE(0,Li,1,0,"ds-loading",1)(1,$i,2,4,"ds-form",2),2&e&&(t.vxM(o.isLoading?0:-1),t.R7$(),t.vxM(!o.isLoading&&o.formModel?1:-1))},dependencies:[B.s,yt.v]})}}return s})();function Ni(s,m){if(1&s&&(t.j41(0,"li"),t.EFF(1),t.nI1(2,"translate"),t.k0s()),2&s){const i=t.XpG().$implicit;t.R7$(),t.Lme("",t.bMT(2,2,"submission.sections.identifiers."+i.identifierType+"_label")," ",i.value,"")}}function Gi(s,m){if(1&s&&t.DNE(0,Ni,3,4,"li"),2&s){const i=m.$implicit;t.XpG(2);const e=t.r8f(0);t.vxM(e.displayTypes.includes(i.identifierType)&&i.value?0:-1)}}function Ki(s,m){if(1&s&&(t.j41(0,"div")(1,"span"),t.EFF(2),t.nI1(3,"translate"),t.k0s(),t.j41(4,"ul"),t.Z7z(5,Gi,1,1,null,null,t.fX1),t.k0s()()),2&s){t.XpG();const i=t.r8f(0);t.R7$(2),t.JRh(t.bMT(3,1,"submission.sections.identifiers.info")),t.R7$(3),t.Dyx(i.identifiers)}}let Vi=(()=>{class s extends A{constructor(i,e,o,l,E,M){super(l,E,M),this.translate=i,this.sectionService=e,this.submissionService=o,this.injectedCollectionId=l,this.injectedSectionData=E,this.injectedSubmissionId=M,this.isLoading=!0}onSectionInit(){this.isLoading=!1,this.identifierData$=this.getIdentifierData()}onSectionDestroy(){}getSectionStatus(){return(0,y.of)(!this.isLoading)}getIdentifierData(){return this.sectionService.getSectionData(this.submissionId,this.sectionData.id,this.sectionData.sectionType)}static{this.\u0275fac=function(e){return new(e||s)(t.rXU(h.c$),t.rXU(H.c),t.rXU(Et.E),t.rXU("collectionIdProvider"),t.rXU("sectionDataProvider"),t.rXU("submissionIdProvider"))}}static{this.\u0275cmp=t.VBU({type:s,selectors:[["ds-submission-section-identifiers"]],standalone:!0,features:[t.Vt3,t.aNF],decls:3,vars:4,template:function(e,o){if(1&e&&(t.SS7(0),t.nI1(1,"async"),t.DNE(2,Ki,7,3,"div")),2&e){const l=t.bH3(t.bMT(1,1,o.identifierData$));t.R7$(2),t.vxM(l&&l.identifiers?2:-1)}},dependencies:[C.Jj,h.h,h.D9],encapsulation:2})}}return s})();var Ht=n(69295);const Wi={granted:{element:{container:"custom-control custom-checkbox ps-1",control:"custom-control-input",label:"custom-control-label pt-1"}}},ki=[{id:"granted",label:"submission.sections.license.granted-label",required:!0,value:!1,validators:{required:null},errorMessages:{required:"submission.sections.license.required",notgranted:"submission.sections.license.notgranted"},type:"CHECKBOX"}],Yi=["formRef"];function zi(s,m){if(1&s){const i=t.RV6();t.j41(0,"ds-form",3,0),t.bIt("dfChange",function(o){t.eBV(i);const l=t.XpG();return t.Njj(l.onChange(o))}),t.k0s()}if(2&s){const i=t.XpG();t.Y8G("formId",i.formId)("formModel",i.formModel)("formLayout",i.formLayout)("displaySubmit",i.displaySubmit)("displayCancel",!1)}}let Ji=(()=>{class s extends A{constructor(i,e,o,l,E,M,G,Y,ot,dt,pt,gt){super(dt,pt,gt),this.changeDetectorRef=i,this.collectionDataService=e,this.formBuilderService=o,this.formOperationsService=l,this.formService=E,this.operationsBuilder=M,this.sectionService=G,this.submissionService=Y,this.translateService=ot,this.injectedCollectionId=dt,this.injectedSectionData=pt,this.injectedSubmissionId=gt,this.formLayout=Wi,this.displaySubmit=!1,this.subs=[]}onSectionInit(){this.pathCombiner=new P.S("sections",this.sectionData.id),this.formId=this.formService.getUniqueId(this.sectionData.id),this.formModel=this.formBuilderService.fromJSON(ki);const i=this.formBuilderService.findById("granted",this.formModel);i.label&&(i.label=this.translateService.instant(i.label)),i.value=this.sectionData.data.granted,this.licenseText$=this.collectionDataService.findById(this.collectionId,!0,!0,(0,Wt.s)("license")).pipe((0,_.p)(e=>(0,v.EA)(e.payload)),(0,d.Z)(e=>e.payload.license),(0,Yt.I)(e=>(0,v.EA)(e.payload)),(0,f.T)(e=>e.payload.text),(0,rt.Z)("")),this.subs.push(this.sectionService.isSectionReadOnly(this.submissionId,this.sectionData.id,this.submissionService.getSubmissionScope()).pipe((0,a.s)(1),(0,_.p)(e=>e)).subscribe(()=>{i.disabled=!0}),this.sectionService.getSectionErrors(this.submissionId,this.sectionData.id).pipe((0,_.p)(e=>(0,v.hj)(e)),(0,vt.F)()).subscribe(e=>{const o=e.map(l=>"/sections/license"===l.path?i.checked?null:Object.assign({},l,{path:"/sections/license/granted"}):l).filter(l=>(0,v.Pe)(l));(0,v.hj)(o)?(this.sectionService.checkSectionErrors(this.submissionId,this.sectionData.id,this.formId,o),this.sectionData.errors=e):this.sectionService.dispatchRemoveSectionErrors(this.submissionId,this.sectionData.id)}))}ngAfterViewChecked(){this.changeDetectorRef.detectChanges()}getSectionStatus(){const i=this.formBuilderService.findById("granted",this.formModel);return i.valueChanges.pipe((0,f.T)(e=>!0===e),(0,rt.Z)(i.value))}onChange(i){const e=this.formOperationsService.getFieldPathSegmentedFromChangeEvent(i),o=this.formOperationsService.getFieldValueFromChangeEvent(i);o?(this.operationsBuilder.add(this.pathCombiner.getPath(e),o.value.toString(),!1,!0),this.sectionService.dispatchRemoveSectionErrors(this.submissionId,this.sectionData.id)):this.operationsBuilder.remove(this.pathCombiner.getPath(e)),this.submissionService.dispatchSaveSection(this.submissionId,this.sectionData.id)}onSectionDestroy(){this.subs.filter(i=>(0,v.a4)(i)).forEach(i=>i.unsubscribe())}static{this.\u0275fac=function(e){return new(e||s)(t.rXU(t.gRc),t.rXU(Ht.CollectionDataService),t.rXU(F.j),t.rXU(Z),t.rXU(L.u),t.rXU(j.C),t.rXU(H.c),t.rXU(Et.E),t.rXU(h.c$),t.rXU("collectionIdProvider"),t.rXU("sectionDataProvider"),t.rXU("submissionIdProvider"))}}static{this.\u0275cmp=t.VBU({type:s,selectors:[["ds-submission-section-license"]],viewQuery:function(e,o){if(1&e&&t.GBs(Yi,5),2&e){let l;t.mGM(l=t.lsd())&&(o.formRef=l.first)}},standalone:!0,features:[t.Jv_([]),t.Vt3,t.aNF],decls:5,vars:4,consts:[["formRef","formComponent"],[1,"mb-5","preserve-line-breaks",3,"innerHTML"],[3,"formId","formModel","formLayout","displaySubmit","displayCancel"],[3,"dfChange","formId","formModel","formLayout","displaySubmit","displayCancel"]],template:function(e,o){1&e&&(t.nrm(0,"span",1),t.nI1(1,"async"),t.nrm(2,"br")(3,"br"),t.DNE(4,zi,2,5,"ds-form",2)),2&e&&(t.Y8G("innerHTML",t.bMT(1,2,o.licenseText$),t.npT),t.R7$(4),t.vxM(o.formModel?4:-1))},dependencies:[C.Jj,B.s]})}}return s})();var Hi=n(43374),wi=n(49832);const Qi=s=>({"border-danger":s}),Zi=s=>({"bg-light":s}),qi=s=>({pattern:s});function te(s,m){1&s&&(t.j41(0,"button",11),t.EFF(1),t.nI1(2,"translate"),t.k0s()),2&s&&(t.R7$(),t.SpI(" ",t.bMT(2,1,"submission.section.section-coar-notify.dropdown.no-data")," "))}function ie(s,m){if(1&s){const i=t.RV6();t.j41(0,"button",17),t.bIt("click",function(){t.eBV(i);const o=t.XpG().$index,l=t.XpG(3).$implicit,E=t.XpG(2);return t.Njj(E.onChange(l.pattern,o,null))}),t.EFF(1),t.nI1(2,"translate"),t.k0s()}2&s&&(t.R7$(),t.SpI(" ",t.bMT(2,1,"submission.section.section-coar-notify.dropdown.select-none")," "))}function ee(s,m){if(1&s){const i=t.RV6();t.j41(0,"button",18),t.bIt("click",function(){const o=t.eBV(i).$implicit,l=t.XpG().$index,E=t.XpG(3).$implicit,M=t.XpG(2);return t.Njj(M.onChange(E.pattern,l,o))}),t.j41(1,"b"),t.EFF(2),t.k0s(),t.nrm(3,"br"),t.EFF(4),t.k0s()}if(2&s){const i=m.$implicit,e=t.XpG().$index,o=t.XpG(3).$implicit,l=t.XpG(2);t.Y8G("ngClass",t.eq3(3,Zi,(null==l.ldnServiceByPattern[o.pattern].services[e]?null:l.ldnServiceByPattern[o.pattern].services[e].id)===i.id)),t.R7$(2),t.SpI(" ",i.name," "),t.R7$(2),t.SpI(" ",i.description," ")}}function ne(s,m){if(1&s){const i=t.RV6();t.j41(0,"button",19),t.nI1(1,"translate"),t.nI1(2,"translate"),t.bIt("click",function(){t.eBV(i);const o=t.XpG().$index,l=t.XpG(3).$implicit,E=t.XpG(2);return t.Njj(E.removeService(l,o))}),t.j41(3,"span"),t.nrm(4,"i",20),t.k0s()()}if(2&s){const i=t.XpG().$index;t.AVh("mt-2",i>0),t.FS9("title",t.bMT(1,4,"form.remove")),t.BMQ("aria-label",t.bMT(2,6,"form.remove"))}}function se(s,m){if(1&s&&(t.j41(0,"small",14),t.EFF(1),t.nI1(2,"translate"),t.k0s()),2&s){const i=t.XpG(4).$implicit;t.R7$(),t.SpI(" ",t.i5U(2,1,"submission.section.section-coar-notify.small.notification",t.eq3(4,qi,i.pattern))," ")}}function oe(s,m){if(1&s&&(t.j41(0,"small",21),t.EFF(1),t.nI1(2,"translate"),t.k0s()),2&s){const i=m.$implicit;t.R7$(),t.SpI(" ",t.bMT(2,1,i.message)," ")}}function ae(s,m){if(1&s&&(t.Z7z(0,oe,3,3,"small",21,t.fX1),t.nI1(2,"async")),2&s){const i=t.XpG().$index,e=t.XpG(3).$implicit,o=t.XpG(2);t.Dyx(t.bMT(2,0,o.getShownSectionErrors$(e.pattern,i)))}}function re(s,m){if(1&s&&(t.j41(0,"div"),t.EFF(1),t.k0s()),2&s){const i=t.XpG(2).$index,e=t.XpG(3).$implicit,o=t.XpG(2);t.R7$(),t.SpI(" ",o.ldnServiceByPattern[e.pattern].services[i].description," ")}}function ce(s,m){1&s&&(t.j41(0,"span",25),t.EFF(1),t.nI1(2,"translate"),t.k0s()),2&s&&(t.R7$(),t.SpI(" ",t.bMT(2,1,"submission.section.section-coar-notify.selection.no-description")," "))}function le(s,m){if(1&s&&(t.j41(0,"div",15)(1,"div",22),t.nrm(2,"i",23),t.j41(3,"div",24)(4,"div"),t.EFF(5),t.nI1(6,"translate"),t.k0s(),t.DNE(7,re,2,1,"div")(8,ce,3,3,"span",25),t.k0s()()()),2&s){const i=t.XpG().$index,e=t.XpG(3).$implicit,o=t.XpG(2);t.R7$(5),t.JRh(t.bMT(6,2,"submission.section.section-coar-notify.selection.description")),t.R7$(2),t.vxM(null!=o.ldnServiceByPattern[e.pattern].services[i]&&o.ldnServiceByPattern[e.pattern].services[i].description?7:8)}}function de(s,m){1&s&&(t.j41(0,"div",4)(1,"div",26)(2,"div",24)(3,"span"),t.EFF(4),t.nI1(5,"translate"),t.k0s()()()()),2&s&&(t.R7$(4),t.SpI(" ",t.bMT(5,1,"submission.section.section-coar-notify.notification.error")," "))}function me(s,m){if(1&s){const i=t.RV6();t.j41(0,"div",27),t.bIt("click",function(){t.eBV(i);const o=t.XpG(4).$implicit,l=t.XpG(2);return t.Njj(l.addNewService(o))}),t.nrm(1,"i",28),t.EFF(2),t.nI1(3,"translate"),t.k0s()}2&s&&(t.R7$(2),t.SpI(" ",t.bMT(3,1,"submission.sections.general.add-more")," "))}function ue(s,m){if(1&s){const i=t.RV6();t.j41(0,"div")(1,"div",4)(2,"div",5,0)(4,"div",6),t.nrm(5,"i",7),t.j41(6,"input",8),t.nI1(7,"async"),t.bIt("click",function(){t.eBV(i);const o=t.sdS(3);return t.Njj(o.open())}),t.k0s()(),t.j41(8,"div",9)(9,"div",10),t.DNE(10,te,3,3,"button",11),t.nI1(11,"async"),t.DNE(12,ie,3,3,"button",11),t.nI1(13,"async"),t.Z7z(14,ee,5,5,"button",12,t.fX1),t.nI1(16,"async"),t.k0s()()(),t.DNE(17,ne,5,8,"button",13),t.k0s(),t.DNE(18,se,3,6,"small",14)(19,ae,3,2),t.nI1(20,"async"),t.DNE(21,le,9,4,"div",15)(22,de,6,3,"div",4),t.nI1(23,"async"),t.j41(24,"div",4),t.DNE(25,me,4,3,"div",16),t.k0s()()}if(2&s){let i,e,o,l,E;const M=m.$index,G=t.XpG(3).$implicit,Y=t.XpG(2);t.R7$(2),t.AVh("mt-2",M>0),t.R7$(2),t.BMQ("aria-label",G.pattern+".dropdown"),t.R7$(2),t.Y8G("readonly",!0)("ngClass",t.eq3(30,Qi,(null==(i=t.bMT(7,18,Y.getShownSectionErrors$(G.pattern,M)))?null:i.length)>0))("value",null==Y.ldnServiceByPattern[G.pattern].services[M]?null:Y.ldnServiceByPattern[G.pattern].services[M].name),t.BMQ("aria-label",G.pattern+".dropdownanchor"),t.R7$(3),t.Y8G("infiniteScrollDistance",2)("infiniteScrollThrottle",50)("scrollWindow",!1),t.R7$(),t.vxM(0===(null==(e=t.bMT(11,20,Y.filterServices(G.pattern)))?null:e.length)?10:-1),t.R7$(2),t.vxM((null==(o=t.bMT(13,22,Y.filterServices(G.pattern)))?null:o.length)>0?12:-1),t.R7$(2),t.Dyx(t.bMT(16,24,Y.filterServices(G.pattern))),t.R7$(3),t.vxM(Y.ldnServiceByPattern[G.pattern].services.length>1?17:-1),t.R7$(),t.vxM(Y.ldnServiceByPattern[G.pattern].services[M]||M!==Y.ldnServiceByPattern[G.pattern].services.length-1?-1:18),t.R7$(),t.vxM((null==(l=t.bMT(20,26,Y.getShownSectionErrors$(G.pattern,M)))?null:l.length)>0?19:-1),t.R7$(2),t.vxM(Y.ldnServiceByPattern[G.pattern].services[M]?21:-1),t.R7$(),t.vxM((null==(E=t.bMT(23,28,Y.getShownSectionErrors$(G.pattern,M)))?null:E.length)>0?22:-1),t.R7$(3),t.vxM(G.multipleRequest&&M===Y.ldnServiceByPattern[G.pattern].services.length-1?25:-1)}}function pe(s,m){if(1&s&&(t.j41(0,"div"),t.Z7z(1,ue,26,32,"div",null,t.fX1),t.k0s()),2&s){const i=t.XpG(2).$implicit,e=t.XpG(2);t.R7$(),t.Dyx(e.ldnServiceByPattern[i.pattern].services)}}function _e(s,m){if(1&s&&(t.j41(0,"div")(1,"label",3),t.EFF(2),t.nI1(3,"translate"),t.k0s(),t.DNE(4,pe,3,0,"div"),t.k0s()),2&s){const i=t.XpG().$implicit,e=t.XpG(2);t.R7$(2),t.SpI(" ",t.bMT(3,2,"submission.section.section-coar-notify.control."+i.pattern+".label")," "),t.R7$(2),t.vxM(null!=e.ldnServiceByPattern[i.pattern]&&e.ldnServiceByPattern[i.pattern].services.length?4:-1)}}function he(s,m){if(1&s&&(t.j41(0,"div",2),t.DNE(1,_e,5,4,"div"),t.nI1(2,"async"),t.k0s()),2&s){let i;const e=m.$implicit,o=t.XpG(2);t.R7$(),t.vxM((null==(i=t.bMT(2,1,o.filterServices(e.pattern)))?null:i.length)>0?1:-1)}}function fe(s,m){if(1&s&&t.Z7z(0,he,3,3,"div",2,t.fX1),2&s){const i=t.XpG();t.Dyx(i.patterns)}}function ve(s,m){1&s&&(t.j41(0,"p"),t.EFF(1),t.nI1(2,"translate"),t.k0s()),2&s&&(t.R7$(),t.SpI(" ",t.bMT(2,1,"submission.section.section-coar-notify.info.no-pattern")," "))}let be=(()=>{class s extends A{constructor(i,e,o,l,E,M,G,Y){super(M,G,Y),this.ldnServicesService=i,this.operationsBuilder=e,this.sectionService=o,this.coarNotifyConfigDataService=l,this.chd=E,this.injectedCollectionId=M,this.injectedSectionData=G,this.injectedSubmissionId=Y,this.hasSectionData=!1,this.patterns=[],this.ldnServiceByPattern={},this.previousServices={},this.fieldsOnTheirWayToBeRemoved=new Map,this.subs=[],this.filteredServicesByPattern={}}onSectionInit(){this.setCoarNotifyConfig(),this.getSectionServerErrorsAndSetErrorsToDisplay(),this.pathCombiner=new P.S("sections",this.sectionData.id)}setCoarNotifyConfig(){this.subs.push(this.coarNotifyConfigDataService.findAll().pipe((0,k.qD)()).subscribe(i=>{i.hasSucceeded&&(this.patterns=i.payload.page[0].patterns,this.initSelectedServicesByPattern())}))}onChange(i,e,o){if(this.ldnServiceByPattern[i].services[e]?.id===o?.id)return;this.previousServices[i]||(this.previousServices[i]={services:[],allowsMultipleRequests:this.patterns.find(E=>E.pattern===i)?.multipleRequest}),this.previousServices[i].services[e]=this.ldnServiceByPattern[i].services[e],this.ldnServiceByPattern[i].services[e]=o;const l=(0,v.a4)(this.previousServices[i].services[e])&&this.previousServices[i].services[e].id!==o?.id;l&&(this.operationsBuilder.flushOperation(this.pathCombiner.getPath([i,"-"])),this.filteredServicesByPattern[i]?.includes(this.previousServices[i].services[e])&&this.operationsBuilder.remove(this.pathCombiner.getPath([i,e.toString()]))),(!l||o?.id&&l)&&this.operationsBuilder.add(this.pathCombiner.getPath([i,"-"]),[o.id],!1,!0),this.previousServices[i].services[e]=this.ldnServiceByPattern[i].services[e],this.sectionService.dispatchRemoveSectionErrors(this.submissionId,this.sectionData.id),this.chd.detectChanges()}initSelectedServicesByPattern(){this.patterns.forEach(i=>{(0,v.a4)(this.sectionData.data[i.pattern])?this.subs.push(this.filterServices(i.pattern).subscribe(e=>{this.ldnServiceByPattern[i.pattern]||(this.ldnServiceByPattern[i.pattern]={services:[],allowsMultipleRequests:i.multipleRequest}),this.ldnServiceByPattern[i.pattern].services=e.filter(o=>{const l=this.sectionData.data[i.pattern].find(E=>E.id===o.id);return this.addService(i,l),this.sectionData.data[i.pattern].includes(o.uuid)})})):(this.ldnServiceByPattern[i.pattern]={services:[],allowsMultipleRequests:i.multipleRequest},this.addService(i,null))})}addService(i,e){this.ldnServiceByPattern[i.pattern]||(this.ldnServiceByPattern[i.pattern]={services:[],allowsMultipleRequests:i.multipleRequest}),this.ldnServiceByPattern[i.pattern].services.push(e)}removeService(i,e){this.ldnServiceByPattern[i.pattern]&&(this.ldnServiceByPattern[i.pattern].services.splice(e,1),this.previousServices[i.pattern]?.services.splice(e,1),this.operationsBuilder.flushOperation(this.pathCombiner.getPath([i.pattern,"-"])),this.sectionService.dispatchRemoveSectionErrors(this.submissionId,this.sectionData.id)),this.ldnServiceByPattern[i.pattern].services.length||this.addNewService(i)}filterServices(i){return this.ldnServicesService.findByInboundPattern(i).pipe((0,k.qD)(),(0,V.M)(e=>{if(e.hasFailed)throw new Error(`Failed to retrieve services for pattern ${i}`)}),(0,_.p)(e=>e.hasSucceeded),(0,k.Bo)(),(0,k.W8)(),(0,V.M)(e=>{this.filteredServicesByPattern[i]||(this.filteredServicesByPattern[i]=[]),0===this.filteredServicesByPattern[i].length&&this.filteredServicesByPattern[i].push(...e)}),(0,f.T)(e=>e.filter(o=>(this.hasSectionData||(this.hasSectionData=this.hasInboundPattern(o,i)),this.hasInboundPattern(o,i)))))}hasInboundPattern(i,e){return i.notifyServiceInboundPatterns.some(o=>o.pattern===e)}getSectionServerErrorsAndSetErrorsToDisplay(){this.subs.push(this.sectionService.getSectionServerErrors(this.submissionId,this.sectionData.id).pipe((0,a.s)(1),(0,_.p)(i=>(0,v.hj)(i))).subscribe(i=>{(0,v.hj)(i)&&i.forEach(e=>{this.sectionService.setSectionError(this.submissionId,this.sectionData.id,e)})}))}getShownSectionErrors$(i,e){return this.sectionService.getShownSectionErrors(this.submissionId,this.sectionData.id,this.sectionData.sectionType).pipe((0,a.s)(1),(0,_.p)(o=>(0,v.hj)(o)),(0,f.T)(o=>o.filter(l=>l.path.includes(`${i}/${e}`))))}getSectionStatus(){return this.sectionService.getSectionServerErrors(this.submissionId,this.sectionData.id).pipe((0,f.T)(i=>(0,v.Im)(i)))}onSectionDestroy(){this.subs.filter(i=>(0,v.a4)(i)).forEach(i=>i.unsubscribe())}addNewService(i){this.ldnServiceByPattern[i.pattern].services.push(null)}static{this.\u0275fac=function(e){return new(e||s)(t.rXU(Hi.LdnServicesService),t.rXU(j.C),t.rXU(H.c),t.rXU(wi.CoarNotifyConfigDataService),t.rXU(t.gRc),t.rXU("collectionIdProvider"),t.rXU("sectionDataProvider"),t.rXU("submissionIdProvider"))}}static{this.\u0275cmp=t.VBU({type:s,selectors:[["ds-submission-section-coar-notify"]],standalone:!0,features:[t.Jv_([p.tg]),t.Vt3,t.aNF],decls:3,vars:2,consts:[["myDropdown","ngbDropdown"],[1,"container-fluid"],[1,"col"],[1,"row","col-form-label"],[1,"row"],["ngbDropdown","",1,"flex-grow-1"],[1,"position-relative","right-addon"],["ngbDropdownToggle","","aria-hidden","true",1,"position-absolute","scrollable-dropdown-toggle"],["type","text",1,"form-control","w-100","scrollable-dropdown-input",3,"click","readonly","ngClass","value"],["ngbDropdownMenu","","aria-haspopup","true","aria-expanded","false",1,"dropdown-menu","scrollable-dropdown-menu","w-100"],["role","listbox","infiniteScroll","",1,"scrollable-menu",3,"infiniteScrollDistance","infiniteScrollThrottle","scrollWindow"],[1,"dropdown-item","collection-item","text-truncate","w-100"],[1,"dropdown-item","collection-item","text-truncate","w-100",3,"ngClass"],["type","button","role","button",1,"btn","btn-secondary","ms-2",3,"mt-2","title"],[1,"row","text-muted"],[1,"row","mt-1"],[1,"btn","btn-link","mt-2","ps-0"],[1,"dropdown-item","collection-item","text-truncate","w-100",3,"click"],[1,"dropdown-item","collection-item","text-truncate","w-100",3,"click","ngClass"],["type","button","role","button",1,"btn","btn-secondary","ms-2",3,"click","title"],["aria-hidden","true",1,"fas","fa-trash"],[1,"row","text-danger"],[1,"alert","alert-info","w-100","d-flex","align-items-center","flex-row"],[1,"fa-solid","fa-circle-info","fa-xl","ms-2"],[1,"ms-4"],[1,"text-muted"],[1,"alert","alert-danger","w-100","d-flex","align-items-center","flex-row"],[1,"btn","btn-link","mt-2","ps-0",3,"click"],[1,"fas","fa-plus"]],template:function(e,o){1&e&&(t.j41(0,"div",1),t.DNE(1,fe,2,0)(2,ve,3,3,"p"),t.k0s()),2&e&&(t.R7$(),t.vxM((null==o.patterns?null:o.patterns.length)>0?1:-1),t.R7$(),t.vxM(o.hasSectionData?-1:2))},dependencies:[C.Jj,w.e,w.D,p.zH,p.tg,p.do,p.U0,C.YU,h.h,h.D9],styles:[".scrollable-menu[_ngcontent-%COMP%]{height:auto;max-height:var(--ds-dropdown-menu-max-height);overflow-x:hidden}.collection-item[_ngcontent-%COMP%]{border-bottom:var(--bs-dropdown-border-width) solid var(--bs-dropdown-border-color)}.scrollable-dropdown-loading[_ngcontent-%COMP%]{background-color:var(--bs-primary);color:#fff;height:calc(var(--bs-spacer) * 2)!important;line-height:calc(var(--bs-spacer) * 2);position:sticky;bottom:0}.scrollable-dropdown-menu[_ngcontent-%COMP%]{left:0!important;margin-bottom:var(--bs-spacer);z-index:1000}.scrollable-dropdown-toggle[_ngcontent-%COMP%], .toggle-icon[_ngcontent-%COMP%]{padding:.7rem .7rem 0}.ds-form-input-addon[_ngcontent-%COMP%]{border-top-right-radius:0!important;border-bottom-right-radius:0!important;border-right:0!important}.ds-form-input-btn[_ngcontent-%COMP%]{border:var(--bs-input-btn-border-width) solid var(--bs-input-border-color);border-top-left-radius:0;border-bottom-left-radius:0;border-left:0}.ds-form-input-btn[_ngcontent-%COMP%]:focus{box-shadow:none!important}button.ds-form-add-more[_ngcontent-%COMP%]:focus{outline:none;box-shadow:none!important}.ds-form-input-value[_ngcontent-%COMP%]{border-top-left-radius:0!important;border-bottom-left-radius:0!important}.fa-spin[_ngcontent-%COMP%]{pointer-events:none}.left-addon[_ngcontent-%COMP%]   .far[_ngcontent-%COMP%], .left-addon[_ngcontent-%COMP%]   .fas[_ngcontent-%COMP%], .left-addon[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{left:0}.right-addon[_ngcontent-%COMP%]   .far[_ngcontent-%COMP%], .right-addon[_ngcontent-%COMP%]   .fas[_ngcontent-%COMP%], .right-addon[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{right:0}.left-addon[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{padding-left:calc(var(--bs-spacer) * 2.25)}.right-addon[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{padding-right:calc(var(--bs-spacer) * 2.25)}select.form-control[_ngcontent-%COMP%]{appearance:auto}.col-sm-6[_ngcontent-%COMP%], .col-sm-12[_ngcontent-%COMP%]{padding-left:15px;padding-right:15px}"]})}}return s})();var wt=n(84412);function Ce(s,m){if(1&s&&(t.j41(0,"div",1)(1,"div",2)(2,"p",3),t.EFF(3),t.nI1(4,"translate"),t.k0s()(),t.j41(5,"div",4)(6,"p",3),t.EFF(7),t.k0s()()()),2&s){const i=t.XpG();t.R7$(3),t.JRh(t.bMT(4,2,"submission.sections.sherpa.record.information.id")),t.R7$(4),t.SpI("",i.metadata.id," ")}}function Se(s,m){if(1&s&&(t.j41(0,"div",1)(1,"div",2)(2,"p",3),t.EFF(3),t.nI1(4,"translate"),t.k0s()(),t.j41(5,"div",4)(6,"p",3),t.EFF(7),t.nI1(8,"date"),t.k0s()()()),2&s){const i=t.XpG();t.R7$(3),t.JRh(t.bMT(4,2,"submission.sections.sherpa.record.information.date.created")),t.R7$(4),t.SpI("",t.i5U(8,4,i.metadata.dateCreated,"d MMMM Y H:mm:ss zzzz")," ")}}function Ee(s,m){if(1&s&&(t.j41(0,"div",1)(1,"div",2)(2,"p",3),t.EFF(3),t.nI1(4,"translate"),t.k0s()(),t.j41(5,"div",4)(6,"p",3),t.EFF(7),t.nI1(8,"date"),t.k0s()()()),2&s){const i=t.XpG();t.R7$(3),t.JRh(t.bMT(4,2,"submission.sections.sherpa.record.information.date.modified")),t.R7$(4),t.SpI("",t.i5U(8,4,i.metadata.dateModified,"d MMMM Y H:mm:ss zzzz")," ")}}function ge(s,m){if(1&s&&(t.j41(0,"div",1)(1,"div",2)(2,"p",3),t.EFF(3),t.nI1(4,"translate"),t.k0s()(),t.j41(5,"div",4)(6,"p",3)(7,"a",5),t.EFF(8),t.k0s()()()()),2&s){const i=t.XpG();t.R7$(3),t.JRh(t.bMT(4,3,"submission.sections.sherpa.record.information.uri")),t.R7$(4),t.Y8G("href",i.metadata.uri,t.B4B),t.R7$(),t.JRh(i.metadata.uri)}}let De=(()=>{class s{static{this.\u0275fac=function(e){return new(e||s)}}static{this.\u0275cmp=t.VBU({type:s,selectors:[["ds-metadata-information"]],inputs:{metadata:"metadata"},standalone:!0,features:[t.aNF],decls:5,vars:4,consts:[[1,"ms-4"],[1,"row"],[1,"col-4"],[1,"m-1"],[1,"col-8"],["target","_blank",3,"href"]],template:function(e,o){1&e&&(t.j41(0,"div",0),t.DNE(1,Ce,8,4,"div",1)(2,Se,9,7,"div",1)(3,Ee,9,7,"div",1)(4,ge,9,5,"div",1),t.k0s()),2&e&&(t.R7$(),t.vxM(null!=o.metadata&&o.metadata.id?1:-1),t.R7$(),t.vxM(null!=o.metadata&&o.metadata.dateCreated?2:-1),t.R7$(),t.vxM(null!=o.metadata&&o.metadata.dateModified?3:-1),t.R7$(),t.vxM(null!=o.metadata&&o.metadata.uri?4:-1))},dependencies:[C.vh,h.h,h.D9]})}}return s})();function Ie(s,m){if(1&s&&(t.j41(0,"p",3),t.EFF(1),t.k0s()),2&s){const i=m.$implicit;t.R7$(),t.SpI("",i," ")}}function Me(s,m){if(1&s&&(t.j41(0,"div",1)(1,"div",2)(2,"p",3),t.EFF(3),t.nI1(4,"translate"),t.k0s()(),t.j41(5,"div",2),t.Z7z(6,Ie,2,1,"p",3,t.fX1),t.k0s()()),2&s){const i=t.XpG();t.R7$(3),t.JRh(t.bMT(4,1,"submission.sections.sherpa.publication.information.title")),t.R7$(3),t.Dyx(i.journal.titles)}}function Te(s,m){if(1&s&&(t.j41(0,"p",3),t.EFF(1),t.k0s()),2&s){const i=m.$implicit;t.R7$(),t.SpI("",i," ")}}function Oe(s,m){if(1&s&&(t.j41(0,"div",1)(1,"div",2)(2,"p",3),t.EFF(3),t.nI1(4,"translate"),t.k0s()(),t.j41(5,"div",2),t.Z7z(6,Te,2,1,"p",3,t.fX1),t.k0s()()),2&s){const i=t.XpG();t.R7$(3),t.JRh(t.bMT(4,1,"submission.sections.sherpa.publication.information.issns")),t.R7$(3),t.Dyx(i.journal.issns)}}function ye(s,m){if(1&s&&(t.j41(0,"div",1)(1,"div",2)(2,"p",3),t.EFF(3),t.nI1(4,"translate"),t.k0s()(),t.j41(5,"div",2)(6,"p",3)(7,"a",4),t.EFF(8),t.k0s()()()()),2&s){const i=t.XpG();t.R7$(3),t.JRh(t.bMT(4,3,"submission.sections.sherpa.publication.information.url")),t.R7$(4),t.FS9("href",i.journal.url,t.B4B),t.R7$(),t.SpI(" ",i.journal.url," ")}}function Fe(s,m){if(1&s&&(t.j41(0,"div",2)(1,"p",3)(2,"a",4),t.EFF(3),t.k0s()()()),2&s){const i=m.$implicit;t.R7$(2),t.FS9("href",i.uri,t.B4B),t.R7$(),t.SpI(" ",i.name," ")}}function Pe(s,m){if(1&s&&(t.j41(0,"div",1)(1,"div",2)(2,"p",3),t.EFF(3),t.nI1(4,"translate"),t.k0s()(),t.Z7z(5,Fe,4,2,"div",2,t.fX1),t.k0s()),2&s){const i=t.XpG();t.R7$(3),t.JRh(t.bMT(4,1,"submission.sections.sherpa.publication.information.publishers")),t.R7$(2),t.Dyx(i.journal.publishers)}}function Re(s,m){if(1&s&&(t.j41(0,"div",1)(1,"div",2)(2,"p",3),t.EFF(3),t.nI1(4,"translate"),t.k0s()(),t.j41(5,"div",2)(6,"p",3),t.EFF(7),t.k0s()()()),2&s){const i=t.XpG();t.R7$(3),t.JRh(t.bMT(4,2,"submission.sections.sherpa.publication.information.romeoPub")),t.R7$(4),t.SpI(" ",i.journal.romeoPub," ")}}function Be(s,m){if(1&s&&(t.j41(0,"div",1)(1,"div",2)(2,"p",3),t.EFF(3),t.nI1(4,"translate"),t.k0s()(),t.j41(5,"div",2)(6,"p",3),t.EFF(7),t.k0s()()()),2&s){const i=t.XpG();t.R7$(3),t.JRh(t.bMT(4,2,"submission.sections.sherpa.publication.information.zetoPub")),t.R7$(4),t.SpI(" ",i.journal.zetoPub," ")}}let xe=(()=>{class s{static{this.\u0275fac=function(e){return new(e||s)}}static{this.\u0275cmp=t.VBU({type:s,selectors:[["ds-publication-information"]],inputs:{journal:"journal"},standalone:!0,features:[t.aNF],decls:7,vars:6,consts:[[1,"ms-4"],[1,"row"],[1,"col-4"],[1,"m-1"],["target","_blank","rel","noopener noreferrer",3,"href"]],template:function(e,o){1&e&&(t.j41(0,"div",0),t.DNE(1,Me,8,3,"div",1)(2,Oe,8,3,"div",1)(3,ye,9,5,"div",1)(4,Pe,7,3,"div",1)(5,Re,8,4,"div",1)(6,Be,8,4,"div",1),t.k0s()),2&e&&(t.R7$(),t.vxM(null!=o.journal&&o.journal.titles&&o.journal.titles.length>0?1:-1),t.R7$(),t.vxM(null!=o.journal&&o.journal.issns&&o.journal.issns.length>0?2:-1),t.R7$(),t.vxM(null!=o.journal&&o.journal.url?3:-1),t.R7$(),t.vxM(null!=o.journal&&o.journal.publishers&&o.journal.publishers.length>0?4:-1),t.R7$(),t.vxM(null!=o.journal&&o.journal.romeoPub?5:-1),t.R7$(),t.vxM(null!=o.journal&&o.journal.zetoPub?6:-1))},dependencies:[h.h,h.D9]})}}return s})();function Ue(s,m){if(1&s&&(t.j41(0,"span"),t.nrm(1,"i",12),t.EFF(2),t.k0s()),2&s){const i=t.XpG();t.R7$(2),t.Lme(" ",i.version.embargo.amount," ",null==i.version.embargo?null:i.version.embargo.units[0],"")}}function je(s,m){1&s&&(t.j41(0,"span"),t.nrm(1,"i",12),t.EFF(2),t.nI1(3,"translate"),t.k0s()),2&s&&(t.R7$(2),t.SpI(" ",t.bMT(3,1,"submission.sections.sherpa.publisher.policy.noembargo"),""))}function Ae(s,m){if(1&s&&(t.j41(0,"span"),t.EFF(1),t.k0s()),2&s){const i=t.XpG(2);t.R7$(),t.SpI("+",i.version.locations.length-1,"")}}function Le(s,m){if(1&s&&(t.j41(0,"span"),t.EFF(1),t.DNE(2,Ae,2,1,"span"),t.k0s()),2&s){const i=t.XpG();t.R7$(),t.SpI(" ",i.version.locations[0]," "),t.R7$(),t.vxM(i.version.locations.length>1?2:-1)}}function $e(s,m){1&s&&(t.j41(0,"span"),t.EFF(1),t.nI1(2,"translate"),t.k0s()),2&s&&(t.R7$(),t.JRh(t.bMT(2,1,"submission.sections.sherpa.publisher.policy.nolocation")))}function Xe(s,m){1&s&&t.nrm(0,"span",8)}function Ne(s,m){1&s&&t.nrm(0,"span",9)}function Ge(s,m){if(1&s&&(t.j41(0,"p",15),t.EFF(1),t.k0s()),2&s){const i=t.XpG(3);t.R7$(),t.Lme("",i.version.embargo.amount," ",i.version.embargo.units,"")}}function Ke(s,m){1&s&&(t.j41(0,"p",15),t.EFF(1),t.nI1(2,"translate"),t.k0s()),2&s&&(t.R7$(),t.JRh(t.bMT(2,1,"submission.sections.sherpa.publisher.policy.noembargo")))}function Ve(s,m){if(1&s&&(t.j41(0,"div",13)(1,"div",14)(2,"p",15),t.nrm(3,"i",12),t.EFF(4),t.nI1(5,"translate"),t.k0s()(),t.j41(6,"div",16),t.DNE(7,Ge,2,2,"p",15)(8,Ke,3,3,"p",15),t.k0s()()),2&s){const i=t.XpG(2);t.R7$(4),t.SpI(" ",t.bMT(5,2,"submission.sections.sherpa.publisher.policy.embargo"),""),t.R7$(3),t.vxM(i.version.embargo?7:8)}}function We(s,m){if(1&s&&(t.j41(0,"p",15),t.EFF(1),t.k0s()),2&s){const i=m.$implicit;t.R7$(),t.JRh(i)}}function ke(s,m){if(1&s&&(t.j41(0,"div",13)(1,"div",14)(2,"p",15),t.nrm(3,"i",17),t.EFF(4),t.nI1(5,"translate"),t.k0s()(),t.j41(6,"div",16),t.Z7z(7,We,2,1,"p",15,t.fX1),t.k0s()()),2&s){const i=t.XpG(2);t.R7$(4),t.SpI(" ",t.bMT(5,1,"submission.sections.sherpa.publisher.policy.license"),""),t.R7$(3),t.Dyx(i.version.licenses)}}function Ye(s,m){if(1&s&&(t.j41(0,"p",15),t.EFF(1),t.k0s()),2&s){const i=m.$implicit;t.R7$(),t.JRh(i)}}function ze(s,m){if(1&s&&(t.j41(0,"div",13)(1,"div",14)(2,"p",15),t.nrm(3,"i",18),t.EFF(4),t.nI1(5,"translate"),t.k0s()(),t.j41(6,"div",16),t.Z7z(7,Ye,2,1,"p",15,t.fX1),t.k0s()()),2&s){const i=t.XpG(2);t.R7$(4),t.SpI(" ",t.bMT(5,1,"submission.sections.sherpa.publisher.policy.prerequisites"),""),t.R7$(3),t.Dyx(i.version.prerequisites)}}function Je(s,m){if(1&s&&(t.j41(0,"p",15),t.EFF(1),t.k0s()),2&s){const i=m.$implicit;t.R7$(),t.JRh(i)}}function He(s,m){if(1&s&&(t.j41(0,"div",13)(1,"div",14)(2,"p",15),t.nrm(3,"i",6),t.EFF(4),t.nI1(5,"translate"),t.k0s()(),t.j41(6,"div",16),t.Z7z(7,Je,2,1,"p",15,t.fX1),t.k0s()()),2&s){const i=t.XpG(2);t.R7$(4),t.SpI(" ",t.bMT(5,1,"submission.sections.sherpa.publisher.policy.location"),""),t.R7$(3),t.Dyx(i.version.locations)}}function we(s,m){if(1&s&&(t.j41(0,"p",15),t.EFF(1),t.k0s()),2&s){const i=m.$implicit;t.R7$(),t.JRh(i)}}function Qe(s,m){if(1&s&&(t.j41(0,"div",13)(1,"div",14)(2,"p",15),t.nrm(3,"i",19),t.EFF(4),t.nI1(5,"translate"),t.k0s()(),t.j41(6,"div",16),t.Z7z(7,we,2,1,"p",15,t.fX1),t.k0s()()),2&s){const i=t.XpG(2);t.R7$(4),t.SpI(" ",t.bMT(5,1,"submission.sections.sherpa.publisher.policy.conditions"),""),t.R7$(3),t.Dyx(i.version.conditions)}}function Ze(s,m){if(1&s&&(t.j41(0,"div",11),t.DNE(1,Ve,9,4,"div",13)(2,ke,9,3,"div",13)(3,ze,9,3,"div",13)(4,He,9,3,"div",13)(5,Qe,9,3,"div",13),t.k0s()),2&s){const i=t.XpG();t.R7$(),t.vxM(null!=i.version&&i.version.embargo&&null!=i.version&&i.version.embargo.amount?1:-1),t.R7$(),t.vxM(null!=i.version&&i.version.licenses&&i.version.licenses.length>0?2:-1),t.R7$(),t.vxM(null!=i.version&&i.version.prerequisites&&i.version.prerequisites.length>0?3:-1),t.R7$(),t.vxM(null!=i.version&&i.version.locations&&i.version.locations.length>0?4:-1),t.R7$(),t.vxM(null!=i.version&&i.version.conditions&&i.version.conditions.length>0?5:-1)}}let qe=(()=>{class s{constructor(){this.isCollapsed=!0}static{this.\u0275fac=function(e){return new(e||s)}}static{this.\u0275cmp=t.VBU({type:s,selectors:[["ds-content-accordion"]],inputs:{version:"version"},standalone:!0,features:[t.aNF],decls:20,vars:13,consts:[["collapse","ngbCollapse"],["data-test","collapse",1,"mb-3","border-bottom"],[1,"w-100","d-flex","justify-content-between","collapse-toggle",3,"click"],[1,"d-flex"],["type","button","aria-controls","collapseExample",1,"btn","btn-link","p-0","me-4",3,"click"],[1,"m-1","ms-4"],[1,"far","fa-folder-open"],[1,"d-inline-block"],[1,"fas","fa-chevron-down"],[1,"fas","fa-chevron-up"],[3,"ngbCollapse"],[1,"ms-4"],[1,"fas","fa-hourglass-half"],[1,"row"],[1,"col-4"],[1,"m-1"],[1,"col-6"],[1,"fas","fa-certificate"],[1,"fas","fa-exclamation-circle"],[1,"fas","fa-tasks"]],template:function(e,o){if(1&e){const l=t.RV6();t.j41(0,"div",1)(1,"div",2),t.bIt("click",function(){t.eBV(l);const M=t.sdS(18);return t.Njj(M.toggle())}),t.j41(2,"div",3)(3,"button",4),t.bIt("click",function(M){return t.eBV(l),t.Njj(M.preventDefault())}),t.EFF(4),t.nI1(5,"titlecase"),t.nI1(6,"translate"),t.k0s(),t.j41(7,"div"),t.DNE(8,Ue,3,2,"span")(9,je,4,3,"span"),t.j41(10,"span",5),t.nrm(11,"i",6),t.DNE(12,Le,3,2,"span")(13,$e,3,3,"span"),t.k0s()()(),t.j41(14,"div",7),t.DNE(15,Xe,1,0,"span",8)(16,Ne,1,0,"span",9),t.k0s()(),t.j41(17,"div",10,0),t.DNE(19,Ze,6,5,"div",11),t.k0s()()}if(2&e){const l=t.sdS(18);t.R7$(3),t.BMQ("aria-expanded",!l.collapsed),t.R7$(),t.Lme(" ",t.bMT(5,9,o.version.articleVersion)," ",t.bMT(6,11,"submission.sections.sherpa.publisher.policy.version")," "),t.R7$(4),t.vxM(null!=o.version&&o.version.embargo&&null!=o.version&&o.version.embargo.amount?8:9),t.R7$(4),t.vxM(null!=o.version&&o.version.locations&&o.version.locations.length>0?12:13),t.R7$(3),t.vxM(l.collapsed?15:-1),t.R7$(),t.vxM(l.collapsed?-1:16),t.R7$(),t.Y8G("ngbCollapse",o.isCollapsed),t.R7$(2),t.vxM(o.version?19:-1)}},dependencies:[p.HC,p.$G,C.PV,h.h,h.D9]})}}return s})();function tn(s,m){1&s&&t.nrm(0,"ds-content-accordion",1),2&s&&t.Y8G("version",m.$implicit)}function en(s,m){if(1&s&&(t.j41(0,"li")(1,"a",5),t.EFF(2),t.k0s()()),2&s){const i=m.$implicit;t.R7$(),t.FS9("href",i.key,t.B4B),t.R7$(),t.JRh(i.value)}}function nn(s,m){if(1&s&&(t.j41(0,"div",2)(1,"div",3)(2,"p",4),t.EFF(3),t.nI1(4,"translate"),t.k0s(),t.j41(5,"ul"),t.Z7z(6,en,3,2,"li",null,t.fX1),t.nI1(8,"keyvalue"),t.k0s()()()),2&s){const i=t.XpG();t.R7$(3),t.SpI(" ",t.bMT(4,1,"submission.sections.sherpa.publisher.policy.more.information")," "),t.R7$(3),t.Dyx(t.bMT(8,3,i.policy.urls))}}let sn=(()=>{class s{constructor(){this.AlertTypeEnum=S.v}static{this.\u0275fac=function(e){return new(e||s)}}static{this.\u0275cmp=t.VBU({type:s,selectors:[["ds-publisher-policy"]],inputs:{policy:"policy"},standalone:!0,features:[t.aNF],decls:4,vars:1,consts:[[1,"ms-4"],[3,"version"],[1,"row"],[1,"col-12"],[1,"m-1"],["target","_blank","rel","noopener noreferrer",3,"href"]],template:function(e,o){1&e&&(t.j41(0,"div",0),t.Z7z(1,tn,1,1,"ds-content-accordion",1,t.fX1),t.DNE(3,nn,9,5,"div",2),t.k0s()),2&e&&(t.R7$(),t.Dyx(o.policy.permittedVersions),t.R7$(2),t.vxM(null!=o.policy&&o.policy.urls?3:-1))},dependencies:[qe,C.lG,h.h,h.D9]})}}return s})();function on(s,m){1&s&&t.nrm(0,"ds-alert",1),2&s&&t.Y8G("type","alert-info")("content","submission.sections.sherpa-policy.title-empty")}function an(s,m){if(1&s){const i=t.RV6();t.j41(0,"div",2)(1,"ds-alert",4),t.EFF(2),t.nI1(3,"translate"),t.k0s(),t.j41(4,"div")(5,"button",5),t.bIt("click",function(){t.eBV(i);const o=t.XpG();return t.Njj(o.refresh())}),t.j41(6,"span"),t.nrm(7,"i",6),t.EFF(8),t.nI1(9,"translate"),t.k0s()()()()}2&s&&(t.R7$(),t.Y8G("type","alert-info"),t.R7$(),t.SpI(" ",t.bMT(3,3,"submission.sections.sherpa.publisher.policy.description")," "),t.R7$(6),t.SpI(" ",t.bMT(9,5,"submission.sections.sherpa.publisher.policy.refresh")," "))}function rn(s,m){1&s&&t.nrm(0,"span",11)}function cn(s,m){1&s&&t.nrm(0,"span",12)}function ln(s,m){1&s&&t.nrm(0,"span",11)}function dn(s,m){1&s&&t.nrm(0,"span",12)}function mn(s,m){if(1&s){const i=t.RV6();t.j41(0,"div",7)(1,"div",8),t.bIt("click",function(){t.eBV(i);const o=t.sdS(9);return t.Njj(o.toggle())}),t.j41(2,"button",9),t.bIt("click",function(o){return t.eBV(i),t.Njj(o.preventDefault())}),t.EFF(3),t.nI1(4,"translate"),t.k0s(),t.j41(5,"div",10),t.DNE(6,ln,1,0,"span",11)(7,dn,1,0,"span",12),t.k0s()(),t.j41(8,"div",13,0),t.nrm(10,"ds-publisher-policy",16),t.k0s()()}if(2&s){const i=m.$implicit,e=t.sdS(9),o=t.XpG(4);t.R7$(2),t.BMQ("aria-expanded",!e.collapsed),t.R7$(),t.SpI(" ",t.bMT(4,6,"submission.sections.sherpa.publisher.policy")," "),t.R7$(3),t.vxM(e.collapsed?6:-1),t.R7$(),t.vxM(e.collapsed?-1:7),t.R7$(),t.Y8G("ngbCollapse",o.isCollapsed),t.R7$(2),t.Y8G("policy",i)}}function un(s,m){if(1&s){const i=t.RV6();t.j41(0,"div",7)(1,"div",8),t.bIt("click",function(){t.eBV(i);const o=t.sdS(9);return t.Njj(o.toggle())}),t.j41(2,"button",9),t.bIt("click",function(o){return t.eBV(i),t.Njj(o.preventDefault())}),t.EFF(3),t.nI1(4,"translate"),t.k0s(),t.j41(5,"div",10),t.DNE(6,rn,1,0,"span",11)(7,cn,1,0,"span",12),t.k0s()(),t.j41(8,"div",13,0),t.nrm(10,"ds-publication-information",15),t.k0s()(),t.Z7z(11,mn,11,8,"div",7,t.fX1)}if(2&s){const i=m.$implicit,e=t.sdS(9),o=t.XpG(3);t.R7$(2),t.BMQ("aria-expanded",!e.collapsed),t.R7$(),t.SpI(" ",t.bMT(4,6,"submission.sections.sherpa.publication.information")," "),t.R7$(3),t.vxM(e.collapsed?6:-1),t.R7$(),t.vxM(e.collapsed?-1:7),t.R7$(),t.Y8G("ngbCollapse",o.isCollapsed),t.R7$(2),t.Y8G("journal",i),t.R7$(),t.Dyx(i.policies)}}function pn(s,m){1&s&&t.nrm(0,"span",11)}function _n(s,m){1&s&&t.nrm(0,"span",12)}function hn(s,m){if(1&s){const i=t.RV6();t.Z7z(0,un,13,8,null,null,t.fX1),t.j41(2,"div",7)(3,"div",8),t.bIt("click",function(){t.eBV(i);const o=t.sdS(11);return t.Njj(o.toggle())}),t.j41(4,"button",9),t.bIt("click",function(o){return t.eBV(i),t.Njj(o.preventDefault())}),t.EFF(5),t.nI1(6,"translate"),t.k0s(),t.j41(7,"div",10),t.DNE(8,pn,1,0,"span",11)(9,_n,1,0,"span",12),t.k0s()(),t.j41(10,"div",13,0),t.nrm(12,"ds-metadata-information",14),t.k0s()()}if(2&s){const i=t.sdS(11),e=t.XpG().ngVar,o=t.XpG();t.Dyx(e.journals),t.R7$(4),t.BMQ("aria-expanded",!i.collapsed),t.R7$(),t.SpI(" ",t.bMT(6,6,"submission.sections.sherpa.record.information")," "),t.R7$(3),t.vxM(i.collapsed?8:-1),t.R7$(),t.vxM(i.collapsed?-1:9),t.R7$(),t.Y8G("ngbCollapse",o.isCollapsed),t.R7$(2),t.Y8G("metadata",e.metadata)}}function fn(s,m){if(1&s&&(t.nrm(0,"ds-alert",1),t.nI1(1,"translate")),2&s){const i=t.XpG().ngVar,e=t.XpG();t.Y8G("type",e.AlertTypeEnum.Error)("content",i.message?i.message:t.bMT(1,2,"submission.sections.sherpa.error.message"))}}function vn(s,m){if(1&s&&(t.qex(0),t.DNE(1,hn,13,8,"div",7)(2,fn,2,4,"ds-alert",1),t.bVm()),2&s){const i=m.ngVar,e=t.XpG();t.R7$(),t.vxM(e.hasNoData()||!i||i.error?-1:1),t.R7$(),t.vxM(i&&i.error?2:-1)}}let bn=(()=>{class s extends A{constructor(i,e,o,l,E){super(void 0,l,E),this.sectionService=i,this.operationsBuilder=e,this.submissionService=o,this.injectedSectionData=l,this.injectedSubmissionId=E,this.sherpaPoliciesData$=new wt.t(null),this.subs=[],this.isCollapsed=!1,this.AlertTypeEnum=S.v}onSectionDestroy(){this.subs.filter(i=>(0,v.a4)(i)).forEach(i=>i.unsubscribe())}onSectionInit(){this.pathCombiner=new P.S("sections",this.sectionData.id),this.subs.push(this.sectionService.getSectionData(this.submissionId,this.sectionData.id,this.sectionData.sectionType).subscribe(i=>{this.sherpaPoliciesData$.next(i)}))}getSectionStatus(){return(0,y.of)(!0)}hasNoData(){return(0,v.Im)(this.sherpaPoliciesData$.value)}refresh(){this.operationsBuilder.remove(this.pathCombiner.getPath("retrievalTime")),this.submissionService.dispatchSaveSection(this.submissionId,this.sectionData.id)}static{this.\u0275fac=function(e){return new(e||s)(t.rXU(H.c),t.rXU(j.C),t.rXU(Et.E),t.rXU("sectionDataProvider"),t.rXU("submissionIdProvider"))}}static{this.\u0275cmp=t.VBU({type:s,selectors:[["ds-section-sherpa-policies"]],standalone:!0,features:[t.Vt3,t.aNF],decls:4,vars:5,consts:[["collapse","ngbCollapse"],[3,"type","content"],[1,"d-flex","flex-column","flex-nowrap","mt-2","mb-4"],[4,"ngVar"],[3,"type"],["type","button","data-test","refresh-btn",1,"btn","btn-secondary","float-end",3,"click"],[1,"fas","fa-sync"],["data-test","collapse",1,"mb-3","border-bottom"],[1,"w-100","d-flex","justify-content-between","collapse-toggle","mb-3",3,"click"],["type","button","aria-controls","collapseExample",1,"btn","btn-link","p-0",3,"click"],[1,"d-inline-block"],[1,"fas","fa-chevron-down"],[1,"fas","fa-chevron-up"],[3,"ngbCollapse"],[3,"metadata"],[3,"journal"],[3,"policy"]],template:function(e,o){if(1&e&&(t.DNE(0,on,1,2,"ds-alert",1)(1,an,10,7,"div",2)(2,vn,3,2,"ng-container",3),t.nI1(3,"async")),2&e){let l;t.vxM(o.hasNoData()?0:-1),t.R7$(),t.vxM(o.hasNoData()?-1:1),t.R7$(),t.Y8G("ngVar",null==(l=t.bMT(3,3,o.sherpaPoliciesData$))?null:l.sherpaResponse)}},dependencies:[c.C,C.Jj,De,p.HC,p.$G,xe,sn,h.h,h.D9,ct.r]})}}return s})();var Cn=n(25558),Sn=n(43446),En=n(99545),gn=n(2086),Dn=n(33017),In=n(96298),Mn=(n(75534),n(29710));n(8727);const Tn=["*"];function On(s,m){}let yn=(()=>{class s extends Mn.J{constructor(){super(...arguments),this.inAndOutputNames=["availableAccessConditionOptions","isPrimary","collectionId","collectionPolicyType","configMetadataForm","fileId","fileIndex","fileName","sectionId","submissionId"]}getComponentName(){return"SubmissionSectionUploadFileComponent"}importThemedComponent(i){return n(96682)(`./${i}/app/submission/sections/upload/file/section-upload-file.component`)}importUnthemedComponent(){return Promise.resolve().then(n.bind(n,8727))}static{this.\u0275fac=(()=>{let i;return function(o){return(i||(i=t.xGo(s)))(o||s)}})()}static{this.\u0275cmp=t.VBU({type:s,selectors:[["ds-submission-upload-section-file"]],inputs:{availableAccessConditionOptions:"availableAccessConditionOptions",isPrimary:"isPrimary",collectionId:"collectionId",collectionPolicyType:"collectionPolicyType",configMetadataForm:"configMetadataForm",fileId:"fileId",fileIndex:"fileIndex",fileName:"fileName",sectionId:"sectionId",submissionId:"submissionId"},standalone:!0,features:[t.Vt3,t.aNF],ngContentSelectors:Tn,decls:5,vars:0,consts:[["vcr",""],["content",""]],template:function(e,o){1&e&&(t.NAR(),t.DNE(0,On,0,0,"ng-template",null,0,t.C5r),t.j41(2,"div",null,1),t.SdG(4),t.k0s())},encapsulation:2})}}return s})();var Fn=n(76668);const Qt=s=>({collectionName:s});function Pn(s,m){if(1&s&&(t.EFF(0),t.nI1(1,"translate")),2&s){const i=t.XpG(3);t.SpI(" ",t.i5U(1,1,"submission.sections.upload.header.policy.default.nolist",t.eq3(4,Qt,i.collectionName))," ")}}function Rn(s,m){if(1&s&&(t.EFF(0),t.nI1(1,"translate")),2&s){const i=t.XpG(3);t.SpI(" ",t.i5U(1,1,"submission.sections.upload.header.policy.default.withlist",t.eq3(4,Qt,i.collectionName))," ")}}function Bn(s,m){if(1&s&&(t.j41(0,"div",1)(1,"div",5)(2,"ds-alert",6),t.DNE(3,Pn,2,6)(4,Rn,2,6),t.nrm(5,"span",7)(6,"ds-submission-section-upload-access-conditions",8),t.k0s()()()),2&s){const i=t.XpG(2);t.R7$(2),t.Y8G("type",i.AlertTypeEnum.Warning),t.R7$(),t.vxM(1===i.collectionPolicyType?3:-1),t.R7$(),t.vxM(2===i.collectionPolicyType?4:-1),t.R7$(2),t.Y8G("accessConditions",i.collectionDefaultAccessConditions)}}function xn(s,m){if(1&s&&(t.nrm(0,"ds-submission-upload-section-file",9),t.nI1(1,"async"),t.j41(2,"div",1)(3,"div",4),t.nrm(4,"hr"),t.k0s()()),2&s){const i=m.$implicit,e=m.$index,o=t.XpG(2);t.Y8G("isPrimary",o.primaryBitstreamUUID?o.primaryBitstreamUUID===i.uuid:null)("availableAccessConditionOptions",o.availableAccessConditionOptions)("collectionId",o.collectionId)("collectionPolicyType",o.collectionPolicyType)("configMetadataForm",t.bMT(1,10,o.configMetadataForm$))("fileId",i.uuid)("fileIndex",e)("fileName",o.fileNames[e])("sectionId",o.sectionData.id)("submissionId",o.submissionId)}}function Un(s,m){if(1&s&&(t.DNE(0,Bn,7,4,"div",1),t.j41(1,"div",1)(2,"div",2)(3,"span",3),t.EFF(4),t.nI1(5,"translate"),t.k0s()()(),t.j41(6,"div",1)(7,"div",4),t.nrm(8,"hr"),t.k0s()(),t.Z7z(9,xn,5,12,null,null,t.fX1)),2&s){const i=t.XpG();t.vxM(i.collectionDefaultAccessConditions.length>0?0:-1),t.R7$(4),t.JRh(t.bMT(5,2,"bitstream.edit.form.primaryBitstream.label")),t.R7$(5),t.Dyx(i.fileList)}}function jn(s,m){1&s&&(t.j41(0,"div",1)(1,"div",4)(2,"div",10)(3,"span",11),t.EFF(4),t.nI1(5,"translate"),t.k0s()()()()),2&s&&(t.R7$(4),t.JRh(t.bMT(5,1,"submission.sections.upload.no-file-uploaded")))}let $n=(()=>{class s extends A{constructor(i,e,o,l,E,M,G,Y,ot,dt,pt){super(void 0,dt,pt),this.bitstreamService=i,this.changeDetectorRef=e,this.collectionDataService=o,this.groupService=l,this.resourcePolicyService=E,this.sectionService=M,this.submissionService=G,this.uploadsConfigService=Y,this.dsoNameService=ot,this.injectedSectionData=dt,this.injectedSubmissionId=pt,this.AlertTypeEnum=S.v,this.primaryBitstreamUUID=null,this.fileList=[],this.fileNames=[],this.collectionDefaultAccessConditions=[],this.required$=new wt.t(!0),this.subs=[]}onSectionInit(){const i=this.uploadsConfigService.findByHref(this.sectionData.config,!0,!1,(0,Wt.s)("metadata")).pipe((0,k.yd)(),(0,f.T)(e=>e.payload));this.configMetadataForm$=i.pipe((0,Cn.n)(e=>e.metadata.pipe((0,k.yd)(),(0,f.T)(o=>o.payload)))),this.subs.push(this.submissionService.getSubmissionObject(this.submissionId).pipe((0,_.p)(e=>(0,v.EA)(e)&&!e.isLoading),(0,_.p)(e=>(0,v.b0)(this.collectionId)||this.collectionId!==e.collection),(0,V.M)(e=>this.collectionId=e.collection),(0,d.Z)(e=>this.collectionDataService.findById(e.collection)),(0,_.p)(e=>(0,v.EA)(e.payload)),(0,V.M)(e=>this.collectionName=this.dsoNameService.getName(e.payload)),(0,d.Z)(()=>i)).subscribe(e=>{this.required$.next(e.required),this.availableAccessConditionOptions=(0,v.hj)(e.accessConditionOptions)?e.accessConditionOptions:[],this.collectionPolicyType=this.availableAccessConditionOptions.length>0?2:1,this.changeDetectorRef.detectChanges()}),(0,u.z)([this.configMetadataForm$,this.bitstreamService.getUploadedFilesData(this.submissionId,this.sectionData.id)]).pipe((0,_.p)(([e,o])=>(0,v.hj)(e)&&(0,v.hj)(o)),(0,vt.F)()).subscribe(([e,{primary:o,files:l}])=>{this.primaryBitstreamUUID=o,this.fileList=l,this.fileNames=Array.from(l,E=>this.getFileName(e,E)),this.changeDetectorRef.detectChanges()}))}getFileName(i,e){const o=i.rows[0].fields[0].selectableMetadata[0].metadata;let l;return l=(0,v.hj)(e.metadata)&&(0,v.hj)(e.metadata[o])?e.metadata[o][0].display:e.uuid,l}getSectionStatus(){return(0,u.z)(this.required$,this.bitstreamService.getUploadedFileList(this.submissionId,this.sectionData.id),(i,e)=>!i||(0,v.EA)(e)&&e.length>0)}onSectionDestroy(){this.subs.filter(i=>(0,v.a4)(i)).forEach(i=>i.unsubscribe())}static{this.\u0275fac=function(e){return new(e||s)(t.rXU(Fn.i),t.rXU(t.gRc),t.rXU(Ht.CollectionDataService),t.rXU(gn.GroupDataService),t.rXU(Dn.ResourcePolicyDataService),t.rXU(H.c),t.rXU(Et.E),t.rXU(En.SubmissionUploadsConfigDataService),t.rXU(Sn.f),t.rXU("sectionDataProvider"),t.rXU("submissionIdProvider"))}}static{this.\u0275cmp=t.VBU({type:s,selectors:[["ds-submission-section-upload"]],standalone:!0,features:[t.Vt3,t.aNF],decls:3,vars:4,consts:[[3,"content","dismissible","type"],[1,"row"],[1,"col-md-2"],[1,"text-start","fw-bold"],[1,"col-md-12"],[1,"col-sm-12"],[3,"type"],[1,"clearfix"],[3,"accessConditions"],[3,"isPrimary","availableAccessConditionOptions","collectionId","collectionPolicyType","configMetadataForm","fileId","fileIndex","fileName","sectionId","submissionId"],[1,"text-center","h3"],[1,"text-muted"]],template:function(e,o){1&e&&(t.nrm(0,"ds-alert",0),t.DNE(1,Un,11,4)(2,jn,6,3,"div",1)),2&e&&(t.Y8G("content","submission.sections.upload.info")("dismissible",!0)("type",o.AlertTypeEnum.Info),t.R7$(),t.vxM(o.fileList.length>0?1:2))},dependencies:[c.C,C.Jj,In._,yn,h.h,h.D9]})}}return s})();const ft=new Map;ft.set(st.l.AccessesCondition,$),ft.set(st.l.License,Ji),ft.set(st.l.CcLicense,_i),ft.set(st.l.SherpaPolicies,bn),ft.set(st.l.Upload,$n),ft.set(st.l.SubmissionForm,Xi),ft.set(st.l.Identifiers,Vi),ft.set(st.l.CoarNotify,be),ft.set(st.l.Duplicates,Mi);const Nn=["sectionRef"],Gn=s=>({"section-focus":s}),Kn=s=>({"text-white":s});function Vn(s,m){1&s&&(t.nrm(0,"i",10),t.nI1(1,"translate"),t.nI1(2,"translate")),2&s&&(t.FS9("title",t.bMT(1,2,"submission.sections.status.warnings.title")),t.BMQ("aria-label",t.bMT(2,4,"submission.sections.status.warnings.aria")))}function Wn(s,m){1&s&&(t.nrm(0,"i",11),t.nI1(1,"translate"),t.nI1(2,"translate")),2&s&&(t.FS9("title",t.bMT(1,2,"submission.sections.status.errors.title")),t.BMQ("aria-label",t.bMT(2,4,"submission.sections.status.errors.aria")))}function kn(s,m){1&s&&(t.nrm(0,"i",12),t.nI1(1,"translate"),t.nI1(2,"translate")),2&s&&(t.FS9("title",t.bMT(1,2,"submission.sections.status.valid.title")),t.BMQ("aria-label",t.bMT(2,4,"submission.sections.status.valid.aria")))}function Yn(s,m){1&s&&(t.nrm(0,"i",13),t.nI1(1,"translate"),t.nI1(2,"translate")),2&s&&(t.FS9("title",t.bMT(1,2,"submission.sections.status.info.title")),t.BMQ("aria-label",t.bMT(2,4,"submission.sections.status.info.aria")))}function zn(s,m){if(1&s){const i=t.RV6();t.j41(0,"a",15),t.bIt("click",function(o){t.eBV(i);const l=t.XpG(3);return t.Njj(l.removeSection(o))}),t.nrm(1,"i",16),t.k0s()}}function Jn(s,m){if(1&s&&(t.j41(0,"span",8),t.EFF(1),t.nI1(2,"translate"),t.k0s(),t.j41(3,"div",9),t.DNE(4,Vn,3,6,"i",10),t.nI1(5,"async"),t.DNE(6,Wn,3,6,"i",11)(7,kn,3,6,"i",12),t.nI1(8,"async"),t.DNE(9,Yn,3,6,"i",13)(10,zn,2,0,"a",14),t.k0s()),2&s){const i=t.XpG(2),e=t.sdS(1);t.Y8G("ngClass",t.eq3(13,Kn,e.isInfo())),t.R7$(),t.JRh(t.bMT(2,7,"submission.sections."+i.sectionData.header)),t.R7$(3),t.vxM(!0===t.bMT(5,9,e.isValid())||e.hasErrors()||e.isInfo()?-1:4),t.R7$(2),t.vxM(e.hasErrors()&&!e.isInfo()?6:-1),t.R7$(),t.vxM(!t.bMT(8,11,e.isValid())||e.hasErrors()||e.isInfo()?-1:7),t.R7$(2),t.vxM(e.isInfo()?9:-1),t.R7$(),t.vxM(e.isMandatory()?-1:10)}}function Hn(s,m){if(1&s){const i=t.RV6();t.j41(0,"ds-alert",21),t.bIt("close",function(){const o=t.eBV(i).$index;t.XpG(4);const l=t.sdS(1);return t.Njj(l.removeError(o))}),t.k0s()}if(2&s){const i=m.$implicit,e=t.XpG(4);t.Y8G("content",i)("dismissible",!0)("type",e.AlertTypeEnum.Error)}}function wn(s,m){if(1&s&&(t.j41(0,"div",17),t.Z7z(1,Hn,1,3,"ds-alert",20,t.fX1),t.k0s()),2&s){const i=t.XpG(3),e=t.sdS(1);t.Mz_("id","sectionGenericError_",i.sectionData.id,""),t.R7$(),t.Dyx(e.getErrors())}}function Qn(s,m){1&s&&t.eu8(0)}function Zn(s,m){if(1&s){const i=t.RV6();t.DNE(0,wn,3,2,"div",17),t.j41(1,"div",18),t.bIt("click",function(o){t.eBV(i),t.XpG(2);const l=t.sdS(1);return t.Njj(l.setFocus(o))}),t.DNE(2,Qn,1,0,"ng-container",19),t.k0s()}if(2&s){const i=t.XpG(2),e=t.sdS(1);t.vxM(e.hasGenericErrors()?0:-1),t.R7$(),t.Mz_("id","sectionContent_",i.sectionData.id,""),t.R7$(),t.Y8G("ngComponentOutlet",i.getSectionContent())("ngComponentOutletInjector",i.objectInjector)}}function qn(s,m){if(1&s){const i=t.RV6();t.j41(0,"ngb-accordion",4,1),t.bIt("panelChange",function(o){t.eBV(i),t.XpG();const l=t.sdS(1);return t.Njj(l.sectionChange(o))}),t.j41(2,"ngb-panel",5),t.DNE(3,Jn,11,15,"ng-template",6)(4,Zn,3,5,"ng-template",7),t.k0s()()}if(2&s){const i=t.XpG(),e=t.sdS(1);t.FS9("activeIds",i.sectionData.id),t.Y8G("destroyOnHide",!1),t.R7$(2),t.FS9("id",i.sectionData.id),t.Y8G("type",e.isInfo()?"info":"")}}let ts=(()=>{class s{constructor(i){this.injector=i,this.AlertTypeEnum=S.v}ngOnInit(){this.objectInjector=t.zZn.create({providers:[{provide:"collectionIdProvider",useFactory:()=>this.collectionId,deps:[]},{provide:"sectionDataProvider",useFactory:()=>this.sectionData,deps:[]},{provide:"submissionIdProvider",useFactory:()=>this.submissionId,deps:[]}],parent:this.injector})}removeSection(i){i.preventDefault(),i.stopPropagation(),this.sectionRef.removeSection(this.submissionId,this.sectionData.id)}getSectionContent(){return function Xn(s){return ft.get(s)}(this.sectionData.sectionType)}static{this.\u0275fac=function(e){return new(e||s)(t.rXU(t.zZn))}}static{this.\u0275cmp=t.VBU({type:s,selectors:[["ds-base-submission-section-container"]],viewQuery:function(e,o){if(1&e&&t.GBs(Nn,5),2&e){let l;t.mGM(l=t.lsd())&&(o.sectionRef=l.first)}},inputs:{collectionId:"collectionId",sectionData:"sectionData",submissionId:"submissionId"},standalone:!0,features:[t.aNF],decls:4,vars:11,consts:[["sectionRef","sectionRef"],["acc","ngbAccordion"],["dsSection","",1,"mb-2",3,"ngClass","mandatory","submissionId","sectionType","sectionId"],[3,"activeIds","destroyOnHide"],[3,"panelChange","activeIds","destroyOnHide"],[3,"id","type"],["ngbPanelTitle","",1,"d-flex"],["ngbPanelContent",""],["tabindex","0",1,"flex-grow-1","section-title",3,"ngClass"],[1,"d-inline-block"],["role","img",1,"fas","fa-exclamation-circle","text-warning","me-3",3,"title"],["role","img",1,"fas","fa-exclamation-circle","text-danger","me-3",3,"title"],["role","img",1,"fas","fa-check-circle","text-success","me-3",3,"title"],["role","img",1,"fas","fa-info-circle","me-3","text-white",3,"title"],["href","javascript:void(0);",1,"me-3"],["href","javascript:void(0);",1,"me-3",3,"click"],["aria-hidden","true","tabindex","0",1,"fas","fa-trash-o"],[3,"id"],[3,"click","id"],[4,"ngComponentOutlet","ngComponentOutletInjector"],[3,"content","dismissible","type"],[3,"close","content","dismissible","type"]],template:function(e,o){if(1&e&&(t.j41(0,"div",2,0),t.DNE(2,qn,5,4,"ngb-accordion",3),t.nI1(3,"async"),t.k0s()),2&e){const l=t.sdS(1);t.Y8G("ngClass",t.eq3(9,Gn,l.isSectionActive()))("mandatory",o.sectionData.mandatory)("submissionId",o.submissionId)("sectionType",o.sectionData.sectionType)("sectionId",o.sectionData.id),t.BMQ("id","section_"+o.sectionData.id),t.R7$(2),t.vxM(t.bMT(3,7,l.isEnabled())?2:-1)}},dependencies:[c.C,C.Jj,p._f,p.W1,p.CT,p.sb,p.t3,C.YU,C.OI,I.m,h.h,h.D9],styles:["[_nghost-%COMP%]     .card{margin-bottom:var(--ds-submission-sections-margin-bottom);overflow:unset}.section-focus[_ngcontent-%COMP%]{border-radius:var(--bs-border-radius);box-shadow:var(--bs-btn-focus-box-shadow)}[_nghost-%COMP%]     .card:first-of-type{border-bottom:var(--bs-card-border-width) solid var(--bs-card-border-color)!important;border-bottom-left-radius:var(--bs-card-border-radius)!important;border-bottom-right-radius:var(--bs-card-border-radius)!important}[_nghost-%COMP%]     .card-header button{box-shadow:none!important;width:100%}"]})}}return s})()},79092:(z,R,n)=>{"use strict";n.d(R,{P:()=>S});var C=n(29710),p=(n(63309),n(54438));const h=["*"];function c(I,g){}let S=(()=>{class I extends C.J{constructor(){super(...arguments),this.inAndOutputNames=["collectionId","sectionData","submissionId"]}getComponentName(){return"SubmissionSectionContainerComponent"}importThemedComponent(u){return n(20174)(`./${u}/app/submission/sections/container/section-container.component`)}importUnthemedComponent(){return Promise.resolve().then(n.bind(n,63309))}static{this.\u0275fac=(()=>{let u;return function(a){return(u||(u=p.xGo(I)))(a||I)}})()}static{this.\u0275cmp=p.VBU({type:I,selectors:[["ds-submission-section-container"]],inputs:{collectionId:"collectionId",sectionData:"sectionData",submissionId:"submissionId"},standalone:!0,features:[p.Vt3,p.aNF],ngContentSelectors:h,decls:5,vars:0,consts:[["vcr",""],["content",""]],template:function(y,a){1&y&&(p.NAR(),p.DNE(0,c,0,0,"ng-template",null,0,p.C5r),p.j41(2,"div",null,1),p.SdG(4),p.k0s())},encapsulation:2})}}return I})()},49832:(z,R,n)=>{"use strict";n.r(R),n.d(R,{CoarNotifyConfigDataService:()=>P});var C=n(96697),t=n(96354),p=n(57775),h=n(81948),c=n(18328),S=n(72073),I=n(88667),g=n(20881),u=n(4318),y=n(49755),a=n(3601),_=n(7094),d=n(5127),f=n(9847),D=n(54438);let P=(()=>{class j extends g.W{constructor(O,U,v,F,B){super("submissioncoarnotifyconfigs",O,U,v,F),this.requestService=O,this.rdbService=U,this.objectCache=v,this.halService=F,this.notificationsService=B,this.findAllData=new I.H(this.linkPath,O,U,v,F,this.responseMsToLive),this.deleteData=new S.I(this.linkPath,O,U,v,F,B,this.responseMsToLive,this.constructIdEndpoint),this.patchData=new u.n(this.linkPath,O,U,v,F,this.comparator,this.responseMsToLive,this.constructIdEndpoint),this.createData=new c.V(this.linkPath,O,U,v,F,B,this.responseMsToLive)}create(O,...U){return this.createData.create(O,...U)}patch(O,U){return this.patchData.patch(O,U)}update(O){return this.patchData.update(O)}commitUpdates(O){return this.patchData.commitUpdates(O)}createPatchFromCache(O){return this.patchData.createPatchFromCache(O)}findAll(O,U,v,...F){return this.findAllData.findAll(O,U,v,...F)}delete(O,U){return this.deleteData.delete(O,U)}deleteByHref(O,U){return this.deleteData.deleteByHref(O,U)}invoke(O,U,v){const F=this.requestService.generateRequestId();return this.getBrowseEndpoint().pipe((0,C.s)(1),(0,t.T)(B=>new d.t(B,O,"submissioncoarnotifyconfigmodel",U).toString()),(0,t.T)(B=>{const L=this.getInvocationFormData(v);return new y.E0(F,B,L)})).subscribe(B=>this.requestService.send(B)),this.rdbService.buildFromRequestUUID(F)}getInvocationFormData(O){const U=new FormData;return O.forEach(v=>{U.append("file",v)}),U}static{this.\u0275fac=function(U){return new(U||j)(D.KVO(a.B),D.KVO(p.o),D.KVO(h.$),D.KVO(_.Y),D.KVO(f.I))}}static{this.\u0275prov=D.jDH({token:j,factory:j.\u0275fac,providedIn:"root"})}}return j})()},44845:(z,R,n)=>{"use strict";n.d(R,{m:()=>y});var C=n(89488),t=n.n(C),p=n(96354),h=n(89777),c=n(30250),S=n(69289),I=n(12443),u=(n(67707),n(54438));let y=(()=>{class a{constructor(d,f,D){this.changeDetectorRef=d,this.submissionService=f,this.sectionService=D,this.mandatory=!0,this.genericSectionErrors=[],this.allSectionErrors=[],this.active=!0,this.sectionState=this.mandatory,this.subs=[]}ngOnInit(){this.valid=this.sectionService.isSectionValid(this.submissionId,this.sectionId).pipe((0,p.T)(d=>(d&&this.resetErrors(),d))),this.subs.push(this.sectionService.getShownSectionErrors(this.submissionId,this.sectionId,this.sectionType).subscribe(d=>{(0,h.hj)(d)?d.forEach(f=>{(0,S.A)(f.path).forEach(P=>{P.fieldId?this.allSectionErrors.push(f.message):this.genericSectionErrors=t()(this.genericSectionErrors.concat(f.message))})}):this.resetErrors()}),this.submissionService.getActiveSectionId(this.submissionId).subscribe(d=>{const f=this.active;this.active=d===this.sectionId,f!==this.active&&(this.changeDetectorRef.detectChanges(),!this.active&&(0,h.Pe)(d)&&this.submissionService.dispatchSave(this.submissionId))})),this.enabled=this.sectionService.isSectionEnabled(this.submissionId,this.sectionId)}ngOnDestroy(){this.subs.filter(d=>(0,h.a4)(d)).forEach(d=>d.unsubscribe())}sectionChange(d){this.sectionState=d.nextState}isOpen(){return this.sectionState}isMandatory(){return this.mandatory}isSectionActive(){return this.active}isEnabled(){return this.enabled}isValid(){return this.valid}removeSection(d,f){this.sectionService.removeSection(d,f)}hasGenericErrors(){return this.genericSectionErrors&&this.genericSectionErrors.length>0}hasErrors(){return this.genericSectionErrors&&this.genericSectionErrors.length>0||this.allSectionErrors&&this.allSectionErrors.length>0}getErrors(){return this.genericSectionErrors}setFocus(d){this.active||this.submissionService.setActiveSection(this.submissionId,this.sectionId)}isInfo(){return this.sectionService.getIsInformational(this.sectionType)}removeError(d){this.genericSectionErrors.splice(d)}resetErrors(){(0,h.hj)(this.genericSectionErrors)&&this.sectionService.dispatchRemoveSectionErrors(this.submissionId,this.sectionId),this.genericSectionErrors=[],this.allSectionErrors=[]}static{this.\u0275fac=function(f){return new(f||a)(u.rXU(u.gRc),u.rXU(c.E),u.rXU(I.c))}}static{this.\u0275dir=u.FsC({type:a,selectors:[["","dsSection",""]],inputs:{mandatory:"mandatory",sectionId:"sectionId",sectionType:"sectionType",submissionId:"submissionId"},exportAs:["sectionRef"],standalone:!0})}}return a})()},96298:(z,R,n)=>{"use strict";n.d(R,{_:()=>y});var C=n(43446),t=n(2086),p=n(4093),h=n(89777),c=n(54438);function S(a,_){if(1&a&&(c.j41(0,"span",0),c.EFF(1),c.k0s()),2&a){const d=c.XpG().$implicit;c.R7$(),c.E5c(" ",d.name," ",d.startDate," ",d.endDate," ")}}function I(a,_){if(1&a&&(c.j41(0,"span",0),c.EFF(1),c.k0s()),2&a){const d=c.XpG().$implicit;c.R7$(),c.Lme("",d.name," from ",d.endDate,"")}}function g(a,_){if(1&a&&(c.j41(0,"span",1),c.EFF(1),c.k0s()),2&a){const d=c.XpG().$implicit;c.R7$(),c.Lme("",d.name," until ",d.startDate,"")}}function u(a,_){if(1&a&&(c.DNE(0,S,2,3,"span",0)(1,I,2,2,"span",0)(2,g,2,2,"span",1),c.nrm(3,"br")),2&a){const d=_.$implicit;c.vxM("DEFAULT_BITSTREAM_READ"===d.action?0:-1),c.R7$(),c.vxM("lease"===d.name?1:-1),c.R7$(),c.vxM("embargo"===d.name?2:-1)}}let y=(()=>{class a{constructor(d,f){this.dsoNameService=d,this.groupService=f,this.accessConditionsList=[]}ngOnInit(){this.accessConditions.forEach(d=>{(0,h.Im)(d.name)?this.groupService.findByHref(d._links.group.href).pipe((0,p.qD)()).subscribe(f=>{if(f.hasSucceeded){const D=f.payload,P=Object.assign({},d);P.name=this.dsoNameService.getName(D),this.accessConditionsList.push(P)}}):this.accessConditionsList.push(d)})}static{this.\u0275fac=function(f){return new(f||a)(c.rXU(C.f),c.rXU(t.GroupDataService))}}static{this.\u0275cmp=c.VBU({type:a,selectors:[["ds-submission-section-upload-access-conditions"]],inputs:{accessConditions:"accessConditions"},standalone:!0,features:[c.aNF],decls:2,vars:0,consts:[[1,"badge","bg-primary","mt-3","me-2"],[1,"badge","bg-dark","mt-3","me-2"]],template:function(f,D){1&f&&c.Z7z(0,u,4,3,"br",null,c.fX1),2&f&&c.Dyx(D.accessConditionsList)},encapsulation:2})}}return a})()},8727:(z,R,n)=>{"use strict";n.r(R),n.d(R,{SubmissionSectionUploadFileComponent:()=>$t});var C=n(60177),t=n(68018),p=n(84412),h=n(5964),S=(n(75534),n(33553)),I=n(39592),g=n(21832),u=n(28690),y=n(79104),a=n(89777),_=n(96044),d=n(70338),f=n(30250),D=n(76668),P=n(1473),j=n(96697),k=n(73028),O=n(17964),U=n(50813),v=n(49838),F=n(86332);const T={id:"metadata",group:[]},b={element:{container:"mb-3",label:"col-form-label"},grid:{label:"col-sm-3"}},W={id:"accessConditionGroup",group:[]},K={element:{host:"mb-3 access-condition-group col",container:"ps-1 pe-1",control:"row "}},tt={id:"accessConditions",groupFactory:null},N={grid:{group:"row pt-4"}},J={id:"name",label:"submission.sections.upload.form.access-condition-label",hint:"submission.sections.upload.form.access-condition-hint",options:[]},Q={element:{host:"col-12",label:"col-form-label name-label"}},nt={element:{host:"col-12",container:"text-right"}},Z={id:"primary",name:"primary",label:"bitstream.edit.form.primaryBitstream.label"},rt={id:"startDate",label:"submission.sections.upload.form.from-label",hint:"submission.sections.upload.form.from-hint",placeholder:"submission.sections.upload.form.from-placeholder",inline:!1,toggleIcon:"far fa-calendar-alt",relations:[{match:P.AjF,operator:P.fXj,when:[]}],required:!0,validators:{required:null},errorMessages:{required:"submission.sections.upload.form.date-required-from"}},A={element:{label:"col-form-label"},grid:{host:"col-6"}},H={id:"endDate",label:"submission.sections.upload.form.until-label",hint:"submission.sections.upload.form.until-hint",placeholder:"submission.sections.upload.form.until-placeholder",inline:!1,toggleIcon:"far fa-calendar-alt",relations:[{match:P.AjF,operator:P.fXj,when:[]}],required:!0,validators:{required:null},errorMessages:{required:"submission.sections.upload.form.date-required-until"}},lt={element:{label:"col-form-label"},grid:{host:"col-6"}};var r=n(54438),Ct=n(58003);const Rt=["formRef"];function Bt(q,bt){if(1&q){const x=r.RV6();r.j41(0,"ds-form",6,0),r.bIt("submitForm",function(){r.eBV(x);const X=r.XpG();return r.Njj(X.onSubmit())})("cancel",function(){r.eBV(x);const X=r.XpG();return r.Njj(X.onModalClose())})("dfChange",function(X){r.eBV(x);const w=r.XpG();return r.Njj(w.onChange(X))}),r.k0s()}if(2&q){const x=r.XpG();r.Y8G("formId",x.formId)("formModel",x.formModel)("displaySubmit",!x.isSaving)("displayCancel",!x.isSaving)}}let Mt=(()=>{class q{constructor(x,$,X,w,V,it,et,_t){this.activeModal=x,this.cdr=$,this.formBuilderService=X,this.formService=w,this.submissionService=V,this.operationsBuilder=it,this.operationsService=et,this.uploadService=_t,this.formMetadata=[],this.isSaving=!1,this.subscriptions=[]}initModelData(x){this.formBuilderService.findById("primary",x,this.fileIndex).value=this.isPrimary||!1,this.fileData.accessConditions.forEach((X,w)=>{Array.of("name","startDate","endDate").filter(V=>X.hasOwnProperty(V)&&(0,a.hj)(X[V])).forEach(V=>{const it=this.formBuilderService.findById(V,x,w);if(it)if(it.type===P.fQD){const et=new Date(X[V]);it.value={year:et.getUTCFullYear(),month:et.getUTCMonth()+1,day:et.getUTCDate()}}else it.value=X[V]})})}onChange(x){"name"===x.model.id&&this.setOptions(x.model,x.control)}onModalClose(){this.activeModal.dismiss()}onSubmit(){this.isSaving=!0,this.saveBitstreamData()}setOptions(x,$){let X=null;if(this.availableAccessConditionOptions.filter(w=>w.name===$.value).forEach(w=>X=w),(0,a.hj)(X)){const w=$.parent.get("startDate"),V=$.parent.get("endDate");w?.markAsUntouched(),V?.markAsUntouched(),w?.setValue(null),$.parent.markAsDirty(),V?.setValue(null)}}ngOnInit(){this.fileData&&this.formId&&(this.formModel=this.buildFileEditForm(),this.cdr.detectChanges())}ngOnDestroy(){this.unsubscribeAll()}retrieveValueFromField(x){const $=Array.isArray(x)?x[0]:x;return $?$.value:void 0}buildFileEditForm(){const x=Object.assign({},this.configMetadataForm.rows[0].fields[0]);x.repeatable=!1;const $=Object.assign({},this.configMetadataForm,{fields:Object.assign([],this.configMetadataForm.rows[0].fields[0],[this.configMetadataForm.rows[0].fields[0],x])}),X=[];X.push(new O.i(Z,nt));const w=Object.assign({},T);w.group=this.formBuilderService.modelFromConfiguration(this.submissionId,$,this.collectionId,this.fileData.metadata,this.submissionService.getSubmissionScope()),X.push(new P.iO5(w,b));const V=Object.assign({},J),it=Object.assign({},tt),et=[];if(2===this.collectionPolicyType){for(const ct of this.availableAccessConditionOptions)et.push({label:ct.name,value:ct.name});V.options=et;const _t=[],mt=[];let ht,Dt;this.availableAccessConditionOptions.forEach(ct=>{if(ct.hasStartDate&&(_t.push({id:"name",value:ct.name}),ct.maxStartDate)){const st=new Date(ct.maxStartDate);ht={year:st.getUTCFullYear(),month:st.getUTCMonth()+1,day:st.getUTCDate()}}if(ct.hasEndDate&&(mt.push({id:"name",value:ct.name}),ct.maxEndDate)){const st=new Date(ct.maxEndDate);Dt={year:st.getUTCFullYear(),month:st.getUTCMonth()+1,day:st.getUTCDate()}}});const Xt={relations:[{match:P.AjF,operator:P.fXj,when:_t}]},Nt={relations:[{match:P.AjF,operator:P.fXj,when:mt}]},Gt=_t.length>0,yt=mt.length>0;it.groupFactory=()=>{const ct=new P.z4z(V,Q),st=Object.assign({},rt,Xt);ht&&(st.max=ht);const Ft=Object.assign({},H,Nt);Dt&&(Ft.max=Dt);const Kt=new P.dku(st,A),Vt=new P.dku(Ft,lt),St=Object.assign({},W);return St.group=[ct],Gt&&St.group.push(Kt),yt&&St.group.push(Vt),[new P.iO5(St,K)]},it.initialCount=(0,a.hj)(this.fileData.accessConditions)?this.fileData.accessConditions.length:1,X.push(new P.UqU(it,N))}return this.initModelData(X),X}saveBitstreamData(){const x=["files",this.fileIndex];this.formService.validateAllFormFields(this.formRef.formGroup);const $=this.formService.isValid(this.formId).pipe((0,j.s)(1),(0,h.p)(X=>X),(0,k.Z)(()=>this.formService.getFormData(this.formId)),(0,j.s)(1),(0,k.Z)(X=>{this.uploadService.updatePrimaryBitstreamOperation(this.pathCombiner.getPath("primary"),this.isPrimary,X.primary[0],this.fileId),Object.keys(X.metadata).filter(V=>(0,a.hj)(X.metadata[V])).forEach(V=>{const et=`metadata/${V.replace(/_/g,".")}`;this.operationsBuilder.add(this.pathCombiner.getPath([...x,et]),X.metadata[V],!0)}),Object.keys(this.fileData.metadata).filter(V=>(0,a.hj)(this.fileData.metadata[V])).filter(V=>(0,a.Tn)(X.metadata[V])).filter(V=>this.formMetadata.includes(V)).forEach(V=>{const et=`metadata/${V.replace(/_/g,".")}`;this.operationsBuilder.remove(this.pathCombiner.getPath([...x,et]))});const w=[];return X.hasOwnProperty("accessConditions")&&X.accessConditions.filter(V=>(0,a.Pe)(V)).map(V=>V.accessConditionGroup).filter(V=>(0,a.hj)(V)).forEach(V=>{let it;if(this.availableAccessConditionOptions.filter(et=>(0,a.Pe)(V.name)&&et.name===V.name[0].value).forEach(et=>it=et),it){const et=Object.assign({},V);if(et.name=this.retrieveValueFromField(V.name),it.hasStartDate){if(V.startDate){const _t=this.retrieveValueFromField(V.startDate);let mt=new Date(_t);if(it.maxStartDate){const ht=new Date(it.maxStartDate);mt>ht&&(mt=ht)}et.startDate=(0,U.Sd)(mt)}}else delete et.startDate;if(it.hasEndDate){if(V.endDate){const _t=this.retrieveValueFromField(V.endDate);let mt=new Date(_t);if(it.maxEndDate){const ht=new Date(it.maxEndDate);mt>ht&&(mt=ht)}et.endDate=(0,U.Sd)(mt)}}else delete et.endDate;w.push(et)}}),(0,a.hj)(w)&&this.operationsBuilder.add(this.pathCombiner.getPath([...x,"accessConditions"]),w,!0),this.operationsService.jsonPatchByResourceID(this.submissionService.getSubmissionObjectLinkName(),this.submissionId,this.pathCombiner.rootElement,this.pathCombiner.subRootElement)})).subscribe(X=>{const w=X[0].sections[this.sectionId];if(!w)return;const V=w;this.uploadService.updateFilePrimaryBitstream(this.submissionId,this.sectionId,V.primary),Object.keys(V.files).filter(it=>V.files[it].uuid===this.fileId).forEach(it=>this.uploadService.updateFileData(this.submissionId,this.sectionId,this.fileId,V.files[it])),this.isSaving=!1,this.activeModal.close()});this.subscriptions.push($)}unsubscribeAll(){this.subscriptions.filter(x=>(0,a.a4)(x)).forEach(x=>x.unsubscribe())}static{this.\u0275fac=function($){return new($||q)(r.rXU(Ct.Lw),r.rXU(r.gRc),r.rXU(v.j),r.rXU(d.u),r.rXU(f.E),r.rXU(I.C),r.rXU(u.U),r.rXU(D.i))}}static{this.\u0275cmp=r.VBU({type:q,selectors:[["ds-submission-section-upload-file-edit"]],viewQuery:function($,X){if(1&$&&r.GBs(Rt,5),2&$){let w;r.mGM(w=r.lsd())&&(X.formRef=w.first)}},standalone:!0,features:[r.aNF],decls:8,vars:5,consts:[["formRef","formComponent"],[1,"modal-header"],[1,"modal-title"],["type","button","aria-label","Close",1,"btn-close",3,"click","dsBtnDisabled"],[1,"modal-body"],[3,"formId","formModel","displaySubmit","displayCancel"],[3,"submitForm","cancel","dfChange","formId","formModel","displaySubmit","displayCancel"]],template:function($,X){1&$&&(r.j41(0,"div")(1,"div",1)(2,"h4",2),r.EFF(3),r.nI1(4,"translate"),r.k0s(),r.j41(5,"button",3),r.bIt("click",function(){return X.onModalClose()}),r.k0s()(),r.j41(6,"div",4),r.DNE(7,Bt,2,4,"ds-form",5),r.k0s()()),2&$&&(r.R7$(3),r.JRh(r.bMT(4,3,"submission.sections.upload.edit.title")),r.R7$(2),r.Y8G("dsBtnDisabled",X.isSaving),r.R7$(2),r.vxM(X.formModel?7:-1))},dependencies:[y.A,F.s,t.h,t.D9],styles:[".access-condition-group{position:relative;top:-2.3rem;margin-bottom:-2.3rem}"]})}}return q})();var Tt=n(4958);const Ot=q=>({fileName:q});function xt(q,bt){if(1&q&&(r.j41(0,"span",6),r.EFF(1),r.nI1(2,"translate"),r.k0s()),2&q){const x=r.XpG(2);r.R7$(),r.JRh(r.i5U(2,1,"submission.sections.upload.primary.make",r.eq3(4,Ot,x.fileName)))}}function Ut(q,bt){if(1&q&&(r.j41(0,"span",6),r.EFF(1),r.nI1(2,"translate"),r.k0s()),2&q){const x=r.XpG(2);r.R7$(),r.JRh(r.i5U(2,1,"submission.sections.upload.primary.remove",r.eq3(4,Ot,x.fileName)))}}function jt(q,bt){1&q&&r.nrm(0,"i",16)}function At(q,bt){1&q&&r.nrm(0,"i",17)}function vt(q,bt){if(1&q){const x=r.RV6();r.j41(0,"div",1)(1,"div",2)(2,"div",3)(3,"input",4),r.nI1(4,"async"),r.bIt("change",function(X){r.eBV(x);const w=r.XpG();return r.Njj(w.togglePrimaryBitstream(X))}),r.k0s(),r.j41(5,"label",5),r.DNE(6,xt,3,6,"span",6)(7,Ut,3,6,"span",6),r.k0s()()(),r.j41(8,"div",7)(9,"div",8),r.nrm(10,"ds-submission-section-upload-file-view",9),r.k0s(),r.j41(11,"div",10),r.qex(12),r.j41(13,"ds-file-download-link",11),r.nrm(14,"i",12),r.k0s(),r.j41(15,"button",13),r.nI1(16,"translate"),r.nI1(17,"translate"),r.bIt("click",function(X){r.eBV(x);const w=r.XpG();return X.preventDefault(),r.Njj(w.editBitstreamData())}),r.nrm(18,"i",14),r.k0s(),r.j41(19,"button",15),r.nI1(20,"translate"),r.nI1(21,"async"),r.nI1(22,"translate"),r.bIt("click",function(X){r.eBV(x);const w=r.XpG(),V=r.sdS(2);return X.preventDefault(),r.Njj(w.confirmDelete(V))}),r.DNE(23,jt,1,0,"i",16),r.nI1(24,"async"),r.DNE(25,At,1,0,"i",17),r.nI1(26,"async"),r.k0s(),r.bVm(),r.k0s(),r.nrm(27,"div",18),r.k0s()()}if(2&q){const x=r.XpG();r.R7$(3),r.Mz_("id","primaryBitstream",x.fileIndex,""),r.Y8G("disabled",r.bMT(4,21,x.processingSaveStatus$))("checked",x.isPrimary),r.R7$(2),r.Mz_("for","primaryBitstream",x.fileIndex,""),r.R7$(),r.vxM(x.isPrimary?-1:6),r.R7$(),r.vxM(x.isPrimary?7:-1),r.R7$(3),r.Y8G("fileData",x.fileData),r.R7$(3),r.Y8G("cssClasses","btn btn-link-focus")("isBlank",!0)("bitstream",x.getBitstream())("enableRequestACopy",!1)("showAccessStatusBadge",!1),r.R7$(2),r.FS9("title",r.bMT(16,23,"submission.sections.upload.edit.title")),r.BMQ("aria-label",r.bMT(17,25,"submission.sections.upload.edit.title")),r.R7$(4),r.FS9("title",r.bMT(20,27,"submission.sections.upload.delete.confirm.title")),r.Y8G("dsBtnDisabled",r.bMT(21,29,x.processingDelete$)),r.BMQ("aria-label",r.bMT(22,31,"submission.sections.upload.delete.confirm.title")),r.R7$(4),r.vxM(r.bMT(24,33,x.processingDelete$)?23:-1),r.R7$(2),r.vxM(!0!==r.bMT(26,35,x.processingDelete$)?25:-1)}}function Lt(q,bt){if(1&q){const x=r.RV6();r.j41(0,"div",19)(1,"h4",20),r.EFF(2),r.nI1(3,"translate"),r.k0s(),r.j41(4,"button",21),r.bIt("click",function(){const X=r.eBV(x).dismiss;return r.Njj(X("cancel"))}),r.k0s()(),r.j41(5,"div",22)(6,"p"),r.EFF(7),r.nI1(8,"translate"),r.k0s()(),r.j41(9,"div",23)(10,"button",24),r.bIt("click",function(){const X=r.eBV(x).close;return r.Njj(X("cancel"))}),r.EFF(11),r.nI1(12,"translate"),r.k0s(),r.j41(13,"button",25),r.bIt("click",function(){const X=r.eBV(x).close;return r.Njj(X("ok"))}),r.EFF(14),r.nI1(15,"translate"),r.k0s()()}2&q&&(r.R7$(2),r.JRh(r.bMT(3,4,"submission.sections.upload.delete.confirm.title")),r.R7$(5),r.JRh(r.bMT(8,6,"submission.sections.upload.delete.confirm.info")),r.R7$(4),r.JRh(r.bMT(12,8,"submission.sections.upload.delete.confirm.cancel")),r.R7$(3),r.JRh(r.bMT(15,10,"submission.sections.upload.delete.confirm.submit")))}let $t=(()=>{class q{constructor(x,$,X,w,V,it){this.formService=x,this.modalService=$,this.operationsBuilder=X,this.operationsService=w,this.submissionService=V,this.uploadService=it,this.processingDelete$=new p.t(!1),this.subscriptions=[],this.formMetadata=[],this.readMode=!0}ngOnChanges(x){this.availableAccessConditionOptions&&this.subscriptions.push(this.uploadService.getFileData(this.submissionId,this.sectionId,this.fileId).pipe((0,h.p)($=>(0,a.EA)($))).subscribe($=>{this.fileData=$}))}ngOnInit(){this.formId=this.formService.getUniqueId(this.fileId),this.processingSaveStatus$=this.submissionService.getSubmissionSaveProcessingStatus(this.submissionId),this.pathCombiner=new S.S("sections",this.sectionId),this.loadFormMetadata()}confirmDelete(x){this.modalService.open(x).result.then($=>{"ok"===$&&(this.processingDelete$.next(!0),this.deleteFile())})}getBitstream(){return Object.assign(new g._,{uuid:this.fileData.uuid})}editBitstreamData(){const $=this.modalService.open(Mt,{size:"xl",backdrop:"static"});$.componentInstance.availableAccessConditionOptions=this.availableAccessConditionOptions,$.componentInstance.collectionId=this.collectionId,$.componentInstance.collectionPolicyType=this.collectionPolicyType,$.componentInstance.configMetadataForm=this.configMetadataForm,$.componentInstance.fileData=this.fileData,$.componentInstance.fileId=this.fileId,$.componentInstance.fileIndex=this.fileIndex,$.componentInstance.formId=this.formId,$.componentInstance.sectionId=this.sectionId,$.componentInstance.formMetadata=this.formMetadata,$.componentInstance.pathCombiner=this.pathCombiner,$.componentInstance.submissionId=this.submissionId,$.componentInstance.isPrimary=this.isPrimary}togglePrimaryBitstream(x){this.uploadService.updatePrimaryBitstreamOperation(this.pathCombiner.getPath("primary"),this.isPrimary,x.target.checked,this.fileId),this.submissionService.dispatchSaveSection(this.submissionId,this.sectionId)}ngOnDestroy(){this.unsubscribeAll()}unsubscribeAll(){this.subscriptions.filter(x=>(0,a.a4)(x)).forEach(x=>x.unsubscribe())}loadFormMetadata(){this.configMetadataForm.rows.forEach(x=>{x.fields.forEach($=>{$.selectableMetadata.forEach(X=>{this.formMetadata.push(X.metadata)})})})}deleteFile(){this.operationsBuilder.remove(this.pathCombiner.getPath(["files",this.fileIndex])),this.isPrimary&&this.operationsBuilder.remove(this.pathCombiner.getPath("primary")),this.subscriptions.push(this.operationsService.jsonPatchByResourceID(this.submissionService.getSubmissionObjectLinkName(),this.submissionId,this.pathCombiner.rootElement,this.pathCombiner.subRootElement).subscribe(()=>{this.isPrimary&&this.uploadService.updateFilePrimaryBitstream(this.submissionId,this.sectionId,null),this.uploadService.removeUploadedFile(this.submissionId,this.sectionId,this.fileId),this.processingDelete$.next(!1)}))}static{this.\u0275fac=function($){return new($||q)(r.rXU(d.u),r.rXU(Ct.Bq),r.rXU(I.C),r.rXU(u.U),r.rXU(f.E),r.rXU(D.i))}}static{this.\u0275cmp=r.VBU({type:q,selectors:[["ds-base-submission-upload-section-file"]],viewQuery:function($,X){if(1&$&&r.GBs(Mt,5),2&$){let w;r.mGM(w=r.lsd())&&(X.fileEditComp=w.first)}},inputs:{isPrimary:"isPrimary",availableAccessConditionOptions:"availableAccessConditionOptions",collectionId:"collectionId",collectionPolicyType:"collectionPolicyType",configMetadataForm:"configMetadataForm",fileId:"fileId",fileIndex:"fileIndex",fileName:"fileName",sectionId:"sectionId",submissionId:"submissionId"},standalone:!0,features:[r.OA$,r.aNF],decls:3,vars:1,consts:[["content",""],[1,"row"],[1,"col-md-2","d-flex","justify-content-center","align-items-center"],[1,"form-check","form-switch"],["type","checkbox",1,"form-check-input",3,"change","id","disabled","checked"],[1,"form-check-label",3,"for"],[1,"sr-only"],[1,"col-md-10"],[1,"float-start","w-75"],[3,"fileData"],[1,"float-end","w-15"],[3,"cssClasses","isBlank","bitstream","enableRequestACopy","showAccessStatusBadge"],["aria-hidden","true",1,"fa","fa-download","fa-2x","text-normal"],[1,"btn","btn-link-focus",3,"click","title"],[1,"fa","fa-edit","fa-2x","text-normal"],[1,"btn","btn-link-focus",3,"click","title","dsBtnDisabled"],[1,"fas","fa-circle-notch","fa-spin","fa-2x","link-danger"],[1,"fa","fa-trash","fa-2x","link-danger"],[1,"clearfix"],[1,"modal-header"],[1,"modal-title","text-danger"],["type","button","aria-label","Close",1,"btn-close",3,"click"],[1,"modal-body"],[1,"modal-footer"],["type","button",1,"btn","btn-secondary",3,"click"],["type","button",1,"btn","btn-danger",3,"click"]],template:function($,X){1&$&&r.DNE(0,vt,28,37,"div",1)(1,Lt,16,12,"ng-template",null,0,r.C5r),2&$&&r.vxM(X.fileData?0:-1)},dependencies:[C.Jj,y.A,Tt.h,_.z,t.h,t.D9]})}}return q})()},4958:(z,R,n)=>{"use strict";n.d(R,{h:()=>v});var C=n(68018),t=n(61880),p=n(89777),h=n(81829),c=n(54438);let S=(()=>{class F{transform(L,T){if((0,p.a4)(L)){const b=T&&T.length>0?parseInt(T[0],10):10;return L.length>b?L.substring(0,b)+"...":L}return L}static{this.\u0275fac=function(T){return new(T||F)}}static{this.\u0275pipe=c.EJ8({name:"dsTruncate",type:F,pure:!0,standalone:!0})}}return F})();var I=n(96298);const g=()=>["150"],u=F=>({format:F});function y(F,B){if(1&F&&(c.j41(0,"h3"),c.EFF(1),c.j41(2,"span",3),c.EFF(3),c.nI1(4,"dsFileSize"),c.k0s()()),2&F){const L=c.XpG().$implicit,T=c.XpG(2);c.R7$(),c.SpI(" ",L.value," "),c.R7$(2),c.SpI("(",c.bMT(4,2,null==T.fileData?null:T.fileData.sizeBytes),")")}}function a(F,B){if(1&F&&(c.j41(0,"h5")(1,"span",3),c.EFF(2),c.nI1(3,"translate"),c.k0s()()),2&F){const L=c.XpG(4);c.R7$(2),c.Lme("",c.bMT(3,2,"submission.sections.upload.no-entry")," ",L.fileTitleKey,"")}}function _(F,B){if(1&F&&c.DNE(0,a,4,4,"h5"),2&F){const L=c.XpG().$implicit,T=c.XpG(2);c.vxM(0===T.metadata[T.fileTitleKey].indexOf(L)?0:-1)}}function d(F,B){if(1&F&&(c.DNE(0,y,5,4,"h3")(1,_,1,1),c.nrm(2,"span",1)),2&F){const L=B.$implicit;c.vxM(""!==L.value?0:-1),c.R7$(),c.vxM(""===L.value?1:-1)}}function f(F,B){if(1&F&&(c.EFF(0),c.nI1(1,"dsTruncate")),2&F){const L=c.XpG().$implicit;c.SpI(" ",c.i5U(1,1,L.value,c.lJ4(4,g))," ")}}function D(F,B){if(1&F&&(c.j41(0,"span",3),c.EFF(1),c.nI1(2,"translate"),c.k0s()),2&F){const L=c.XpG(4);c.R7$(),c.Lme("",c.bMT(2,2,"submission.sections.upload.no-entry")," ",L.fileDescrKey,"")}}function P(F,B){if(1&F&&c.DNE(0,D,3,4,"span",3),2&F){const L=c.XpG().$implicit,T=c.XpG(2);c.vxM(0===T.metadata[T.fileDescrKey].indexOf(L)?0:-1)}}function j(F,B){if(1&F&&(c.DNE(0,f,2,5)(1,P,1,1),c.nrm(2,"span",1)),2&F){const L=B.$implicit;c.vxM(""!==L.value?0:-1),c.R7$(),c.vxM(""===L.value?1:-1)}}function k(F,B){if(1&F&&(c.Z7z(0,d,3,2,"span",1,c.fX1),c.Z7z(2,j,3,2,"span",1,c.fX1)),2&F){const L=c.XpG();c.Dyx(L.getAllMetadataValue(L.fileTitleKey)),c.R7$(2),c.Dyx(L.getAllMetadataValue(L.fileDescrKey))}}function O(F,B){if(1&F&&(c.j41(0,"div",0),c.EFF(1),c.nI1(2,"translate"),c.k0s()),2&F){const L=c.XpG();c.R7$(),c.SpI(" ",c.i5U(2,1,"admin.registries.bitstream-formats.edit.head",c.eq3(4,u,L.fileFormat))," ")}}function U(F,B){if(1&F&&(c.j41(0,"div",0),c.EFF(1),c.k0s()),2&F){const L=c.XpG();c.R7$(),c.Lme(" Checksum ",L.fileCheckSum.checkSumAlgorithm,": ",L.fileCheckSum.value," ")}}let v=(()=>{class F{constructor(){this.metadata=Object.create({}),this.fileTitleKey="Title",this.fileDescrKey="Description"}ngOnInit(){(0,p.hj)(this.fileData.metadata)&&(this.metadata[this.fileTitleKey]=t.O.all(this.fileData.metadata,"dc.title"),this.metadata[this.fileDescrKey]=t.O.all(this.fileData.metadata,"dc.description")),this.fileCheckSum=this.fileData.checkSum,this.fileFormat=this.fileData.format.shortDescription}getAllMetadataValue(L){return t.O.all(this.metadata,L)}static{this.\u0275fac=function(T){return new(T||F)}}static{this.\u0275cmp=c.VBU({type:F,selectors:[["ds-submission-section-upload-file-view"]],inputs:{fileData:"fileData"},standalone:!0,features:[c.aNF],decls:6,vars:4,consts:[[1,"mt-1"],[1,"clearfix"],[3,"accessConditions"],[1,"text-muted"]],template:function(T,b){1&T&&(c.j41(0,"div"),c.DNE(1,k,4,0)(2,O,3,6,"div",0)(3,U,2,2,"div",0),c.nrm(4,"span",1)(5,"ds-submission-section-upload-access-conditions",2),c.k0s()),2&T&&(c.R7$(),c.vxM(b.metadata?1:-1),c.R7$(),c.vxM(b.fileFormat?2:-1),c.R7$(),c.vxM(b.fileCheckSum?3:-1),c.R7$(2),c.Y8G("accessConditions",b.fileData.accessConditions))},dependencies:[h.s,I._,C.h,C.D9,S],encapsulation:2})}}return F})()},76668:(z,R,n)=>{"use strict";n.d(R,{i:()=>y});var C=n(96354),t=n(23294),p=n(5964),h=n(39592),c=n(89777),S=n(8734),I=n(91261),g=n(54438),u=n(59640);let y=(()=>{class a{constructor(d,f){this.store=d,this.operationsBuilder=f}updatePrimaryBitstreamOperation(d,f,D,P){if(null===f&&D)this.operationsBuilder.add(d,P,!1,!0);else if(f!==D){if(D)return void this.operationsBuilder.replace(d,P,!0);this.operationsBuilder.remove(d)}}getUploadedFilesData(d,f){return this.store.select((0,I.on)(d,f)).pipe((0,C.T)(D=>D),(0,t.F)())}getUploadedFileList(d,f){return this.store.select((0,I.Uh)(d,f)).pipe((0,C.T)(D=>D),(0,t.F)())}getFileData(d,f,D){return this.store.select((0,I.Uh)(d,f)).pipe((0,p.p)(P=>!(0,c.b0)(P)),(0,C.T)(P=>{let j;return Object.keys(P).filter(k=>P[k].uuid===D).forEach(k=>j=P[k]),j}),(0,t.F)())}getDefaultPolicies(d,f,D){return this.store.select((0,I.hi)(d,f,D)).pipe((0,C.T)(P=>P),(0,t.F)())}addUploadedFile(d,f,D,P){this.store.dispatch(new S.Bo(d,f,D,P))}updateFilePrimaryBitstream(d,f,D){this.store.dispatch(new S.w7(d,f,D))}updateFileData(d,f,D,P){this.store.dispatch(new S.nt(d,f,D,P))}removeUploadedFile(d,f,D){this.store.dispatch(new S.IE(d,f,D))}static{this.\u0275fac=function(f){return new(f||a)(g.KVO(u.il),g.KVO(h.C))}}static{this.\u0275prov=g.jDH({token:a,factory:a.\u0275fac,providedIn:"root"})}}return a})()},89488:(z,R,n)=>{var C=n(73136);z.exports=function t(p){return p&&p.length?C(p):[]}},9048:(z,R,n)=>{var C={"./custom/app/submission/edit/submission-edit.component":[45393,5393]};function t(p){if(!n.o(C,p))return Promise.resolve().then(()=>{var S=new Error("Cannot find module '"+p+"'");throw S.code="MODULE_NOT_FOUND",S});var h=C[p],c=h[0];return n.e(h[1]).then(()=>n(c))}t.keys=()=>Object.keys(C),t.id=9048,z.exports=t},46274:(z,R,n)=>{var C={"./custom/app/submission/form/footer/submission-form-footer.component":[57807,7807]};function t(p){if(!n.o(C,p))return Promise.resolve().then(()=>{var S=new Error("Cannot find module '"+p+"'");throw S.code="MODULE_NOT_FOUND",S});var h=C[p],c=h[0];return n.e(h[1]).then(()=>n(c))}t.keys=()=>Object.keys(C),t.id=46274,z.exports=t},21392:(z,R,n)=>{var C={"./custom/app/submission/form/submission-form.component":[90525,525]};function t(p){if(!n.o(C,p))return Promise.resolve().then(()=>{var S=new Error("Cannot find module '"+p+"'");throw S.code="MODULE_NOT_FOUND",S});var h=C[p],c=h[0];return n.e(h[1]).then(()=>n(c))}t.keys=()=>Object.keys(C),t.id=21392,z.exports=t},28767:(z,R,n)=>{var C={"./custom/app/submission/form/submission-upload-files/submission-upload-files.component.ts":[31383,1383]};function t(p){if(!n.o(C,p))return Promise.resolve().then(()=>{var S=new Error("Cannot find module '"+p+"'");throw S.code="MODULE_NOT_FOUND",S});var h=C[p],c=h[0];return n.e(h[1]).then(()=>n(c))}t.keys=()=>Object.keys(C),t.id=28767,z.exports=t},20174:(z,R,n)=>{var C={"./custom/app/submission/sections/container/section-container.component":[27855,7855]};function t(p){if(!n.o(C,p))return Promise.resolve().then(()=>{var S=new Error("Cannot find module '"+p+"'");throw S.code="MODULE_NOT_FOUND",S});var h=C[p],c=h[0];return n.e(h[1]).then(()=>n(c))}t.keys=()=>Object.keys(C),t.id=20174,z.exports=t},96682:(z,R,n)=>{var C={"./custom/app/submission/sections/upload/file/section-upload-file.component":[24433,4433]};function t(p){if(!n.o(C,p))return Promise.resolve().then(()=>{var S=new Error("Cannot find module '"+p+"'");throw S.code="MODULE_NOT_FOUND",S});var h=C[p],c=h[0];return n.e(h[1]).then(()=>n(c))}t.keys=()=>Object.keys(C),t.id=96682,z.exports=t}}]);