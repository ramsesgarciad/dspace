(self.webpackChunkdspace_angular=self.webpackChunkdspace_angular||[]).push([[9916],{74593:($,I,o)=>{"use strict";o.d(I,{G:()=>C,o:()=>d});var g=o(96354),e=o(15343),m=o(89777),p=o(4093);const C=(T,f,l,b,...S)=>d(T,f,T.params.id,l,b,...S),d=(T,f,l,b,S,...E)=>S.findById(l,!0,!1,...E).pipe((0,p.qD)(),(0,p.Bo)(),(0,g.T)(O=>{if((0,m.a4)(O))return{provider:b,key:O,url:(0,e.wN)(O)}}))},85360:($,I,o)=>{"use strict";o.d(I,{L:()=>m});var g=o(96354),e=o(69944);const m=(p,C)=>(0,e.FO)(p,(d,T)=>C(d,T).pipe((0,g.T)(f=>[f])))},69944:($,I,o)=>{"use strict";o.d(I,{FO:()=>T});var g=o(96354),e=o(89777),m=o(4093),p=o(8245);const d=f=>(l,b)=>{const S=(f=>{let l=f;for(;(0,e.Tn)(l.params.id)&&(0,e.a4)(l.parent);)l=l.parent;return l})(l);return f(S,b).pipe((0,m.Hz)(),(0,g.T)(E=>E.self))},T=(f,l,b=d,S)=>(0,p.h)((E,O)=>l(E,O),b(f()),S)},1939:($,I,o)=>{"use strict";o.d(I,{r:()=>E});var g=o(84572),e=o(96354),m=o(25558),p=o(89777),C=o(94925),d=o(89894),T=o(19252),f=o(4093),l=o(5127),b=o(54438),S=o(7901);let E=(()=>{class O{constructor(h,_,F,D){this._window=h,this.configurationService=_,this.researcherProfileService=F,this.router=D}isLinkedToOrcid(h){return h.hasMetadata("dspace.orcid.authenticated")}onlyAdminCanDisconnectProfileFromOrcid(){return this.getOrcidDisconnectionAllowedUsersConfiguration().pipe((0,e.T)(h=>h.hasSucceeded&&h.payload.values.map(_=>_.toLowerCase()).includes("only_admin")))}ownerCanDisconnectProfileFromOrcid(){return this.getOrcidDisconnectionAllowedUsersConfiguration().pipe((0,e.T)(h=>h.hasSucceeded&&h.payload.values.map(_=>_.toLowerCase()).includes("admin_and_owner")))}linkOrcidByItem(h,_){const F=[{path:"/orcid",op:"add",value:_}];return this.researcherProfileService.findById(h.firstMetadata("dspace.object.owner").authority).pipe((0,f.qD)(),(0,m.n)(D=>this.researcherProfileService.patch(D.payload,F)))}unlinkOrcidByItem(h){const _=[{path:"/orcid",op:"remove"}];return this.researcherProfileService.findById(h.firstMetadata("dspace.object.owner").authority).pipe((0,f.qD)(),(0,m.n)(F=>this.researcherProfileService.patch(F.payload,_)))}getOrcidAuthorizeUrl(h){return(0,g.z)([this.configurationService.findByPropertyName("orcid.authorize-url").pipe((0,f.ak)()),this.configurationService.findByPropertyName("orcid.application-client-id").pipe((0,f.ak)()),this.configurationService.findByPropertyName("orcid.scope").pipe((0,f.ak)())]).pipe((0,e.T)(([_,F,D])=>{const U=new l.t(this._window.nativeWindow.origin,encodeURIComponent(this.router.url.split("?")[0]));return _.values[0]+"?client_id="+F.values[0]+"&redirect_uri="+U+"&response_type=code&scope="+D.values.join(" ")}))}getOrcidAuthorizationScopesByItem(h){return(0,p.hj)(h)?h.allMetadataValues("dspace.orcid.scope"):[]}getOrcidAuthorizationScopes(){return this.configurationService.findByPropertyName("orcid.scope").pipe((0,f.qD)(),(0,e.T)(h=>h.hasSucceeded?h.payload.values:[]))}getOrcidDisconnectionAllowedUsersConfiguration(){return this.configurationService.findByPropertyName("orcid.disconnection.allowed-users").pipe((0,f.qD)())}static{this.\u0275fac=function(_){return new(_||O)(b.KVO(T.lc),b.KVO(C.ConfigurationDataService),b.KVO(d.ResearcherProfileDataService),b.KVO(S.Ix))}}static{this.\u0275prov=b.jDH({token:O,factory:O.\u0275fac,providedIn:"root"})}}return O})()},10817:($,I,o)=>{"use strict";o.d(I,{j:()=>m});const e={RESOLVED:(0,o(6800).N)("dspace/resolver/RESOLVED")};class m{constructor(C,d){this.type=e.RESOLVED,this.payload={url:C,dso:d}}}},59916:($,I,o)=>{"use strict";o.r(I),o.d(I,{ROUTES:()=>Xt});var g=o(15343),e=o(54438),m=o(7901),p=o(96354),C=o(88141),d=o(89777),T=o(12970),f=o(19548),l=o(4093),b=o(94196);const S=(s,r,t=(0,e.WQX)(m.Ix),n=(0,e.WQX)(b.uR),i=(0,e.WQX)(T.W))=>{const a=s.queryParams.accessToken;return(0,d.a4)(a)?i.getSanitizedRequestByAccessToken(a).pipe((0,l.qD)(),(0,f.QD)(t,n),(0,p.T)(u=>u),(0,l.ak)(),(0,C.M)(u=>((0,d.a4)(u)||t.navigateByUrl((0,g.bZ)()),u))):null};var E=o(85643),O=o(67849),x=o(61206),h=o(74593),_=o(46541),D=o(10686),U=o(66423),R=o(60177),c=o(89417),v=o(68018),k=o(84572),N=o(7673),B=o(5964),P=o(25558),j=o(96697),W=o(43446),re=o(4266),ce=o(11873),w=o(6170),le=o(7094);let de=(()=>{class s{constructor(t){this.halService=t,this.linkPath="captcha"}getChallengeHref(){return this.getEndpoint().pipe((0,p.T)(t=>t+"/challenge"))}getEndpoint(){return this.halService.getEndpoint(this.linkPath)}static{this.\u0275fac=function(n){return new(n||s)(e.KVO(le.Y))}}static{this.\u0275prov=e.jDH({token:s,factory:s.\u0275fac,providedIn:"root"})}}return s})();var ue=o(43588),Z=o(79104),X=o(9847),A=o(92767);let pe=(()=>{class s{constructor(){this.autoload="onload",this.payload=new e.bkB}ngOnInit(){document.querySelector("#altcha-widget").addEventListener("statechange",t=>{"verified"===t.detail.state&&this.payload.emit(t.detail.payload)})}static{this.\u0275fac=function(n){return new(n||s)}}static{this.\u0275cmp=e.VBU({type:s,selectors:[["ds-altcha-captcha"]],inputs:{challengeUrl:"challengeUrl",autoload:"autoload",debug:"debug"},outputs:{payload:"payload"},standalone:!0,features:[e.aNF],decls:1,vars:2,consts:[["id","altcha-widget","expire","100000","workers","16",3,"auto","challengeurl"]],template:function(n,i){1&n&&e.nrm(0,"altcha-widget",0),2&n&&(e.FS9("auto",i.autoload),e.FS9("challengeurl",i.challengeUrl))},dependencies:[c.X1,v.h],encapsulation:2})}}return s})();function me(s,r){if(1&s&&(e.j41(0,"div",2)(1,"span"),e.EFF(2),e.nI1(3,"translate"),e.k0s(),e.j41(4,"a",3),e.EFF(5),e.nI1(6,"translate"),e.k0s()()),2&s){const t=e.XpG();e.R7$(2),e.JRh(e.bMT(3,3,"bitstream-request-a-copy.alert.canDownload1")),e.R7$(2),e.Y8G("routerLink",t.getBitstreamLink()),e.R7$(),e.JRh(e.bMT(6,5,"bitstream-request-a-copy.alert.canDownload2"))}}function he(s,r){if(1&s&&(e.j41(0,"p"),e.EFF(1),e.nI1(2,"translate"),e.k0s()),2&s){const t=e.XpG();e.R7$(),e.Lme("",e.bMT(2,2,"bitstream-request-a-copy.intro.bitstream.one")," ",t.bitstreamName,"")}}function ge(s,r){1&s&&(e.j41(0,"p"),e.EFF(1),e.nI1(2,"translate"),e.k0s()),2&s&&(e.R7$(),e.JRh(e.bMT(2,1,"bitstream-request-a-copy.intro.bitstream.all")))}function fe(s,r){1&s&&(e.j41(0,"span"),e.EFF(1),e.nI1(2,"translate"),e.k0s()),2&s&&(e.R7$(),e.SpI(" ",e.bMT(2,1,"bitstream-request-a-copy.name.error")," "))}function ve(s,r){if(1&s&&(e.j41(0,"div",10),e.DNE(1,fe,3,3,"span"),e.k0s()),2&s){const t=e.XpG();e.R7$(),e.vxM(t.name.errors&&t.name.errors.required?1:-1)}}function ye(s,r){1&s&&(e.j41(0,"span"),e.EFF(1),e.nI1(2,"translate"),e.k0s()),2&s&&(e.R7$(),e.SpI(" ",e.bMT(2,1,"bitstream-request-a-copy.email.error")," "))}function be(s,r){if(1&s&&(e.j41(0,"div",10),e.DNE(1,ye,3,3,"span"),e.k0s()),2&s){const t=e.XpG();e.R7$(),e.vxM(t.email.errors?1:-1)}}function _e(s,r){if(1&s){const t=e.RV6();e.j41(0,"div")(1,"ds-altcha-captcha",26),e.nI1(2,"async"),e.bIt("payload",function(i){e.eBV(t);const a=e.XpG();return e.Njj(a.handlePayload(i))}),e.k0s()()}if(2&s){const t=e.XpG();e.R7$(),e.FS9("challengeUrl",e.bMT(2,1,t.challengeHref$))}}let Ce=(()=>{class s{constructor(t,n,i,a,u,y,z,Q,H,Gt,zt,Vt,Lt){this.location=t,this.translateService=n,this.route=i,this.router=a,this.authorizationService=u,this.auth=y,this.formBuilder=z,this.itemRequestDataService=Q,this.notificationsService=H,this.dsoNameService=Gt,this.bitstreamService=zt,this.captchaService=Vt,this.changeDetectorRef=Lt,this.subs=[]}ngOnInit(){this.requestCopyForm=this.formBuilder.group({name:new c.hs("",{validators:[c.k0.required]}),email:new c.hs("",{validators:[c.k0.required,c.k0.pattern("^[a-z0-9._%+-]+@[a-z0-9.-]+.[a-z]{2,4}$")]}),allfiles:new c.hs(""),message:new c.hs(""),captchaPayload:new c.hs("",{validators:[c.k0.required]})}),this.captchaEnabled$=this.itemRequestDataService.isProtectedByCaptcha(),this.challengeHref$=this.captchaService.getChallengeHref(),this.item$=this.route.data.pipe((0,p.T)(n=>n.dso),(0,l.ak)()),this.subs.push(this.item$.subscribe(n=>{this.item=n,this.itemName=this.dsoNameService.getName(n)})),this.bitstream$=this.route.queryParams.pipe((0,B.p)(n=>(0,d.a4)(n)&&(0,d.a4)(n.bitstream)),(0,P.n)(n=>this.bitstreamService.findById(n.bitstream)),(0,l.ak)()),this.subs.push(this.bitstream$.subscribe(n=>{this.bitstream=n,this.bitstreamName=this.dsoNameService.getName(n)})),this.canDownload$=this.bitstream$.pipe((0,P.n)(n=>this.authorizationService.isAuthorized(w._.CanDownload,(0,d.hj)(n)?n.self:void 0)));const t=this.bitstream$.pipe((0,P.n)(n=>this.authorizationService.isAuthorized(w._.CanRequestACopy,(0,d.hj)(n)?n.self:void 0)));this.subs.push((0,k.z)([this.canDownload$,t]).subscribe(([n,i])=>{!n&&!i&&this.router.navigateByUrl((0,g.bZ)(),{skipLocationChange:!0})})),this.initValues()}get name(){return this.requestCopyForm.get("name")}get email(){return this.requestCopyForm.get("email")}get message(){return this.requestCopyForm.get("message")}get allfiles(){return this.requestCopyForm.get("allfiles")}get captchaPayload(){return this.requestCopyForm.get("captchaPayload")}initValues(){this.getCurrentUser().pipe((0,j.s)(1)).subscribe(t=>{this.requestCopyForm.patchValue({allfiles:"true"}),(0,d.a4)(t)&&this.requestCopyForm.patchValue({name:t.name,email:t.email})}),this.bitstream$.pipe((0,j.s)(1)).subscribe(t=>{this.requestCopyForm.patchValue({allfiles:"false"})}),this.subs.push(this.captchaEnabled$.pipe((0,j.s)(1)).subscribe(t=>{t||(this.requestCopyForm.get("captchaPayload").clearValidators(),this.requestCopyForm.get("captchaPayload").reset(),this.requestCopyForm.updateValueAndValidity()),this.changeDetectorRef.detectChanges()}))}getCurrentUser(){return this.auth.isAuthenticated().pipe((0,P.n)(t=>t?this.auth.getAuthenticatedUserFromStore():(0,N.of)(void 0)))}onSubmit(){const t=new ue.b;(0,d.a4)(this.bitstream)&&(t.bitstreamId=this.bitstream.uuid),t.itemId=this.item.uuid,t.allfiles=this.allfiles.value,t.requestEmail=this.email.value,t.requestName=this.name.value,t.requestMessage=this.message.value,this.itemRequestDataService.requestACopy(t,this.captchaPayload.value).pipe((0,l.qD)()).subscribe(i=>{i.hasSucceeded?(this.notificationsService.success(this.translateService.get("bitstream-request-a-copy.submit.success")),this.navigateBack()):this.notificationsService.error(this.translateService.get("bitstream-request-a-copy.submit.error"))})}handlePayload(t){this.requestCopyForm.patchValue({captchaPayload:t})}ngOnDestroy(){(0,d.a4)(this.subs)&&this.subs.forEach(t=>{(0,d.a4)(t)&&t.unsubscribe()})}navigateBack(){this.location.back()}getItemPath(){return[(0,A._o)(this.item)]}getBitstreamLink(){return[(0,g.hV)(this.bitstream)]}static{this.\u0275fac=function(n){return new(n||s)(e.rXU(R.aZ),e.rXU(v.c$),e.rXU(m.nX),e.rXU(m.Ix),e.rXU(ce.AuthorizationDataService),e.rXU(b.uR),e.rXU(c.ze),e.rXU(T.W),e.rXU(X.I),e.rXU(W.f),e.rXU(re.BitstreamDataService),e.rXU(de),e.rXU(e.gRc))}}static{this.\u0275cmp=e.VBU({type:s,selectors:[["ds-bitstream-request-a-copy-page"]],standalone:!0,features:[e.aNF],decls:66,vars:55,consts:[[1,"container"],[1,"mb-4"],[1,"alert","alert-success"],[3,"routerLink"],[3,"ngSubmit","formGroup"],[1,"mb-3"],[1,"row","mb-4"],[1,"col-12"],["for","name",1,"form-label"],["type","text","id","name","formControlName","name",3,"className"],[1,"invalid-feedback","show-feedback"],["for","email",1,"form-label"],["id","email","formControlName","email",3,"className"],[1,"text-muted","ds-hint"],[1,"ms-2","form-check"],["type","radio","id","allfiles-true","formControlName","allfiles","value","true",3,"className"],["for","allfiles-true",1,"form-check-label"],["type","radio","id","allfiles-false","formControlName","allfiles","value","false",3,"className"],["for","allfiles-false",1,"form-check-label"],["for","message",1,"form-label"],["rows","5","id","message","formControlName","message",3,"className"],[1,"row"],[1,"col-12","text-end"],["role","button",1,"btn","btn-outline-secondary","me-1",3,"click"],[1,"fas","fa-arrow-left"],[1,"btn","btn-default","btn-primary",3,"click","dsBtnDisabled"],["autoload","onload",3,"payload","challengeUrl"]],template:function(n,i){1&n&&(e.j41(0,"div",0)(1,"h1",1),e.EFF(2),e.nI1(3,"translate"),e.k0s(),e.DNE(4,me,7,7,"div",2),e.nI1(5,"async"),e.j41(6,"div")(7,"p"),e.EFF(8),e.nI1(9,"translate"),e.j41(10,"a",3),e.EFF(11),e.k0s()(),e.DNE(12,he,3,4,"p")(13,ge,3,3,"p"),e.k0s(),e.j41(14,"form",4),e.bIt("ngSubmit",function(){return i.onSubmit()}),e.j41(15,"div",5)(16,"div",6)(17,"div",7)(18,"label",8),e.EFF(19),e.nI1(20,"translate"),e.k0s(),e.nrm(21,"input",9),e.DNE(22,ve,2,1,"div",10),e.k0s()(),e.j41(23,"div",6)(24,"div",7)(25,"label",11),e.EFF(26),e.nI1(27,"translate"),e.k0s(),e.nrm(28,"input",12),e.DNE(29,be,2,1,"div",10),e.j41(30,"small",13),e.EFF(31),e.nI1(32,"translate"),e.k0s()()(),e.j41(33,"div",6)(34,"div",7)(35,"div"),e.EFF(36),e.nI1(37,"translate"),e.k0s(),e.j41(38,"div",14),e.nrm(39,"input",15),e.j41(40,"label",16),e.EFF(41),e.nI1(42,"translate"),e.k0s()(),e.j41(43,"div",14),e.nrm(44,"input",17),e.j41(45,"label",18),e.EFF(46),e.nI1(47,"translate"),e.k0s()()()(),e.j41(48,"div",6)(49,"div",7)(50,"label",19),e.EFF(51),e.nI1(52,"translate"),e.k0s(),e.nrm(53,"textarea",20),e.k0s()()()(),e.DNE(54,_e,3,3,"div"),e.nI1(55,"async"),e.nrm(56,"hr"),e.j41(57,"div",21)(58,"div",22)(59,"a",23),e.bIt("click",function(){return i.navigateBack()}),e.nrm(60,"i",24),e.EFF(61),e.nI1(62,"translate"),e.k0s(),e.j41(63,"button",25),e.bIt("click",function(){return i.onSubmit()}),e.EFF(64),e.nI1(65,"translate"),e.k0s()()()()),2&n&&(e.R7$(2),e.JRh(e.bMT(3,29,"bitstream-request-a-copy.header")),e.R7$(2),e.vxM(e.bMT(5,31,i.canDownload$)?4:-1),e.R7$(4),e.SpI("",e.bMT(9,33,"bitstream-request-a-copy.intro")," "),e.R7$(2),e.Y8G("routerLink",i.getItemPath()),e.R7$(),e.JRh(i.itemName),e.R7$(),e.vxM(void 0!==i.bitstream&&"false"===i.allfiles.value?12:-1),e.R7$(),e.vxM("true"===i.allfiles.value?13:-1),e.R7$(),e.HbH("ng-invalid"),e.Y8G("formGroup",i.requestCopyForm),e.R7$(5),e.JRh(e.bMT(20,35,"bitstream-request-a-copy.name.label")),e.R7$(2),e.Y8G("className",i.name.invalid&&(i.name.dirty||i.name.touched)?"form-control is-invalid":"form-control"),e.R7$(),e.vxM(i.name.invalid&&(i.name.dirty||i.name.touched)?22:-1),e.R7$(4),e.JRh(e.bMT(27,37,"bitstream-request-a-copy.email.label")),e.R7$(2),e.Y8G("className",i.email.invalid&&(i.email.dirty||i.email.touched)?"form-control is-invalid":"form-control"),e.R7$(),e.vxM(i.email.invalid&&(i.email.dirty||i.email.touched)?29:-1),e.R7$(2),e.JRh(e.bMT(32,39,"bitstream-request-a-copy.email.hint")),e.R7$(5),e.JRh(e.bMT(37,41,"bitstream-request-a-copy.allfiles.label")),e.R7$(3),e.Y8G("className","form-check-input"),e.R7$(2),e.JRh(e.bMT(42,43,"bitstream-request-a-copy.files-all-true.label")),e.R7$(3),e.Y8G("className","form-check-input"),e.BMQ("disabled",void 0===i.bitstream||null),e.R7$(2),e.JRh(e.bMT(47,45,"bitstream-request-a-copy.files-all-false.label")),e.R7$(5),e.JRh(e.bMT(52,47,"bitstream-request-a-copy.message.label")),e.R7$(2),e.Y8G("className","form-control"),e.R7$(),e.vxM(e.bMT(55,49,i.captchaEnabled$)?54:-1),e.R7$(7),e.SpI(" ",e.bMT(62,51,"bitstream-request-a-copy.return")," "),e.R7$(2),e.Y8G("dsBtnDisabled",i.requestCopyForm.invalid),e.R7$(),e.JRh(e.bMT(65,53,"bitstream-request-a-copy.submit")))},dependencies:[pe,R.Jj,Z.A,c.X1,c.qT,c.me,c.Fm,c.BC,c.cb,c.j4,c.JD,m.Wk,v.h,v.D9],encapsulation:2})}}return s})();var q=o(78544),Ie=o(37419),Oe=o(3601),ee=o(41033),Te=o(19192),Se=o(79669),Re=o(8447),Me=o(38133),Ee=o(19370),Fe=o(51828);const De=s=>({"is-invalid":s}),Pe=()=>({standalone:!0}),$e=s=>({show:s});function Be(s,r){if(1&s){const t=e.RV6();e.j41(0,"div")(1,"button",8,2),e.bIt("click",function(){const i=e.eBV(t).$implicit,a=e.XpG();return e.Njj(a.onClickSuggestion(i))}),e.nrm(3,"ds-listable-object-component-loader",9),e.k0s()()}if(2&s){const t=r.$implicit,n=e.XpG();e.R7$(3),e.Y8G("object",t)("viewMode",n.viewMode)("linkType",n.linkTypes.None)}}let je=(()=>{class s extends Fe.t{constructor(t){super(),this.dsoNameService=t,this.viewMode=Te.n.ListElement,this.linkTypes=Se.n,this.suggestions=[]}onSubmit(t){(0,d.a4)(t)&&(this.value=this.dsoNameService.getName(t),this.currentObject=t,this.submitSuggestion.emit(t))}onClickSuggestion(t){return this.value=this.dsoNameService.getName(t),this.currentObject=t,this.clickSuggestion.emit(t),this.close(),this.blockReopen=!0,this.queryInput.nativeElement.focus(),!1}static{this.\u0275fac=function(n){return new(n||s)(e.rXU(W.f))}}static{this.\u0275cmp=e.VBU({type:s,selectors:[["ds-dso-input-suggestions"]],inputs:{suggestions:"suggestions"},standalone:!0,features:[e.Jv_([{provide:c.kq,useExisting:(0,e.Rfq)(()=>s),multi:!0}]),e.Vt3,e.aNF],decls:12,vars:18,consts:[["form","ngForm"],["inputField",""],["suggestion",""],[3,"ngSubmit","keydown.arrowdown","keydown.arrowup","keydown.esc","dsClickOutside","action"],["type","text","autocomplete","off",1,"form-control","suggestion_input","mb-2",3,"ngModelChange","onDebounce","ngModel","name","ngClass","dsDebounce","placeholder","ngModelOptions"],["type","submit",1,"sr-only"],[1,"autocomplete","dropdown-menu",3,"ngClass"],[1,"dropdown-list"],[1,"d-block","dropdown-item",3,"click"],[3,"object","viewMode","linkType"]],template:function(n,i){if(1&n){const a=e.RV6();e.j41(0,"form",3,0),e.bIt("ngSubmit",function(){return e.eBV(a),e.Njj(i.onSubmit(i.currentObject))})("keydown.arrowdown",function(y){return e.eBV(a),e.Njj(i.shiftFocusDown(y))})("keydown.arrowup",function(y){return e.eBV(a),e.Njj(i.shiftFocusUp(y))})("keydown.esc",function(){return e.eBV(a),e.Njj(i.close())})("dsClickOutside",function(){return e.eBV(a),e.Njj(i.close())}),e.j41(2,"input",4,1),e.mxI("ngModelChange",function(y){return e.eBV(a),e.DH7(i.value,y)||(i.value=y),e.Njj(y)}),e.bIt("onDebounce",function(y){return e.eBV(a),e.Njj(i.find(y))}),e.k0s(),e.j41(4,"button",5),e.EFF(5),e.nI1(6,"translate"),e.k0s(),e.j41(7,"div",6),e.nI1(8,"async"),e.j41(9,"div",7),e.Z7z(10,Be,4,3,"div",null,e.fX1),e.k0s()()()}2&n&&(e.Y8G("action",i.action,e.B4B),e.R7$(2),e.R50("ngModel",i.value),e.Y8G("name",i.name)("ngClass",e.eq3(13,De,!i.valid))("dsDebounce",i.debounceTime)("placeholder",i.placeholder)("ngModelOptions",e.lJ4(15,Pe)),e.R7$(3),e.SpI(" ",e.bMT(6,9,"search.filters.search.submit")," "),e.R7$(2),e.Y8G("ngClass",e.eq3(16,$e,e.bMT(8,11,i.show)&&i.isNotEmpty(i.suggestions))),e.R7$(3),e.Dyx(i.suggestions))},dependencies:[R.Jj,Me.z,Ee.R,c.YN,c.qT,c.me,c.BC,c.cb,c.vS,c.cV,Re.v,R.YU,v.h,v.D9],styles:[".autocomplete[_ngcontent-%COMP%]{width:100%}.autocomplete[_ngcontent-%COMP%]   .dropdown-item[_ngcontent-%COMP%]{white-space:normal;word-break:break-word;padding:var(--bs-input-padding-y) var(--bs-input-padding-x)}.autocomplete[_ngcontent-%COMP%]   .dropdown-item[_ngcontent-%COMP%]:focus{outline:none}form[_ngcontent-%COMP%]{position:relative}"]})}}return s})();var te=o(84780),Ae=o(89291),ke=o(50186);function Ue(s,r){if(1&s&&(e.j41(0,"div")(1,"span",11),e.EFF(2),e.nI1(3,"translate"),e.k0s(),e.j41(4,"span"),e.EFF(5),e.k0s()()),2&s){const t=e.XpG().ngVar,n=e.XpG(2);e.R7$(2),e.JRh(e.bMT(3,2,"item.bitstreams.upload.item")),e.R7$(3),e.JRh(n.dsoNameService.getName(t))}}function Ne(s,r){if(1&s&&(e.qex(0),e.DNE(1,Ue,6,4,"div"),e.bVm()),2&s){const t=r.ngVar;e.R7$(),e.vxM(t?1:-1)}}function xe(s,r){if(1&s){const t=e.RV6();e.j41(0,"button",12),e.bIt("click",function(){e.eBV(t);const i=e.XpG(2);return e.Njj(i.createBundle())}),e.nrm(1,"i",13),e.EFF(2),e.nI1(3,"translate"),e.k0s()}2&s&&(e.R7$(2),e.SpI(" ",e.bMT(3,1,"item.bitstreams.upload.bundle.new")," "))}function Xe(s,r){if(1&s){const t=e.RV6();e.j41(0,"ds-uploader",14),e.bIt("onCompleteItem",function(i){e.eBV(t);const a=e.XpG(2);return e.Njj(a.onCompleteItem(i))})("onUploadError",function(){e.eBV(t);const i=e.XpG(2);return e.Njj(i.onUploadError())}),e.k0s()}if(2&s){const t=e.XpG(2);e.Y8G("dropMsg","item.bitstreams.upload.drop-message")("dropOverDocumentMsg","item.bitstreams.upload.drop-message")("enableDragOverDocument",!0)("uploadFilesOptions",t.uploadFilesOptions)}}function Ge(s,r){if(1&s){const t=e.RV6();e.j41(0,"div",2)(1,"div",3)(2,"h1"),e.EFF(3),e.nI1(4,"translate"),e.k0s(),e.DNE(5,Ne,2,1,"ng-container",4),e.nI1(6,"async"),e.k0s(),e.j41(7,"div",5)(8,"label",6),e.EFF(9),e.nI1(10,"translate"),e.k0s(),e.j41(11,"ds-dso-input-suggestions",7,0),e.nI1(13,"translate"),e.mxI("ngModelChange",function(i){e.eBV(t);const a=e.XpG();return e.DH7(a.selectedBundleName,i)||(a.selectedBundleName=i),e.Njj(i)}),e.bIt("typeSuggestion",function(){e.eBV(t);const i=e.XpG();return e.Njj(i.bundleNameChange())})("clickSuggestion",function(i){e.eBV(t);const a=e.XpG();return e.Njj(a.onClick(i))})("click",function(){e.eBV(t);const i=e.sdS(12);return e.Njj(i.open())}),e.k0s(),e.DNE(14,xe,4,3,"button",8)(15,Xe,1,4,"ds-uploader",9),e.j41(16,"button",10),e.bIt("click",function(){e.eBV(t);const i=e.XpG();return e.Njj(i.onCancel())}),e.EFF(17),e.nI1(18,"translate"),e.k0s()()()}if(2&s){let t;const n=e.XpG();e.R7$(3),e.JRh(e.bMT(4,12,"item.bitstreams.upload.title")),e.R7$(2),e.Y8G("ngVar",null==(t=e.bMT(6,14,n.itemRD$))?null:t.payload),e.R7$(4),e.JRh(e.bMT(10,16,"item.bitstreams.upload.bundle")),e.R7$(2),e.Y8G("suggestions",n.bundles)("placeholder",e.bMT(13,18,"item.bitstreams.upload.bundle.placeholder"))("action",n.getCurrentUrl())("name","bundle-select")("debounceTime",50),e.R50("ngModel",n.selectedBundleName),e.R7$(3),e.vxM(!n.selectedBundleId&&(null==n.selectedBundleName?null:n.selectedBundleName.length)>0?14:-1),e.R7$(),e.vxM(n.selectedBundleId?15:-1),e.R7$(2),e.JRh(e.bMT(18,20,"item.bitstreams.upload.cancel"))}}let ze=(()=>{class s{constructor(t,n,i,a,u,y,z,Q,H){this.route=t,this.router=n,this.itemService=i,this.bundleService=a,this.authService=u,this.notificationsService=y,this.translate=z,this.requestService=Q,this.dsoNameService=H,this.bundles=[],this.uploadFilesOptions=Object.assign(new Ae.H,{url:"placeholder",authToken:null,disableMultipart:!1,itemAlias:null}),this.NOTIFICATIONS_PREFIX="item.bitstreams.upload.notifications.",this.subs=[]}ngOnInit(){this.itemId=this.route.snapshot.params.id,this.entityType=this.route.snapshot.params["entity-type"],this.itemRD$=this.route.data.pipe((0,p.T)(n=>n.dso));const t=this.itemService.getBundles(this.itemId).pipe((0,l.qD)(),(0,P.n)(n=>{if(n.hasSucceeded){if(n.payload.page){this.bundles=n.payload.page;for(const i of q.c.bundle.standardBundles){let a=!0;n.payload.page.forEach(u=>{i===u.name&&(a=!1)}),a&&this.bundles.push(Object.assign(new ee.N,{_name:i,type:"bundle"}))}}else this.bundles=q.c.bundle.standardBundles.map(i=>Object.assign(new ee.N,{_name:i,type:"bundle"}));return(0,N.of)(n.payload.page)}}));this.selectedBundleId=this.route.snapshot.queryParams.bundle,(0,d.hj)(this.selectedBundleId)&&(this.subs.push(this.bundleService.findById(this.selectedBundleId).pipe((0,l.ak)()).subscribe(n=>{this.selectedBundleName=n.name})),this.setUploadUrl()),this.subs.push(t.subscribe())}createBundle(){this.itemService.createBundle(this.itemId,this.selectedBundleName).pipe((0,l.ak)()).subscribe(t=>{this.selectedBundleId=t.id,this.notificationsService.success(this.translate.instant(this.NOTIFICATIONS_PREFIX+"bundle.created.title"),this.translate.instant(this.NOTIFICATIONS_PREFIX+"bundle.created.content")),this.setUploadUrl()})}bundleNameChange(){this.selectedBundleId=void 0;for(const t of this.bundles)if(this.selectedBundleName===t.name){this.selectedBundleId=t.id;break}}setUploadUrl(){this.bundleService.getBitstreamsEndpoint(this.selectedBundleId).pipe((0,j.s)(1)).subscribe(t=>{this.uploadFilesOptions.url=t,(0,d.Im)(this.uploadFilesOptions.authToken)&&(this.uploadFilesOptions.authToken=this.authService.buildAuthHeader()),this.uploaderComponent&&(this.uploaderComponent.ngOnInit(),this.uploaderComponent.ngAfterViewInit())})}onCompleteItem(t){this.bundleService.getBitstreamsEndpoint(this.selectedBundleId).pipe((0,j.s)(1)).subscribe(i=>{this.requestService.removeByHrefSubstring(i)});const n={itemId:this.itemId,entityType:this.entityType};this.router.navigate([(0,g.dF)(),t.id,"edit"],{queryParams:n})}onUploadError(){this.notificationsService.error(null,this.translate.get(this.NOTIFICATIONS_PREFIX+"upload.failed"))}onClick(t){this.selectedBundleId=t.id,this.selectedBundleName=t.name,t.id&&this.setUploadUrl()}onCancel(){this.router.navigate([(0,A.DL)(this.entityType,this.itemId),"bitstreams"])}getCurrentUrl(){return this.router.url}ngOnDestroy(){this.subs.filter(t=>(0,d.a4)(t)).forEach(t=>t.unsubscribe())}static{this.\u0275fac=function(n){return new(n||s)(e.rXU(m.nX),e.rXU(m.Ix),e.rXU(x.ItemDataService),e.rXU(Ie.BundleDataService),e.rXU(b.uR),e.rXU(X.I),e.rXU(v.c$),e.rXU(Oe.B),e.rXU(W.f))}}static{this.\u0275cmp=e.VBU({type:s,selectors:[["ds-upload-bitstream"]],viewQuery:function(n,i){if(1&n&&e.GBs(te.y,5),2&n){let a;e.mGM(a=e.lsd())&&(i.uploaderComponent=a.first)}},standalone:!0,features:[e.aNF],decls:2,vars:1,consts:[["f",""],[1,"container"],[1,"row"],[1,"col-12","mb-2"],[4,"ngVar"],[1,"col-12"],[1,"fw-bold","form-label"],["id","search-form","ngDefaultControl","",3,"ngModelChange","typeSuggestion","clickSuggestion","click","suggestions","placeholder","action","name","debounceTime","ngModel"],[1,"btn","btn-success","me-2"],[1,"w-100",3,"dropMsg","dropOverDocumentMsg","enableDragOverDocument","uploadFilesOptions"],[1,"btn","btn-outline-secondary",3,"click"],[1,"fw-bold"],[1,"btn","btn-success","me-2",3,"click"],[1,"fa","fa-plus"],[1,"w-100",3,"onCompleteItem","onUploadError","dropMsg","dropOverDocumentMsg","enableDragOverDocument","uploadFilesOptions"]],template:function(n,i){1&n&&(e.j41(0,"div",1),e.DNE(1,Ge,19,22,"div",2),e.k0s()),2&n&&(e.R7$(),e.vxM(i.bundles?1:-1))},dependencies:[R.Jj,je,c.YN,c.me,c.BC,c.vS,v.h,v.D9,te.y,ke.r],encapsulation:2})}}return s})();var ne=o(54766),ie=o(55021),M=o(84412),Y=o(1939),V=o(64972),L=o(74082),se=o(15202),J=o(99437),Ve=o(19252),K=(o(15862),o(34180));function Le(s,r){if(1&s&&(e.j41(0,"li",15),e.EFF(1),e.nI1(2,"translate"),e.k0s()),2&s){const t=r.$implicit,n=e.XpG(3);e.R7$(),e.SpI(" ",e.bMT(2,1,n.getAuthorizationDescription(t))," ")}}function We(s,r){if(1&s&&(e.j41(0,"div",4)(1,"div",6)(2,"div",7),e.EFF(3),e.nI1(4,"translate"),e.k0s(),e.j41(5,"div",8)(6,"div",14)(7,"ul"),e.Z7z(8,Le,3,3,"li",15,e.fX1),e.nI1(10,"async"),e.k0s()()()()()),2&s){const t=e.XpG(2);e.R7$(3),e.JRh(e.bMT(4,1,"person.page.orcid.granted-authorizations")),e.R7$(5),e.Dyx(e.bMT(10,3,t.profileAuthorizationScopes$))}}function we(s,r){if(1&s&&(e.j41(0,"ds-alert",10),e.EFF(1),e.nI1(2,"translate"),e.k0s()),2&s){const t=e.XpG(2);e.Y8G("type",t.AlertType.Success),e.R7$(),e.SpI(" ",e.bMT(2,2,"person.page.orcid.no-missing-authorizations-message")," ")}}function Ye(s,r){if(1&s&&(e.j41(0,"li",16),e.EFF(1),e.nI1(2,"translate"),e.k0s()),2&s){const t=r.$implicit,n=e.XpG(3);e.R7$(),e.SpI(" ",e.bMT(2,1,n.getAuthorizationDescription(t))," ")}}function Je(s,r){if(1&s&&(e.j41(0,"ds-alert",11),e.EFF(1),e.nI1(2,"translate"),e.j41(3,"ul"),e.Z7z(4,Ye,3,3,"li",16,e.fX1),e.nI1(6,"async"),e.k0s()()),2&s){const t=e.XpG(2);e.Y8G("type",t.AlertType.Warning),e.R7$(),e.SpI(" ",e.bMT(2,2,"person.page.orcid.missing-authorizations-message")," "),e.R7$(3),e.Dyx(e.bMT(6,4,t.profileAuthorizationScopes$))}}function Ke(s,r){if(1&s&&(e.j41(0,"ds-alert",12),e.EFF(1),e.nI1(2,"translate"),e.k0s()),2&s){const t=e.XpG(2);e.Y8G("type",t.AlertType.Warning),e.R7$(),e.SpI(" ",e.bMT(2,2,"person.page.orcid.remove-orcid-message")," ")}}function Qe(s,r){1&s&&(e.j41(0,"span"),e.nrm(1,"i",20),e.EFF(2),e.nI1(3,"translate"),e.k0s()),2&s&&(e.R7$(2),e.SpI(" ",e.bMT(3,1,"person.page.orcid.unlink"),""))}function He(s,r){1&s&&(e.j41(0,"span"),e.nrm(1,"i",21),e.EFF(2),e.nI1(3,"translate"),e.k0s()),2&s&&(e.R7$(2),e.SpI(" ",e.bMT(3,1,"person.page.orcid.unlink.processing"),""))}function Ze(s,r){if(1&s){const t=e.RV6();e.j41(0,"button",22),e.bIt("click",function(){e.eBV(t);const i=e.XpG(3);return e.Njj(i.linkOrcid())}),e.j41(1,"span"),e.nrm(2,"i",23),e.EFF(3),e.nI1(4,"translate"),e.k0s()()}2&s&&(e.R7$(3),e.SpI(" ",e.bMT(4,1,"person.page.orcid.grant-authorizations"),""))}function qe(s,r){if(1&s){const t=e.RV6();e.j41(0,"div",13)(1,"div",17)(2,"button",18),e.nI1(3,"async"),e.bIt("click",function(){e.eBV(t);const i=e.XpG(2);return e.Njj(i.unlinkOrcid())}),e.DNE(4,Qe,4,3,"span"),e.nI1(5,"async"),e.DNE(6,He,4,3,"span"),e.nI1(7,"async"),e.k0s(),e.DNE(8,Ze,5,3,"button",19),e.nI1(9,"async"),e.k0s()()}if(2&s){const t=e.XpG(2);e.R7$(2),e.Y8G("dsBtnDisabled",e.bMT(3,4,t.unlinkProcessing)),e.R7$(2),e.vxM(!0!==e.bMT(5,6,t.unlinkProcessing)?4:-1),e.R7$(2),e.vxM(e.bMT(7,8,t.unlinkProcessing)?6:-1),e.R7$(2),e.vxM(e.bMT(9,10,t.hasMissingOrcidAuthorizations$)?8:-1)}}function et(s,r){if(1&s&&(e.j41(0,"div",1)(1,"div",3),e.DNE(2,We,11,5,"div",4),e.nI1(3,"async"),e.j41(4,"div",5)(5,"div",6)(6,"div",7),e.EFF(7),e.nI1(8,"translate"),e.k0s(),e.j41(9,"div",8)(10,"div",9),e.DNE(11,we,3,4,"ds-alert",10),e.nI1(12,"async"),e.DNE(13,Je,7,6,"ds-alert",11),e.nI1(14,"async"),e.k0s()()()()(),e.DNE(15,Ke,3,4,"ds-alert",12),e.nI1(16,"async"),e.nI1(17,"async"),e.DNE(18,qe,10,12,"div",13),e.nI1(19,"async"),e.k0s()),2&s){const t=e.XpG();e.R7$(2),e.vxM(e.bMT(3,6,t.hasOrcidAuthorizations$)?2:-1),e.R7$(5),e.JRh(e.bMT(8,8,"person.page.orcid.missing-authorizations")),e.R7$(4),e.vxM(!0!==e.bMT(12,10,t.hasMissingOrcidAuthorizations$)?11:-1),e.R7$(2),e.vxM(e.bMT(14,12,t.hasMissingOrcidAuthorizations$)?13:-1),e.R7$(2),e.vxM(e.bMT(16,14,t.onlyAdminCanDisconnectProfileFromOrcid$)&&!0!==e.bMT(17,16,t.ownerCanDisconnectProfileFromOrcid$)?15:-1),e.R7$(3),e.vxM(e.bMT(19,18,t.ownerCanDisconnectProfileFromOrcid$)?18:-1)}}function tt(s,r){if(1&s){const t=e.RV6();e.j41(0,"div",2)(1,"div",3)(2,"div",24),e.nrm(3,"img",25),e.k0s(),e.j41(4,"div",17)(5,"ds-alert",26),e.EFF(6),e.k0s()()(),e.j41(7,"div",3)(8,"div",17)(9,"button",27),e.bIt("click",function(){e.eBV(t);const i=e.XpG();return e.Njj(i.linkOrcid())}),e.nrm(10,"i",28),e.EFF(11),e.nI1(12,"translate"),e.k0s()()()()}if(2&s){const t=e.XpG();e.R7$(5),e.Y8G("type",t.AlertType.Info),e.R7$(),e.JRh(t.getOrcidNotLinkedMessage()),e.R7$(5),e.SpI(" ",e.bMT(12,3,"person.page.orcid.link")," ")}}let nt=(()=>{class s{constructor(t,n,i,a){this.orcidAuthService=t,this.translateService=n,this.notificationsService=i,this._window=a,this.profileAuthorizationScopes$=new M.t([]),this.missingAuthorizationScopes=new M.t([]),this.orcidAuthorizationScopes=new M.t([]),this.unlinkProcessing=new M.t(!1),this.isOrcidLinked$=new M.t(!1),this.onlyAdminCanDisconnectProfileFromOrcid$=new M.t(!1),this.ownerCanDisconnectProfileFromOrcid$=new M.t(!1),this.unlink=new e.bkB,this.AlertType=L.v}ngOnInit(){this.orcidAuthService.getOrcidAuthorizationScopes().subscribe(t=>{this.orcidAuthorizationScopes.next(t),this.initOrcidAuthSettings()}),this.hasOrcidAuthorizations$=this.hasOrcidAuthorizations(),this.hasMissingOrcidAuthorizations$=this.hasMissingOrcidAuthorizations()}ngOnChanges(t){!t.item.isFirstChange()&&t.item.currentValue!==t.item.previousValue&&this.initOrcidAuthSettings()}hasOrcidAuthorizations(){return this.profileAuthorizationScopes$.pipe((0,p.T)(t=>t.length>0))}hasMissingOrcidAuthorizations(){return this.missingAuthorizationScopes.asObservable().pipe((0,p.T)(t=>t.length>0))}getOrcidNotLinkedMessage(){const t=this.item.firstMetadataValue("person.identifier.orcid");return t?this.translateService.instant("person.page.orcid.orcid-not-linked-message",{orcid:t}):this.translateService.instant("person.page.orcid.no-orcid-message")}getAuthorizationDescription(t){return"person.page.orcid.scope."+t.substring(1).replace("/","-")}ownerCanDisconnectProfileFromOrcid(){return this.ownerCanDisconnectProfileFromOrcid$.asObservable()}linkOrcid(){this.orcidAuthService.getOrcidAuthorizeUrl(this.item).subscribe(t=>{this._window.nativeWindow.location.href=t})}unlinkOrcid(){this.unlinkProcessing.next(!0),this.orcidAuthService.unlinkOrcidByItem(this.item).pipe((0,l.qD)(),(0,J.W)(K.V7)).subscribe(t=>{this.unlinkProcessing.next(!1),t.hasFailed?this.notificationsService.error(this.translateService.get("person.page.orcid.unlink.error")):(this.notificationsService.success(this.translateService.get("person.page.orcid.unlink.success")),this.unlink.emit())})}initOrcidAuthSettings(){this.setOrcidAuthorizationsFromItem(),this.setMissingOrcidAuthorizations(),this.orcidAuthService.onlyAdminCanDisconnectProfileFromOrcid().subscribe(t=>{this.onlyAdminCanDisconnectProfileFromOrcid$.next(t)}),this.orcidAuthService.ownerCanDisconnectProfileFromOrcid().subscribe(t=>{this.ownerCanDisconnectProfileFromOrcid$.next(t)}),this.isOrcidLinked$.next(this.orcidAuthService.isLinkedToOrcid(this.item))}setMissingOrcidAuthorizations(){const t=this.orcidAuthService.getOrcidAuthorizationScopesByItem(this.item),i=this.orcidAuthorizationScopes.value.filter(a=>!t.includes(a));this.missingAuthorizationScopes.next(i)}setOrcidAuthorizationsFromItem(){this.profileAuthorizationScopes$.next(this.orcidAuthService.getOrcidAuthorizationScopesByItem(this.item))}static{this.\u0275fac=function(n){return new(n||s)(e.rXU(Y.r),e.rXU(v.c$),e.rXU(X.I),e.rXU(Ve.lc))}}static{this.\u0275cmp=e.VBU({type:s,selectors:[["ds-orcid-auth"]],inputs:{item:"item"},outputs:{unlink:"unlink"},standalone:!0,features:[e.OA$,e.aNF],decls:7,vars:6,consts:[[1,"container","mb-5"],["data-test","orcidLinked"],["data-test","orcidNotLinked"],[1,"row"],["data-test","hasOrcidAuthorizations",1,"col-sm-6","mb-3"],[1,"col-sm-6","mb-3"],[1,"card","h-100"],[1,"card-header"],[1,"card-body"],[1,"container"],["data-test","noMissingOrcidAuthorizations",3,"type"],["data-test","missingOrcidAuthorizations",3,"type"],["data-test","unlinkOnlyAdmin",3,"type"],["data-test","unlinkOwner",1,"row"],[1,"container","p-0"],["data-test","orcidAuthorization"],["data-test","missingOrcidAuthorization"],[1,"col"],["type","submit",1,"btn","btn-danger","float-end",3,"click","dsBtnDisabled"],["type","submit",1,"btn","btn-primary","float-end"],[1,"fas","fa-unlink"],[1,"fas","fa-circle-notch","fa-spin"],["type","submit",1,"btn","btn-primary","float-end",3,"click"],[1,"fas","fa-check"],[1,"col-2"],["alt","orcid-logo","src","../../../../assets/images/orcid.logo.icon.svg"],[3,"type"],[1,"btn","btn-primary","float-end",3,"click"],[1,"fas","fa-link"]],template:function(n,i){1&n&&(e.j41(0,"div",0)(1,"h1"),e.EFF(2),e.nI1(3,"translate"),e.k0s(),e.DNE(4,et,20,20,"div",1),e.nI1(5,"async"),e.DNE(6,tt,13,5,"div",2),e.k0s()),2&n&&(e.R7$(2),e.JRh(e.bMT(3,2,"person.orcid.registry.auth")),e.R7$(2),e.vxM(e.bMT(5,4,i.isOrcidLinked$)?4:6))},dependencies:[V.C,R.Jj,Z.A,v.h,v.D9]})}}return s})();var oe=o(58003),it=o(70152),st=o(23294),ot=o(27038),at=o(23619),rt=o(31),ct=o(2175),lt=o(8417);function dt(s,r){1&s&&e.nrm(0,"ds-loading")}function ut(s,r){if(1&s&&(e.j41(0,"ds-alert",1),e.EFF(1),e.nI1(2,"translate"),e.k0s()),2&s){const t=e.XpG();e.Y8G("type",t.AlertTypeEnum.Info),e.R7$(),e.SpI(" ",e.bMT(2,2,"person.page.orcid.sync-queue.empty-message")," ")}}function pt(s,r){if(1&s){const t=e.RV6();e.j41(0,"tr",7)(1,"td",8),e.nrm(2,"i",9),e.nI1(3,"translate"),e.k0s(),e.j41(4,"td",6),e.EFF(5),e.k0s(),e.j41(6,"td",10)(7,"div",11)(8,"button",12),e.nI1(9,"translate"),e.bIt("click",function(){const i=e.eBV(t).$implicit,a=e.XpG(2);return e.Njj(a.send(i))}),e.nrm(10,"span",13),e.j41(11,"span",14),e.EFF(12),e.nI1(13,"translate"),e.k0s()(),e.j41(14,"button",15),e.nI1(15,"translate"),e.bIt("click",function(){const i=e.eBV(t).$implicit,a=e.XpG(2);return e.Njj(a.discardEntry(i))}),e.nrm(16,"span",16),e.j41(17,"span",14),e.EFF(18),e.nI1(19,"translate"),e.k0s()()()()()}if(2&s){const t=r.$implicit,n=e.XpG(2);e.R7$(2),e.Y8G("ngClass",n.getIconClass(t))("ngbTooltip",e.bMT(3,8,n.getIconTooltip(t))),e.R7$(3),e.SpI(" ",t.description," "),e.R7$(3),e.Y8G("ngbTooltip",e.bMT(9,10,n.getOperationTooltip(t))),e.R7$(2),e.Y8G("ngClass",n.getOperationClass(t)),e.R7$(2),e.JRh(e.bMT(13,12,n.getOperationTooltip(t))),e.R7$(2),e.Y8G("ngbTooltip",e.bMT(15,14,"person.page.orcid.sync-queue.discard")),e.R7$(4),e.JRh(e.bMT(19,16,"person.page.orcid.sync-queue.discard"))}}function mt(s,r){if(1&s){const t=e.RV6();e.j41(0,"ds-pagination",3),e.nI1(1,"async"),e.bIt("paginationChange",function(){e.eBV(t);const i=e.XpG();return e.Njj(i.updateList())}),e.j41(2,"div",4)(3,"table",5)(4,"thead")(5,"tr",6)(6,"th"),e.EFF(7),e.nI1(8,"translate"),e.k0s(),e.j41(9,"th"),e.EFF(10),e.nI1(11,"translate"),e.k0s(),e.j41(12,"th"),e.EFF(13),e.nI1(14,"translate"),e.k0s()()(),e.j41(15,"tbody"),e.Z7z(16,pt,20,18,"tr",7,e.fX1),e.nI1(18,"async"),e.k0s()()()()}if(2&s){let t,n;const i=e.XpG();e.Y8G("paginationOptions",i.paginationOptions)("collectionSize",null==(t=e.bMT(1,7,i.list$))||null==t.payload?null:t.payload.totalElements)("retainScrollPosition",!1)("hideGear",!0),e.R7$(7),e.JRh(e.bMT(8,9,"person.page.orcid.sync-queue.table.header.type")),e.R7$(3),e.JRh(e.bMT(11,11,"person.page.orcid.sync-queue.table.header.description")),e.R7$(3),e.JRh(e.bMT(14,13,"person.page.orcid.sync-queue.table.header.action")),e.R7$(3),e.Dyx(null==(n=e.bMT(18,15,i.list$))||null==n.payload?null:n.payload.page)}}let ht=(()=>{class s{constructor(t,n,i,a,u,y){this.orcidAuthService=t,this.orcidQueueService=n,this.translateService=i,this.paginationService=a,this.notificationsService=u,this.orcidHistoryService=y,this.paginationOptions=Object.assign(new lt.W,{id:"oqp",pageSize:5}),this.processing$=new M.t(!1),this.list$=new M.t({}),this.AlertTypeEnum=L.v,this.subs=[]}ngOnInit(){this.updateList()}ngOnChanges(t){!t.item.isFirstChange()&&t.item.currentValue!==t.item.previousValue&&this.updateList()}updateList(){this.subs.push(this.paginationService.getCurrentPagination(this.paginationOptions.id,this.paginationOptions).pipe((0,it.B)(100),(0,st.F)(),(0,C.M)(()=>this.processing$.next(!0)),(0,P.n)(t=>this.orcidQueueService.searchByProfileItemId(this.item.id,t,!1)),(0,l.qD)()).subscribe(t=>{this.processing$.next(!1),this.list$.next(t),this.orcidQueueService.clearFindByProfileItemRequests()}))}getIconClass(t){if(!t.recordType)return"fa fa-user";switch(t.recordType.toLowerCase()){case"publication":return"fas fa-book";case"project":return"fas fa-wallet";case"education":return"fas fa-school";case"affiliation":return"fas fa-university";case"country":return"fas fa-globe-europe";case"external_ids":case"researcher_urls":return"fas fa-external-link-alt";default:return"fa fa-user"}}getIconTooltip(t){return t.recordType?"person.page.orcid.sync-queue.tooltip."+t.recordType.toLowerCase():""}getOperationTooltip(t){return t.operation?"person.page.orcid.sync-queue.tooltip."+t.operation.toLowerCase():""}getOperationClass(t){if(!t.operation)return"";switch(t.operation.toLowerCase()){case"insert":return"fas fa-plus";case"update":return"fas fa-edit";case"delete":return"fas fa-trash-alt";default:return""}}discardEntry(t){this.processing$.next(!0),this.subs.push(this.orcidQueueService.deleteById(t.id).pipe((0,l.qD)()).subscribe(n=>{this.processing$.next(!1),n.isSuccess?(this.notificationsService.success(this.translateService.get("person.page.orcid.sync-queue.discard.success")),this.updateList()):this.notificationsService.error(this.translateService.get("person.page.orcid.sync-queue.discard.error"))}))}send(t){this.processing$.next(!0),this.subs.push(this.orcidHistoryService.sendToORCID(t).pipe((0,l.qD)()).subscribe(n=>{this.processing$.next(!1),n.isSuccess?this.handleOrcidHistoryRecordCreation(n.payload):422===n.statusCode?this.handleValidationErrors(n):this.notificationsService.error(this.translateService.get("person.page.orcid.sync-queue.send.error"))}))}getUnauthorizedErrorContent(){return this.orcidAuthService.getOrcidAuthorizeUrl(this.item).pipe((0,P.n)(t=>this.translateService.get("person.page.orcid.sync-queue.send.unauthorized-error.content",{orcid:t})))}handleOrcidHistoryRecordCreation(t){switch(t.status){case 200:case 201:case 204:this.notificationsService.success(this.translateService.get("person.page.orcid.sync-queue.send.success")),this.updateList();break;case 400:this.notificationsService.error(this.translateService.get("person.page.orcid.sync-queue.send.bad-request-error"),null,{timeOut:0});break;case 401:(0,k.z)([this.translateService.get("person.page.orcid.sync-queue.send.unauthorized-error.title"),this.getUnauthorizedErrorContent()]).subscribe(([n,i])=>{this.notificationsService.error(n,i,{timeOut:0},!0)});break;case 404:this.notificationsService.warning(this.translateService.get("person.page.orcid.sync-queue.send.not-found-warning"));break;case 409:this.notificationsService.error(this.translateService.get("person.page.orcid.sync-queue.send.conflict-error"),null,{timeOut:0});break;default:this.notificationsService.error(this.translateService.get("person.page.orcid.sync-queue.send.error"),null,{timeOut:0})}}handleValidationErrors(t){const n=[this.translateService.get("person.page.orcid.sync-queue.send.validation-error")],i=t.errorMessage;i&&i.indexOf("Error codes:")>0&&i.substring(i.indexOf(":")+1).trim().split(",").forEach(a=>n.push(this.translateService.get("person.page.orcid.sync-queue.send.validation-error."+a))),(0,k.z)(n).subscribe(a=>{const u=a.shift(),y="<ul>"+a.map(z=>`<li>${z}</li>`).join("")+"</ul>";this.notificationsService.error(u,y,{timeOut:0},!0)})}ngOnDestroy(){this.list$=null,this.subs.filter(t=>(0,d.a4)(t)).forEach(t=>t.unsubscribe())}static{this.\u0275fac=function(n){return new(n||s)(e.rXU(Y.r),e.rXU(at.OrcidQueueDataService),e.rXU(v.c$),e.rXU(rt.m),e.rXU(X.I),e.rXU(ot.OrcidHistoryDataService))}}static{this.\u0275cmp=e.VBU({type:s,selectors:[["ds-orcid-queue"]],inputs:{item:"item"},standalone:!0,features:[e.OA$,e.aNF],decls:13,vars:16,consts:[[1,"container"],[3,"type"],[3,"paginationOptions","collectionSize","retainScrollPosition","hideGear"],[3,"paginationChange","paginationOptions","collectionSize","retainScrollPosition","hideGear"],[1,"table-responsive"],["id","groups",1,"table","table-sm","table-striped","table-hover","table-bordered"],[1,"text-center","align-middle"],["data-test","orcidQueueElementRow"],[1,"text-center","align-middle",2,"width","15%"],["aria-hidden","true",1,"fa-2x",3,"ngClass","ngbTooltip"],[1,"text-center",2,"width","20%"],[1,"btn-group","edit-field"],["container","body",1,"btn","btn-outline-primary","my-1","col-md",3,"click","ngbTooltip"],[3,"ngClass"],[1,"sr-only"],["container","body",1,"btn","btn-outline-danger","my-1","col-md",3,"click","ngbTooltip"],[1,"fas","fa-unlink"]],template:function(n,i){if(1&n&&(e.j41(0,"div"),e.DNE(1,dt,1,0,"ds-loading"),e.nI1(2,"async"),e.j41(3,"div",0)(4,"h2"),e.EFF(5),e.nI1(6,"translate"),e.k0s(),e.DNE(7,ut,3,4,"ds-alert",1),e.nI1(8,"async"),e.nI1(9,"async"),e.DNE(10,mt,19,17,"ds-pagination",2),e.nI1(11,"async"),e.nI1(12,"async"),e.k0s()()),2&n){let a,u;e.R7$(),e.vxM(e.bMT(2,4,i.processing$)?1:-1),e.R7$(4),e.JRh(e.bMT(6,6,"person.orcid.registry.queue")),e.R7$(2),e.vxM(!0!==e.bMT(8,8,i.processing$)&&0===(null==(a=e.bMT(9,10,i.list$))||null==a.payload?null:a.payload.totalElements)?7:-1),e.R7$(3),e.vxM(!0!==e.bMT(11,12,i.processing$)&&(null==(u=e.bMT(12,14,i.list$))||null==u.payload?null:u.payload.totalElements)>0?10:-1)}},dependencies:[V.C,R.MD,R.YU,R.Jj,oe.n8,oe.md,ct.e,se.v,v.h,v.D9]})}}return s})();var G=o(56977),gt=o(89894);function ft(s,r){if(1&s&&(e.j41(0,"option",14),e.EFF(1),e.nI1(2,"translate"),e.k0s()),2&s){const t=r.$implicit;e.Y8G("value",t.value),e.R7$(),e.JRh(e.bMT(2,2,t.label))}}function vt(s,r){if(1&s){const t=e.RV6();e.j41(0,"div",18)(1,"input",24),e.mxI("ngModelChange",function(i){e.eBV(t);const a=e.XpG();return e.DH7(a.currentSyncPublications,i)||(a.currentSyncPublications=i),e.Njj(i)}),e.k0s(),e.j41(2,"label",25),e.EFF(3),e.nI1(4,"translate"),e.k0s()()}if(2&s){const t=r.$implicit,n=e.XpG();e.R7$(),e.Mz_("id","publicationOption_",t.value,""),e.R50("ngModel",n.currentSyncPublications),e.Y8G("value",t.value),e.R7$(),e.Mz_("for","publicationOption_",t.value,""),e.R7$(),e.JRh(e.bMT(4,7,t.label))}}function yt(s,r){if(1&s){const t=e.RV6();e.j41(0,"div",18)(1,"input",26),e.mxI("ngModelChange",function(i){e.eBV(t);const a=e.XpG();return e.DH7(a.currentSyncFunding,i)||(a.currentSyncFunding=i),e.Njj(i)}),e.k0s(),e.j41(2,"label",27),e.EFF(3),e.nI1(4,"translate"),e.k0s()()}if(2&s){const t=r.$implicit,n=e.XpG();e.R7$(),e.Mz_("id","fundingOption_",t.value,""),e.R50("ngModel",n.currentSyncFunding),e.Y8G("value",t.value),e.R7$(),e.Mz_("for","fundingOption_",t.value,""),e.R7$(),e.JRh(e.bMT(4,7,t.label))}}function bt(s,r){if(1&s){const t=e.RV6();e.j41(0,"div",18)(1,"input",28),e.mxI("ngModelChange",function(i){const a=e.eBV(t).$implicit;return e.DH7(a.checked,i)||(a.checked=i),e.Njj(i)}),e.k0s(),e.j41(2,"label",27),e.EFF(3),e.nI1(4,"translate"),e.k0s()()}if(2&s){const t=r.$implicit;e.R7$(),e.Mz_("name","syncProfile_",t.value,""),e.Mz_("id","profileOption_",t.value,""),e.R50("ngModel",t.checked),e.Y8G("value",t.value),e.R7$(),e.Mz_("for","profileOption_",t.value,""),e.R7$(),e.JRh(e.bMT(4,9,t.label))}}let _t=(()=>{class s{#e;#t;#n;constructor(t,n,i){this.researcherProfileService=t,this.notificationsService=n,this.translateService=i,this.AlertType=L.v,this.messagePrefix="person.page.orcid",this.settingsUpdated=new e.bkB,this.#e=new e.bkB,this.#t=new M.t(null)}set item(t){this.#t.next(t)}ngOnDestroy(){this.#e.next()}ngOnInit(){this.syncModes=[{label:this.messagePrefix+".synchronization-mode.batch",value:"BATCH"},{label:this.messagePrefix+".synchronization-mode.manual",value:"MANUAL"}],this.syncPublicationOptions=["DISABLED","ALL"].map(t=>({label:this.messagePrefix+".sync-publications."+t.toLowerCase(),value:t})),this.syncFundingOptions=["DISABLED","ALL"].map(t=>({label:this.messagePrefix+".sync-fundings."+t.toLowerCase(),value:t})),this.updateSyncProfileOptions(this.#t.asObservable()),this.updateSyncPreferences(this.#t.asObservable()),this.#n=this.#t.pipe((0,P.n)(t=>this.researcherProfileService.findByRelatedItem(t).pipe((0,l.qD)(),(0,J.W)(K.V7),(0,l.Bo)())),(0,G.Q)(this.#e))}onSubmit(t){const n=[];this.fillOperationsFor(n,"/orcid/mode",t.value.syncMode),this.fillOperationsFor(n,"/orcid/publications",t.value.syncPublications),this.fillOperationsFor(n,"/orcid/fundings",t.value.syncFundings);const i=this.syncProfileOptions.map(a=>a.value).filter(a=>t.value["syncProfile_"+a]).join(",");this.fillOperationsFor(n,"/orcid/profile",i),0!==n.length&&this.#n.pipe((0,P.n)(a=>this.researcherProfileService.patch(a,n)),(0,l.qD)(),(0,J.W)(K.V7),(0,j.s)(1)).subscribe(a=>{a.hasFailed?this.notificationsService.error(this.translateService.get(this.messagePrefix+".synchronization-settings-update.error")):(this.notificationsService.success(this.translateService.get(this.messagePrefix+".synchronization-settings-update.success")),this.settingsUpdated.emit())})}updateSyncPreferences(t){t.pipe((0,B.p)(d.a4),(0,p.T)(n=>this.getCurrentPreference(n,"dspace.orcid.sync-mode",["BATCH","MANUAL"],"MANUAL")),(0,G.Q)(this.#e)).subscribe(n=>this.currentSyncMode=n),t.pipe((0,B.p)(d.a4),(0,p.T)(n=>this.getCurrentPreference(n,"dspace.orcid.sync-publications",["DISABLED","ALL"],"DISABLED")),(0,G.Q)(this.#e)).subscribe(n=>this.currentSyncPublications=n),t.pipe((0,B.p)(d.a4),(0,p.T)(n=>this.getCurrentPreference(n,"dspace.orcid.sync-fundings",["DISABLED","ALL"],"DISABLED")),(0,G.Q)(this.#e)).subscribe(n=>this.currentSyncFunding=n)}updateSyncProfileOptions(t){t.pipe((0,B.p)(d.a4),(0,p.T)(n=>n.allMetadataValues("dspace.orcid.sync-profile")),(0,p.T)(n=>["BIOGRAPHICAL","IDENTIFIERS"].map(i=>({label:this.messagePrefix+".sync-profile."+i.toLowerCase(),value:i,checked:n.includes(i)}))),(0,G.Q)(this.#e)).subscribe(n=>this.syncProfileOptions=n)}getCurrentPreference(t,n,i,a){const u=t.firstMetadataValue(n);return u&&i.includes(u)?u:a}fillOperationsFor(t,n,i){t.push({path:n,op:"replace",value:i})}static{this.\u0275fac=function(n){return new(n||s)(e.rXU(gt.ResearcherProfileDataService),e.rXU(X.I),e.rXU(v.c$))}}static{this.\u0275cmp=e.VBU({type:s,selectors:[["ds-orcid-sync-setting"]],inputs:{item:"item"},outputs:{settingsUpdated:"settingsUpdated"},standalone:!0,features:[e.aNF],decls:74,vars:38,consts:[["f","ngForm"],[1,"container","mb-5"],[3,"ngSubmit"],[1,"row","mb-3"],[1,"col-md"],["data-test","sync-mode",1,"card"],[1,"card-header"],[1,"card-body"],[1,"container"],[1,"row"],[3,"type"],[1,"mb-3","row"],["for","syncMode",1,"form-label"],["name","syncMode","id","syncMode","required","",1,"form-select",3,"ngModelChange","ngModel"],[3,"value"],[1,"col-md","mb-3"],["data-test","sync-mode-publication",1,"card","h-100"],[1,"mb-3"],[1,"row","form-check"],["data-test","sync-mode-funding",1,"card","h-100"],["data-test","profile-preferences",1,"card","h-100"],[1,"col"],["type","submit",1,"btn","btn-primary","float-end"],[1,"fas","fa-edit"],["type","radio","name","syncPublications","required","",3,"ngModelChange","ngModel","id","value"],[1,"form-label",3,"for"],["type","radio","name","syncFundings","required","",3,"ngModelChange","ngModel","id","value"],[1,"ms-2","form-label",3,"for"],["type","checkbox",3,"ngModelChange","ngModel","name","id","value"]],template:function(n,i){if(1&n){const a=e.RV6();e.j41(0,"div",1)(1,"h2"),e.EFF(2),e.nI1(3,"translate"),e.k0s(),e.j41(4,"form",2,0),e.bIt("ngSubmit",function(){e.eBV(a);const y=e.sdS(5);return e.Njj(i.onSubmit(y.form))}),e.j41(6,"div",3)(7,"div",4)(8,"div",5)(9,"div",6),e.EFF(10),e.nI1(11,"translate"),e.k0s(),e.j41(12,"div",7)(13,"div",8)(14,"div",9)(15,"ds-alert",10),e.EFF(16),e.nI1(17,"translate"),e.k0s()(),e.j41(18,"div",11)(19,"label",12),e.EFF(20),e.nI1(21,"translate"),e.k0s(),e.j41(22,"select",13),e.mxI("ngModelChange",function(y){return e.eBV(a),e.DH7(i.currentSyncMode,y)||(i.currentSyncMode=y),e.Njj(y)}),e.Z7z(23,ft,3,4,"option",14,e.fX1),e.k0s()()()()()()(),e.j41(25,"div",9)(26,"div",15)(27,"div",16)(28,"div",6),e.EFF(29),e.nI1(30,"translate"),e.k0s(),e.j41(31,"div",7)(32,"div",8)(33,"div",9)(34,"ds-alert",10),e.EFF(35),e.nI1(36,"translate"),e.k0s()(),e.j41(37,"div",17),e.Z7z(38,vt,5,9,"div",18,e.fX1),e.k0s()()()()(),e.j41(40,"div",15)(41,"div",19)(42,"div",6),e.EFF(43),e.nI1(44,"translate"),e.k0s(),e.j41(45,"div",7)(46,"div",8)(47,"div",9)(48,"ds-alert",10),e.EFF(49),e.nI1(50,"translate"),e.k0s()(),e.j41(51,"div",17),e.Z7z(52,yt,5,9,"div",18,e.fX1),e.k0s()()()()(),e.j41(54,"div",15)(55,"div",20)(56,"div",6),e.EFF(57),e.nI1(58,"translate"),e.k0s(),e.j41(59,"div",7)(60,"div",8)(61,"div",9)(62,"ds-alert",10),e.EFF(63),e.nI1(64,"translate"),e.k0s()(),e.j41(65,"div",17),e.Z7z(66,bt,5,11,"div",18,e.fX1),e.k0s()()()()()(),e.j41(68,"div",9)(69,"div",21)(70,"button",22),e.nrm(71,"i",23),e.EFF(72),e.nI1(73,"translate"),e.k0s()()()()()}2&n&&(e.R7$(2),e.JRh(e.bMT(3,16,"person.orcid.sync.setting")),e.R7$(8),e.JRh(e.bMT(11,18,"person.page.orcid.synchronization-mode")),e.R7$(5),e.Y8G("type",i.AlertType.Info),e.R7$(),e.SpI(" ",e.bMT(17,20,"person.page.orcid.synchronization-mode-message")," "),e.R7$(4),e.JRh(e.bMT(21,22,"person.page.orcid.synchronization-mode.label")),e.R7$(2),e.R50("ngModel",i.currentSyncMode),e.R7$(),e.Dyx(i.syncModes),e.R7$(6),e.JRh(e.bMT(30,24,"person.page.orcid.publications-preferences")),e.R7$(5),e.Y8G("type",i.AlertType.Info),e.R7$(),e.SpI(" ",e.bMT(36,26,"person.page.orcid.synchronization-mode-publication-message")," "),e.R7$(3),e.Dyx(i.syncPublicationOptions),e.R7$(5),e.JRh(e.bMT(44,28,"person.page.orcid.funding-preferences")),e.R7$(5),e.Y8G("type",i.AlertType.Info),e.R7$(),e.SpI(" ",e.bMT(50,30,"person.page.orcid.synchronization-mode-funding-message")," "),e.R7$(3),e.Dyx(i.syncFundingOptions),e.R7$(5),e.JRh(e.bMT(58,32,"person.page.orcid.profile-preferences")),e.R7$(5),e.Y8G("type",i.AlertType.Info),e.R7$(),e.SpI(" ",e.bMT(64,34,"person.page.orcid.synchronization-mode-profile-message")," "),e.R7$(3),e.Dyx(i.syncProfileOptions),e.R7$(6),e.SpI(" ",e.bMT(73,36,"person.page.orcid.save.preference.changes")," "))},dependencies:[V.C,c.YN,c.qT,c.xH,c.y7,c.me,c.Zm,c.wz,c.Fm,c.BC,c.cb,c.YS,c.vS,c.cV,v.h,v.D9],styles:[".form-check[_ngcontent-%COMP%]   input[_ngcontent-%COMP%], .form-check[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{width:auto}"]})}}return s})();function Ct(s,r){1&s&&(e.nrm(0,"ds-loading",0),e.nI1(1,"translate")),2&s&&e.Y8G("message",e.bMT(1,1,"person.page.orcid.link.processing"))}function It(s,r){if(1&s&&(e.j41(0,"div",1)(1,"ds-alert",3),e.EFF(2),e.nI1(3,"translate"),e.k0s()()),2&s){const t=e.XpG();e.R7$(),e.Y8G("type",t.AlertType.Error),e.R7$(),e.JRh(e.bMT(3,2,"person.page.orcid.link.error.message"))}}function Ot(s,r){if(1&s){const t=e.RV6();e.j41(0,"ds-orcid-sync-setting",7),e.nI1(1,"async"),e.bIt("settingsUpdated",function(){e.eBV(t);const i=e.XpG(2);return e.Njj(i.updateItem())}),e.k0s()}if(2&s){const t=e.XpG(2);e.Y8G("item",e.bMT(1,1,t.item))}}function Tt(s,r){if(1&s&&(e.nrm(0,"ds-orcid-queue",6),e.nI1(1,"async")),2&s){const t=e.XpG(2);e.Y8G("item",e.bMT(1,1,t.item))}}function St(s,r){if(1&s){const t=e.RV6();e.j41(0,"ds-orcid-auth",4),e.nI1(1,"async"),e.bIt("unlink",function(){e.eBV(t);const i=e.XpG();return e.Njj(i.updateItem())}),e.k0s(),e.DNE(2,Ot,2,3,"ds-orcid-sync-setting",5)(3,Tt,2,3,"ds-orcid-queue",6)}if(2&s){const t=e.XpG();e.Y8G("item",e.bMT(1,3,t.item)),e.R7$(2),e.vxM(t.isLinkedToOrcid()?2:-1),e.R7$(),e.vxM(t.isLinkedToOrcid()?3:-1)}}function Rt(s,r){if(1&s&&(e.j41(0,"div",2)(1,"div",8)(2,"div",9)(3,"a",10),e.nrm(4,"i",11),e.EFF(5),e.nI1(6,"translate"),e.k0s()()()()),2&s){const t=e.XpG();e.R7$(3),e.Y8G("routerLink",t.getItemPage()),e.R7$(2),e.SpI(" ",e.bMT(6,2,"item.orcid.return")," ")}}let Mt=(()=>{class s{constructor(t,n,i,a,u,y){this.platformId=t,this.authService=n,this.itemService=i,this.orcidAuthService=a,this.route=u,this.router=y,this.AlertType=L.v,this.connectionStatus=new M.t(!1),this.item=new M.t(null),this.processingConnection=new M.t(!0)}ngOnInit(){if((0,R.UE)(this.platformId)){const t=this.route.queryParamMap.pipe((0,j.s)(1),(0,p.T)(i=>i.get("code"))),n=this.route.data.pipe((0,p.T)(i=>i.dso),(0,f.QD)(this.router,this.authService),(0,l.ak)());(0,k.z)([t,n]).subscribe(([i,a])=>{this.itemId=a.id,(0,d.hj)(i)?this.linkProfileToOrcid(a,i):(this.item.next(a),this.processingConnection.next(!1),this.connectionStatus.next(!0))})}}isLinkedToOrcid(){return this.orcidAuthService.isLinkedToOrcid(this.item.value)}getItemPage(){return(0,A._o)(this.item.value)}updateItem(){this.clearRouteParams(),this.itemService.findById(this.itemId,!1).pipe((0,l.qD)()).subscribe(t=>{t.hasSucceeded&&this.item.next(t.payload)})}linkProfileToOrcid(t,n){this.orcidAuthService.linkOrcidByItem(t,n).pipe((0,l.qD)()).subscribe(i=>{this.processingConnection.next(!1),i.hasSucceeded?(this.connectionStatus.next(!0),this.updateItem()):(this.item.next(t),this.connectionStatus.next(!1),this.clearRouteParams())})}clearRouteParams(){this.route.queryParamMap.pipe((0,B.p)(t=>(0,d.hj)(t.keys)),(0,p.T)(t=>Object.assign({})),(0,j.s)(1)).subscribe(t=>this.router.navigate([],{relativeTo:this.route,queryParams:t}))}static{this.\u0275fac=function(n){return new(n||s)(e.rXU(e.Agw),e.rXU(b.uR),e.rXU(x.ItemDataService),e.rXU(Y.r),e.rXU(m.nX),e.rXU(m.Ix))}}static{this.\u0275cmp=e.VBU({type:s,selectors:[["ds-orcid-page"]],standalone:!0,features:[e.aNF],decls:12,vars:20,consts:[[3,"message"],["data-test","error-box",1,"container"],[1,"container"],[3,"type"],["data-test","orcid-auth",3,"unlink","item"],["data-test","orcid-sync-setting",3,"item"],[3,"item"],["data-test","orcid-sync-setting",3,"settingsUpdated","item"],[1,"button-row","bottom","mb-3"],[1,"text-end"],["role","button","data-test","back-button",1,"btn","btn-outline-secondary",3,"routerLink"],[1,"fas","fa-arrow-left"]],template:function(n,i){1&n&&(e.DNE(0,Ct,2,3,"ds-loading",0),e.nI1(1,"async"),e.DNE(2,It,4,4,"div",1),e.nI1(3,"async"),e.nI1(4,"async"),e.DNE(5,St,4,5),e.nI1(6,"async"),e.nI1(7,"async"),e.nI1(8,"async"),e.DNE(9,Rt,7,4,"div",2),e.nI1(10,"async"),e.nI1(11,"async")),2&n&&(e.vxM(e.bMT(1,4,i.processingConnection)?0:-1),e.R7$(2),e.vxM(!0!==e.bMT(3,6,i.processingConnection)&&!0!==e.bMT(4,8,i.connectionStatus)?2:-1),e.R7$(3),e.vxM(!0!==e.bMT(6,10,i.processingConnection)&&e.bMT(7,12,i.item)&&e.bMT(8,14,i.connectionStatus)?5:-1),e.R7$(4),e.vxM(!0!==e.bMT(10,16,i.processingConnection)&&e.bMT(11,18,i.item)?9:-1))},dependencies:[V.C,R.Jj,nt,ht,_t,m.Wk,se.v,v.h,v.D9]})}}return s})();const Ft=(0,o(85360).L)(()=>ie.Z,()=>(0,N.of)(w._.CanSynchronizeWithORCID));var Dt=o(29710);o(43883);const Pt=["*"];function $t(s,r){}let Bt=(()=>{class s extends Dt.J{getComponentName(){return"ItemPageComponent"}importThemedComponent(t){return o(5729)(`./${t}/app/item-page/simple/item-page.component`)}importUnthemedComponent(){return Promise.resolve().then(o.bind(o,43883))}static{this.\u0275fac=(()=>{let t;return function(i){return(t||(t=e.xGo(s)))(i||s)}})()}static{this.\u0275cmp=e.VBU({type:s,selectors:[["ds-item-page"]],standalone:!0,features:[e.Vt3,e.aNF],ngContentSelectors:Pt,decls:5,vars:0,consts:[["vcr",""],["content",""]],template:function(n,i){1&n&&(e.NAR(),e.DNE(0,$t,0,0,"ng-template",null,0,e.C5r),e.j41(2,"div",null,1),e.SdG(4),e.k0s())},encapsulation:2})}}return s})();var jt=o(59640),ae=o(57439),At=o(10817);const Ut=[(0,o(4600).s)("item")],Xt=[{path:":id",resolve:{dso:ie.Z,itemRequest:S,breadcrumb:(s,r,t=(0,e.WQX)(_.U),n=(0,e.WQX)(x.ItemDataService))=>{const i=(0,O.U)();return(0,h.G)(s,r,t,n,...i)}},runGuardsAndResolvers:"always",children:[{path:"",component:Bt,pathMatch:"full",data:{menuRoute:D.r.ITEM_PAGE},resolve:{tracking:U.Y}},{path:"full",component:ne.i,data:{menuRoute:D.r.ITEM_PAGE},resolve:{tracking:U.Y}},{path:A.jU,loadChildren:()=>Promise.all([o.e(2313),o.e(1200),o.e(7502),o.e(9494),o.e(2033),o.e(2076),o.e(3932)]).then(o.bind(o,23932)).then(s=>s.ROUTES)},{path:A.aX,component:ze,canActivate:[E.t]},{path:g.RZ,component:Ce},{path:A._z,component:Mt,canActivate:[E.t,Ft]},{path:A.HN,component:ne.i,resolve:{menu:S}}]},{path:"version",children:[{path:":id",component:(()=>{class s{constructor(t,n,i,a){this.route=t,this.router=n,this.versionService=i,this.authService=a}ngOnInit(){this.versionRD$=this.route.data.pipe((0,p.T)(t=>t.dso),(0,f.QD)(this.router,this.authService)),this.versionRD$.pipe((0,l.ak)(),(0,P.n)(t=>t.item),(0,f.QD)(this.router,this.authService),(0,l.qD)()).subscribe(t=>{if(t.hasNoContent)this.router.navigateByUrl((0,g.EX)(),{skipLocationChange:!0});else{const n=(0,A._o)(t.payload);this.router.navigateByUrl(n)}})}static{this.\u0275fac=function(n){return new(n||s)(e.rXU(m.nX),e.rXU(m.Ix),e.rXU(ae.VersionDataService),e.rXU(b.uR))}}static{this.\u0275cmp=e.VBU({type:s,selectors:[["ds-version-page"]],standalone:!0,features:[e.aNF],decls:0,vars:0,template:function(n,i){}})}}return s})(),resolve:{dso:(s,r,t=(0,e.WQX)(ae.VersionDataService),n=(0,e.WQX)(jt.il))=>{const i=t.findById(s.params.id,!0,!1,...Ut).pipe((0,l.qD)());return i.subscribe(a=>{n.dispatch(new At.j(r.url,a.payload))}),i}}}]}]},55021:($,I,o)=>{"use strict";o.d(I,{Z:()=>O});var g=o(54438),e=o(7901),m=o(59640),p=o(96354),C=o(94196),d=o(61206),T=o(10817),f=o(19548),l=o(4093),b=o(89777),S=o(67849),E=o(92767);const O=(x,h,_=(0,g.WQX)(e.Ix),F=(0,g.WQX)(d.ItemDataService),D=(0,g.WQX)(m.il),U=(0,g.WQX)(C.uR))=>{const R=F.findById(x.params.id,!0,!1,...(0,S.U)()).pipe((0,l.qD)(),(0,f.QD)(_,U));return R.subscribe(c=>{D.dispatch(new T.j(h.url,c.payload))}),R.pipe((0,p.T)(c=>{if(c.hasSucceeded&&(0,b.a4)(c.payload)){const v=h.url,k=_.parseUrl((0,E._o)(c.payload)).toString();if(!v.startsWith(k)){const N=c.payload.uuid,B=v.substring(v.indexOf(N)+N.length,v.length);_.navigateByUrl(k+B)}}return c}))}},5729:($,I,o)=>{var g={"./custom/app/item-page/simple/item-page.component":[31614,1614]};function e(m){if(!o.o(g,m))return Promise.resolve().then(()=>{var d=new Error("Cannot find module '"+m+"'");throw d.code="MODULE_NOT_FOUND",d});var p=g[m],C=p[0];return o.e(p[1]).then(()=>o(C))}e.keys=()=>Object.keys(g),e.id=5729,$.exports=e}}]);