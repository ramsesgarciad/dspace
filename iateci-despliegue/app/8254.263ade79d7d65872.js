(self.webpackChunkdspace_angular=self.webpackChunkdspace_angular||[]).push([[8254],{13260:(O,g,e)=>{"use strict";e.d(g,{f:()=>m});var d=e(21626),p=e(5964),S=e(96354),C=e(47677),v=e(89777),t=e(57775),D=e(7094),L=e(4093),M=e(88906),j=e(76456),I=e(54438);let f=(()=>{class h{parse(s,r){const c=r.payload,l=Object.assign(new M.cH,c);return new j.hT(r.statusCode,void 0,l)}static{this.\u0275fac=function(r){return new(r||h)}}static{this.\u0275prov=I.jDH({token:h,factory:h.\u0275fac,providedIn:"root"})}}return h})();var R=e(49755),P=e(3601);let m=(()=>{class h{constructor(s,r,c){this.requestService=s,this.rdbService=r,this.halService=c,this.linkPath="registrations",this.searchByTokenPath="/search/findByToken?token="}getRegistrationEndpoint(){return this.halService.getEndpoint(this.linkPath)}getTokenSearchEndpoint(s){return this.halService.getEndpoint(this.linkPath).pipe((0,p.p)(r=>(0,v.hj)(r)),(0,S.T)(r=>`${r}${this.searchByTokenPath}${s}`))}registerEmail(s,r=null,c){const l=new M.cH;l.email=s;const T=this.requestService.generateRequestId(),F=this.getRegistrationEndpoint(),U=Object.create({});let E=new d.Lr;return r&&(E=E.append("x-captcha-payload",r)),U.headers=E,(0,v.a4)(c)&&(U.params=c?new d.Nl({fromString:"accountRequestType="+c}):new d.Nl),F.pipe((0,C.I)(b=>(0,v.a4)(b)),(0,S.T)(b=>{const k=new R.Qf(T,b,l,U);this.requestService.send(k)})).subscribe(),this.rdbService.buildFromRequestUUID(T).pipe((0,L.qD)())}searchByTokenAndUpdateData(s){const r=this.requestService.generateRequestId(),c=this.getTokenSearchEndpoint(s).pipe((0,C.I)(l=>(0,v.a4)(l)));return c.subscribe(l=>{const T=new R.IP(r,l);Object.assign(T,{getResponseParser:()=>f}),this.requestService.send(T,!0)}),this.rdbService.buildSingle(c).pipe((0,S.T)(l=>l.hasSucceeded&&(0,v.a4)(l.payload)?Object.assign(l,{payload:Object.assign(new M.cH,{email:l.payload.email,token:s,user:l.payload.user})}):l))}searchByTokenAndHandleError(s){const r=this.requestService.generateRequestId(),c=this.getTokenSearchEndpoint(s).pipe((0,C.I)(l=>(0,v.a4)(l)));return c.subscribe(l=>{const T=new R.IP(r,l);Object.assign(T,{getResponseParser:()=>f}),this.requestService.send(T,!0)}),this.rdbService.buildSingle(c)}patchUpdateRegistration(s,r,c,l,T){const F=this.requestService.generateRequestId();return this.getRegistrationEndpoint().pipe((0,C.I)(E=>(0,v.a4)(E)),(0,S.T)(E=>`${E}/${c}?token=${l}`)).subscribe(E=>{const b=this.generateOperations(s,r,T),k=new R.EA(F,E,b);this.requestService.send(k)}),this.rdbService.buildFromRequestUUID(F)}generateOperations(s,r,c){let l=[];return s.length>0&&(0,v.a4)(r)&&(l=[{op:c,path:`/${r}`,value:s}]),l}static{this.\u0275fac=function(r){return new(r||h)(I.KVO(P.B),I.KVO(t.o),I.KVO(D.Y))}}static{this.\u0275prov=I.jDH({token:h,factory:h.\u0275fac,providedIn:"root"})}}return h})()},16745:(O,g,e)=>{"use strict";e.r(g),e.d(g,{ExternalLoginPageComponent:()=>nt});var d=e(60177),p=e(68018),S=e(61594),C=e(88141),v=e(96354),t=e(54438),D=e(94196),L=e(14563),j=(e(88906),e(64972)),I=e(74082),f=e(89777),R=e(20044),P=e(9129),m=e(89417),h=e(48125),A=e.n(h),s=e(84572),r=e(96697),c=e(13817),l=e(89253),T=e(19252),F=e(4093),U=e(9847),E=e(26074),b=e(95488);function k(i,x){1&i&&(t.j41(0,"div",5),t.EFF(1),t.nI1(2,"translate"),t.k0s()),2&i&&(t.R7$(),t.SpI(" ",t.bMT(2,1,"external-login.confirmation.email-required")," "))}function B(i,x){1&i&&(t.j41(0,"div",5),t.EFF(1),t.nI1(2,"translate"),t.k0s()),2&i&&(t.R7$(),t.SpI(" ",t.bMT(2,1,"external-login.confirmation.email-invalid")," "))}let G=(()=>{class i{constructor(n,o,a,u,y,$,X,N){this._window=n,this.formBuilder=o,this.externalLoginService=a,this.epersonDataService=u,this.notificationService=y,this.translate=$,this.authService=X,this.hardRedirectService=N,this.subs=[]}ngOnInit(){this.emailForm=this.formBuilder.group({email:[this.registrationData.email,[m.k0.required,m.k0.email]]})}submitForm(){if(this.emailForm.markAllAsTouched(),this.emailForm.valid){const n=this.emailForm.get("email").value;n&&A()(this.registrationData.email,n.trim())?this.postCreateAccountFromToken(this.token,this.registrationData):this.patchUpdateRegistration([n])}}patchUpdateRegistration(n){this.subs.push(this.externalLoginService.patchUpdateRegistration(n,"email",this.registrationData.id,this.token,"replace").pipe((0,F.Bo)()).subscribe())}postCreateAccountFromToken(n,o){if((0,f.Tn)(this.registrationData.netId))return void this.notificationService.error(this.translate.get("external-login-page.confirm-email.create-account.notifications.error.no-netId"));const a={};for(const[y,$]of Object.entries(o.registrationMetadata))(0,f.a4)($[0]?.value)&&"email"!==y&&(a[y]=$);const u=new l.f;u.email=o.email,u.netid=o.netId,u.metadata=a,u.canLogIn=!0,u.requireCertificate=!1,u.selfRegistered=!0,this.subs.push((0,s.z)([this.epersonDataService.createEPersonForToken(u,n).pipe((0,F.qD)()),this.externalLoginService.getExternalAuthLocation(this.registrationData.registrationType),this.authService.getRedirectUrl().pipe((0,r.s)(1))]).subscribe(([y,$,X])=>{if(y.hasFailed)this.notificationService.error(this.translate.get("external-login-page.provide-email.create-account.notifications.error.header"),this.translate.get("external-login-page.provide-email.create-account.notifications.error.content"));else if(y.hasSucceeded){this.authService.setRedirectUrl("/profile");const N=this.authService.getExternalServerRedirectUrl(this._window.nativeWindow.origin,X,$);this.hardRedirectService.redirect(N)}}))}ngOnDestroy(){this.subs.filter(n=>(0,f.a4)(n)).forEach(n=>n.unsubscribe())}static{this.\u0275fac=function(o){return new(o||i)(t.rXU(T.lc),t.rXU(m.ok),t.rXU(E.u),t.rXU(c.EPersonDataService),t.rXU(U.I),t.rXU(p.c$),t.rXU(D.uR),t.rXU(b.$))}}static{this.\u0275cmp=t.VBU({type:i,selectors:[["ds-confirm-email"]],inputs:{registrationData:"registrationData",token:"token"},standalone:!0,features:[t.aNF],decls:16,vars:12,consts:[[3,"ngSubmit","formGroup"],[1,"mb-3"],[1,"row"],[1,"col-12","my-2"],["type","email","id","email","formControlName","email","placeholder","profile.email@example.com",1,"form-control","form-control-lg","position-relative"],[1,"text-danger"],[1,"col-12"],["type","submit",1,"btn","btn-lg","btn-primary","w-100"]],template:function(o,a){1&o&&(t.j41(0,"h4"),t.EFF(1),t.nI1(2,"translate"),t.k0s(),t.j41(3,"form",0),t.bIt("ngSubmit",function(){return a.submitForm()}),t.j41(4,"div",1)(5,"div",2)(6,"div",3),t.nrm(7,"input",4),t.nI1(8,"translate"),t.DNE(9,k,3,3,"div",5)(10,B,3,3,"div",5),t.k0s()(),t.j41(11,"div",2)(12,"div",6)(13,"button",7),t.EFF(14),t.nI1(15,"translate"),t.k0s()()()()()),2&o&&(t.R7$(),t.SpI(" ",t.bMT(2,6,"external-login.confirm-email.header"),"\n"),t.R7$(2),t.Y8G("formGroup",a.emailForm),t.R7$(4),t.BMQ("aria-label",t.bMT(8,8,"external-login.confirmation.email-label")),t.R7$(2),t.vxM(a.emailForm.get("email").hasError("required")&&a.emailForm.get("email").touched?9:-1),t.R7$(),t.vxM(a.emailForm.get("email").hasError("email")&&a.emailForm.get("email").touched?10:-1),t.R7$(4),t.SpI(" ",t.bMT(15,10,"external-login.confirm.button.label")," "))},dependencies:[m.X1,m.qT,m.me,m.BC,m.cb,m.j4,m.JD,p.h,p.D9],changeDetection:0})}}return i})();function V(i,x){1&i&&(t.j41(0,"div",5),t.EFF(1),t.nI1(2,"translate"),t.k0s()),2&i&&(t.R7$(),t.SpI(" ",t.bMT(2,1,"external-login.confirmation.email-required")," "))}function Y(i,x){1&i&&(t.j41(0,"div",5),t.EFF(1),t.nI1(2,"translate"),t.k0s()),2&i&&(t.R7$(),t.SpI(" ",t.bMT(2,1,"external-login.confirmation.email-invalid")," "))}let W=(()=>{class i{constructor(n,o){this.formBuilder=n,this.externalLoginService=o,this.subs=[],this.emailForm=this.formBuilder.group({email:["",[m.k0.required,m.k0.email]]})}submitForm(){if(this.emailForm.markAllAsTouched(),this.emailForm.valid){const n=this.emailForm.get("email").value;this.subs.push(this.externalLoginService.patchUpdateRegistration([n],"email",this.registrationId,this.token,"add").subscribe())}}ngOnDestroy(){this.subs.filter(n=>(0,f.a4)(n)).forEach(n=>n.unsubscribe())}static{this.\u0275fac=function(o){return new(o||i)(t.rXU(m.ok),t.rXU(E.u))}}static{this.\u0275cmp=t.VBU({type:i,selectors:[["ds-provide-email"]],inputs:{registrationId:"registrationId",token:"token"},standalone:!0,features:[t.aNF],decls:16,vars:12,consts:[[3,"ngSubmit","formGroup"],[1,"mb-3"],[1,"row"],[1,"col-12","my-2"],["type","email","id","email","formControlName","email",1,"form-control","form-control-lg","position-relative"],[1,"text-danger"],[1,"col-12"],["type","submit",1,"btn","btn-lg","btn-primary","w-100"]],template:function(o,a){1&o&&(t.j41(0,"h4"),t.EFF(1),t.nI1(2,"translate"),t.k0s(),t.j41(3,"form",0),t.bIt("ngSubmit",function(){return a.submitForm()}),t.j41(4,"div",1)(5,"div",2)(6,"div",3),t.nrm(7,"input",4),t.nI1(8,"translate"),t.DNE(9,V,3,3,"div",5)(10,Y,3,3,"div",5),t.k0s()(),t.j41(11,"div",2)(12,"div",6)(13,"button",7),t.EFF(14),t.nI1(15,"translate"),t.k0s()()()()()),2&o&&(t.R7$(),t.SpI(" ",t.bMT(2,6,"external-login.provide-email.header"),"\n"),t.R7$(2),t.Y8G("formGroup",a.emailForm),t.R7$(4),t.BMQ("aria-label",t.bMT(8,8,"external-login.confirmation.email")),t.R7$(2),t.vxM(a.emailForm.get("email").hasError("required")&&a.emailForm.get("email").touched?9:-1),t.R7$(),t.vxM(a.emailForm.get("email").hasError("email")&&a.emailForm.get("email").touched?10:-1),t.R7$(4),t.SpI(" ",t.bMT(15,10,"external-login.provide-email.button.label")," "))},dependencies:[m.X1,m.qT,m.me,m.BC,m.cb,m.j4,m.JD,p.h,p.D9],changeDetection:0})}}return i})();var H=e(58003);function J(i,x){1&i&&t.eu8(0)}function Q(i,x){if(1&i&&t.nrm(0,"ds-confirm-email",8),2&i){const n=t.XpG();t.Y8G("registrationData",n.registrationData)("token",n.token)}}function z(i,x){if(1&i&&t.nrm(0,"ds-provide-email",9),2&i){const n=t.XpG();t.Y8G("registrationId",n.registrationData.id)("token",n.token)}}function K(i,x){if(1&i){const n=t.RV6();t.j41(0,"div",10)(1,"h4",11),t.EFF(2),t.nI1(3,"translate"),t.k0s()(),t.j41(4,"div",7)(5,"button",12),t.bIt("click",function(){t.eBV(n);const a=t.XpG(),u=t.sdS(16);return t.Njj(a.openLoginModal(u))}),t.EFF(6),t.nI1(7,"translate"),t.k0s()()}2&i&&(t.R7$(2),t.JRh(t.bMT(3,2,"external-login.component.or")),t.R7$(4),t.SpI(" ",t.bMT(7,4,"external-login.connect-to-existing-account.label")," "))}function Z(i,x){if(1&i){const n=t.RV6();t.j41(0,"div",13)(1,"h4",14),t.EFF(2),t.nI1(3,"translate"),t.k0s()(),t.j41(4,"div",15)(5,"div",2),t.nrm(6,"ds-log-in",16),t.k0s()(),t.j41(7,"div",17)(8,"button",18),t.bIt("click",function(){const a=t.eBV(n).close,u=t.XpG();return a("Close click"),t.Njj(u.clearRedirectUrl())}),t.nrm(9,"i",19),t.EFF(10),t.nI1(11,"translate"),t.k0s()()}if(2&i){const n=t.XpG();t.R7$(2),t.SpI(" ",t.bMT(3,5,"external-login.connect-to-existing-account.label"),""),t.R7$(4),t.Y8G("excludedAuthMethod",n.relatedAuthMethod)("showRegisterLink",!1)("isStandalonePage",!0),t.R7$(4),t.SpI(" ",t.bMT(11,7,"external-login.modal.label.close")," ")}}let q=(()=>{class i{constructor(n,o,a,u,y){this.injector=n,this.translate=o,this.modalService=a,this.authService=u,this.authMethodsService=y,this.AlertTypeEnum=I.v,this.informationText=""}ngOnInit(){this.objectInjector=t.zZn.create({providers:[{provide:"registrationDataProvider",useFactory:()=>this.registrationData,deps:[]}],parent:this.injector}),this.registrationType=this.registrationData?.registrationType??null,this.relatedAuthMethod=(0,f.Im)(this.registrationType)?null:this.registrationType.replace("VALIDATION_","").toLocaleLowerCase(),this.informationText=(0,f.a4)(this.registrationData?.email)?this.generateInformationTextWhenEmail(this.registrationType):this.generateInformationTextWhenNOEmail(this.registrationType),this.hasAuthMethodTypes=this.authMethodsService.getAuthMethods(this.authMethods,this.relatedAuthMethod).pipe((0,v.T)(n=>n.length>0))}getExternalLoginConfirmationType(){return(0,P.Mx)(this.registrationType)}openLoginModal(n){this.modalRef=this.modalService.open(n),this.authService.setRedirectUrl(`/review-account/${this.token}`),this.modalRef.dismissed.subscribe(()=>{this.clearRedirectUrl()})}clearRedirectUrl(){this.authService.clearRedirectUrl()}ngOnDestroy(){this.modalRef?.close()}generateInformationTextWhenNOEmail(n){if(n){const o=n.toUpperCase();return this.translate.instant("external-login.noEmail.informationText",{authMethod:o})}}generateInformationTextWhenEmail(n){if(n){const o=n.toUpperCase();return this.translate.instant("external-login.haveEmail.informationText",{authMethod:o})}}static{this.\u0275fac=function(o){return new(o||i)(t.rXU(t.zZn),t.rXU(p.c$),t.rXU(H.Bq),t.rXU(D.uR),t.rXU(L.q))}}static{this.\u0275cmp=t.VBU({type:i,selectors:[["ds-external-log-in"]],inputs:{registrationData:"registrationData",token:"token",authMethods:"authMethods"},standalone:!0,features:[t.aNF],decls:17,vars:12,consts:[["loginModal",""],[1,"row"],[1,"row","justify-content-center"],[4,"ngComponentOutlet","ngComponentOutletInjector"],[1,"container","mt-2",3,"type"],[1,"row","d-flex","justify-content-center"],[1,"col-6","d-flex"],[1,"col","d-flex","justify-content-center","align-items-center"],[3,"registrationData","token"],[3,"registrationId","token"],[1,"col-1","d-flex","justify-content-center","align-items-center"],[1,"mt-2"],["data-test","open-modal",1,"btn","block","btn-lg","btn-primary",3,"click"],[1,"modal-header"],[1,"modal-title","text-info"],[1,"modal-body"],[3,"excludedAuthMethod","showRegisterLink","isStandalonePage"],[1,"modal-footer"],["type","button",1,"btn","btn-outline-primary","btn-sm",3,"click"],["aria-hidden","true",1,"fa","fa-times"]],template:function(o,a){1&o&&(t.j41(0,"div",1)(1,"h4"),t.EFF(2),t.nI1(3,"translate"),t.k0s()(),t.j41(4,"div",2),t.DNE(5,J,1,0,"ng-container",3),t.k0s(),t.j41(6,"ds-alert",4),t.EFF(7),t.k0s(),t.j41(8,"div",5)(9,"div",6)(10,"div",7),t.DNE(11,Q,1,2,"ds-confirm-email",8)(12,z,1,2,"ds-provide-email",9),t.k0s(),t.DNE(13,K,8,6),t.nI1(14,"async"),t.k0s()(),t.DNE(15,Z,12,9,"ng-template",null,0,t.C5r)),2&o&&(t.R7$(2),t.JRh(t.bMT(3,8,"external-login.confirmation.header")),t.R7$(3),t.Y8G("ngComponentOutlet",a.getExternalLoginConfirmationType())("ngComponentOutletInjector",a.objectInjector),t.R7$(),t.Y8G("type",a.AlertTypeEnum.Info),t.BMQ("data-test","info-text"),t.R7$(),t.SpI(" ",a.informationText,"\n"),t.R7$(4),t.vxM(a.registrationData.email?11:12),t.R7$(2),t.vxM(t.bMT(14,10,a.hasAuthMethodTypes)?13:-1))},dependencies:[j.C,d.Jj,G,d.OI,W,R.W,p.h,p.D9],changeDetection:0})}}return i})();var w=e(87908),_=e(7901);function tt(i,x){if(1&i&&t.nrm(0,"ds-external-log-in",1),2&i){const n=t.XpG();t.Y8G("authMethods",n.authMethods)("registrationData",x)("token",n.token)}}function et(i,x){if(1&i&&(t.nrm(0,"ds-alert",2),t.nI1(1,"translate")),2&i){const n=t.XpG();t.Y8G("type",n.AlertTypeEnum.Error)("content",t.bMT(1,2,"external-login.error.notification"))}}let nt=(()=>{class i{constructor(n){this.arouter=n,this.AlertTypeEnum=I.v,this.hasErrors=!1,this.token=this.arouter.snapshot.params.token,this.hasErrors=(0,f.Tn)(this.arouter.snapshot.params.token),this.authMethods=w.y}ngOnInit(){this.registrationData$=this.arouter.data.pipe((0,S.$)(),(0,C.M)(n=>this.hasErrors=n.registrationData.hasFailed),(0,v.T)(n=>n.registrationData.payload))}static{this.\u0275fac=function(o){return new(o||i)(t.rXU(_.nX))}}static{this.\u0275cmp=t.VBU({type:i,selectors:[["ng-component"]],standalone:!0,features:[t.aNF],decls:4,vars:4,consts:[[1,"container"],[3,"authMethods","registrationData","token"],[3,"type","content"]],template:function(o,a){if(1&o&&(t.j41(0,"div",0),t.DNE(1,tt,1,3,"ds-external-log-in",1),t.nI1(2,"async"),t.DNE(3,et,2,4,"ds-alert",2),t.k0s()),2&o){let u;t.R7$(),t.vxM((u=t.bMT(2,2,a.registrationData$))?1:-1,u),t.R7$(2),t.vxM(a.hasErrors?3:-1)}},dependencies:[j.C,d.Jj,q,p.h,p.D9]})}}return i})()},98254:(O,g,e)=>{"use strict";e.r(g),e.d(g,{ROUTES:()=>m});var d=e(54438),p=e(7901),S=e(96354),C=e(7673),v=e(13260),t=e(4093),D=e(89777),M=e(16373),j=e(29710);e(16745);const f=["*"];function R(h,A){}const m=[{path:"",pathMatch:"full",component:(()=>{class h extends j.J{getComponentName(){return"ExternalLoginPageComponent"}importThemedComponent(s){return e(41018)(`./${s}/app/external-login-page/external-login-page.component`)}importUnthemedComponent(){return Promise.resolve().then(e.bind(e,16745))}static{this.\u0275fac=(()=>{let s;return function(c){return(s||(s=d.xGo(h)))(c||h)}})()}static{this.\u0275cmp=d.VBU({type:h,selectors:[["ds-external-login-page"]],standalone:!0,features:[d.Vt3,d.aNF],ngContentSelectors:f,decls:5,vars:0,consts:[["vcr",""],["content",""]],template:function(r,c){1&r&&(d.NAR(),d.DNE(0,R,0,0,"ng-template",null,0,d.C5r),d.j41(2,"div",null,1),d.SdG(4),d.k0s())},encapsulation:2})}}return h})(),canActivate:[(h,A)=>{const s=(0,d.WQX)(v.f),r=(0,d.WQX)(p.Ix);return h.params.token?s.searchByTokenAndHandleError(h.params.token).pipe((0,t.qD)(),(0,S.T)(c=>{if(c.hasSucceeded&&(0,D.a4)(c))return!0;r.navigate(["/404"])})):(r.navigate(["/404"]),(0,C.of)(!1))}],resolve:{registrationData:M.Q}}]},41018:O=>{function g(e){return Promise.resolve().then(()=>{var d=new Error("Cannot find module '"+e+"'");throw d.code="MODULE_NOT_FOUND",d})}g.keys=()=>[],g.resolve=g,g.id=41018,O.exports=g}}]);